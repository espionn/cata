{"version":3,"file":"preset_utils-BI4Zd4bY.chunk.js","sources":["../../../ui/core/party.ts","../../../ui/core/encounter.ts","../../../ui/core/raid.ts","../../../ui/core/worker_pool.ts","../../../ui/core/sim.ts","../../../ui/core/components/copy_button.tsx","../../../ui/core/components/base_modal.tsx","../../../ui/core/components/content_block.tsx","../../../ui/core/css_utils.ts","../../../ui/core/talents/glyphs_picker.tsx","../../../ui/core/talents/talents_picker.tsx","../../../ui/core/talents/death_knight.ts","../../../ui/core/talents/druid.ts","../../../ui/core/talents/hunter.ts","../../../ui/core/talents/mage.ts","../../../ui/core/talents/paladin.ts","../../../ui/core/talents/priest.ts","../../../ui/core/talents/rogue.ts","../../../ui/core/talents/shaman.ts","../../../ui/core/talents/warlock.ts","../../../ui/core/talents/warrior.ts","../../../ui/core/talents/factory.ts","../../../ui/core/player.ts","../../../ui/core/components/icon_enum_picker.tsx","../../../ui/core/components/icon_picker.tsx","../../../ui/core/components/input_helpers.ts","../../../ui/core/components/icon_inputs.ts","../../../ui/core/components/multi_icon_picker.ts","../../../ui/core/components/inputs/buffs_debuffs.ts","../../../ui/core/components/enum_picker.ts","../../../ui/core/components/other_inputs.ts","../../../ui/core/components/number_picker.ts","../../../ui/core/components/character_stats.tsx","../../../ui/core/components/importers.ts","../../../ui/core/components/exporters.tsx","../../../ui/core/proto_utils/enchants.ts","../../../ui/core/components/filters_menu.ts","../../../ui/core/components/virtual_scroll/clusterize.ts","../../../ui/core/components/gear_picker.tsx","../../../ui/core/components/results_viewer.tsx","../../../ui/core/components/sim_tab.ts","../../../ui/core/components/individual_sim_ui/bulk_tab.ts","../../../ui/core/components/saved_data_manager.ts","../../../ui/core/components/individual_sim_ui/gem_summary.ts","../../../ui/core/components/individual_sim_ui/gear_tab.ts","../../../ui/core/constants/tooltips.ts","../../../ui/core/components/list_picker.tsx","../../../ui/core/components/string_picker.ts","../../../ui/core/components/individual_sim_ui/apl_helpers.ts","../../../ui/core/components/individual_sim_ui/apl_values.ts","../../../ui/core/components/individual_sim_ui/apl_actions.ts","../../../ui/core/components/individual_sim_ui/apl_rotation_picker.ts","../../../ui/core/components/number_list_picker.ts","../../../ui/core/components/individual_sim_ui/cooldowns_picker.ts","../../../ui/core/components/individual_sim_ui/rotation_tab.ts","../../../ui/core/components/encounter_picker.ts","../../../ui/core/components/inputs/stat_options.ts","../../../ui/core/components/item_swap_picker.tsx","../../../ui/core/components/inputs/consumables.ts","../../../ui/core/components/individual_sim_ui/consumes_picker.ts","../../../ui/core/components/individual_sim_ui/settings_tab.ts","../../../ui/core/talents/hunter_pet.tsx","../../../ui/core/components/individual_sim_ui/talents_tab.ts","../../../ui/core/components/stat_weights_action.ts","../../../ui/core/launched_sims.ts","../../../ui/core/components/settings_menu.ts","../../../ui/core/components/social_links.tsx","../../../ui/core/components/sim_header.tsx","../../../ui/core/components/sim_title_dropdown.ts","../../../ui/core/sim_ui.ts","../../../ui/core/individual_sim_ui.ts","../../../ui/core/preset_utils.ts"],"sourcesContent":["import { Player } from './player.js';\nimport { Party as PartyProto, Player as PlayerProto } from './proto/api.js';\nimport { Class, PartyBuffs } from './proto/common.js';\nimport { getPlayerSpecFromPlayer } from './proto_utils/utils.js';\nimport { Raid } from './raid.js';\nimport { Sim } from './sim.js';\nimport { EventID, TypedEvent } from './typed_event.js';\n\nexport const MAX_PARTY_SIZE = 5;\n\n// Manages all the settings for a single Party.\nexport class Party {\n\treadonly sim: Sim;\n\treadonly raid: Raid;\n\n\tprivate buffs: PartyBuffs = PartyBuffs.create();\n\n\t// Emits when a party member is added/removed/moved.\n\treadonly compChangeEmitter = new TypedEvent<void>();\n\n\treadonly buffsChangeEmitter = new TypedEvent<void>();\n\n\t// Emits when anything in the party changes.\n\treadonly changeEmitter: TypedEvent<void>;\n\n\t// Should always hold exactly MAX_PARTY_SIZE elements.\n\tprivate players: Array<Player<any> | null>;\n\n\tprivate readonly playerChangeListener: (eventID: EventID) => void;\n\n\tconstructor(raid: Raid, sim: Sim) {\n\t\tthis.sim = sim;\n\t\tthis.raid = raid;\n\t\tthis.players = [...Array(MAX_PARTY_SIZE).keys()].map(_i => null);\n\t\tthis.playerChangeListener = eventID => this.changeEmitter.emit(eventID);\n\n\t\tthis.changeEmitter = TypedEvent.onAny([this.compChangeEmitter, this.buffsChangeEmitter], 'PartyChange');\n\t}\n\n\tsize(): number {\n\t\treturn this.players.filter(player => player != null).length;\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this.size() == 0;\n\t}\n\n\tclear(eventID: EventID) {\n\t\tthis.setBuffs(eventID, PartyBuffs.create());\n\t\tfor (let i = 0; i < MAX_PARTY_SIZE; i++) {\n\t\t\tthis.setPlayer(eventID, i, null);\n\t\t}\n\t}\n\n\t// Returns this party's index within the raid [0-4].\n\tgetIndex(): number {\n\t\treturn this.raid.getParties().indexOf(this);\n\t}\n\n\tgetPlayers(): Array<Player<any> | null> {\n\t\t// Make defensive copy.\n\t\treturn this.players.slice();\n\t}\n\n\tgetPlayer(playerIndex: number): Player<any> | null {\n\t\treturn this.players[playerIndex];\n\t}\n\n\tsetPlayer(eventID: EventID, playerIndex: number, newPlayer: Player<any> | null) {\n\t\tif (playerIndex < 0 || playerIndex >= MAX_PARTY_SIZE) {\n\t\t\tthrow new Error('Invalid player index: ' + playerIndex);\n\t\t}\n\n\t\tif (newPlayer == this.players[playerIndex]) {\n\t\t\treturn;\n\t\t}\n\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tconst oldPlayer = this.players[playerIndex];\n\t\t\tif (oldPlayer != null) {\n\t\t\t\toldPlayer.changeEmitter.off(this.playerChangeListener);\n\t\t\t\toldPlayer.setParty(null);\n\t\t\t}\n\t\t\tif (newPlayer != null) {\n\t\t\t\tconst newPlayerOldParty = newPlayer.getParty();\n\t\t\t\tif (newPlayerOldParty) {\n\t\t\t\t\tnewPlayerOldParty.setPlayer(eventID, newPlayer.getPartyIndex(), null);\n\t\t\t\t}\n\t\t\t\tthis.players[playerIndex] = newPlayer;\n\t\t\t\tnewPlayer.changeEmitter.on(this.playerChangeListener);\n\t\t\t\tnewPlayer.setParty(this);\n\t\t\t} else {\n\t\t\t\tthis.players[playerIndex] = null;\n\t\t\t}\n\n\t\t\tthis.compChangeEmitter.emit(eventID);\n\t\t});\n\t}\n\n\tgetBuffs(): PartyBuffs {\n\t\t// Make a defensive copy\n\t\treturn PartyBuffs.clone(this.buffs);\n\t}\n\n\tsetBuffs(eventID: EventID, newBuffs: PartyBuffs) {\n\t\tif (PartyBuffs.equals(this.buffs, newBuffs)) return;\n\n\t\t// Make a defensive copy\n\t\tthis.buffs = PartyBuffs.clone(newBuffs);\n\t\tthis.buffsChangeEmitter.emit(eventID);\n\t}\n\n\ttoProto(forExport?: boolean, forSimming?: boolean): PartyProto {\n\t\treturn PartyProto.create({\n\t\t\tplayers: this.players.map(player => (player == null ? PlayerProto.create() : player.toProto(forExport, forSimming))),\n\t\t\tbuffs: this.buffs,\n\t\t});\n\t}\n\n\tfromProto(eventID: EventID, proto: PartyProto) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.setBuffs(eventID, proto.buffs || PartyBuffs.create());\n\n\t\t\tfor (let i = 0; i < MAX_PARTY_SIZE; i++) {\n\t\t\t\tif (!proto.players[i] || proto.players[i].class == Class.ClassUnknown) {\n\t\t\t\t\tthis.setPlayer(eventID, i, null);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst playerProto = proto.players[i];\n\t\t\t\tconst spec = getPlayerSpecFromPlayer(playerProto);\n\t\t\t\tconst currentPlayer = this.players[i];\n\n\t\t\t\t// Reuse the current player if possible, so that event handlers are preserved.\n\t\t\t\tif (currentPlayer && spec == currentPlayer.getSpec()) {\n\t\t\t\t\tcurrentPlayer.fromProto(eventID, playerProto);\n\t\t\t\t} else {\n\t\t\t\t\tconst newPlayer = new Player(spec, this.sim);\n\t\t\t\t\tnewPlayer.fromProto(eventID, playerProto);\n\t\t\t\t\tthis.setPlayer(eventID, i, newPlayer);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n","import * as Mechanics from './constants/mechanics.js';\nimport { UnitMetadataList } from './player.js';\nimport { Encounter as EncounterProto, MobType, PresetEncounter, PresetTarget, SpellSchool, Stat, Target as TargetProto, TargetInput } from './proto/common.js';\nimport { Stats } from './proto_utils/stats.js';\nimport { Sim } from './sim.js';\nimport { EventID, TypedEvent } from './typed_event.js';\n\n// Manages all the settings for an Encounter.\nexport class Encounter {\n\treadonly sim: Sim;\n\n\tprivate duration = 180;\n\tprivate durationVariation = 5;\n\tprivate executeProportion20 = 0.2;\n\tprivate executeProportion25 = 0.25;\n\tprivate executeProportion35 = 0.35;\n\tprivate executeProportion90 = 0.1;\n\tprivate useHealth = false;\n\ttargets: Array<TargetProto>;\n\ttargetsMetadata: UnitMetadataList;\n\n\treadonly targetsChangeEmitter = new TypedEvent<void>();\n\treadonly durationChangeEmitter = new TypedEvent<void>();\n\treadonly executeProportionChangeEmitter = new TypedEvent<void>();\n\n\t// Emits when any of the above emitters emit.\n\treadonly changeEmitter = new TypedEvent<void>();\n\n\tconstructor(sim: Sim) {\n\t\tthis.sim = sim;\n\t\tthis.targets = [Encounter.defaultTargetProto()];\n\t\tthis.targetsMetadata = new UnitMetadataList();\n\n\t\t[this.targetsChangeEmitter, this.durationChangeEmitter, this.executeProportionChangeEmitter].forEach(emitter =>\n\t\t\temitter.on(eventID => this.changeEmitter.emit(eventID)),\n\t\t);\n\t}\n\n\tget primaryTarget(): TargetProto {\n\t\treturn TargetProto.clone(this.targets[0]);\n\t}\n\n\tgetDurationVariation(): number {\n\t\treturn this.durationVariation;\n\t}\n\tsetDurationVariation(eventID: EventID, newDuration: number) {\n\t\tif (newDuration == this.durationVariation) return;\n\n\t\tthis.durationVariation = newDuration;\n\t\tthis.durationChangeEmitter.emit(eventID);\n\t}\n\n\tgetDuration(): number {\n\t\treturn this.duration;\n\t}\n\tsetDuration(eventID: EventID, newDuration: number) {\n\t\tif (newDuration == this.duration) return;\n\n\t\tthis.duration = newDuration;\n\t\tthis.durationChangeEmitter.emit(eventID);\n\t}\n\n\tgetExecuteProportion20(): number {\n\t\treturn this.executeProportion20;\n\t}\n\tsetExecuteProportion20(eventID: EventID, newExecuteProportion20: number) {\n\t\tif (newExecuteProportion20 == this.executeProportion20) return;\n\n\t\tthis.executeProportion20 = newExecuteProportion20;\n\t\tthis.executeProportionChangeEmitter.emit(eventID);\n\t}\n\tgetExecuteProportion25(): number {\n\t\treturn this.executeProportion25;\n\t}\n\tsetExecuteProportion25(eventID: EventID, newExecuteProportion25: number) {\n\t\tif (newExecuteProportion25 == this.executeProportion25) return;\n\n\t\tthis.executeProportion25 = newExecuteProportion25;\n\t\tthis.executeProportionChangeEmitter.emit(eventID);\n\t}\n\tgetExecuteProportion35(): number {\n\t\treturn this.executeProportion35;\n\t}\n\tsetExecuteProportion35(eventID: EventID, newExecuteProportion35: number) {\n\t\tif (newExecuteProportion35 == this.executeProportion35) return;\n\n\t\tthis.executeProportion35 = newExecuteProportion35;\n\t\tthis.executeProportionChangeEmitter.emit(eventID);\n\t}\n\tgetExecuteProportion90(): number {\n\t\treturn this.executeProportion90;\n\t}\n\tsetExecuteProportion90(eventID: EventID, newExecuteProportion90: number) {\n\t\tif (newExecuteProportion90 == this.executeProportion90) return;\n\n\t\tthis.executeProportion90 = newExecuteProportion90;\n\t\tthis.executeProportionChangeEmitter.emit(eventID);\n\t}\n\tgetUseHealth(): boolean {\n\t\treturn this.useHealth;\n\t}\n\tsetUseHealth(eventID: EventID, newUseHealth: boolean) {\n\t\tif (newUseHealth == this.useHealth) return;\n\n\t\tthis.useHealth = newUseHealth;\n\t\tthis.durationChangeEmitter.emit(eventID);\n\t\tthis.executeProportionChangeEmitter.emit(eventID);\n\t}\n\n\tmatchesPreset(preset: PresetEncounter): boolean {\n\t\treturn preset.targets.length == this.targets.length && this.targets.every((t, i) => TargetProto.equals(t, preset.targets[i].target));\n\t}\n\n\tapplyPreset(eventID: EventID, preset: PresetEncounter) {\n\t\tthis.targets = preset.targets.map(presetTarget => presetTarget.target || TargetProto.create());\n\t\tthis.targetsChangeEmitter.emit(eventID);\n\t}\n\n\tapplyPresetTarget(eventID: EventID, preset: PresetTarget, index: number) {\n\t\tthis.targets[index] = preset.target || TargetProto.create();\n\t\tthis.targetsChangeEmitter.emit(eventID);\n\t}\n\n\ttoProto(): EncounterProto {\n\t\treturn EncounterProto.create({\n\t\t\tduration: this.duration,\n\t\t\tdurationVariation: this.durationVariation,\n\t\t\texecuteProportion20: this.executeProportion20,\n\t\t\texecuteProportion25: this.executeProportion25,\n\t\t\texecuteProportion35: this.executeProportion35,\n\t\t\texecuteProportion90: this.executeProportion90,\n\t\t\tuseHealth: this.useHealth,\n\t\t\ttargets: this.targets,\n\t\t});\n\t}\n\n\tfromProto(eventID: EventID, proto: EncounterProto) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.setDuration(eventID, proto.duration);\n\t\t\tthis.setDurationVariation(eventID, proto.durationVariation);\n\t\t\tthis.setExecuteProportion20(eventID, proto.executeProportion20);\n\t\t\tthis.setExecuteProportion25(eventID, proto.executeProportion25);\n\t\t\tthis.setExecuteProportion35(eventID, proto.executeProportion35);\n\t\t\tthis.setExecuteProportion90(eventID, proto.executeProportion90);\n\t\t\tthis.setUseHealth(eventID, proto.useHealth);\n\t\t\tthis.targets = proto.targets;\n\t\t\tthis.targetsChangeEmitter.emit(eventID);\n\t\t});\n\t}\n\n\tapplyDefaults(eventID: EventID) {\n\t\tthis.fromProto(\n\t\t\teventID,\n\t\t\tEncounterProto.create({\n\t\t\t\tduration: 180,\n\t\t\t\tdurationVariation: 5,\n\t\t\t\texecuteProportion20: 0.2,\n\t\t\t\texecuteProportion25: 0.25,\n\t\t\t\texecuteProportion35: 0.35,\n\t\t\t\texecuteProportion90: 0.1,\n\t\t\t\ttargets: [Encounter.defaultTargetProto()],\n\t\t\t}),\n\t\t);\n\t}\n\n\tstatic defaultTargetProto(): TargetProto {\n\t\treturn TargetProto.create({\n\t\t\tlevel: Mechanics.BOSS_LEVEL,\n\t\t\tmobType: MobType.MobTypeGiant,\n\t\t\ttankIndex: 0,\n\t\t\tswingSpeed: 1.5,\n\t\t\tminBaseDamage: 65000,\n\t\t\tdualWield: false,\n\t\t\tdualWieldPenalty: false,\n\t\t\tsuppressDodge: false,\n\t\t\tparryHaste: true,\n\t\t\tspellSchool: SpellSchool.SpellSchoolPhysical,\n\t\t\tstats: Stats.fromMap({\n\t\t\t\t[Stat.StatArmor]: 11977,\n\t\t\t\t[Stat.StatAttackPower]: 805,\n\t\t\t\t[Stat.StatBlockValue]: 76,\n\t\t\t}).asArray(),\n\t\t\ttargetInputs: new Array<TargetInput>(0),\n\t\t});\n\t}\n}\n","import {\n\tClass,\n\tDebuffs,\n\tRaidBuffs,\n\tUnitReference,\n\tUnitReference_Type as UnitType,\n} from './proto/common.js';\nimport { Raid as RaidProto } from './proto/api.js';\n\nimport { Party, MAX_PARTY_SIZE } from './party.js';\nimport { Player } from './player.js';\nimport { EventID, TypedEvent } from './typed_event.js';\nimport { Sim } from './sim.js';\nimport { sum } from './utils.js';\n\nexport const MAX_NUM_PARTIES = 8;\n\n// Manages all the settings for a single Raid.\nexport class Raid {\n\tprivate buffs: RaidBuffs = RaidBuffs.create();\n\tprivate debuffs: Debuffs = Debuffs.create();\n\tprivate tanks: Array<UnitReference> = [];\n\tprivate targetDummies: number = 0;\n\tprivate numActiveParties: number = 5;\n\n\t// Emits when a raid member is added/removed/moved.\n\treadonly compChangeEmitter = new TypedEvent<void>();\n\n\treadonly buffsChangeEmitter = new TypedEvent<void>();\n\treadonly debuffsChangeEmitter = new TypedEvent<void>();\n\treadonly tanksChangeEmitter = new TypedEvent<void>();\n\treadonly targetDummiesChangeEmitter = new TypedEvent<void>();\n\treadonly numActivePartiesChangeEmitter = new TypedEvent<void>();\n\n\t// Emits when anything in the raid changes.\n\treadonly changeEmitter: TypedEvent<void>;\n\n\t// Should always hold exactly MAX_NUM_PARTIES elements.\n\tprivate parties: Array<Party>;\n\n\t// Cached return value for getActivePlayers().\n\tprivate activePlayers: Array<Player<any>>;\n\n\treadonly sim: Sim;\n\n\tconstructor(sim: Sim) {\n\t\tthis.sim = sim;\n\n\t\tthis.parties = [...Array(MAX_NUM_PARTIES).keys()].map(i => {\n\t\t\tconst newParty = new Party(this, sim);\n\t\t\tnewParty.compChangeEmitter.on(eventID => this.compChangeEmitter.emit(eventID));\n\t\t\tnewParty.changeEmitter.on(eventID => this.changeEmitter.emit(eventID));\n\t\t\treturn newParty;\n\t\t});\n\t\tthis.activePlayers = [];\n\n\t\tthis.numActivePartiesChangeEmitter.on(eventID => this.compChangeEmitter.emit(eventID));\n\n\t\tthis.changeEmitter = TypedEvent.onAny([\n\t\t\tthis.compChangeEmitter,\n\t\t\tthis.buffsChangeEmitter,\n\t\t\tthis.debuffsChangeEmitter,\n\t\t\tthis.tanksChangeEmitter,\n\t\t\tthis.targetDummiesChangeEmitter,\n\t\t], 'RaidChange');\n\n\t\tthis.changeEmitter.on(() => {\n\t\t\tthis.activePlayers = [];\n\t\t});\n\t}\n\n\tsize(): number {\n\t\treturn sum(this.parties.map(party => party.size()));\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this.size() == 0;\n\t}\n\n\tgetParties(): Array<Party> {\n\t\t// Make defensive copy.\n\t\treturn this.parties.slice();\n\t}\n\n\tgetParty(index: number): Party {\n\t\treturn this.parties[index];\n\t}\n\n\tgetPlayers(): Array<Player<any> | null> {\n\t\treturn this.parties.map(party => party.getPlayers()).flat();\n\t}\n\n\tgetPlayer(index: number): Player<any> | null {\n\t\tif (index === -1) return null;\n\n\t\tconst party = this.parties[Math.floor(index / MAX_PARTY_SIZE)];\n\t\treturn party.getPlayer(index % MAX_PARTY_SIZE);\n\t}\n\n\tgetPlayerFromUnitReference(raidTarget: UnitReference|undefined, contextPlayer?: Player<any>|null): Player<any> | null {\n\t\tif (!raidTarget || raidTarget.type == UnitType.Unknown) {\n\t\t\treturn null;\n\t\t} else if (raidTarget.type == UnitType.Player) {\n\t\t\treturn this.getPlayer(raidTarget.index);\n\t\t} else if (raidTarget.type == UnitType.Self) {\n\t\t\treturn contextPlayer || null;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tsetPlayer(eventID: EventID, index: number, newPlayer: Player<any> | null) {\n\t\tconst party = this.parties[Math.floor(index / MAX_PARTY_SIZE)];\n\t\tparty.setPlayer(eventID, index % MAX_PARTY_SIZE, newPlayer);\n\t}\n\n\tgetClassCount(playerClass: Class) {\n\t\treturn this.getPlayers().filter(player => player != null && player.getClass() == playerClass).length;\n\t}\n\n\tgetBuffs(): RaidBuffs {\n\t\t// Make a defensive copy\n\t\treturn RaidBuffs.clone(this.buffs);\n\t}\n\n\tsetBuffs(eventID: EventID, newBuffs: RaidBuffs) {\n\t\tif (RaidBuffs.equals(this.buffs, newBuffs))\n\t\t\treturn;\n\n\t\t// Make a defensive copy\n\t\tthis.buffs = RaidBuffs.clone(newBuffs);\n\t\tthis.buffsChangeEmitter.emit(eventID);\n\t}\n\n\tgetDebuffs(): Debuffs {\n\t\t// Make a defensive copy\n\t\treturn Debuffs.clone(this.debuffs);\n\t}\n\n\tsetDebuffs(eventID: EventID, newDebuffs: Debuffs) {\n\t\tif (Debuffs.equals(this.debuffs, newDebuffs))\n\t\t\treturn;\n\n\t\t// Make a defensive copy\n\t\tthis.debuffs = Debuffs.clone(newDebuffs);\n\t\tthis.debuffsChangeEmitter.emit(eventID);\n\t}\n\n\tgetTanks(): Array<UnitReference> {\n\t\t// Make a defensive copy\n\t\treturn this.tanks.map(tank => UnitReference.clone(tank));\n\t}\n\n\tsetTanks(eventID: EventID, newTanks: Array<UnitReference>) {\n\t\tif (this.tanks.length == newTanks.length && this.tanks.every((tank, i) => UnitReference.equals(tank, newTanks[i])))\n\t\t\treturn;\n\n\t\t// Make a defensive copy\n\t\tthis.tanks = newTanks.map(tank => UnitReference.clone(tank));\n\t\tthis.tanksChangeEmitter.emit(eventID);\n\t}\n\n\tgetTargetDummies(): number {\n\t\treturn this.targetDummies;\n\t}\n\n\tsetTargetDummies(eventID: EventID, newTargetDummies: number) {\n\t\tif (this.targetDummies == newTargetDummies)\n\t\t\treturn;\n\n\t\tthis.targetDummies = newTargetDummies;\n\t\tthis.targetDummiesChangeEmitter.emit(eventID);\n\t}\n\n\tgetNumActiveParties(): number {\n\t\treturn this.numActiveParties;\n\t}\n\tsetNumActiveParties(eventID: EventID, newNumActiveParties: number) {\n\t\tif (newNumActiveParties != this.numActiveParties && newNumActiveParties > 0) {\n\t\t\tthis.numActiveParties = newNumActiveParties;\n\t\t\tthis.numActivePartiesChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\tgetActivePlayers(): Array<Player<any>> {\n\t\tif (this.activePlayers.length == 0) {\n\t\t\tconst activeParties = this.getParties().filter((party, i) => i < this.numActiveParties);\n\t\t\tthis.activePlayers = activeParties\n\t\t\t\t.map(party => party.getPlayers())\n\t\t\t\t.flat()\n\t\t\t\t.filter(player => player != null) as Array<Player<any>>;\n\t\t}\n\t\treturn this.activePlayers;\n\t}\n\n\ttoProto(forExport?: boolean, forSimming?: boolean): RaidProto {\n\t\treturn RaidProto.create({\n\t\t\tparties: this.parties.map(party => party.toProto(forExport, forSimming)),\n\t\t\tbuffs: this.getBuffs(),\n\t\t\tdebuffs: this.getDebuffs(),\n\t\t\ttanks: this.getTanks(),\n\t\t\ttargetDummies: this.getTargetDummies(),\n\t\t\tnumActiveParties: this.getNumActiveParties(),\n\t\t});\n\t}\n\n\tfromProto(eventID: EventID, proto: RaidProto) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.setBuffs(eventID, proto.buffs || RaidBuffs.create());\n\t\t\tthis.setDebuffs(eventID, proto.debuffs || Debuffs.create());\n\t\t\tthis.setTanks(eventID, proto.tanks);\n\t\t\tthis.setTargetDummies(eventID, proto.targetDummies);\n\t\t\tthis.setNumActiveParties(eventID, proto.numActiveParties || 5);\n\n\t\t\tfor (let i = 0; i < MAX_NUM_PARTIES; i++) {\n\t\t\t\tif (proto.parties[i]) {\n\t\t\t\t\tthis.parties[i].fromProto(eventID, proto.parties[i]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.parties[i].clear(eventID);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tclear(eventID: EventID) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tfor (let i = 0; i < MAX_NUM_PARTIES; i++) {\n\t\t\t\tthis.parties[i].clear(eventID);\n\t\t\t}\n\t\t});\n\t}\n}\n","import { REPO_NAME } from './constants/other.js'\nimport { GemColor } from './proto/common.js';\nimport { ItemQuality } from './proto/common.js';\nimport { ItemSlot } from './proto/common.js';\nimport { ItemSpec } from './proto/common.js';\nimport { ItemType } from './proto/common.js';\nimport { Stat } from './proto/common.js';\n\nimport { ComputeStatsRequest, ComputeStatsResult } from './proto/api.js';\nimport { RaidSimRequest, RaidSimResult, ProgressMetrics } from './proto/api.js';\nimport { StatWeightsRequest, StatWeightsResult } from './proto/api.js';\nimport { BulkSimRequest, BulkSimResult } from './proto/api.js';\n\nimport { wait } from './utils.js';\n\nconst SIM_WORKER_URL = `/${REPO_NAME}/sim_worker.js`;\n\nexport class WorkerPool {\n\tprivate workers: Array<SimWorker>;\n\n\tconstructor(numWorkers: number) {\n\t\tthis.workers = [];\n\t\tfor (let i = 0; i < numWorkers; i++) {\n\t\t\tthis.workers.push(new SimWorker());\n\t\t}\n\t}\n\n\tprivate getLeastBusyWorker(): SimWorker {\n\t\treturn this.workers.reduce(\n\t\t\t(curMinWorker, nextWorker) => curMinWorker.numTasksRunning < nextWorker.numTasksRunning ?\n\t\t\t\tcurMinWorker : nextWorker);\n\t}\n\n\tasync makeApiCall(requestName: string, request: Uint8Array): Promise<Uint8Array> {\n\t\treturn await this.getLeastBusyWorker().doApiCall(requestName, request, \"\");\n\t}\n\n\tasync computeStats(request: ComputeStatsRequest): Promise<ComputeStatsResult> {\n\t\tconst result = await this.makeApiCall('computeStats', ComputeStatsRequest.toBinary(request));\n\t\treturn ComputeStatsResult.fromBinary(result);\n\t}\n\n\tasync statWeightsAsync(request: StatWeightsRequest, onProgress: Function): Promise<StatWeightsResult> {\n\t\tconsole.log('Stat weights request: ' + StatWeightsRequest.toJsonString(request));\n\t\tconst worker = this.getLeastBusyWorker();\n\t\tconst id = worker.makeTaskId();\n\t\t// Add handler for the progress events\n\t\tworker.addPromiseFunc(id + \"progress\", this.newProgressHandler(id, worker, onProgress), (err) => { })\n\n\t\t// Now start the async sim\n\t\tconst resultData = await worker.doApiCall('statWeightsAsync', StatWeightsRequest.toBinary(request), id);\n\t\tconst result = ProgressMetrics.fromBinary(resultData)\n\t\tconsole.log('Stat weights result: ' + StatWeightsResult.toJsonString(result.finalWeightResult!));\n\t\treturn result.finalWeightResult!;\n\t}\n\n\tasync bulkSimAsync(request: BulkSimRequest, onProgress: Function): Promise<BulkSimResult> {\n\t\tconsole.log('bulk sim request: ' + BulkSimRequest.toJsonString(request, { enumAsInteger: true }));\n\t\tconst worker = this.getLeastBusyWorker();\n\t\tconst id = worker.makeTaskId();\n\t\t// Add handler for the progress events\n\t\tworker.addPromiseFunc(id + \"progress\", this.newProgressHandler(id, worker, onProgress), (err) => { })\n\n\t\t// Now start the async sim\n\t\tconst resultData = await worker.doApiCall('bulkSimAsync', BulkSimRequest.toBinary(request), id);\n\t\tconst result = ProgressMetrics.fromBinary(resultData)\n\t\tconst resultJson = BulkSimResult.toJson(result.finalBulkResult!) as any;\n\t\tconsole.log('bulk sim result: ' + JSON.stringify(resultJson));\n\t\treturn result.finalBulkResult!;\n\t}\n\n\tasync raidSimAsync(request: RaidSimRequest, onProgress: Function): Promise<RaidSimResult> {\n\t\tconsole.log('Raid sim request: ' + RaidSimRequest.toJsonString(request));\n\t\tconst worker = this.getLeastBusyWorker();\n\t\tconst id = worker.makeTaskId();\n\t\t// Add handler for the progress events\n\t\tworker.addPromiseFunc(id + \"progress\", this.newProgressHandler(id, worker, onProgress), (err) => { })\n\n\t\t// Now start the async sim\n\t\tconst resultData = await worker.doApiCall('raidSimAsync', RaidSimRequest.toBinary(request), id);\n\t\tconst result = ProgressMetrics.fromBinary(resultData)\n\n\t\t// Don't print the logs because it just clogs the console.\n\t\tconst resultJson = RaidSimResult.toJson(result.finalRaidResult!) as any;\n\t\tdelete resultJson!['logs'];\n\t\tconsole.log('Raid sim result: ' + JSON.stringify(resultJson));\n\t\treturn result.finalRaidResult!;\n\t}\n\n\tnewProgressHandler(id: string, worker: SimWorker, onProgress: Function): (progressData: any) => void {\n\t\treturn (progressData: any) => {\n\t\t\tvar progress = ProgressMetrics.fromBinary(progressData);\n\t\t\tonProgress(progress);\n\t\t\t// If we are done, stop adding the handler.\n\t\t\tif (progress.finalRaidResult != null || progress.finalWeightResult != null) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tworker.addPromiseFunc(id + \"progress\", this.newProgressHandler(id, worker, onProgress), (err) => { });\n\t\t};\n\t}\n}\n\nclass SimWorker {\n\tnumTasksRunning: number;\n\tprivate taskIdsToPromiseFuncs: Record<string, [(result: any) => void, (error: any) => void]>;\n\tprivate worker: Worker;\n\tprivate onReady: Promise<void>;\n\n\tconstructor() {\n\t\tthis.numTasksRunning = 0;\n\t\tthis.taskIdsToPromiseFuncs = {};\n\t\tthis.worker = new window.Worker(SIM_WORKER_URL);\n\n\t\tlet resolveReady: (() => void) | null = null;\n\t\tthis.onReady = new Promise((_resolve, _reject) => {\n\t\t\tresolveReady = _resolve;\n\t\t});\n\n\t\tthis.worker.onmessage = event => {\n\t\t\tif (event.data.msg == 'ready') {\n\t\t\t\tthis.worker.postMessage({ msg: 'setID', id: '1' });\n\t\t\t\tresolveReady!();\n\t\t\t} else if (event.data.msg == 'idconfirm') {\n\t\t\t\t// Do nothing\n\t\t\t} else {\n\t\t\t\tconst id = event.data.id;\n\t\t\t\tif (!this.taskIdsToPromiseFuncs[id]) {\n\t\t\t\t\tconsole.warn('Unrecognized result id: ' + id);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst promiseFuncs = this.taskIdsToPromiseFuncs[id];\n\t\t\t\tdelete this.taskIdsToPromiseFuncs[id];\n\t\t\t\tthis.numTasksRunning--;\n\n\t\t\t\tpromiseFuncs[0](event.data.outputData);\n\t\t\t}\n\t\t};\n\t}\n\n\taddPromiseFunc(id: string, callback: (result: any) => void, onError: (error: any) => void) {\n\t\tthis.taskIdsToPromiseFuncs[id] = [callback, onError];\n\t}\n\n\tmakeTaskId(): string {\n\t\tlet id = '';\n\t\tconst characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\t\tfor (let i = 0; i < 16; i++) {\n\t\t\tid += characters.charAt(Math.floor(Math.random() * characters.length));\n\t\t}\n\t\treturn id;\n\t}\n\n\tasync doApiCall(requestName: string, request: Uint8Array, id: string): Promise<Uint8Array> {\n\t\tthis.numTasksRunning++;\n\t\tawait this.onReady;\n\n\t\tconst taskPromise = new Promise<Uint8Array>((resolve, reject) => {\n\t\t\tif (!id) {\n\t\t\t\tid = this.makeTaskId();\n\t\t\t}\n\t\t\tthis.taskIdsToPromiseFuncs[id] = [resolve, reject];\n\n\t\t\tthis.worker.postMessage({\n\t\t\t\tmsg: requestName,\n\t\t\t\tid: id,\n\t\t\t\tinputData: request,\n\t\t\t});\n\t\t});\n\t\treturn await taskPromise;\n\t}\n}\n","import { getBrowserLanguageCode, setLanguageCode } from './constants/lang.js';\nimport * as OtherConstants from './constants/other.js';\nimport { Encounter } from './encounter.js';\nimport { Player, UnitMetadata } from './player.js';\nimport { BulkSettings, BulkSimRequest, BulkSimResult, ComputeStatsRequest , Raid as RaidProto , RaidSimRequest, RaidSimResult , SimOptions , StatWeightsRequest, StatWeightsResult } from './proto/api.js';\nimport {\n\tArmorType,\n\tFaction,\n\tProfession,\nPseudoStat,\n\tRangedWeaponType,\n\tSimDatabase,\n\tStat, \tUnitReference,\n\tUnitReference_Type as UnitType,\n\tWeaponType,\n} from './proto/common.js';\nimport {\n\tDatabaseFilters,\n\tRaidFilterOption,\n\tSimSettings as SimSettingsProto,\n\tSourceFilterOption,\n} from './proto/ui.js';\nimport { Database } from './proto_utils/database.js';\nimport { SimResult } from './proto_utils/sim_result.js';\nimport { Raid } from './raid.js';\nimport { EventID, TypedEvent } from './typed_event.js';\nimport { getEnumValues } from './utils.js';\nimport { WorkerPool } from './worker_pool.js';\n\nexport type RaidSimData = {\n\trequest: RaidSimRequest,\n\tresult: RaidSimResult,\n};\n\nexport type StatWeightsData = {\n\trequest: StatWeightsRequest,\n\tresult: StatWeightsResult,\n};\n\nexport enum SimSettingCategories {\n\tGear = 0,\n\tTalents,\n\tRotation,\n\tConsumes,\n\tMiscellaneous, // Spec-specific settings, Distance from target, tank status, etc\n\tExternal, // Buffs and debuffs\n\tEncounter,\n\tUISettings, // # iterations, EP weights, filters, etc\n}\n\n// Core Sim module which deals only with api types, no UI-related stuff.\nexport class Sim {\n\tprivate readonly workerPool: WorkerPool;\n\n\tprivate iterations = 3000;\n\tprivate phase: number = OtherConstants.CURRENT_PHASE;\n\tprivate faction: Faction = Faction.Alliance;\n\tprivate fixedRngSeed = 0;\n\tprivate filters: DatabaseFilters = Sim.defaultFilters();\n\tprivate showDamageMetrics = true;\n\tprivate showThreatMetrics = false;\n\tprivate showHealingMetrics = false;\n\tprivate showExperimental = false;\n\tprivate showEPValues = false;\n\tprivate language = '';\n\n\treadonly raid: Raid;\n\treadonly encounter: Encounter;\n\n\tprivate db_: Database | null = null;\n\n\treadonly iterationsChangeEmitter = new TypedEvent<void>();\n\treadonly phaseChangeEmitter = new TypedEvent<void>();\n\treadonly factionChangeEmitter = new TypedEvent<void>();\n\treadonly fixedRngSeedChangeEmitter = new TypedEvent<void>();\n\treadonly lastUsedRngSeedChangeEmitter = new TypedEvent<void>();\n\treadonly filtersChangeEmitter = new TypedEvent<void>();\n\treadonly showDamageMetricsChangeEmitter = new TypedEvent<void>();\n\treadonly showThreatMetricsChangeEmitter = new TypedEvent<void>();\n\treadonly showHealingMetricsChangeEmitter = new TypedEvent<void>();\n\treadonly showExperimentalChangeEmitter = new TypedEvent<void>();\n\treadonly showEPValuesChangeEmitter = new TypedEvent<void>();\n\treadonly languageChangeEmitter = new TypedEvent<void>();\n\treadonly crashEmitter = new TypedEvent<SimError>();\n\n\t// Emits when any of the settings change (but not the raid / encounter).\n\treadonly settingsChangeEmitter: TypedEvent<void>;\n\n\t// Emits when any player, target, or pet has metadata changes (spells or auras).\n\treadonly unitMetadataEmitter = new TypedEvent<void>('UnitMetadata');\n\n\t// Emits when any of the above emitters emit.\n\treadonly changeEmitter: TypedEvent<void>;\n\n\t// Fires when a raid sim API call completes.\n\treadonly simResultEmitter = new TypedEvent<SimResult>();\n\n\t// Fires when a bulk sim API call starts.\n\treadonly bulkSimStartEmitter = new TypedEvent<BulkSimRequest>();\n\t// Fires when a bulk sim API call completes..\n\treadonly bulkSimResultEmitter = new TypedEvent<BulkSimResult>();\n\n\tprivate readonly _initPromise: Promise<any>;\n\tprivate lastUsedRngSeed = 0;\n\n\t// These callbacks are needed so we can apply BuffBot modifications automatically before sending requests.\n\tprivate modifyRaidProto: ((raidProto: RaidProto) => void) = () => { };\n\n\tconstructor() {\n\t\tthis.workerPool = new WorkerPool(1);\n\t\tthis._initPromise = Database.get().then(db => {\n\t\t\tthis.db_ = db;\n\t\t});\n\n\t\tthis.raid = new Raid(this);\n\t\tthis.encounter = new Encounter(this);\n\n\t\tthis.settingsChangeEmitter = TypedEvent.onAny([\n\t\t\tthis.iterationsChangeEmitter,\n\t\t\tthis.phaseChangeEmitter,\n\t\t\tthis.fixedRngSeedChangeEmitter,\n\t\t\tthis.filtersChangeEmitter,\n\t\t\tthis.showDamageMetricsChangeEmitter,\n\t\t\tthis.showThreatMetricsChangeEmitter,\n\t\t\tthis.showHealingMetricsChangeEmitter,\n\t\t\tthis.showExperimentalChangeEmitter,\n\t\t\tthis.showEPValuesChangeEmitter,\n\t\t\tthis.languageChangeEmitter,\n\t\t]);\n\n\t\tthis.changeEmitter = TypedEvent.onAny([\n\t\t\tthis.settingsChangeEmitter,\n\t\t\tthis.raid.changeEmitter,\n\t\t\tthis.encounter.changeEmitter,\n\t\t]);\n\n\t\tTypedEvent.onAny([this.raid.changeEmitter, this.encounter.changeEmitter]).on(eventID => this.updateCharacterStats(eventID));\n\t}\n\n\twaitForInit(): Promise<void> {\n\t\treturn this._initPromise;\n\t}\n\n\tget db(): Database {\n\t\treturn this.db_!;\n\t}\n\n\tsetModifyRaidProto(newModFn: (raidProto: RaidProto) => void) {\n\t\tthis.modifyRaidProto = newModFn;\n\t}\n\tgetModifiedRaidProto(): RaidProto {\n\t\tconst raidProto = this.raid.toProto(false, true);\n\t\tthis.modifyRaidProto(raidProto);\n\n\t\t// Remove any inactive meta gems, since the backend doesn't have its own validation.\n\t\traidProto.parties.forEach(party => {\n\t\t\tparty.players.forEach(player => {\n\t\t\t\tif (!player.equipment) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet gear = this.db.lookupEquipmentSpec(player.equipment);\n\t\t\t\tlet gearChanged = false;\n\n\t\t\t\tconst isBlacksmith = [player.profession1, player.profession2].includes(Profession.Blacksmithing);\n\n\t\t\t\t// Disable meta gem if inactive.\n\t\t\t\tif (gear.hasInactiveMetaGem(isBlacksmith)) {\n\t\t\t\t\tgear = gear.withoutMetaGem();\n\t\t\t\t\tgearChanged = true;\n\t\t\t\t}\n\n\t\t\t\t// Remove bonus sockets if not blacksmith.\n\t\t\t\tif (!isBlacksmith) {\n\t\t\t\t\tgear = gear.withoutBlacksmithSockets();\n\t\t\t\t\tgearChanged = true;\n\t\t\t\t}\n\n\t\t\t\tif (gearChanged) {\n\t\t\t\t\tplayer.equipment = gear.asSpec();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn raidProto;\n\t}\n\n\tmakeRaidSimRequest(debug: boolean): RaidSimRequest {\n\t\tconst raid = this.getModifiedRaidProto();\n\t\tconst encounter = this.encounter.toProto();\n\n\t\t// TODO: remove any replenishment from sim request here? probably makes more sense to do it inside the sim to protect against accidents\n\n\t\treturn RaidSimRequest.create({\n\t\t\traid: raid,\n\t\t\tencounter: encounter,\n\t\t\tsimOptions: SimOptions.create({\n\t\t\t\titerations: debug ? 1 : this.getIterations(),\n\t\t\t\trandomSeed: BigInt(this.nextRngSeed()),\n\t\t\t\tdebugFirstIteration: true,\n\t\t\t}),\n\t\t});\n\t}\n\n\tasync runBulkSim(bulkSettings: BulkSettings, bulkItemsDb: SimDatabase, onProgress: Function): Promise<BulkSimResult> {\n\t\tif (this.raid.isEmpty()) {\n\t\t\tthrow new Error('Raid is empty! Try adding some players first.');\n\t\t} else if (this.encounter.targets.length < 1) {\n\t\t\tthrow new Error('Encounter has no targets! Try adding some targets first.');\n\t\t}\n\n\t\tawait this.waitForInit();\n\n\t\tconst request = BulkSimRequest.create({\n\t\t\tbaseSettings: this.makeRaidSimRequest(false),\n\t\t\tbulkSettings: bulkSettings,\n\t\t});\n\n\t\tif (request.baseSettings != null && request.baseSettings.simOptions != null) {\n\t\t\trequest.baseSettings.simOptions.debugFirstIteration = false;\n\t\t}\n\n\t\tif (!request.baseSettings?.raid || request.baseSettings?.raid?.parties.length == 0 || request.baseSettings?.raid?.parties[0].players.length == 0) {\n\t\t\tthrow new Error('Raid must contain exactly 1 player for bulk sim.');\n\t\t}\n\n\t\t// Attach the extra database to the player.\n\t\tconst playerDatabase = request.baseSettings.raid.parties[0].players[0].database;\n\t\tplayerDatabase?.items.push(...bulkItemsDb.items);\n\t\tplayerDatabase?.enchants.push(...bulkItemsDb.enchants);\n\t\tplayerDatabase?.gems.push(...bulkItemsDb.gems);\n\n\t\tthis.bulkSimStartEmitter.emit(TypedEvent.nextEventID(), request);\n\n\t\tconst result = await this.workerPool.bulkSimAsync(request, onProgress);\n\t\tif (result.errorResult != \"\") {\n\t\t\tthrow new SimError(result.errorResult);\n\t\t}\n\n\t\tthis.bulkSimResultEmitter.emit(TypedEvent.nextEventID(), result);\n\t\treturn result;\n\t}\n\n\tasync runRaidSim(eventID: EventID, onProgress: Function): Promise<SimResult> {\n\t\tif (this.raid.isEmpty()) {\n\t\t\tthrow new Error('Raid is empty! Try adding some players first.');\n\t\t} else if (this.encounter.targets.length < 1) {\n\t\t\tthrow new Error('Encounter has no targets! Try adding some targets first.');\n\t\t}\n\n\t\tawait this.waitForInit();\n\n\t\tconst request = this.makeRaidSimRequest(false);\n\n\t\tconst result = await this.workerPool.raidSimAsync(request, onProgress);\n\t\tif (result.errorResult != \"\") {\n\t\t\tthrow new SimError(result.errorResult);\n\t\t}\n\t\tconst simResult = await SimResult.makeNew(request, result);\n\t\tthis.simResultEmitter.emit(eventID, simResult);\n\t\treturn simResult;\n\t}\n\n\tasync runRaidSimWithLogs(eventID: EventID): Promise<SimResult> {\n\t\tif (this.raid.isEmpty()) {\n\t\t\tthrow new Error('Raid is empty! Try adding some players first.');\n\t\t} else if (this.encounter.targets.length < 1) {\n\t\t\tthrow new Error('Encounter has no targets! Try adding some targets first.');\n\t\t}\n\n\t\tawait this.waitForInit();\n\n\t\tconst request = this.makeRaidSimRequest(true);\n\t\tconst result = await this.workerPool.raidSimAsync(request, () => { });\n\t\tif (result.errorResult != \"\") {\n\t\t\tthrow new SimError(result.errorResult);\n\t\t}\n\t\tconst simResult = await SimResult.makeNew(request, result);\n\t\tthis.simResultEmitter.emit(eventID, simResult);\n\t\treturn simResult;\n\t}\n\n\t// This should be invoked internally whenever stats might have changed.\n\tasync updateCharacterStats(eventID: EventID) {\n\t\tif (eventID == 0) {\n\t\t\t// Skip the first event ID because it interferes with the loaded stats.\n\t\t\treturn;\n\t\t}\n\t\teventID = TypedEvent.nextEventID();\n\n\t\tawait this.waitForInit();\n\n\t\t// Capture the current players so we avoid issues if something changes while\n\t\t// request is in-flight.\n\t\tconst players = this.raid.getPlayers();\n\n\t\tconst req = ComputeStatsRequest.create({\n\t\t\traid: this.getModifiedRaidProto(),\n\t\t\tencounter: this.encounter.toProto(),\n\t\t});\n\t\tconst result = await this.workerPool.computeStats(req);\n\n\t\tif (result.errorResult != \"\") {\n\t\t\tthis.crashEmitter.emit(eventID, new SimError(result.errorResult));\n\t\t\treturn;\n\t\t}\n\n\t\tTypedEvent.freezeAllAndDo(async () => {\n\t\t\tconst playerUpdatePromises = result.raidStats!.parties\n\t\t\t\t.map((partyStats, partyIndex) =>\n\t\t\t\t\tpartyStats.players.map((playerStats, playerIndex) => {\n\t\t\t\t\t\tconst player = players[partyIndex * 5 + playerIndex];\n\t\t\t\t\t\tif (player) {\n\t\t\t\t\t\t\tplayer.setCurrentStats(eventID, playerStats);\n\t\t\t\t\t\t\treturn player.updateMetadata();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}))\n\t\t\t\t.flat()\n\t\t\t\t.filter(p => p != null) as Array<Promise<boolean>>;\n\n\t\t\tconst targetUpdatePromise = this.encounter.targetsMetadata.update(result.encounterStats!.targets.map(t => t.metadata!));\n\n\t\t\tconst anyUpdates = await Promise.all(playerUpdatePromises.concat([targetUpdatePromise]));\n\t\t\tif (anyUpdates.some(v => v)) {\n\t\t\t\tthis.unitMetadataEmitter.emit(eventID);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync statWeights(player: Player<any>, epStats: Array<Stat>, epPseudoStats: Array<PseudoStat>, epReferenceStat: Stat, onProgress: Function): Promise<StatWeightsResult> {\n\t\tif (this.raid.isEmpty()) {\n\t\t\tthrow new Error('Raid is empty! Try adding some players first.');\n\t\t} else if (this.encounter.targets.length < 1) {\n\t\t\tthrow new Error('Encounter has no targets! Try adding some targets first.');\n\t\t}\n\n\t\tawait this.waitForInit();\n\n\t\tif (player.getParty() == null) {\n\t\t\tconsole.warn('Trying to get stat weights without a party!');\n\t\t\treturn StatWeightsResult.create();\n\t\t} else {\n\t\t\tconst tanks = this.raid.getTanks().map(tank => tank.index).includes(player.getRaidIndex())\n\t\t\t\t? [UnitReference.create({ type: UnitType.Player, index: 0 })]\n\t\t\t\t: [];\n\t\t\tconst request = StatWeightsRequest.create({\n\t\t\t\tplayer: player.toProto(false, true),\n\t\t\t\traidBuffs: this.raid.getBuffs(),\n\t\t\t\tpartyBuffs: player.getParty()!.getBuffs(),\n\t\t\t\tdebuffs: this.raid.getDebuffs(),\n\t\t\t\tencounter: this.encounter.toProto(),\n\t\t\t\tsimOptions: SimOptions.create({\n\t\t\t\t\titerations: this.getIterations(),\n\t\t\t\t\trandomSeed: BigInt(this.nextRngSeed()),\n\t\t\t\t\tdebug: false,\n\t\t\t\t}),\n\t\t\t\ttanks: tanks,\n\n\t\t\t\tstatsToWeigh: epStats,\n\t\t\t\tpseudoStatsToWeigh: epPseudoStats,\n\t\t\t\tepReferenceStat: epReferenceStat,\n\t\t\t});\n\t\t\tconst result = await this.workerPool.statWeightsAsync(request, onProgress);\n\t\t\treturn result;\n\t\t}\n\t}\n\n\tgetUnitMetadata(ref: UnitReference|undefined, contextPlayer: Player<any>|null, defaultRef: UnitReference): UnitMetadata|undefined {\n\t\tif (!ref || ref.type == UnitType.Unknown) {\n\t\t\treturn this.getUnitMetadata(defaultRef, contextPlayer, defaultRef);\n\t\t} else if (ref.type == UnitType.Player) {\n\t\t\treturn this.raid.getPlayerFromUnitReference(ref)?.getMetadata();\n\t\t} else if (ref.type == UnitType.Target) {\n\t\t\treturn this.encounter.targetsMetadata.asList()[ref.index];\n\t\t} else if (ref.type == UnitType.Pet) {\n\t\t\tconst owner = this.raid.getPlayerFromUnitReference(ref.owner, contextPlayer);\n\t\t\tif (owner) {\n\t\t\t\treturn owner.getPetMetadatas().asList()[ref.index];\n\t\t\t} else {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t} else if (ref.type == UnitType.Self) {\n\t\t\treturn contextPlayer?.getMetadata();\n\t\t} else if (ref.type == UnitType.CurrentTarget) {\n\t\t\treturn this.encounter.targetsMetadata.asList()[0];\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tgetPhase(): number {\n\t\treturn this.phase;\n\t}\n\tsetPhase(eventID: EventID, newPhase: number) {\n\t\tif (newPhase != this.phase && newPhase > 0) {\n\t\t\tthis.phase = newPhase;\n\t\t\tthis.phaseChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetFaction(): Faction {\n\t\treturn this.faction;\n\t}\n\tsetFaction(eventID: EventID, newFaction: Faction) {\n\t\tif (newFaction != this.faction && !!newFaction) {\n\t\t\tthis.faction = newFaction;\n\t\t\tthis.factionChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetFixedRngSeed(): number {\n\t\treturn this.fixedRngSeed;\n\t}\n\tsetFixedRngSeed(eventID: EventID, newFixedRngSeed: number) {\n\t\tif (newFixedRngSeed != this.fixedRngSeed) {\n\t\t\tthis.fixedRngSeed = newFixedRngSeed;\n\t\t\tthis.fixedRngSeedChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tstatic MAX_RNG_SEED = Math.pow(2, 32) - 1;\n\tprivate nextRngSeed(): number {\n\t\tlet rngSeed = 0;\n\t\tif (this.fixedRngSeed) {\n\t\t\trngSeed = this.fixedRngSeed;\n\t\t} else {\n\t\t\trngSeed = Math.floor(Math.random() * Sim.MAX_RNG_SEED);\n\t\t}\n\n\t\tthis.lastUsedRngSeed = rngSeed;\n\t\tthis.lastUsedRngSeedChangeEmitter.emit(TypedEvent.nextEventID());\n\t\treturn rngSeed;\n\t}\n\tgetLastUsedRngSeed(): number {\n\t\treturn this.lastUsedRngSeed;\n\t}\n\n\tgetFilters(): DatabaseFilters {\n\t\t// Make a defensive copy\n\t\treturn DatabaseFilters.clone(this.filters);\n\t}\n\tsetFilters(eventID: EventID, newFilters: DatabaseFilters) {\n\t\tif (DatabaseFilters.equals(newFilters, this.filters)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Make a defensive copy\n\t\tthis.filters = DatabaseFilters.clone(newFilters);\n\t\tthis.filtersChangeEmitter.emit(eventID);\n\t}\n\n\tgetShowDamageMetrics(): boolean {\n\t\treturn this.showDamageMetrics;\n\t}\n\tsetShowDamageMetrics(eventID: EventID, newShowDamageMetrics: boolean) {\n\t\tif (newShowDamageMetrics != this.showDamageMetrics) {\n\t\t\tthis.showDamageMetrics = newShowDamageMetrics;\n\t\t\tthis.showDamageMetricsChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetShowThreatMetrics(): boolean {\n\t\treturn this.showThreatMetrics;\n\t}\n\tsetShowThreatMetrics(eventID: EventID, newShowThreatMetrics: boolean) {\n\t\tif (newShowThreatMetrics != this.showThreatMetrics) {\n\t\t\tthis.showThreatMetrics = newShowThreatMetrics;\n\t\t\tthis.showThreatMetricsChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetShowHealingMetrics(): boolean {\n\t\treturn this.showHealingMetrics;\n\t}\n\tsetShowHealingMetrics(eventID: EventID, newShowHealingMetrics: boolean) {\n\t\tif (newShowHealingMetrics != this.showHealingMetrics) {\n\t\t\tthis.showHealingMetrics = newShowHealingMetrics;\n\t\t\tthis.showHealingMetricsChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetShowExperimental(): boolean {\n\t\treturn this.showExperimental;\n\t}\n\tsetShowExperimental(eventID: EventID, newShowExperimental: boolean) {\n\t\tif (newShowExperimental != this.showExperimental) {\n\t\t\tthis.showExperimental = newShowExperimental;\n\t\t\tthis.showExperimentalChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetShowEPValues(): boolean {\n\t\treturn this.showEPValues;\n\t}\n\tsetShowEPValues(eventID: EventID, newShowEPValues: boolean) {\n\t\tif (newShowEPValues != this.showEPValues) {\n\t\t\tthis.showEPValues = newShowEPValues;\n\t\t\tthis.showEPValuesChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetLanguage(): string {\n\t\treturn this.language;\n\t}\n\tsetLanguage(eventID: EventID, newLanguage: string) {\n\t\tnewLanguage = newLanguage || getBrowserLanguageCode();\n\t\tif (newLanguage != this.language) {\n\t\t\tthis.language = newLanguage;\n\t\t\tsetLanguageCode(this.language);\n\t\t\tthis.languageChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetIterations(): number {\n\t\treturn this.iterations;\n\t}\n\tsetIterations(eventID: EventID, newIterations: number) {\n\t\tif (newIterations != this.iterations) {\n\t\t\tthis.iterations = newIterations;\n\t\t\tthis.iterationsChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tstatic readonly ALL_ARMOR_TYPES = (getEnumValues(ArmorType) as Array<ArmorType>).filter(v => v != 0);\n\tstatic readonly ALL_WEAPON_TYPES = (getEnumValues(WeaponType) as Array<WeaponType>).filter(v => v != 0);\n\tstatic readonly ALL_RANGED_WEAPON_TYPES = (getEnumValues(RangedWeaponType) as Array<RangedWeaponType>).filter(v => v != 0);\n\tstatic readonly ALL_SOURCES = (getEnumValues(SourceFilterOption) as Array<SourceFilterOption>).filter(v => v != 0);\n\tstatic readonly ALL_RAIDS = (getEnumValues(RaidFilterOption) as Array<RaidFilterOption>).filter(v => v != 0);\n\n\ttoProto(): SimSettingsProto {\n\t\tconst filters = this.getFilters();\n\t\tif (filters.armorTypes.length == Sim.ALL_ARMOR_TYPES.length) {\n\t\t\tfilters.armorTypes = [];\n\t\t}\n\t\tif (filters.weaponTypes.length == Sim.ALL_WEAPON_TYPES.length) {\n\t\t\tfilters.weaponTypes = [];\n\t\t}\n\t\tif (filters.rangedWeaponTypes.length == Sim.ALL_RANGED_WEAPON_TYPES.length) {\n\t\t\tfilters.rangedWeaponTypes = [];\n\t\t}\n\t\tif (filters.sources.length == Sim.ALL_SOURCES.length) {\n\t\t\tfilters.sources = [];\n\t\t}\n\t\tif (filters.raids.length == Sim.ALL_RAIDS.length) {\n\t\t\tfilters.raids = [];\n\t\t}\n\n\t\treturn SimSettingsProto.create({\n\t\t\titerations: this.getIterations(),\n\t\t\tphase: this.getPhase(),\n\t\t\tfixedRngSeed: BigInt(this.getFixedRngSeed()),\n\t\t\tshowDamageMetrics: this.getShowDamageMetrics(),\n\t\t\tshowThreatMetrics: this.getShowThreatMetrics(),\n\t\t\tshowHealingMetrics: this.getShowHealingMetrics(),\n\t\t\tshowExperimental: this.getShowExperimental(),\n\t\t\tshowEpValues: this.getShowEPValues(),\n\t\t\tlanguage: this.getLanguage(),\n\t\t\tfaction: this.getFaction(),\n\t\t\tfilters: filters,\n\t\t});\n\t}\n\n\tfromProto(eventID: EventID, proto: SimSettingsProto) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.setIterations(eventID, proto.iterations || 3000);\n\t\t\tthis.setPhase(eventID, proto.phase || OtherConstants.CURRENT_PHASE);\n\t\t\tthis.setFixedRngSeed(eventID, Number(proto.fixedRngSeed));\n\t\t\tthis.setShowDamageMetrics(eventID, proto.showDamageMetrics);\n\t\t\tthis.setShowThreatMetrics(eventID, proto.showThreatMetrics);\n\t\t\tthis.setShowHealingMetrics(eventID, proto.showHealingMetrics);\n\t\t\tthis.setShowExperimental(eventID, proto.showExperimental);\n\t\t\tthis.setShowEPValues(eventID, proto.showEpValues);\n\t\t\tthis.setLanguage(eventID, proto.language);\n\t\t\tthis.setFaction(eventID, proto.faction || Faction.Alliance)\n\n\t\t\tconst filters = proto.filters || Sim.defaultFilters();\n\t\t\tif (filters.armorTypes.length == 0) {\n\t\t\t\tfilters.armorTypes = Sim.ALL_ARMOR_TYPES.slice();\n\t\t\t}\n\t\t\tif (filters.weaponTypes.length == 0) {\n\t\t\t\tfilters.weaponTypes = Sim.ALL_WEAPON_TYPES.slice();\n\t\t\t}\n\t\t\tif (filters.rangedWeaponTypes.length == 0) {\n\t\t\t\tfilters.rangedWeaponTypes = Sim.ALL_RANGED_WEAPON_TYPES.slice();\n\t\t\t}\n\t\t\tif (filters.sources.length == 0) {\n\t\t\t\tfilters.sources = Sim.ALL_SOURCES.slice();\n\t\t\t}\n\t\t\tif (filters.raids.length == 0) {\n\t\t\t\tfilters.raids = Sim.ALL_RAIDS.slice();\n\t\t\t}\n\t\t\tthis.setFilters(eventID, filters);\n\t\t});\n\t}\n\n\tapplyDefaults(eventID: EventID, isTankSim: boolean, isHealingSim: boolean) {\n\t\tthis.fromProto(eventID, SimSettingsProto.create({\n\t\t\titerations: 3000,\n\t\t\tphase: OtherConstants.CURRENT_PHASE,\n\t\t\tfaction: Faction.Alliance,\n\t\t\tshowDamageMetrics: !isHealingSim,\n\t\t\tshowThreatMetrics: isTankSim,\n\t\t\tshowHealingMetrics: isHealingSim,\n\t\t\tlanguage: this.getLanguage(), // Don't change language.\n\t\t\tfilters: Sim.defaultFilters(),\n\t\t\tshowEpValues: false,\n\t\t}));\n\t}\n\n\tstatic defaultFilters(): DatabaseFilters {\n\t\treturn DatabaseFilters.create({\n\t\t\toneHandedWeapons: true,\n\t\t\ttwoHandedWeapons: true,\n\t\t});\n\t}\n}\n\nexport class SimError extends Error {\n\treadonly errorStr: string;\n\n\tconstructor(errorStr: string) {\n\t\tsuper(errorStr);\n\t\tthis.errorStr = errorStr;\n\t}\n}\n","import { Tooltip } from 'bootstrap';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { element, ref } from 'tsx-vanilla';\n\nimport { Component } from \"./component\";\n\nexport interface CopyButtonConfig {\n\tgetContent: () => string,\n\textraCssClasses?: string[],\n\ttext?: string,\n\ttooltip?: string,\n}\n\nexport class CopyButton extends Component {\n  private readonly config: CopyButtonConfig;\n\n  constructor(parent: HTMLElement, config: CopyButtonConfig) {\n\t\tconst btnRef = ref<HTMLButtonElement>();\n\t\tconst buttonElem = (\n\t\t\t<button\n\t\t\t\tclassName={`btn ${config.extraCssClasses?.join(' ') ?? ''}`}\n\t\t\t\tref={btnRef}\n\t\t\t>\n\t\t\t\t<i className=\"fas fa-copy me-1\" />{config.text ?? 'Copy to Clipboard'}\n\t\t\t</button>\n\t\t)\n\n    super(parent, 'copy-button', buttonElem as HTMLElement);\n    this.config = config;\n\n\t\tconst button = btnRef.value!\n\t\tlet clicked = false\n\t\tbutton.addEventListener('click', _event => {\n\t\t\tif (clicked) return\n\n\t\t\tconst data = this.config.getContent()\n\t\t\tif (navigator.clipboard == undefined) {\n\t\t\t\talert(data);\n\t\t\t} else {\n\t\t\t\tclicked = true\n\t\t\t\tnavigator.clipboard.writeText(data);\n\t\t\t\tconst originalContent = button.innerHTML;\n\t\t\t\tbutton.innerHTML = '<i class=\"fas fa-check me-1\"></i>Copied';\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tbutton.innerHTML = originalContent;\n\t\t\t\t\tclicked = false\n\t\t\t\t}, 1500);\n\t\t\t}\n\t\t});\n\n\t\tif (config.tooltip) {\n\t\t\tTooltip.getOrCreateInstance(button, {title: config.tooltip});\n\t\t}\n  }\n};\n","import { Modal } from 'bootstrap';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { element, ref } from 'tsx-vanilla';\n\nimport { Component } from './component';\n\ntype ModalSize = 'sm' | 'md' | 'lg' | 'xl';\n\ntype BaseModalConfig = {\n\tcloseButton?: {\n\t\t// When true, the button will be rendered in a fixed position on the screen.\n\t\t// Primarily used for the raid sim's embedded player editors\n\t\tfixed?: boolean;\n\t};\n\t// Whether or not to add a modal-footer element\n\tfooter?: boolean;\n\t// Whether or not to add a modal-header element\n\theader?: boolean;\n\t// Whether or not to allow modal contents to extend past the screen height.\n\t// When true, the modal is fixed to the screen height and body contents will scroll.\n\tscrollContents?: boolean;\n\t// Specify the size of the modal\n\tsize?: ModalSize;\n\t// A title for the modal\n\ttitle?: string | null;\n};\n\nconst DEFAULT_CONFIG = {\n\tfooter: false,\n\theader: true,\n\tscrollContents: false,\n\tsize: 'lg' as ModalSize,\n\ttitle: null,\n};\n\nexport class BaseModal extends Component {\n\treadonly modalConfig: BaseModalConfig;\n\n\treadonly modal: Modal;\n\treadonly dialog: HTMLElement;\n\treadonly header: HTMLElement | undefined;\n\treadonly body: HTMLElement;\n\treadonly footer: HTMLElement | undefined;\n\n\tconstructor(parent: HTMLElement, cssClass: string, config: BaseModalConfig = {}) {\n\t\tsuper(parent, 'modal');\n\t\tthis.modalConfig = { ...DEFAULT_CONFIG, ...config };\n\n\t\tconst dialogRef = ref<HTMLDivElement>();\n\t\tconst headerRef = ref<HTMLDivElement>();\n\t\tconst bodyRef = ref<HTMLDivElement>();\n\t\tconst footerRef = ref<HTMLDivElement>();\n\n\t\tconst modalSizeKlass = this.modalConfig.size && this.modalConfig.size != 'md' ? `modal-${this.modalConfig.size}` : '';\n\n\t\tthis.rootElem.classList.add('fade');\n\t\tthis.rootElem.appendChild(\n\t\t\t<div className={`modal-dialog ${cssClass} ${modalSizeKlass} ${this.modalConfig.scrollContents ? 'modal-overflow-scroll' : ''}`} ref={dialogRef}>\n\t\t\t\t<div className=\"modal-content\">\n\t\t\t\t\t<div className={`modal-header ${this.modalConfig.header || this.modalConfig.title ? '' : 'p-0 border-0'}`} ref={headerRef}>\n\t\t\t\t\t\t{this.modalConfig.title && <h5 className=\"modal-title\">{this.modalConfig.title}</h5>}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tclassName={`btn-close ${this.modalConfig.closeButton?.fixed ? 'position-fixed' : ''}`}\n\t\t\t\t\t\t\tonclick={() => this.close()}\n\t\t\t\t\t\t\tattributes={{ 'aria-label': 'Close' }}>\n\t\t\t\t\t\t\t<i className=\"fas fa-times fa-2xl\"></i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"modal-body\" ref={bodyRef} />\n\t\t\t\t\t{this.modalConfig.footer && <div className=\"modal-footer\" ref={footerRef} />}\n\t\t\t\t</div>\n\t\t\t</div>,\n\t\t);\n\n\t\tthis.dialog = dialogRef.value!;\n\t\tthis.header = headerRef.value!;\n\t\tthis.body = bodyRef.value!;\n\t\tthis.footer = footerRef.value!;\n\n\t\tthis.modal = new Modal(this.rootElem, { keyboard: true });\n\t\tthis.open();\n\n\t\tthis.rootElem.addEventListener('hidden.bs.modal', _ => {\n\t\t\tthis.rootElem.remove();\n\t\t\tthis.dispose();\n\t\t});\n\t}\n\n\tprotected onShow(_e: Event) {\n\t\treturn;\n\t}\n\n\topen() {\n\t\tthis.rootElem.addEventListener('show.bs.modal', this.showBSFn.bind(this));\n\t\tthis.rootElem.addEventListener('hide.bs.modal', this.hideBSFn.bind(this));\n\t\tthis.rootElem.addEventListener('hidden.bs.modal', this.hiddenBSFn.bind(this));\n\t\tthis.modal.show();\n\t}\n\n\tclose() {\n\t\tthis.modal.hide();\n\t\tthis.rootElem.removeEventListener('show.bs.modal', this.showBSFn.bind(this));\n\t\tthis.rootElem.removeEventListener('hide.bs.modal', this.hideBSFn.bind(this));\n\t\tthis.rootElem.removeEventListener('hidden.bs.modal', this.hiddenBSFn.bind(this));\n\t}\n\n\t// Hacks for better looking multi modals\n\tprivate async showBSFn(event: Event) {\n\t\t// Prevent the event from bubbling up to parent modals\n\t\tevent.stopImmediatePropagation();\n\n\t\t// Wait for the backdrop to be injected into the DOM\n\t\tconst backdrop = (await new Promise(resolve => {\n\t\t\tsetTimeout(() => {\n\t\t\t\t// @ts-ignore\n\t\t\t\tif (this.modal._backdrop._element)\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\tresolve(this.modal._backdrop._element);\n\t\t\t}, 100);\n\t\t})) as HTMLElement;\n\t\t// Then move it from <body> to the parent element\n\t\tthis.rootElem.insertAdjacentElement('afterend', backdrop);\n\t\tthis.onShow(event);\n\t}\n\n\tprivate hideBSFn(event: Event) {\n\t\t// Prevent the event from bubbling up to parent modals\n\t\tevent.stopImmediatePropagation();\n\t}\n\n\tprivate hiddenBSFn(event: Event) {\n\t\t// Prevent the event from bubbling up to parent modals\n\t\t// Do not use stopImmediatePropagation here. It prevents Bootstrap from removing the modal,\n\t\t// leading to other issues\n\t\tevent.stopPropagation();\n\t}\n}\n","import { Tooltip } from 'bootstrap';\nimport { Component } from './component.js';\n\nimport { element, fragment } from 'tsx-vanilla';\n\nexport interface ContentBlockHeaderConfig {\n\ttitle: string,\n\textraCssClasses?: Array<string>,\n\ttitleTag?: string,\n\ttooltip?: string,\n}\n\nexport interface ContentBlockConfig {\n\tbodyClasses?: Array<string>,\n\textraCssClasses?: Array<string>,\n\trootElem?: HTMLElement,\n\theader?: ContentBlockHeaderConfig,\n}\n\nexport class ContentBlock extends Component {\n\treadonly headerElement: HTMLElement | null;\n\treadonly bodyElement: HTMLElement;\n\n\treadonly config: ContentBlockConfig;\n\n\tconstructor(parent: HTMLElement, cssClass: string, config: ContentBlockConfig) {\n\t\tsuper(parent, 'content-block', config.rootElem);\n\t\tthis.config = config;\n\t\tthis.rootElem.classList.add(cssClass);\n\n\t\tif (config.extraCssClasses) {\n\t\t\tthis.rootElem.classList.add(...config.extraCssClasses);\n\t\t}\n\n\t\tthis.headerElement = this.buildHeader();\n\t\tthis.bodyElement = this.buildBody();\n\t\tconfig.bodyClasses?.forEach((cl) => {\n\t\t\tthis.bodyElement.classList.add(cl);\n\t\t})\n\t}\n\n\tprivate buildHeader(): HTMLElement | null {\n\t\tif (this.config.header && Object.keys(this.config.header).length) {\n\t\t\tlet TitleTag = this.config.header.titleTag || 'h6';\n\t\t\tlet header =(\n\t\t\t\t<div className=\"content-block-header\">\n\t\t\t\t\t<TitleTag className=\"content-block-title\">\n\t\t\t\t\t\t{this.config.header.title}\n\t\t\t\t\t</TitleTag>\n\t\t\t\t</div>\n\t\t\t);\n\n\t\t\tif (this.config.header.extraCssClasses) {\n\t\t\t\theader.classList.add(...this.config.header.extraCssClasses);\n\t\t\t}\n\n\t\t\tif (this.config.header.tooltip)\n\t\t\t\tTooltip.getOrCreateInstance(header.querySelector('.content-block-title') as HTMLElement,  {\n\t\t\t\t\thtml: true,\n\t\t\t\t\ttitle: this.config.header.tooltip\n\t\t\t\t});\n\n\t\t\tthis.rootElem.appendChild(header);\n\n\t\t\treturn header as HTMLElement;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tprivate buildBody(): HTMLElement {\n\t\tlet bodyElem = document.createElement('div');\n\t\tbodyElem.classList.add('content-block-body');\n\n\t\tthis.rootElem.appendChild(bodyElem);\n\n\t\treturn bodyElem;\n\t}\n}\n","import { ItemQuality } from './proto/common.js';\n\nconst itemQualityCssClasses: Record<ItemQuality, string> = {\n\t[ItemQuality.ItemQualityJunk]: 'item-quality-junk',\n\t[ItemQuality.ItemQualityCommon]: 'item-quality-common',\n\t[ItemQuality.ItemQualityUncommon]: 'item-quality-uncommon',\n\t[ItemQuality.ItemQualityRare]: 'item-quality-rare',\n\t[ItemQuality.ItemQualityEpic]: 'item-quality-epic',\n\t[ItemQuality.ItemQualityLegendary]: 'item-quality-legendary',\n\t[ItemQuality.ItemQualityArtifact]: 'item-quality-artifact',\n\t[ItemQuality.ItemQualityHeirloom]: 'item-quality-heirloom'\n};\nexport function setItemQualityCssClass(elem: HTMLElement, quality: ItemQuality | null) {\n\tObject.values(itemQualityCssClasses).forEach(cssClass => elem.classList.remove(cssClass));\n\n\tif (quality) {\n\t\telem.classList.add(itemQualityCssClasses[quality]);\n\t}\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { element, fragment, ref } from 'tsx-vanilla';\n\nimport { BaseModal } from '../components/base_modal.js';\nimport { Component } from '../components/component.js';\nimport { ContentBlock } from '../components/content_block.js';\nimport { Input } from '../components/input.js';\nimport { getLanguageCode } from '../constants/lang';\nimport { setItemQualityCssClass } from '../css_utils.js';\nimport { Player } from '../player.js';\nimport { Glyphs, ItemQuality } from '../proto/common.js';\nimport { ActionId } from '../proto_utils/action_id.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { stringComparator } from '../utils.js';\n\nexport type GlyphConfig = {\n\tname: string;\n\tdescription: string;\n\ticonUrl: string;\n};\n\nexport type GlyphsConfig = {\n\tprimeGlyphs: Record<number, GlyphConfig>;\n\tmajorGlyphs: Record<number, GlyphConfig>;\n\tminorGlyphs: Record<number, GlyphConfig>;\n};\n\ninterface GlyphData {\n\tid: number;\n\tname: string;\n\tdescription: string;\n\ticonUrl: string;\n\tquality: ItemQuality | null;\n}\n\nconst emptyGlyphData: GlyphData = {\n\tid: 0,\n\tname: 'Empty',\n\tdescription: '',\n\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/medium/inventoryslot_empty.jpg',\n\tquality: null,\n};\n\nexport class GlyphsPicker extends Component {\n\tprivate readonly glyphsConfig: GlyphsConfig;\n\n\tprimeGlyphPickers: Array<GlyphPicker> = [];\n\tmajorGlyphPickers: Array<GlyphPicker> = [];\n\tminorGlyphPickers: Array<GlyphPicker> = [];\n\n\tconstructor(parent: HTMLElement, player: Player<any>, glyphsConfig: GlyphsConfig) {\n\t\tsuper(parent, 'glyphs-picker-root');\n\t\tthis.glyphsConfig = glyphsConfig;\n\n\t\tconst primeGlyphs = Object.keys(glyphsConfig.primeGlyphs).map(idStr => Number(idStr));\n\t\tconst majorGlyphs = Object.keys(glyphsConfig.majorGlyphs).map(idStr => Number(idStr));\n\t\tconst minorGlyphs = Object.keys(glyphsConfig.minorGlyphs).map(idStr => Number(idStr));\n\n\t\tconst primeGlyphsData = primeGlyphs.map(glyph => this.getGlyphData(glyph));\n\t\tconst majorGlyphsData = majorGlyphs.map(glyph => this.getGlyphData(glyph));\n\t\tconst minorGlyphsData = minorGlyphs.map(glyph => this.getGlyphData(glyph));\n\n\t\tprimeGlyphsData.sort((a, b) => stringComparator(a.name, b.name));\n\t\tmajorGlyphsData.sort((a, b) => stringComparator(a.name, b.name));\n\t\tminorGlyphsData.sort((a, b) => stringComparator(a.name, b.name));\n\n\t\tconst primeGlyphsBlock = new ContentBlock(this.rootElem, 'prime-glyphs', {\n\t\t\theader: { title: 'Prime Glyphs', extraCssClasses: ['border-0', 'mb-1'] },\n\t\t});\n\n\t\tconst majorGlyphsBlock = new ContentBlock(this.rootElem, 'major-glyphs', {\n\t\t\theader: { title: 'Major Glyphs', extraCssClasses: ['border-0', 'mb-1'] },\n\t\t});\n\n\t\tconst minorGlyphsBlock = new ContentBlock(this.rootElem, 'minor-glyphs', {\n\t\t\theader: { title: 'Minor Glyphs', extraCssClasses: ['border-0', 'mb-1'] },\n\t\t});\n\n\t\tthis.primeGlyphPickers = (['prime1', 'prime2', 'prime3'] as Array<keyof Glyphs>).map(glyphField => {\n\t\t\treturn new GlyphPicker(primeGlyphsBlock.bodyElement, player, primeGlyphsData, glyphField);\n\t\t});\n\n\t\tthis.majorGlyphPickers = (['major1', 'major2', 'major3'] as Array<keyof Glyphs>).map(glyphField => {\n\t\t\treturn new GlyphPicker(majorGlyphsBlock.bodyElement, player, majorGlyphsData, glyphField);\n\t\t});\n\n\t\tthis.minorGlyphPickers = (['minor1', 'minor2', 'minor3'] as Array<keyof Glyphs>).map(glyphField => {\n\t\t\treturn new GlyphPicker(minorGlyphsBlock.bodyElement, player, minorGlyphsData, glyphField);\n\t\t});\n\t}\n\n\t// In case we ever want to parse description from tooltip HTML.\n\t//static descriptionRegex = /<a href=\\\\\"\\/wotlk.*>(.*)<\\/a>/g;\n\tgetGlyphData(glyph: number): GlyphData {\n\t\tconst glyphConfig = this.glyphsConfig.primeGlyphs[glyph] || this.glyphsConfig.majorGlyphs[glyph] || this.glyphsConfig.minorGlyphs[glyph];\n\n\t\treturn {\n\t\t\tid: glyph,\n\t\t\tname: glyphConfig.name,\n\t\t\tdescription: glyphConfig.description,\n\t\t\ticonUrl: glyphConfig.iconUrl,\n\t\t\tquality: ItemQuality.ItemQualityCommon,\n\t\t};\n\t}\n}\n\nclass GlyphPicker extends Input<Player<any>, number> {\n\treadonly player: Player<any>;\n\n\tselectedGlyph: GlyphData | undefined;\n\n\tprivate readonly glyphOptions: Array<GlyphData>;\n\n\tprivate readonly anchorElem: HTMLAnchorElement;\n\tprivate readonly iconElem: HTMLImageElement;\n\tprivate readonly nameElem: HTMLSpanElement;\n\n\tconstructor(parent: HTMLElement, player: Player<any>, glyphOptions: Array<GlyphData>, glyphField: keyof Glyphs) {\n\t\tsuper(parent, 'glyph-picker-root', player, {\n\t\t\tinline: true,\n\t\t\tchangedEvent: (player: Player<any>) => player.glyphsChangeEmitter,\n\t\t\tgetValue: (player: Player<any>) => player.getGlyphs()[glyphField] as number,\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\t\t\tconst glyphs = player.getGlyphs();\n\t\t\t\t(glyphs[glyphField] as number) = newValue;\n\t\t\t\tplayer.setGlyphs(eventID, glyphs);\n\t\t\t},\n\t\t});\n\t\tthis.rootElem.classList.add('item-picker-root');\n\n\t\tthis.player = player;\n\t\tthis.glyphOptions = glyphOptions;\n\t\tthis.selectedGlyph = emptyGlyphData;\n\n\t\tconst anchorElemRef = ref<HTMLAnchorElement>();\n\t\tconst iconElemRef = ref<HTMLImageElement>();\n\t\tconst nameElemRef = ref<HTMLSpanElement>();\n\n\t\tthis.rootElem.appendChild(\n\t\t\t<a ref={anchorElemRef} attributes={{ role: 'button' }} className=\"d-flex w-100\">\n\t\t\t\t<img ref={iconElemRef} className=\"item-picker-icon\" />\n\t\t\t\t<div className=\"item-picker-labels-container\">\n\t\t\t\t\t<span ref={nameElemRef} className=\"item-picker-name\" />\n\t\t\t\t</div>\n\t\t\t</a>,\n\t\t);\n\n\t\tthis.anchorElem = anchorElemRef.value!;\n\t\tthis.iconElem = iconElemRef.value!;\n\t\tthis.nameElem = nameElemRef.value!;\n\n\t\tconst openGlyphSelectorModal = (event: Event) => {\n\t\t\tevent.preventDefault();\n\t\t\tnew GlyphSelectorModal(this.rootElem.closest('.individual-sim-ui')!, this, this.glyphOptions);\n\t\t};\n\n\t\tthis.anchorElem.addEventListener('click', openGlyphSelectorModal);\n\t\tthis.addOnDisposeCallback(() => this.anchorElem.removeEventListener('click', openGlyphSelectorModal));\n\n\t\tthis.init();\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.iconElem;\n\t}\n\n\tgetInputValue(): number {\n\t\treturn this.selectedGlyph?.id ?? 0;\n\t}\n\n\tsetInputValue(newValue: number) {\n\t\tthis.selectedGlyph = this.glyphOptions.find(glyphData => glyphData.id == newValue);\n\n\t\tif (this.selectedGlyph) {\n\t\t\tconst lang = getLanguageCode();\n\t\t\tconst langPrefix = lang ? `${lang}.` : '';\n\n\t\t\tthis.anchorElem.href = ActionId.makeItemUrl(this.selectedGlyph.id);\n\t\t\tthis.anchorElem.dataset.wowhead = `domain=${langPrefix}cata&dataEnv=11`;\n\t\t\tthis.anchorElem.dataset.whtticon = 'false';\n\n\t\t\tthis.iconElem.src = this.selectedGlyph.iconUrl;\n\n\t\t\tthis.nameElem.textContent = this.selectedGlyph.name;\n\t\t} else {\n\t\t\tthis.clear();\n\t\t}\n\t}\n\n\tprivate clear() {\n\t\tthis.anchorElem.removeAttribute('data-wowhead');\n\t\tthis.anchorElem.removeAttribute('href');\n\n\t\tthis.iconElem.src = emptyGlyphData.iconUrl;\n\t\tthis.nameElem.textContent = emptyGlyphData.name;\n\t}\n}\n\nclass GlyphSelectorModal extends BaseModal {\n\tconstructor(parent: HTMLElement, glyphPicker: GlyphPicker, glyphOptions: Array<GlyphData>) {\n\t\tsuper(parent, 'glyph-modal', { title: 'Glyphs' });\n\n\t\tthis.body.innerHTML = `\n\t\t\t<div class=\"input-root\">\n\t\t\t\t<input class=\"selector-modal-search form-control\" type=\"text\" placeholder=\"Search...\">\n\t\t\t</div>\n\t\t\t<ul class=\"selector-modal-list\"></ul>\n\t\t`;\n\n\t\tconst listElem = this.rootElem.getElementsByClassName('selector-modal-list')[0] as HTMLElement;\n\n\t\tglyphOptions = [emptyGlyphData].concat(glyphOptions);\n\t\tconst listItemElems = glyphOptions.map((glyphData, glyphIdx) => {\n\t\t\tconst listItemElem = document.createElement('li');\n\t\t\tlistItemElem.classList.add('selector-modal-list-item');\n\t\t\tlistElem.appendChild(listItemElem);\n\n\t\t\tlistItemElem.dataset.idx = String(glyphIdx);\n\n\t\t\tlistItemElem.innerHTML = `\n\t\t\t\t<a class=\"selector-modal-list-item-link\">\n\t\t\t\t\t<img class=\"selector-modal-list-item-icon\" />\n\t\t\t\t\t<label class=\"selector-modal-list-item-name\">${glyphData.name}</label>\n\t\t\t\t\t<span class=\"selector-modal-list-item-description\">${glyphData.description}</span>\n\t\t\t\t</a>\n      `;\n\n\t\t\tconst anchorElem = listItemElem.children[0] as HTMLAnchorElement;\n\t\t\tconst iconElem = listItemElem.querySelector('.selector-modal-list-item-icon') as HTMLImageElement;\n\t\t\tconst nameElem = listItemElem.querySelector('.selector-modal-list-item-name') as HTMLElement;\n\n\t\t\tanchorElem.href = glyphData.id == 0 ? '' : ActionId.makeItemUrl(glyphData.id);\n\t\t\tanchorElem.addEventListener('click', (event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tglyphPicker.setValue(TypedEvent.nextEventID(), glyphData.id);\n\t\t\t});\n\t\t\ticonElem.src = glyphData.iconUrl;\n\t\t\tsetItemQualityCssClass(nameElem, glyphData.quality);\n\n\t\t\treturn listItemElem;\n\t\t});\n\n\t\tconst updateSelected = () => {\n\t\t\tconst selectedGlyphId = glyphPicker.selectedGlyph?.id ?? 0;\n\n\t\t\tlistItemElems.forEach(elem => {\n\t\t\t\tconst listItemIdx = parseInt(elem.dataset.idx!);\n\t\t\t\tconst listItemData = glyphOptions[listItemIdx];\n\n\t\t\t\telem.classList.remove('active');\n\t\t\t\tif (listItemData.id == selectedGlyphId) {\n\t\t\t\t\telem.classList.add('active');\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\tupdateSelected();\n\n\t\tconst applyFilters = () => {\n\t\t\tlet validItemElems = listItemElems;\n\n\t\t\tvalidItemElems = validItemElems.filter(elem => {\n\t\t\t\tconst listItemIdx = parseInt(elem.dataset.idx!);\n\t\t\t\tconst listItemData = glyphOptions[listItemIdx];\n\n\t\t\t\tif (searchInput.value.length > 0) {\n\t\t\t\t\tconst searchQuery = searchInput.value.toLowerCase().split(' ');\n\t\t\t\t\tconst name = listItemData.name.toLowerCase();\n\n\t\t\t\t\tlet include = true;\n\t\t\t\t\tsearchQuery.forEach(v => {\n\t\t\t\t\t\tif (!name.includes(v)) include = false;\n\t\t\t\t\t});\n\t\t\t\t\tif (!include) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\n\t\t\tlistElem.innerHTML = ``;\n\t\t\tlistElem.append(...validItemElems);\n\t\t};\n\n\t\tconst searchInput = this.rootElem.getElementsByClassName('selector-modal-search')[0] as HTMLInputElement;\n\t\tsearchInput.addEventListener('input', applyFilters);\n\t\tsearchInput.addEventListener('keyup', ev => {\n\t\t\tif (ev.key == 'Enter') {\n\t\t\t\tlistItemElems.find(ele => {\n\t\t\t\t\tif (ele.classList.contains('hidden')) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tconst nameElem = ele.getElementsByClassName('selector-modal-list-item-name')[0] as HTMLElement;\n\t\t\t\t\tnameElem.click();\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tglyphPicker.player.glyphsChangeEmitter.on(() => {\n\t\t\tapplyFilters();\n\t\t\tupdateSelected();\n\t\t});\n\t}\n}\n","import { Tooltip } from 'bootstrap';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { element, fragment, ref } from 'tsx-vanilla';\n\nimport { Component } from '../components/component.js';\nimport { CopyButton } from '../components/copy_button.js';\nimport { Input, InputConfig } from '../components/input.js';\nimport { Player } from '../player.js';\nimport { PlayerClasses } from '../player_classes';\nimport { Class, Spec } from '../proto/common.js';\nimport { ActionId } from '../proto_utils/action_id.js';\nimport { getTalentTreePoints } from '../proto_utils/utils';\nimport { TypedEvent } from '../typed_event.js';\nimport { isRightClick, sum } from '../utils.js';\nimport { classGlyphsConfig } from './factory';\nimport { GlyphsPicker } from './glyphs_picker';\nimport { HunterPet } from './hunter_pet';\n\nexport const MAX_POINTS_PLAYER = 41;\nconst MAX_POINTS_HUNTER_PET = 17;\nconst MAX_POINTS_HUNTER_PET_BM = 21;\n\nconst PLAYER_TREES_UNLOCK_POINT_THRESHOLD = 31;\n\nexport interface TalentsPickerConfig<ModObject, TalentsProto> extends InputConfig<ModObject, string> {\n\tklass: Class;\n\tpointsPerRow: number;\n\ttrees: TalentsConfig<TalentsProto>;\n}\n\nexport class TalentsPicker<ModObject extends Player<any> | HunterPet<any>, TalentsProto> extends Input<ModObject, string> {\n\treadonly modObject: ModObject;\n\n\treadonly numRows: number;\n\treadonly numCols: number;\n\treadonly pointsPerRow: number;\n\n\tmaxPoints: number;\n\n\tprivate readonly config: TalentsPickerConfig<ModObject, TalentsProto>;\n\n\treadonly trees: Array<TalentTreePicker<TalentsProto>>;\n\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: TalentsPickerConfig<ModObject, TalentsProto>) {\n\t\tsuper(parent, 'talents-picker-root', modObject, { ...config });\n\t\tthis.modObject = modObject;\n\t\tthis.config = config;\n\t\tthis.pointsPerRow = config.pointsPerRow;\n\t\tthis.numRows = Math.max(...config.trees.map(treeConfig => treeConfig.talents.map(talentConfig => talentConfig.location.rowIdx).flat()).flat()) + 1;\n\t\tthis.numCols = Math.max(...config.trees.map(treeConfig => treeConfig.talents.map(talentConfig => talentConfig.location.colIdx).flat()).flat()) + 1;\n\n\t\tif (this.isHunterPet()) {\n\t\t\tif (this.modObject.player.isSpec(Spec.SpecBeastMasteryHunter)) {\n\t\t\t\tthis.maxPoints = MAX_POINTS_HUNTER_PET_BM;\n\t\t\t} else {\n\t\t\t\tthis.maxPoints = MAX_POINTS_HUNTER_PET;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.maxPoints = MAX_POINTS_PLAYER;\n\t\t}\n\n\t\tconst getPointsRemaining = (): number => this.maxPoints - modObject.getTalentTreePoints().reduce((sum, points) => sum + points, 0);\n\n\t\tconst containerElemRef = ref<HTMLDivElement>();\n\t\tconst pointsRemainingElemRef = ref<HTMLSpanElement>();\n\t\tconst actionsContainerRef = ref<HTMLDivElement>();\n\n\t\tconst carouselContainerRef = ref<HTMLDivElement>();\n\t\tconst carouselPrevBtnRef = ref<HTMLButtonElement>();\n\t\tconst carouselNextBtnRef = ref<HTMLButtonElement>();\n\n\t\tthis.rootElem.appendChild(\n\t\t\t<div className=\"talents-picker-inner\" ref={containerElemRef}>\n\t\t\t\t<div className=\"talents-picker-header\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label>Points Remaining:</label>\n\t\t\t\t\t\t<span className=\"talent-tree-points\" ref={pointsRemainingElemRef}>\n\t\t\t\t\t\t\t{getPointsRemaining()}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"talents-picker-actions\" ref={actionsContainerRef}></div>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"talents-carousel\" className=\"carousel slide\">\n\t\t\t\t\t<div className=\"carousel-inner\" ref={carouselContainerRef}></div>\n\t\t\t\t\t<button className=\"carousel-control-prev\" type=\"button\" ref={carouselPrevBtnRef}>\n\t\t\t\t\t\t<span className=\"carousel-control-prev-icon\" attributes={{ 'aria-hidden': true }}></span>\n\t\t\t\t\t\t<span className=\"visually-hidden\">Previous</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button className=\"carousel-control-next\" type=\"button\" ref={carouselNextBtnRef}>\n\t\t\t\t\t\t<span className=\"carousel-control-next-icon\" attributes={{ 'aria-hidden': true }}></span>\n\t\t\t\t\t\t<span className=\"visually-hidden\">Next</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>,\n\t\t);\n\n\t\tconst containerElem = containerElemRef.value!;\n\t\tconst carouselContainer = carouselContainerRef.value!;\n\t\tconst carouselPrevBtn = carouselPrevBtnRef.value!;\n\t\tconst carouselNextBtn = carouselNextBtnRef.value!;\n\n\t\tmodObject.talentsChangeEmitter.on(() => (pointsRemainingElemRef.value!.textContent = `${getPointsRemaining()}`));\n\n\t\tnew CopyButton(actionsContainerRef.value!, {\n\t\t\textraCssClasses: ['btn-sm', 'btn-outline-primary', 'copy-talents'],\n\t\t\tgetContent: () => modObject.getTalentsString(),\n\t\t\ttext: 'Copy',\n\t\t\ttooltip: 'Copy talent string',\n\t\t});\n\n\t\tthis.trees = this.config.trees.map((treeConfig, i) => {\n\t\t\tconst carouselItem = document.createElement('div');\n\t\t\tcarouselContainer.appendChild(carouselItem);\n\n\t\t\tcarouselItem.classList.add('carousel-item');\n\t\t\t// Set middle talents active by default for mobile slider\n\t\t\tif (i === 1) carouselItem.classList.add('active');\n\n\t\t\treturn new TalentTreePicker(carouselItem, treeConfig, this, config.klass, i);\n\t\t});\n\t\tthis.trees.forEach(tree => tree.talents.forEach(talent => talent.setPoints(0, false)));\n\n\t\tif (!this.isHunterPet()) {\n\t\t\tthis.updatePlayerTrees();\n\n\t\t\tlet carouselitemIdx = 0;\n\t\t\tconst slidePrev = () => {\n\t\t\t\tif (carouselitemIdx >= 1) return;\n\t\t\t\tcarouselitemIdx += 1;\n\t\t\t\tcarouselContainer.style.transform = `translateX(${33.3 * carouselitemIdx}%)`;\n\t\t\t\tcarouselContainer.children[Math.abs(carouselitemIdx - 2) % 3]!.classList.remove('active');\n\t\t\t\tcarouselContainer.children[Math.abs(carouselitemIdx - 1) % 3]!.classList.add('active');\n\t\t\t};\n\t\t\tconst slideNext = () => {\n\t\t\t\tif (carouselitemIdx <= -1) return;\n\t\t\t\tcarouselitemIdx -= 1;\n\t\t\t\tcarouselContainer.style.transform = `translateX(${33.3 * carouselitemIdx}%)`;\n\t\t\t\tcarouselContainer.children[Math.abs(carouselitemIdx) % 3]!.classList.remove('active');\n\t\t\t\tcarouselContainer.children[Math.abs(carouselitemIdx) + (1 % 3)]!.classList.add('active');\n\t\t\t};\n\n\t\t\tcarouselPrevBtn.addEventListener('click', slidePrev);\n\t\t\tcarouselNextBtn.addEventListener('click', slideNext);\n\n\t\t\tif (this.isPlayer()) {\n\t\t\t\tnew GlyphsPicker(containerElem, this.modObject, classGlyphsConfig[this.modObject.getClass()]);\n\t\t\t}\n\t\t}\n\n\t\tthis.init();\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.rootElem;\n\t}\n\n\tgetInputValue(): string {\n\t\treturn this.trees\n\t\t\t.map(tree => tree.getTalentsString())\n\t\t\t.join('-')\n\t\t\t.replace(/-+$/g, '');\n\t}\n\n\tsetInputValue(newValue: string) {\n\t\tconst parts = newValue.split('-');\n\t\tthis.trees.forEach((tree, idx) => tree.setTalentsString(parts[idx] || ''));\n\t\tthis.updateTrees();\n\t}\n\n\tupdateTrees() {\n\t\tif (this.isFull()) {\n\t\t\tthis.rootElem.classList.add('talents-full');\n\t\t} else {\n\t\t\tthis.rootElem.classList.remove('talents-full');\n\t\t}\n\t\tthis.trees.forEach(tree => tree.update());\n\n\t\t// Disable other player trees if the first tree is not filled to 31 points\n\t\tthis.updatePlayerTrees()\n\t}\n\n\tget numPoints() {\n\t\treturn sum(this.trees.map(tree => tree.numPoints));\n\t}\n\n\tisFull() {\n\t\treturn this.numPoints >= this.maxPoints;\n\t}\n\n\tsetMaxPoints(newMaxPoints: number) {\n\t\tif (newMaxPoints != this.maxPoints) {\n\t\t\tthis.maxPoints = newMaxPoints;\n\t\t\tthis.updateTrees();\n\t\t}\n\t}\n\n\tisPlayer(): this is TalentsPicker<Player<any>, TalentsProto> {\n\t\treturn !!(this.modObject as unknown as Player<any>)?.playerClass;\n\t}\n\n\tisHunterPet(): this is TalentsPicker<HunterPet<any>, TalentsProto> {\n\t\treturn !this.isPlayer();\n\t}\n\n\tprivate updatePlayerTrees() {\n\t\tif (this.isPlayer()) {\n\t\t\tconst specNumber = this.modObject.getPlayerSpec().specIndex\n\t\t\tconst pointsSpent = this.trees[specNumber].numPoints;\n\n\t\t\tif (pointsSpent < PLAYER_TREES_UNLOCK_POINT_THRESHOLD) {\n\t\t\t\t[0, 1, 2].forEach(i => {\n\t\t\t\t\tif (![specNumber].includes(i)) {\n\t\t\t\t\t\tthis.trees[i].rootElem.classList.add('disabled');\n\t\t\t\t\t\tthis.trees[i].resetPoints();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.trees[i].rootElem.classList.remove('disabled');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.enableSecondaryPlayerTrees();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate enableSecondaryPlayerTrees() {\n\t\tthis.trees.forEach(tree => tree.rootElem.classList.remove('disabled'));\n\t}\n}\n\nclass TalentTreePicker<TalentsProto> extends Component {\n\tprivate readonly config: TalentTreeConfig<TalentsProto>;\n\tprivate readonly title: HTMLElement;\n\tprivate readonly pointsElem: HTMLElement;\n\n\treadonly talents: Array<TalentPicker<TalentsProto>>;\n\treadonly picker: TalentsPicker<any, TalentsProto>;\n\n\t// The current number of points in this tree\n\tnumPoints: number;\n\n\tconstructor(parent: HTMLElement, config: TalentTreeConfig<TalentsProto>, picker: TalentsPicker<any, TalentsProto>, klass: Class, specNumber: number) {\n\t\tsuper(parent, 'talent-tree-picker-root');\n\t\tthis.config = config;\n\t\tthis.numPoints = 0;\n\t\tthis.picker = picker;\n\n\t\tthis.rootElem.appendChild(\n\t\t\t<>\n\t\t\t\t<div className=\"talent-tree-header\">\n\t\t\t\t\t<img src={this.getTreeIcon(klass, specNumber)} className=\"talent-tree-icon\" />\n\t\t\t\t\t<span className=\"talent-tree-title\"></span>\n\t\t\t\t\t<span className=\"talent-tree-points\"></span>\n\t\t\t\t\t<button className=\"talent-tree-reset btn btn-link link-danger\">\n\t\t\t\t\t\t<i className=\"fa fa-times\"></i>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"talent-tree-background\"></div>\n\t\t\t\t<div className=\"talent-tree-main\"></div>\n\t\t\t</>,\n\t\t);\n\n\t\tthis.title = this.rootElem.getElementsByClassName('talent-tree-title')[0] as HTMLElement;\n\t\tthis.pointsElem = this.rootElem.querySelector('.talent-tree-points') as HTMLElement;\n\n\t\tconst background = this.rootElem.querySelector('.talent-tree-background') as HTMLElement;\n\t\tbackground.style.backgroundImage = `url('${config.backgroundUrl}')`;\n\n\t\tconst main = this.rootElem.querySelector('.talent-tree-main') as HTMLElement;\n\t\tmain.style.gridTemplateRows = `repeat(${this.picker.numRows}, 1fr)`;\n\t\t// Add 2 for spacing on the sides\n\t\tmain.style.gridTemplateColumns = `repeat(${this.picker.numCols}, 1fr)`;\n\n\t\tconst iconSize = '3.5rem';\n\t\tmain.style.height = `calc(${iconSize} * ${this.picker.numRows})`;\n\t\tmain.style.maxWidth = `calc(${iconSize} * ${this.picker.numCols})`;\n\t\tthis.rootElem.style.maxWidth = `calc(${iconSize} * ${this.picker.numCols + 2})`;\n\n\t\tthis.talents = config.talents.map(talent => new TalentPicker(main, talent, this));\n\t\t// Process parent<->child mapping\n\t\tthis.talents.forEach(talent => {\n\t\t\tif (talent.config.prereqLocation) {\n\t\t\t\tthis.getTalent(talent.config.prereqLocation).config.childLocations!.push(talent.config.location);\n\t\t\t}\n\t\t});\n\t\t// Loop through all and have talent add in divs/items for child dependencies\n\t\t// It'd be nicer to have this in talent constructor but json would have to be updated\n\t\tconst recurseCalcIdx = (t: TalentPicker<TalentsProto>, z: number) => {\n\t\t\tt.initChildReqs();\n\t\t\tt.zIndex = z;\n\t\t\tfor (const cl of t.config.childLocations!) {\n\t\t\t\tconst c = this.getTalent(cl);\n\t\t\t\tc.parentReq = t.getChildReqArrow(cl);\n\t\t\t\trecurseCalcIdx(c, z - 2);\n\t\t\t}\n\t\t};\n\t\t// Start at top of each heirachy chain and recurse down\n\t\tfor (const t of this.talents) {\n\t\t\tif (t.config.childLocations!.length == 0) continue;\n\t\t\tif (t.config.prereqLocation !== undefined) continue;\n\t\t\trecurseCalcIdx(t, 20);\n\t\t}\n\t\tconst resetBtn = this.rootElem.querySelector('.talent-tree-reset') as HTMLElement;\n\t\tnew Tooltip(resetBtn, { title: 'Reset talent points' });\n\t\tresetBtn.addEventListener('click', _event => this.resetPoints());\n\t}\n\n\tupdate() {\n\t\tthis.title.innerHTML = this.config.name;\n\t\tthis.pointsElem.textContent = `${this.numPoints} / ${this.picker.maxPoints}`;\n\t\tthis.talents.forEach(talent => talent.update());\n\t}\n\n\tgetTalent(location: TalentLocation): TalentPicker<TalentsProto> {\n\t\tconst talent = this.talents.find(talent => talent.getRow() == location.rowIdx && talent.getCol() == location.colIdx);\n\t\tif (!talent) throw new Error('No talent found with location: ' + location);\n\t\treturn talent;\n\t}\n\n\tgetTalentsString(): string {\n\t\treturn this.talents\n\t\t\t.map(talent => String(talent.getPoints()))\n\t\t\t.join('')\n\t\t\t.replace(/0+$/g, '');\n\t}\n\n\tsetTalentsString(str: string) {\n\t\tthis.talents.forEach((talent, idx) => talent.setPoints(Number(str.charAt(idx)), false));\n\t}\n\n\tresetPoints() {\n\t\tthis.talents.forEach(talent => talent.setPoints(0, false));\n\t\tthis.picker.inputChanged(TypedEvent.nextEventID());\n\t}\n\n\tprivate getTreeIcon(klass: Class, specNumber: number): string {\n\t\tif (this.picker.isHunterPet()) {\n\t\t\tconst fileName = ['ability_druid_swipe.jpg', 'ability_hunter_pet_bear.jpg', 'ability_hunter_combatexperience.jpg'][specNumber];\n\t\t\treturn `https://wow.zamimg.com/images/wow/icons/medium/${fileName}`;\n\t\t} else {\n\t\t\treturn Object.values(PlayerClasses.fromProto(klass).specs)[specNumber].getIcon('medium');\n\t\t}\n\t}\n}\n\ntype ReqDir = 'down' | 'right' | 'left' | 'rightdown' | 'leftdown';\nclass TalentReqArrow extends Component {\n\tprivate dir: ReqDir;\n\tprivate zIdx: number;\n\treadonly parentLoc: TalentLocation;\n\treadonly childLoc: TalentLocation;\n\n\tconstructor(parent: HTMLElement, parentLoc: TalentLocation, childLoc: TalentLocation) {\n\t\tsuper(parent, 'talent-picker-req-arrow', document.createElement('div'));\n\t\tthis.zIdx = 0;\n\t\tthis.parentLoc = parentLoc;\n\t\tthis.childLoc = childLoc;\n\n\t\tthis.rootElem.style.gridRow = String(parentLoc.rowIdx + 1);\n\t\tthis.rootElem.style.gridColumn = String(parentLoc.colIdx + 1);\n\n\t\tlet rowEnd = Math.max(parentLoc.rowIdx, childLoc.rowIdx) + 1;\n\t\tlet colEnd = Math.max(parentLoc.colIdx, childLoc.colIdx) + 1;\n\n\t\t// Calculate where we need to 'point'\n\t\tif (parentLoc.rowIdx == childLoc.rowIdx) {\n\t\t\tthis.dir = parentLoc.colIdx < childLoc.colIdx ? 'right' : 'left';\n\t\t\tthis.rootElem.dataset.reqArrowColSize = String(Math.abs(parentLoc.colIdx - childLoc.colIdx));\n\t\t\tcolEnd = this.dir == 'left' ? colEnd + 1 : colEnd - 1;\n\t\t} else {\n\t\t\tif (parentLoc.colIdx == childLoc.colIdx) {\n\t\t\t\tthis.dir = 'down';\n\t\t\t\tthis.rootElem.dataset.reqArrowRowSize = String(Math.abs(parentLoc.rowIdx - childLoc.rowIdx));\n\t\t\t\trowEnd += 1;\n\t\t\t} else {\n\t\t\t\tthis.dir = parentLoc.colIdx < childLoc.colIdx ? 'rightdown' : 'leftdown';\n\t\t\t\tthis.rootElem.dataset.reqArrowColSize = String(Math.abs(parentLoc.colIdx - childLoc.colIdx));\n\t\t\t\tthis.rootElem.dataset.reqArrowRowSize = String(Math.abs(parentLoc.rowIdx - childLoc.rowIdx));\n\t\t\t\trowEnd += 1;\n\t\t\t\tcolEnd = this.dir == 'rightdown' ? colEnd + 1 : colEnd - 1;\n\t\t\t\tthis.rootElem.appendChild(<div></div>);\n\t\t\t}\n\t\t}\n\n\t\tthis.rootElem.style.gridRowEnd = String(rowEnd);\n\t\tthis.rootElem.style.gridColumnEnd = String(colEnd);\n\t\tthis.rootElem.classList.add(`talent-picker-req-arrow-${this.dir}`);\n\t}\n\n\tget zIndex() {\n\t\treturn this.zIdx;\n\t}\n\n\tset zIndex(z: number) {\n\t\tthis.zIdx = z;\n\t\tthis.rootElem.style.zIndex = String(z);\n\t}\n\n\tsetReqFufilled(isFufilled: boolean) {\n\t\tif (isFufilled) this.rootElem.dataset.reqActive = 'true';\n\t\telse delete this.rootElem.dataset.reqActive;\n\t}\n}\n\nclass TalentPicker<TalentsProto> extends Component {\n\treadonly config: TalentConfig<TalentsProto>;\n\tprivate readonly tree: TalentTreePicker<TalentsProto>;\n\tprivate readonly pointsDisplay: HTMLElement;\n\n\tprivate longTouchTimer?: number;\n\tprivate childReqs: TalentReqArrow[];\n\tprivate zIdx: number;\n\tparentReq: TalentReqArrow | null;\n\n\tconstructor(parent: HTMLElement, config: TalentConfig<TalentsProto>, tree: TalentTreePicker<TalentsProto>) {\n\t\tsuper(parent, 'talent-picker-root', document.createElement('a'));\n\t\tthis.config = config;\n\t\tthis.tree = tree;\n\t\tthis.childReqs = [];\n\t\tthis.parentReq = null;\n\t\tthis.zIdx = 0;\n\n\t\tthis.rootElem.style.gridRow = String(this.config.location.rowIdx + 1);\n\t\tthis.rootElem.style.gridColumn = String(this.config.location.colIdx + 1);\n\n\t\tthis.rootElem.dataset.maxPoints = String(this.config.maxPoints);\n\t\tthis.rootElem.dataset.whtticon = 'false';\n\n\t\tthis.pointsDisplay = document.createElement('span');\n\t\tthis.pointsDisplay.classList.add('talent-picker-points');\n\t\tthis.rootElem.appendChild(this.pointsDisplay);\n\n\t\tthis.rootElem.addEventListener('click', event => {\n\t\t\tevent.preventDefault();\n\t\t});\n\t\tthis.rootElem.addEventListener('contextmenu', event => {\n\t\t\tevent.preventDefault();\n\t\t});\n\t\tthis.rootElem.addEventListener('touchmove', _event => {\n\t\t\tif (this.longTouchTimer != undefined) {\n\t\t\t\tclearTimeout(this.longTouchTimer);\n\t\t\t\tthis.longTouchTimer = undefined;\n\t\t\t}\n\t\t});\n\t\tthis.rootElem.addEventListener('touchstart', event => {\n\t\t\tevent.preventDefault();\n\t\t\tthis.longTouchTimer = window.setTimeout(() => {\n\t\t\t\tthis.setPoints(0, true);\n\t\t\t\tthis.tree.picker.inputChanged(TypedEvent.nextEventID());\n\t\t\t\tthis.longTouchTimer = undefined;\n\t\t\t}, 750);\n\t\t});\n\t\tthis.rootElem.addEventListener('touchend', event => {\n\t\t\tevent.preventDefault();\n\t\t\tif (this.longTouchTimer != undefined) {\n\t\t\t\tclearTimeout(this.longTouchTimer);\n\t\t\t\tthis.longTouchTimer = undefined;\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet newPoints = this.getPoints() + 1;\n\t\t\tif (this.config.maxPoints < newPoints) {\n\t\t\t\tnewPoints = 0;\n\t\t\t}\n\t\t\tthis.setPoints(newPoints, true);\n\t\t\tthis.tree.picker.inputChanged(TypedEvent.nextEventID());\n\t\t});\n\t\tthis.rootElem.addEventListener('mousedown', event => {\n\t\t\tconst rightClick = isRightClick(event);\n\t\t\tif (rightClick) {\n\t\t\t\tthis.setPoints(this.getPoints() - 1, true);\n\t\t\t} else {\n\t\t\t\tthis.setPoints(this.getPoints() + 1, true);\n\t\t\t}\n\t\t\tthis.tree.picker.inputChanged(TypedEvent.nextEventID());\n\t\t});\n\t}\n\n\tinitChildReqs(): void {\n\t\tif (this.config.childLocations!.length == 0) return;\n\n\t\tfor (const c of this.config.childLocations!) {\n\t\t\tthis.childReqs.push(new TalentReqArrow(this.rootElem.parentElement!, this.config.location, c));\n\t\t}\n\t}\n\n\tgetChildReqArrow(loc: TalentLocation): TalentReqArrow {\n\t\tfor (const c of this.childReqs) {\n\t\t\tif (c.childLoc === loc) {\n\t\t\t\treturn c;\n\t\t\t}\n\t\t}\n\t\tthrow Error('missing child prereq?');\n\t}\n\n\tget zIndex() {\n\t\treturn this.zIdx;\n\t}\n\n\tset zIndex(z: number) {\n\t\tthis.zIdx = z;\n\t\tthis.rootElem.style.zIndex = String(this.zIdx);\n\n\t\tfor (const c of this.childReqs) {\n\t\t\tc.zIndex = this.zIdx - 1;\n\t\t}\n\t}\n\n\tgetRow(): number {\n\t\treturn this.config.location.rowIdx;\n\t}\n\n\tgetCol(): number {\n\t\treturn this.config.location.colIdx;\n\t}\n\n\tgetPoints(): number {\n\t\tconst pts = Number(this.rootElem.dataset.points);\n\t\treturn isNaN(pts) ? 0 : pts;\n\t}\n\n\tisFull(): boolean {\n\t\treturn this.getPoints() >= this.config.maxPoints;\n\t}\n\n\t// Returns whether setting the points to newPoints would be a valid talent tree.\n\tcanSetPoints(newPoints: number): boolean {\n\t\tconst oldPoints = this.getPoints();\n\n\t\tif (newPoints > oldPoints) {\n\t\t\tconst additionalPoints = newPoints - oldPoints;\n\n\t\t\tif (this.tree.picker.numPoints + additionalPoints > this.tree.picker.maxPoints) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.tree.numPoints < this.getRow() * this.tree.picker.pointsPerRow) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.config.prereqLocation) {\n\t\t\t\tif (!this.tree.getTalent(this.config.prereqLocation).isFull()) return false;\n\t\t\t}\n\t\t} else {\n\t\t\tconst removedPoints = oldPoints - newPoints;\n\n\t\t\t// Figure out whether any lower talents would have the row requirement\n\t\t\t// broken by subtracting points.\n\t\t\tconst pointTotalsByRow = [...Array(this.tree.picker.numRows).keys()]\n\t\t\t\t.map(rowIdx => this.tree.talents.filter(talent => talent.getRow() == rowIdx))\n\t\t\t\t.map(talentsInRow => sum(talentsInRow.map(talent => talent.getPoints())));\n\t\t\tpointTotalsByRow[this.getRow()] -= removedPoints;\n\n\t\t\tconst cumulativeTotalsByRow = pointTotalsByRow.map((_, rowIdx) => sum(pointTotalsByRow.slice(0, rowIdx + 1)));\n\n\t\t\tif (\n\t\t\t\t!this.tree.talents.every(\n\t\t\t\t\ttalent =>\n\t\t\t\t\t\ttalent.getPoints() == 0 ||\n\t\t\t\t\t\ttalent.getRow() == 0 ||\n\t\t\t\t\t\tcumulativeTotalsByRow[talent.getRow() - 1] >= talent.getRow() * this.tree.picker.pointsPerRow,\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfor (const c of this.config.childLocations!) {\n\t\t\t\tif (this.tree.getTalent(c).getPoints() > 0) return false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tsetPoints(newPoints: number, checkValidity: boolean) {\n\t\tconst oldPoints = this.getPoints();\n\t\tnewPoints = Math.max(0, newPoints);\n\t\tnewPoints = Math.min(this.config.maxPoints, newPoints);\n\n\t\tif (checkValidity && !this.canSetPoints(newPoints)) return;\n\n\t\tthis.tree.numPoints += newPoints - oldPoints;\n\t\tthis.rootElem.dataset.points = String(newPoints);\n\n\t\tthis.pointsDisplay.textContent = newPoints + '/' + this.config.maxPoints;\n\n\t\tif (this.isFull()) {\n\t\t\tthis.rootElem.classList.add('talent-full');\n\t\t} else {\n\t\t\tthis.rootElem.classList.remove('talent-full');\n\t\t}\n\n\t\tconst spellId = this.getSpellIdForPoints(newPoints);\n\t\tActionId.fromSpellId(spellId)\n\t\t\t.fill()\n\t\t\t.then(actionId => {\n\t\t\t\tactionId.setWowheadHref(this.rootElem as HTMLAnchorElement);\n\t\t\t\tthis.rootElem.style.backgroundImage = `url('${actionId.iconUrl}')`;\n\t\t\t});\n\t}\n\n\tgetSpellIdForPoints(numPoints: number): number {\n\t\t// 0-indexed rank of talent\n\t\tconst rank = Math.max(0, numPoints - 1);\n\n\t\tif (this.config.spellIds[rank]) {\n\t\t\treturn this.config.spellIds[rank];\n\t\t} else {\n\t\t\tthrow new Error(`No rank ${numPoints} for talent ${String(this.config.fieldName)}`);\n\t\t}\n\t}\n\n\tupdate() {\n\t\tconst canSetPoints = this.canSetPoints(this.getPoints() + 1);\n\t\tif (canSetPoints) {\n\t\t\tthis.rootElem.classList.add('talent-picker-can-add');\n\t\t} else {\n\t\t\tthis.rootElem.classList.remove('talent-picker-can-add');\n\t\t}\n\n\t\tif (this.parentReq) {\n\t\t\tthis.parentReq.setReqFufilled(canSetPoints || this.isFull());\n\t\t}\n\t}\n}\n\nexport type TalentsConfig<TalentsProto> = Array<TalentTreeConfig<TalentsProto>>;\n\nexport type TalentTreeConfig<TalentsProto> = {\n\tname: string;\n\tbackgroundUrl: string;\n\ttalents: Array<TalentConfig<TalentsProto>>;\n};\n\nexport type TalentLocation = {\n\t// 0-indexed row in the tree\n\trowIdx: number;\n\t// 0-indexed column in the tree\n\tcolIdx: number;\n};\n\nexport type TalentConfig<TalentsProto> = {\n\tfieldName?: keyof TalentsProto | string;\n\n\tlocation: TalentLocation;\n\n\t// Location of a prerequisite talent, if any\n\tprereqLocation?: TalentLocation;\n\n\t// Child talents depending on this talent. This is populated automatically.\n\tchildLocations?: TalentLocation[];\n\n\t// Spell ID for each rank of this talent.\n\t// Omitted ranks will be inferred by incrementing from the last provided rank.\n\tspellIds: Array<number>;\n\n\tmaxPoints: number;\n};\n\nexport function newTalentsConfig<TalentsProto>(talents: TalentsConfig<TalentsProto>): TalentsConfig<TalentsProto> {\n\ttalents.forEach(tree => {\n\t\ttree.talents.forEach((talent, i) => {\n\t\t\ttalent.childLocations = [];\n\t\t\t// Validate that talents are given in the correct order (left-to-right top-to-bottom).\n\t\t\tif (i != 0) {\n\t\t\t\tconst prevTalent = tree.talents[i - 1];\n\t\t\t\tif (\n\t\t\t\t\ttalent.location.rowIdx < prevTalent.location.rowIdx ||\n\t\t\t\t\t(talent.location.rowIdx == prevTalent.location.rowIdx && talent.location.colIdx <= prevTalent.location.colIdx)\n\t\t\t\t) {\n\t\t\t\t\tthrow new Error(`Out-of-order talent: ${String(talent.fieldName)}`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Infer omitted spell IDs.\n\t\t\tif (talent.spellIds.length < talent.maxPoints) {\n\t\t\t\tlet curSpellId = talent.spellIds[talent.spellIds.length - 1];\n\t\t\t\tfor (let pointIdx = talent.spellIds.length; pointIdx < talent.maxPoints; pointIdx++) {\n\t\t\t\t\tcurSpellId++;\n\t\t\t\t\ttalent.spellIds.push(curSpellId);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\treturn talents;\n}\n","import {DeathKnightMajorGlyph, DeathKnightMinorGlyph, DeathKnightPrimeGlyph, DeathKnightTalents } from '../proto/death_knight';\nimport { GlyphsConfig } from './glyphs_picker.jsx';\nimport { newTalentsConfig, TalentsConfig } from './talents_picker.jsx';\nimport DkTalentsJson from './trees/death_knight.json';\n\nexport const deathKnightTalentsConfig: TalentsConfig<DeathKnightTalents> = newTalentsConfig(DkTalentsJson);\n\nexport const deathKnightGlyphsConfig: GlyphsConfig = {\n\tprimeGlyphs: {\n\t\t[DeathKnightPrimeGlyph.GlyphOfDeathAndDecay]: {\n\t\t\tname: 'Glyph of Death and Decay',\n\t\t\tdescription: 'Increases the duration of your Death and Decay spell by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathanddecay.jpg',\n\t\t},\n\t\t[DeathKnightPrimeGlyph.GlyphOfDeathCoil]: {\n\t\t\tname: 'Glyph of Death Coil',\n\t\t\tdescription: 'Increases the damage or healing done by Death Coil by 15%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathcoil.jpg',\n\t\t},\n\t\t[DeathKnightPrimeGlyph.GlyphOfDeathStrike]: {\n\t\t\tname: 'Glyph of Death Strike',\n\t\t\tdescription: 'Increases your Death Strike\\'s damage by 2% for every 5 Runic Power you currently have (up to a maximum of 40%). The Runic Power is not consumed by this effect.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_butcher2.jpg',\n\t\t},\n\t\t[DeathKnightPrimeGlyph.GlyphOfFrostStrike]: {\n\t\t\tname: 'Glyph of Frost Strike',\n\t\t\tdescription: 'Reduces the cost of your Frost Strike by 8 Runic Power.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_empowerruneblade2.jpg',\n\t\t},\n\t\t[DeathKnightPrimeGlyph.GlyphOfHeartStrike]: {\n\t\t\tname: 'Glyph of Heart Strike',\n\t\t\tdescription: 'Increases the damage of your Heart Strike ability by 30%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_weapon_shortblade_40.jpg',\n\t\t},\n\t\t[DeathKnightPrimeGlyph.GlyphOfHowlingBlast]: {\n\t\t\tname: 'Glyph of Howling Blast',\n\t\t\tdescription: 'Your Howling Blast ability now infects your targets with Frost Fever.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_arcticwinds.jpg',\n\t\t},\n\t\t[DeathKnightPrimeGlyph.GlyphOfIcyTouch]: {\n\t\t\tname: 'Glyph of Icy Touch',\n\t\t\tdescription: 'Your Frost Fever disease deals 20% additional damage.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_icetouch.jpg',\n\t\t},\n\t\t[DeathKnightPrimeGlyph.GlyphOfObliterate]: {\n\t\t\tname: 'Glyph of Obliterate',\n\t\t\tdescription: 'Increases the damage of your Obliterate ability by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_classicon.jpg',\n\t\t},\n\t\t[DeathKnightPrimeGlyph.GlyphOfRaiseDead]: {\n\t\t\tname: 'Glyph of Raise Dead',\n\t\t\tdescription: 'Your Ghoul receives an additional 40% of your Strength and 40% of your Stamina.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_animatedead.jpg',\n\t\t},\n\t\t[DeathKnightPrimeGlyph.GlyphOfRuneStrike]: {\n\t\t\tname: 'Glyph of Rune Strike',\n\t\t\tdescription: 'Increases the critical strike chance of your Rune Strike by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_darkconviction.jpg',\n\t\t},\n\t\t[DeathKnightPrimeGlyph.GlyphOfScourgeStrike]: {\n\t\t\tname: 'Glyph of Scourge Strike',\n\t\t\tdescription: 'Increases the Shadow damage portion of your Scourge Strike by 30%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_scourgestrike.jpg',\n\t\t},\n\t},\n\tmajorGlyphs: {\n\t\t[DeathKnightMajorGlyph.GlyphOfAntiMagicShell]: {\n\t\t\tname: 'Glyph of Anti-Magic Shell',\n\t\t\tdescription: 'Increases the duration of your Anti-Magic Shell by 2 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_antimagicshell.jpg',\n\t\t},\n\t\t[DeathKnightMajorGlyph.GlyphOfBloodBoil]: {\n\t\t\tname: 'Glyph of Blood Boil',\n\t\t\tdescription: 'Increases the radius of your Blood Boil ability by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_bloodboil.jpg',\n\t\t},\n\t\t[DeathKnightMajorGlyph.GlyphOfBoneShield]: {\n\t\t\tname: 'Glyph of Bone Shield',\n\t\t\tdescription: 'Increases your movement speed by 15% while Bone Shield is active. This does not stack with other movement-speed increasing effects.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_deathknight_boneshield.jpg',\n\t\t},\n\t\t[DeathKnightMajorGlyph.GlyphOfChainsOfIce]: {\n\t\t\tname: 'Glyph of Chains of Ice',\n\t\t\tdescription: 'Your Chains of Ice also causes 144 to 156 Frost damage, with additional damage depending on your attack power.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_chainsofice.jpg',\n\t\t},\n\t\t[DeathKnightMajorGlyph.GlyphOfDancingRuneWeapon]: {\n\t\t\tname: 'Glyph of Dancing Rune Weapon',\n\t\t\tdescription: 'Increases your threat generation by 50% while your Dancing Rune Weapon is active.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_sword_07.jpg',\n\t\t},\n\t\t[DeathKnightMajorGlyph.GlyphOfDarkSuccor]: {\n\t\t\tname: 'Glyph of Dark Succor',\n\t\t\tdescription: 'Your next Death Strike performed while in Frost or Unholy Presence, within 15 sec after killing an enemy that yields experience or honor, will restore at least 20% of your maximum health.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_butcher2.jpg',\n\t\t},\n\t\t[DeathKnightMajorGlyph.GlyphOfDeathGrip]: {\n\t\t\tname: 'Glyph of Death Grip',\n\t\t\tdescription: 'Increases the range of your Death Grip ability by 5 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_strangulate.jpg',\n\t\t},\n\t\t[DeathKnightMajorGlyph.GlyphOfHungeringCold]: {\n\t\t\tname: 'Glyph of Hungering Cold',\n\t\t\tdescription: 'Your Hungering Cold ability no longer costs runic power.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_staff_15.jpg',\n\t\t},\n\t\t[DeathKnightMajorGlyph.GlyphOfPestilence]: {\n\t\t\tname: 'Glyph of Pestilence',\n\t\t\tdescription: 'Increases the radius of your Pestilence effect by 5 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_plaguecloud.jpg',\n\t\t},\n\t\t[DeathKnightMajorGlyph.GlyphOfPillarOfFrost]: {\n\t\t\tname: 'Glyph of Pillar of Frost',\n\t\t\tdescription: 'Empowers your Pillar of Frost, making you immune to all effects that cause loss of control of your character, but also freezing you in place while the ability is active.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_deathknight_pillaroffrost.jpg',\n\t\t},\n\t\t[DeathKnightMajorGlyph.GlyphOfRuneTap]: {\n\t\t\tname: 'Glyph of Rune Tap',\n\t\t\tdescription: 'Your Rune Tap also heals your party for 5% of their maximum health.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_runetap.jpg',\n\t\t},\n\t\t[DeathKnightMajorGlyph.GlyphOfStrangulate]: {\n\t\t\tname: 'Glyph of Strangulate',\n\t\t\tdescription: 'Increases the Silence duration of your Strangulate ability by 2 sec when used on a target who is casting a spell.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_soulleech_3.jpg',\n\t\t},\n\t\t[DeathKnightMajorGlyph.GlyphOfVampiricBlood]: {\n\t\t\tname: 'Glyph of Vampiric Blood',\n\t\t\tdescription: 'Increases the bonus healing received while your Vampiric Blood is active by an additional 15%, but your Vampiric Blood no longer grants you health.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg',\n\t\t},\n\t},\n\tminorGlyphs: {\n\t\t[DeathKnightMinorGlyph.GlyphOfBloodTap]: {\n\t\t\tname: 'Glyph of Blood Tap',\n\t\t\tdescription: 'Your Blood Tap no longer causes damage to you.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_bloodtap.jpg',\n\t\t},\n\t\t[DeathKnightMinorGlyph.GlyphOfDeathGate]: {\n\t\t\tname: 'Glyph of Death Gate',\n\t\t\tdescription: 'Reduces the cast time of your Death Gate spell by 60%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_arcane_teleportundercity.jpg',\n\t\t},\n\t\t[DeathKnightMinorGlyph.GlyphOfDeathSEmbrace]: {\n\t\t\tname: 'Glyph of Death\\'s Embrace',\n\t\t\tdescription: 'Your Death Coil refunds 20 Runic Power when used to heal an allied minion.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathcoil.jpg',\n\t\t},\n\t\t[DeathKnightMinorGlyph.GlyphOfHornOfWinter]: {\n\t\t\tname: 'Glyph of Horn of Winter',\n\t\t\tdescription: 'Increases the duration of your Horn of Winter ability by 1 min.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_horn_02.jpg',\n\t\t},\n\t\t[DeathKnightMinorGlyph.GlyphOfPathOfFrost]: {\n\t\t\tname: 'Glyph of Path of Frost',\n\t\t\tdescription: 'Your Path of Frost ability allows you to fall from a greater distance without suffering damage.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_pathoffrost.jpg',\n\t\t},\n\t\t[DeathKnightMinorGlyph.GlyphOfResilientGrip]: {\n\t\t\tname: 'Glyph of Resilient Grip',\n\t\t\tdescription: 'When your Death Grip ability fails because its target is immune, its cooldown is reset.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_strangulate.jpg',\n\t\t},\n\t},\n};","import {DruidMajorGlyph, DruidMinorGlyph,DruidPrimeGlyph, DruidTalents } from '../proto/druid.js';\nimport { GlyphsConfig, } from './glyphs_picker.js';\nimport { newTalentsConfig,TalentsConfig } from './talents_picker.js';\nimport DruidTalentsJson from './trees/druid.json';\n\nexport const druidTalentsConfig: TalentsConfig<DruidTalents> = newTalentsConfig(DruidTalentsJson);\n\nexport const druidGlyphsConfig: GlyphsConfig = {\n\tprimeGlyphs: {\n\t\t[DruidPrimeGlyph.GlyphOfBerserk]: {\n\t\t\tname: 'Glyph of Berserk',\n\t\t\tdescription: 'Increases the duration of Berserk by 10 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_berserk.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfBloodletting]: {\n\t\t\tname: 'Glyph of Bloodletting',\n\t\t\tdescription: 'Each time you Shred or Mangle in Cat Form, the duration of your Rip on the target is extended by 2 sec, up to a maximum of 6 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_vampiricaura.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfInsectSwarm]: {\n\t\t\tname: 'Glyph of Insect Swarm',\n\t\t\tdescription: 'Increases the damage of your Insect Swarm ability by 30%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_insectswarm.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfLacerate]: {\n\t\t\tname: 'Glyph of Lacerate',\n\t\t\tdescription: 'Increases the critical strike chance of your Lacerate ability by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_lacerate.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfLifebloom]: {\n\t\t\tname: 'Glyph of Lifebloom',\n\t\t\tdescription: 'Increases the critical effect chance of your Lifebloom by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_herb_felblossom.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfMangle]: {\n\t\t\tname: 'Glyph of Mangle',\n\t\t\tdescription: 'Increases the damage done by Mangle by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_mangle2.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfMoonfire]: {\n\t\t\tname: 'Glyph of Moonfire',\n\t\t\tdescription: 'Increases the periodic damage of your Moonfire ability by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_starfall.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfRegrowth]: {\n\t\t\tname: 'Glyph of Regrowth',\n\t\t\tdescription: 'Your Regrowth heal-over-time will automatically refresh its duration on targets at or below 50% health.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_resistnature.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfRejuvenation]: {\n\t\t\tname: 'Glyph of Rejuvenation',\n\t\t\tdescription: 'Increases the healing done by your Rejuvenation by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_rejuvenation.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfRip]: {\n\t\t\tname: 'Glyph of Rip',\n\t\t\tdescription: 'Increases the periodic damage of your Rip by 15%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_ghoulfrenzy.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfSavageRoar]: {\n\t\t\tname: 'Glyph of Savage Roar',\n\t\t\tdescription: 'Your Savage Roar ability grants an additional 5% bonus damage done.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_skinteeth.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfStarfire]: {\n\t\t\tname: 'Glyph of Starfire',\n\t\t\tdescription: 'Your Starfire ability increases the duration of your Moonfire effect on the target by 3 sec, up to a maximum of 9 additional seconds. Only functions on the target with your most recently applied Moonfire.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_arcane_starfire.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfStarsurge]: {\n\t\t\tname: 'Glyph of Starsurge',\n\t\t\tdescription: 'When your Starsurge deals damage, the cooldown remaining on your Starfall is reduced by 5 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_arcane_arcane03.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfSwiftmend]: {\n\t\t\tname: 'Glyph of Swiftmend',\n\t\t\tdescription: 'Your Swiftmend ability no longer consumes a Rejuvenation or Regrowth effect from the target.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_relics_idolofrejuvenation.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfTigersFury]: {\n\t\t\tname: 'Glyph of Tiger\\'s Fury',\n\t\t\tdescription: 'Reduces the cooldown of your Tiger\\'s Fury ability by 3 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mount_jungletiger.jpg',\n\t\t},\n\t\t[DruidPrimeGlyph.GlyphOfWrath]: {\n\t\t\tname: 'Glyph of Wrath',\n\t\t\tdescription: 'Increases the damage done by your Wrath by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_wrathv2.jpg',\n\t\t},\n\t},\n\tmajorGlyphs: {\n\t\t[DruidMajorGlyph.GlyphOfBarkskin]: {\n\t\t\tname: 'Glyph of Barkskin',\n\t\t\tdescription: 'Reduces the chance you\\'ll be critically hit by 25% while Barkskin is active.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_stoneclawtotem.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfEntanglingRoots]: {\n\t\t\tname: 'Glyph of Entangling Roots',\n\t\t\tdescription: 'Reduces the cast time of your Entangling Roots by 0.2 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_stranglevines.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfFaerieFire]: {\n\t\t\tname: 'Glyph of Faerie Fire',\n\t\t\tdescription: 'Increases the range of your Faerie Fire and Feral Faerie Fire abilities by 10 yds.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_faeriefire.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfFeralCharge]: {\n\t\t\tname: 'Glyph of Feral Charge',\n\t\t\tdescription: 'Reduces the cooldown of your Feral Charge (Cat) ability by 2 sec and the cooldown of your Feral Charge (Bear) ability by 1 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_pet_bear.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfFerociousBite]: {\n\t\t\tname: 'Glyph of Ferocious Bite',\n\t\t\tdescription: 'Your Ferocious Bite ability heals you for 1% of your maximum health for each 10 energy used.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_ferociousbite.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfFocus]: {\n\t\t\tname: 'Glyph of Focus',\n\t\t\tdescription: 'Increases the damage done by Starfall by 10%, but decreases its radius by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_arcane_arcanepotency.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfFrenziedRegeneration]: {\n\t\t\tname: 'Glyph of Frenzied Regeneration',\n\t\t\tdescription: 'While Frenzied Regeneration is active, healing effects on you are 30% more powerful but causes your Frenzied Regeneration to no longer convert rage into health.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_bullrush.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfHealingTouch]: {\n\t\t\tname: 'Glyph of Healing Touch',\n\t\t\tdescription: 'When you cast Healing Touch, the cooldown on your Nature\\'s Swiftness is reduced by 10 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingtouch.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfHurricane]: {\n\t\t\tname: 'Glyph of Hurricane',\n\t\t\tdescription: 'Your Hurricane ability now also slows the movement speed of its victims by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_cyclone.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfInnervate]: {\n\t\t\tname: 'Glyph of Innervate',\n\t\t\tdescription: 'When Innervate is cast on a friendly target other than the caster, the caster will gain 10% of maximum mana over 10 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfMaul]: {\n\t\t\tname: 'Glyph of Maul',\n\t\t\tdescription: 'Your Maul ability now hits 1 additional target for 50% damage.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_maul.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfMonsoon]: {\n\t\t\tname: 'Glyph of Monsoon',\n\t\t\tdescription: 'Reduces the cooldown of your Typhoon spell by 3 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_riptide.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfOmenOfClarity]: {\n\t\t\tname: 'Glyph of Omen of Clarity',\n\t\t\tdescription: 'Your Omen of Clarity talent has a 100% chance to be triggered by successfully casting Faerie Fire (Feral). Does not trigger on players or player-controlled pets.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_questionmark.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfPounce]: {\n\t\t\tname: 'Glyph of Pounce',\n\t\t\tdescription: 'Increases the range of your Pounce by 3 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_supriseattack.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfRebirth]: {\n\t\t\tname: 'Glyph of Rebirth',\n\t\t\tdescription: 'Players resurrected by Rebirth are returned to life with 100% health.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_reincarnation.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfSolarBeam]: {\n\t\t\tname: 'Glyph of Solar Beam',\n\t\t\tdescription: 'Increases the duration of your Solar Beam silence effect by 5 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_vehicle_sonicshockwave.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfStarfall]: {\n\t\t\tname: 'Glyph of Starfall',\n\t\t\tdescription: 'Reduces the cooldown of Starfall by 30 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_starfall.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfThorns]: {\n\t\t\tname: 'Glyph of Thorns',\n\t\t\tdescription: 'Reduces the cooldown of your Thorns spell by 20 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_thorns.jpg',\n\t\t},\n\t\t[DruidMajorGlyph.GlyphOfWildGrowth]: {\n\t\t\tname: 'Glyph of Wild Growth',\n\t\t\tdescription: 'Wild Growth can affect 1 additional target, but its cooldown is increased by 2 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_flourish.jpg',\n\t\t},\n\t},\n\tminorGlyphs: {\n\t\t[DruidMinorGlyph.GlyphOfAquaticForm]: {\n\t\t\tname: 'Glyph of Aquatic Form',\n\t\t\tdescription: 'Increases your swim speed by 50% while in Aquatic Form.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_aquaticform.jpg',\n\t\t},\n\t\t[DruidMinorGlyph.GlyphOfChallengingRoar]: {\n\t\t\tname: 'Glyph of Challenging Roar',\n\t\t\tdescription: 'Reduces the cooldown of your Challenging Roar ability by 30 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_challangingroar.jpg',\n\t\t},\n\t\t[DruidMinorGlyph.GlyphOfDash]: {\n\t\t\tname: 'Glyph of Dash',\n\t\t\tdescription: 'Reduces the cooldown of your Dash ability by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_dash.jpg',\n\t\t},\n\t\t[DruidMinorGlyph.GlyphOfMarkOfTheWild]: {\n\t\t\tname: 'Glyph of Mark of the Wild',\n\t\t\tdescription: 'Mana cost of your Mark of the Wild reduced by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_giftofthewild.jpg',\n\t\t},\n\t\t[DruidMinorGlyph.GlyphOfTheTreant]: {\n\t\t\tname: 'Glyph of the Treant',\n\t\t\tdescription: 'Your Tree of Life Form now resembles a Treant.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_treeoflife.jpg',\n\t\t},\n\t\t[DruidMinorGlyph.GlyphOfTyphoon]: {\n\t\t\tname: 'Glyph of Typhoon',\n\t\t\tdescription: 'Reduces the cost of your Typhoon spell by 8% and increases its radius by 10 yards, but it no longer knocks enemies back.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_typhoon.jpg',\n\t\t},\n\t\t[DruidMinorGlyph.GlyphOfUnburdenedRebirth]: {\n\t\t\tname: 'Glyph of Unburdened Rebirth',\n\t\t\tdescription: 'Your Rebirth spell no longer requires a reagent.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_wispsplodegreen.jpg',\n\t\t},\n\t},\n};\n","import { HunterMajorGlyph, HunterMinorGlyph, HunterPetTalents, HunterPrimeGlyph, HunterTalents } from '../proto/hunter.js';\nimport { GlyphsConfig } from './glyphs_picker.js';\nimport { newTalentsConfig,TalentsConfig } from './talents_picker.js';\nimport HunterTalentJson from './trees/hunter.json';\n\nexport const hunterTalentsConfig: TalentsConfig<HunterTalents> = newTalentsConfig(HunterTalentJson);\n\nexport const hunterGlyphsConfig: GlyphsConfig = {\n\tprimeGlyphs: {\n\t\t[HunterPrimeGlyph.GlyphOfAimedShot]: {\n\t\t\tname: 'Glyph of Aimed Shot',\n\t\t\tdescription: 'When you critically hit with Aimed Shot, you instantly gain 5 Focus.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_spear_07.jpg',\n\t\t},\n\t\t[HunterPrimeGlyph.GlyphOfArcaneShot]: {\n\t\t\tname: 'Glyph of Arcane Shot',\n\t\t\tdescription: 'Your Arcane Shot deals 12% more damage.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_impalingbolt.jpg',\n\t\t},\n\t\t[HunterPrimeGlyph.GlyphOfChimeraShot]: {\n\t\t\tname: 'Glyph of Chimera Shot',\n\t\t\tdescription: 'Reduces the cooldown of Chimera Shot by 1 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_chimerashot2.jpg',\n\t\t},\n\t\t[HunterPrimeGlyph.GlyphOfDazzledPrey]: {\n\t\t\tname: 'Glyph of Dazzled Prey',\n\t\t\tdescription: 'Your Steady Shot and Cobra Shot abilities generate an additional 2 Focus on targets afflicted by a daze effect.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_cheatdeath.jpg',\n\t\t},\n\t\t[HunterPrimeGlyph.GlyphOfExplosiveShot]: {\n\t\t\tname: 'Glyph of Explosive Shot',\n\t\t\tdescription: 'Increases the critical strike chance of Explosive Shot by 6%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_explosiveshot.jpg',\n\t\t},\n\t\t[HunterPrimeGlyph.GlyphOfKillCommand]: {\n\t\t\tname: 'Glyph of Kill Command',\n\t\t\tdescription: 'Reduces the Focus cost of your Kill Command by 3.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_killcommand.jpg',\n\t\t},\n\t\t[HunterPrimeGlyph.GlyphOfKillShot]: {\n\t\t\tname: 'Glyph of Kill Shot',\n\t\t\tdescription: 'If the damage from your Kill Shot fails to kill a target at or below 20% health, your Kill Shot\\'s cooldown is instantly reset. This effect has a 6 sec cooldown.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_assassinate2.jpg',\n\t\t},\n\t\t[HunterPrimeGlyph.GlyphOfRapidFire]: {\n\t\t\tname: 'Glyph of Rapid Fire',\n\t\t\tdescription: 'Increases the haste from Rapid Fire by an additional 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_runningshot.jpg',\n\t\t},\n\t\t[HunterPrimeGlyph.GlyphOfSerpentSting]: {\n\t\t\tname: 'Glyph of Serpent Sting',\n\t\t\tdescription: 'Increases the periodic critical strike chance of your Serpent Sting by 6%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_quickshot.jpg',\n\t\t},\n\t\t[HunterPrimeGlyph.GlyphOfSteadyShot]: {\n\t\t\tname: 'Glyph of Steady Shot',\n\t\t\tdescription: 'Increases the damage dealt by Steady Shot by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_steadyshot.jpg',\n\t\t},\n\t},\n\tmajorGlyphs: {\n\t\t[HunterMajorGlyph.GlyphOfBestialWrath]: {\n\t\t\tname: 'Glyph of Bestial Wrath',\n\t\t\tdescription: 'Decreases the cooldown of Bestial Wrath by 20 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_ferociousbite.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfConcussiveShot]: {\n\t\t\tname: 'Glyph of Concussive Shot',\n\t\t\tdescription: 'Your Concussive Shot also limits the maximum run speed of your target.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_stun.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfDeterrence]: {\n\t\t\tname: 'Glyph of Deterrence',\n\t\t\tdescription: 'Decreases the cooldown of Deterrence by 10 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_whirlwind.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfDisengage]: {\n\t\t\tname: 'Glyph of Disengage',\n\t\t\tdescription: 'Decreases the cooldown of Disengage by 5 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_feint.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfFreezingTrap]: {\n\t\t\tname: 'Glyph of Freezing Trap',\n\t\t\tdescription: 'When your Freezing Trap breaks, the victim\\'s movement speed is reduced by 70% for 4 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_chainsofice.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfIceTrap]: {\n\t\t\tname: 'Glyph of Ice Trap',\n\t\t\tdescription: 'Increases the radius of the effect from your Ice Trap by 2 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostnova.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfImmolationTrap]: {\n\t\t\tname: 'Glyph of Immolation Trap',\n\t\t\tdescription: 'Decreases the duration of the effect from your Immolation Trap by 6 sec, but damage while active is increased by 100%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_flameshock.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfMasterSCall]: {\n\t\t\tname: 'Glyph of Master\\'s Call',\n\t\t\tdescription: 'Increases the duration of your Master\\'s Call by 4 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_masterscall.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfMending]: {\n\t\t\tname: 'Glyph of Mending',\n\t\t\tdescription: 'Increases the total amount of healing done by your Mend Pet ability by 60%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_mendpet.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfMisdirection]: {\n\t\t\tname: 'Glyph of Misdirection',\n\t\t\tdescription: 'When you use Misdirection on your pet, the cooldown on your Misdirection is reset.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_misdirection.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfRaptorStrike]: {\n\t\t\tname: 'Glyph of Raptor Strike',\n\t\t\tdescription: 'Reduces damage taken by 20% for 5 sec after using Raptor Strike.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_meleedamage.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfScatterShot]: {\n\t\t\tname: 'Glyph of Scatter Shot',\n\t\t\tdescription: 'Increases the range of Scatter Shot by 3 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_golemstormbolt.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfSilencingShot]: {\n\t\t\tname: 'Glyph of Silencing Shot',\n\t\t\tdescription: 'When you successfully silence an enemy\\'s spell cast with Silencing Shot, you instantly gain 10 Focus.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_theblackarrow.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfSnakeTrap]: {\n\t\t\tname: 'Glyph of Snake Trap',\n\t\t\tdescription: 'Snakes from your Snake Trap take 90% reduced damage from area of effect spells.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_snaketrap.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfTrapLauncher]: {\n\t\t\tname: 'Glyph of Trap Launcher',\n\t\t\tdescription: 'Reduces the Focus cost of Trap Launcher by 10.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_traplauncher.jpg',\n\t\t},\n\t\t[HunterMajorGlyph.GlyphOfWyvernSting]: {\n\t\t\tname: 'Glyph of Wyvern Sting',\n\t\t\tdescription: 'Decreases the cooldown of your Wyvern Sting by 6 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_spear_02.jpg',\n\t\t},\n\t},\n\tminorGlyphs: {\n\t\t[HunterMinorGlyph.GlyphOfAspectOfThePack]: {\n\t\t\tname: 'Glyph of Aspect of the Pack',\n\t\t\tdescription: 'Increases the range of your Aspect of the Pack ability by 15 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mount_whitetiger.jpg',\n\t\t},\n\t\t[HunterMinorGlyph.GlyphOfFeignDeath]: {\n\t\t\tname: 'Glyph of Feign Death',\n\t\t\tdescription: 'Reduces the cooldown of your Feign Death spell by 5 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_feigndeath.jpg',\n\t\t},\n\t\t[HunterMinorGlyph.GlyphOfLesserProportion]: {\n\t\t\tname: 'Glyph of Lesser Proportion',\n\t\t\tdescription: 'Slightly reduces the size of your pet.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_bestialdiscipline.jpg',\n\t\t},\n\t\t[HunterMinorGlyph.GlyphOfRevivePet]: {\n\t\t\tname: 'Glyph of Revive Pet',\n\t\t\tdescription: 'Reduces the pushback suffered from damaging attacks while casting Revive Pet by 100%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_beastsoothe.jpg',\n\t\t},\n\t\t[HunterMinorGlyph.GlyphOfScareBeast]: {\n\t\t\tname: 'Glyph of Scare Beast',\n\t\t\tdescription: 'Reduces the pushback suffered from damaging attacks while casting Scare Beast by 75%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_cower.jpg',\n\t\t},\n\t},\n};","import {MageMajorGlyph, MageMinorGlyph,MagePrimeGlyph, MageTalents } from '../proto/mage.js';\nimport { GlyphsConfig } from './glyphs_picker.js';\nimport { newTalentsConfig,TalentsConfig } from './talents_picker.js';\nimport MageTalentJson from './trees/mage.json';\n\nexport const mageTalentsConfig: TalentsConfig<MageTalents> = newTalentsConfig(MageTalentJson);\n\nexport const mageGlyphsConfig: GlyphsConfig = {\n\tprimeGlyphs: {\n\t\t[MagePrimeGlyph.GlyphOfArcaneBarrage]: {\n\t\t\tname: 'Glyph of Arcane Barrage',\n\t\t\tdescription: 'Increases the damage of your Arcane Barrage spell by 4%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mage_arcanebarrage.jpg',\n\t\t},\n\t\t[MagePrimeGlyph.GlyphOfArcaneBlast]: {\n\t\t\tname: 'Glyph of Arcane Blast',\n\t\t\tdescription: 'Increases the damage from your Arcane Blast buff by 3%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_arcane_blast.jpg',\n\t\t},\n\t\t[MagePrimeGlyph.GlyphOfArcaneMissiles]: {\n\t\t\tname: 'Glyph of Arcane Missiles',\n\t\t\tdescription: 'Increases the critical strike chance of your Arcane Missiles spell by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_starfall.jpg',\n\t\t},\n\t\t[MagePrimeGlyph.GlyphOfConeOfCold]: {\n\t\t\tname: 'Glyph of Cone of Cold',\n\t\t\tdescription: 'Increases the damage of your Cone of Cold spell by 25%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_glacier.jpg',\n\t\t},\n\t\t[MagePrimeGlyph.GlyphOfDeepFreeze]: {\n\t\t\tname: 'Glyph of Deep Freeze',\n\t\t\tdescription: 'Your Deep Freeze deals 20% additional damage.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mage_deepfreeze.jpg',\n\t\t},\n\t\t[MagePrimeGlyph.GlyphOfFireball]: {\n\t\t\tname: 'Glyph of Fireball',\n\t\t\tdescription: 'Increases the critical strike chance of your Fireball spell by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_flamebolt.jpg',\n\t\t},\n\t\t[MagePrimeGlyph.GlyphOfFrostbolt]: {\n\t\t\tname: 'Glyph of Frostbolt',\n\t\t\tdescription: 'Increases the critical strike chance of your Frostbolt spell by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostbolt02.jpg',\n\t\t},\n\t\t[MagePrimeGlyph.GlyphOfFrostfire]: {\n\t\t\tname: 'Glyph of Frostfire',\n\t\t\tdescription: 'Increases the damage done by your Frostfire Bolt by 15% and your Frostfire Bolt now deals 3% additional damage over 12 sec, stacking up to 3 times, but no longer reduces the victim\\'s movement speed.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mage_frostfirebolt.jpg',\n\t\t},\n\t\t[MagePrimeGlyph.GlyphOfIceLance]: {\n\t\t\tname: 'Glyph of Ice Lance',\n\t\t\tdescription: 'Increases the damage of your Ice Lance spell by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostblast.jpg',\n\t\t},\n\t\t[MagePrimeGlyph.GlyphOfLivingBomb]: {\n\t\t\tname: 'Glyph of Living Bomb',\n\t\t\tdescription: 'Increases the damage of your Living Bomb spell by 3%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mage_livingbomb.jpg',\n\t\t},\n\t\t[MagePrimeGlyph.GlyphOfMageArmor]: {\n\t\t\tname: 'Glyph of Mage Armor',\n\t\t\tdescription: 'Your Mage Armor regenerates 20% more mana.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_magearmor.jpg',\n\t\t},\n\t\t[MagePrimeGlyph.GlyphOfMoltenArmor]: {\n\t\t\tname: 'Glyph of Molten Armor',\n\t\t\tdescription: 'Your Molten Armor grants an additional 2% spell critical strike chance.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mage_moltenarmor.jpg',\n\t\t},\n\t\t[MagePrimeGlyph.GlyphOfPyroblast]: {\n\t\t\tname: 'Glyph of Pyroblast',\n\t\t\tdescription: 'Increases the critical strike chance of your Pyroblast spell by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_fireball02.jpg',\n\t\t},\n\t},\n\tmajorGlyphs: {\n\t\t[MageMajorGlyph.GlyphOfArcanePower]: {\n\t\t\tname: 'Glyph of Arcane Power',\n\t\t\tdescription: 'While Arcane Power is active the global cooldown of your Blink, Mana Shield, and Mirror Image is reduced to zero.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg',\n\t\t},\n\t\t[MageMajorGlyph.GlyphOfBlastWave]: {\n\t\t\tname: 'Glyph of Blast Wave',\n\t\t\tdescription: 'Increases the duration of Blast Wave\\'s slowing effect by 1 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism_02.jpg',\n\t\t},\n\t\t[MageMajorGlyph.GlyphOfBlink]: {\n\t\t\tname: 'Glyph of Blink',\n\t\t\tdescription: 'Increases the distance you travel with the Blink spell by 5 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_arcane_blink.jpg',\n\t\t},\n\t\t[MageMajorGlyph.GlyphOfDragonSBreath]: {\n\t\t\tname: 'Glyph of Dragon\\'s Breath',\n\t\t\tdescription: 'Reduces the cooldown of your Dragon\\'s Breath by 3 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_head_dragon_01.jpg',\n\t\t},\n\t\t[MageMajorGlyph.GlyphOfEvocation]: {\n\t\t\tname: 'Glyph of Evocation',\n\t\t\tdescription: 'Your Evocation ability also causes you to regain 40% of your health over its duration.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_purge.jpg',\n\t\t},\n\t\t[MageMajorGlyph.GlyphOfFrostArmor]: {\n\t\t\tname: 'Glyph of Frost Armor',\n\t\t\tdescription: 'Your Frost Armor also causes you to regenerate 2% of your maximum mana every 5 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostarmor02.jpg',\n\t\t},\n\t\t[MageMajorGlyph.GlyphOfFrostNova]: {\n\t\t\tname: 'Glyph of Frost Nova',\n\t\t\tdescription: 'Your Frost Nova targets can take an additional 20% damage before the Frost Nova effect automatically breaks.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostnova.jpg',\n\t\t},\n\t\t[MageMajorGlyph.GlyphOfIceBarrier]: {\n\t\t\tname: 'Glyph of Ice Barrier',\n\t\t\tdescription: 'Increases the amount of damage absorbed by your Ice Barrier by 30%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_ice_lament.jpg',\n\t\t},\n\t\t[MageMajorGlyph.GlyphOfIceBlock]: {\n\t\t\tname: 'Glyph of Ice Block',\n\t\t\tdescription: 'Your Frost Nova cooldown is now reset every time you use Ice Block.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frost.jpg',\n\t\t},\n\t\t[MageMajorGlyph.GlyphOfIcyVeins]: {\n\t\t\tname: 'Glyph of Icy Veins',\n\t\t\tdescription: 'Your Icy Veins ability also removes all movement slowing and cast time slowing effects.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_coldhearted.jpg',\n\t\t},\n\t\t[MageMajorGlyph.GlyphOfInvisibility]: {\n\t\t\tname: 'Glyph of Invisibility',\n\t\t\tdescription: 'Increases your movement speed while Invisible by 40%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mage_invisibility.jpg',\n\t\t},\n\t\t[MageMajorGlyph.GlyphOfManaShield]: {\n\t\t\tname: 'Glyph of Mana Shield',\n\t\t\tdescription: 'Reduces the cooldown of your Mana Shield by 2 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_detectlesserinvisibility.jpg',\n\t\t},\n\t\t[MageMajorGlyph.GlyphOfPolymorph]: {\n\t\t\tname: 'Glyph of Polymorph',\n\t\t\tdescription: 'Your Polymorph spell also removes all damage over time effects from the target.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_polymorph.jpg',\n\t\t},\n\t\t[MageMajorGlyph.GlyphOfSlow]: {\n\t\t\tname: 'Glyph of Slow',\n\t\t\tdescription: 'Increases the range of your Slow spell by 5 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_slow.jpg',\n\t\t},\n\t},\n\tminorGlyphs: {\n\t\t[MageMinorGlyph.GlyphOfArcaneBrilliance]: {\n\t\t\tname: 'Glyph of Arcane Brilliance',\n\t\t\tdescription: 'Reduces the mana cost of your Arcane Brilliance spell by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_magicalsentry.jpg',\n\t\t},\n\t\t[MageMinorGlyph.GlyphOfArmors]: {\n\t\t\tname: 'Glyph of Armors',\n\t\t\tdescription: 'Increases the duration of your Armor spells by 30 min.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_chillingarmor.jpg',\n\t\t},\n\t\t[MageMinorGlyph.GlyphOfConjuring]: {\n\t\t\tname: 'Glyph of Conjuring',\n\t\t\tdescription: 'Reduces the mana cost of your Conjuring spells by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mage_conjurefoodrank9.jpg',\n\t\t},\n\t\t[MageMinorGlyph.GlyphOfMirrorImage]: {\n\t\t\tname: 'Glyph of Mirror Image',\n\t\t\tdescription: 'Your Mirror Images cast Arcane Blast or Fireball instead of Frostbolt depending on your primary talent tree.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_magic_lesserinvisibilty.jpg',\n\t\t},\n\t\t[MageMinorGlyph.GlyphOfSlowFall]: {\n\t\t\tname: 'Glyph of Slow Fall',\n\t\t\tdescription: 'Your Slow Fall spell no longer requires a reagent.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_magic_featherfall.jpg',\n\t\t},\n\t\t[MageMinorGlyph.GlyphOfTheMonkey]: {\n\t\t\tname: 'Glyph of the Monkey',\n\t\t\tdescription: 'Your Polymorph: Sheep spell polymorphs the target into a monkey instead.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_aspectofthemonkey.jpg',\n\t\t},\n\t\t[MageMinorGlyph.GlyphOfThePenguin]: {\n\t\t\tname: 'Glyph of the Penguin',\n\t\t\tdescription: 'Your Polymorph: Sheep spell polymorphs the target into a penguin instead.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_penguinpet.jpg',\n\t\t},\n\t},\n};","import {PaladinMajorGlyph, PaladinMinorGlyph,PaladinPrimeGlyph, PaladinTalents } from '../proto/paladin.js';\nimport { GlyphsConfig } from './glyphs_picker.js';\nimport { newTalentsConfig,TalentsConfig } from './talents_picker.js';\nimport PaladinTalentJson from './trees/paladin.json';\n\nexport const paladinTalentsConfig: TalentsConfig<PaladinTalents> = newTalentsConfig(PaladinTalentJson);\n\nexport const paladinGlyphsConfig: GlyphsConfig = {\n\tprimeGlyphs: {\n\t\t[PaladinPrimeGlyph.GlyphOfCrusaderStrike]: {\n\t\t\tname: 'Glyph of Crusader Strike',\n\t\t\tdescription: 'Increases the critical strike chance of Crusader Strike by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_crusaderstrike.jpg',\n\t\t},\n\t\t[PaladinPrimeGlyph.GlyphOfDivineFavor]: {\n\t\t\tname: 'Glyph of Divine Favor',\n\t\t\tdescription: 'Increases the duration of Divine Favor by 10 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_divineillumination.jpg',\n\t\t},\n\t\t[PaladinPrimeGlyph.GlyphOfExorcism]: {\n\t\t\tname: 'Glyph of Exorcism',\n\t\t\tdescription: 'Your Exorcism causes an additional 20% of its damage over 6 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism_02.jpg',\n\t\t},\n\t\t[PaladinPrimeGlyph.GlyphOfHammerOfTheRighteous]: {\n\t\t\tname: 'Glyph of Hammer of the Righteous',\n\t\t\tdescription: 'Increases the damage of both the physical and Holy components of Hammer of the Righteous by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_paladin_hammeroftherighteous.jpg',\n\t\t},\n\t\t[PaladinPrimeGlyph.GlyphOfHolyShock]: {\n\t\t\tname: 'Glyph of Holy Shock',\n\t\t\tdescription: 'Increases the critical effect chance of Holy Shock by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_searinglight.jpg',\n\t\t},\n\t\t[PaladinPrimeGlyph.GlyphOfJudgement]: {\n\t\t\tname: 'Glyph of Judgement',\n\t\t\tdescription: 'Your Judgement deals 10% more damage.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_righteousfury.jpg',\n\t\t},\n\t\t[PaladinPrimeGlyph.GlyphOfSealOfInsight]: {\n\t\t\tname: 'Glyph of Seal of Insight',\n\t\t\tdescription: 'While Seal of Insight is active, the effect of your healing spells is increased by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_healingaura.jpg',\n\t\t},\n\t\t[PaladinPrimeGlyph.GlyphOfSealOfTruth]: {\n\t\t\tname: 'Glyph of Seal of Truth',\n\t\t\tdescription: 'Your Seal of Truth and Seal of Righteousness also grant 10 expertise while active.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofvengeance.jpg',\n\t\t},\n\t\t[PaladinPrimeGlyph.GlyphOfShieldOfTheRighteous]: {\n\t\t\tname: 'Glyph of Shield of the Righteous',\n\t\t\tdescription: 'Increases the damage of Shield of the Righteous by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_paladin_shieldofvengeance.jpg',\n\t\t},\n\t\t[PaladinPrimeGlyph.GlyphOfTemplarSVerdict]: {\n\t\t\tname: 'Glyph of Templar\\'s Verdict',\n\t\t\tdescription: 'Increases the damage of Templar\\'s Verdict by 15%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_paladin_templarsverdict.jpg',\n\t\t},\n\t\t[PaladinPrimeGlyph.GlyphOfWordOfGlory]: {\n\t\t\tname: 'Glyph of Word of Glory',\n\t\t\tdescription: 'Increases the healing done by Word of Glory by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_helmet_96.jpg',\n\t\t},\n\t},\n\tmajorGlyphs: {\n\t\t[PaladinMajorGlyph.GlyphOfBeaconOfLight]: {\n\t\t\tname: 'Glyph of Beacon of Light',\n\t\t\tdescription: 'Your Beacon of Light costs no mana.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_paladin_beaconoflight.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfCleansing]: {\n\t\t\tname: 'Glyph of Cleansing',\n\t\t\tdescription: 'Reduces the mana cost of your Cleanse by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_purify.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfConsecration]: {\n\t\t\tname: 'Glyph of Consecration',\n\t\t\tdescription: 'Increases the duration and cooldown of Consecration by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_innerfire.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfDazingShield]: {\n\t\t\tname: 'Glyph of Dazing Shield',\n\t\t\tdescription: 'Your Avenger\\'s Shield now also dazes targets.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_avengersshield.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfDivinePlea]: {\n\t\t\tname: 'Glyph of Divine Plea',\n\t\t\tdescription: 'Your Divine Plea provides an additional 6% of your total mana.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_aspiration.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfDivineProtection]: {\n\t\t\tname: 'Glyph of Divine Protection',\n\t\t\tdescription: 'Removes the physical damage reduction of your Divine Protection, but increases the magical damage reduction by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_divineprotection.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfDivinity]: {\n\t\t\tname: 'Glyph of Divinity',\n\t\t\tdescription: 'When you use Lay on Hands, you also gain 10% of your maximum mana.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_layonhands.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfFocusedShield]: {\n\t\t\tname: 'Glyph of Focused Shield',\n\t\t\tdescription: 'Your Avenger\\'s Shield hits 2 fewer targets, but for 30% more damage.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_avengersshield.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfHammerOfJustice]: {\n\t\t\tname: 'Glyph of Hammer of Justice',\n\t\t\tdescription: 'Increases your Hammer of Justice range by 5 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofmight.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfHammerOfWrath]: {\n\t\t\tname: 'Glyph of Hammer of Wrath',\n\t\t\tdescription: 'Reduces the mana cost of Hammer of Wrath by 100%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_hammer_04.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfHolyWrath]: {\n\t\t\tname: 'Glyph of Holy Wrath',\n\t\t\tdescription: 'Your Holy Wrath now also stuns Elementals and Dragonkin.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_purifyingpower.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfLayOnHands]: {\n\t\t\tname: 'Glyph of Lay on Hands',\n\t\t\tdescription: 'Reduces the cooldown of your Lay on Hands spell by 3 min.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_layonhands.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfLightOfDawn]: {\n\t\t\tname: 'Glyph of Light of Dawn',\n\t\t\tdescription: 'Light of Dawn affects 2 fewer targets, but heals each target for 25% more.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_paladin_lightofdawn.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfRebuke]: {\n\t\t\tname: 'Glyph of Rebuke',\n\t\t\tdescription: 'Reduces the mana cost of Rebuke by 100%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_rebuke.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfReckoning]: {\n\t\t\tname: 'Glyph of Reckoning',\n\t\t\tdescription: 'Your Hand of Reckoning spell no longer taunts the target and can deal damage to untauntable targets.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_questionmark.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfSalvation]: {\n\t\t\tname: 'Glyph of Salvation',\n\t\t\tdescription: 'Hand of Salvation no longer permanently reduces threat over time but instead reduces all threat as long as Hand of Salvation lasts.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofsalvation.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfTheAsceticCrusader]: {\n\t\t\tname: 'Glyph of the Ascetic Crusader',\n\t\t\tdescription: 'Reduces the mana cost of your Crusader Strike by 30%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_crusaderstrike.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfTheLongWord]: {\n\t\t\tname: 'Glyph of the Long Word',\n\t\t\tdescription: 'Your Word of Glory heals for 50% less up front, but provides an additional 50% healing over 6 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_helmet_96.jpg',\n\t\t},\n\t\t[PaladinMajorGlyph.GlyphOfTurnEvil]: {\n\t\t\tname: 'Glyph of Turn Evil',\n\t\t\tdescription: 'Reduces the casting time of your Turn Evil spell by 100%, but increases the cooldown by 8 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_turnundead.jpg',\n\t\t},\n\t},\n\tminorGlyphs: {\n\t\t[PaladinMinorGlyph.GlyphOfBlessingOfKings]: {\n\t\t\tname: 'Glyph of Blessing of Kings',\n\t\t\tdescription: 'Reduces the mana cost of Blessing of Kings by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_magic_magearmor.jpg',\n\t\t},\n\t\t[PaladinMinorGlyph.GlyphOfBlessingOfMight]: {\n\t\t\tname: 'Glyph of Blessing of Might',\n\t\t\tdescription: 'Reduces the mana cost of your Blessing of Might by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_greaterblessingofkings.jpg',\n\t\t},\n\t\t[PaladinMinorGlyph.GlyphOfInsight]: {\n\t\t\tname: 'Glyph of Insight',\n\t\t\tdescription: 'Reduces the mana cost of Seal of Insight by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_healingaura.jpg',\n\t\t},\n\t\t[PaladinMinorGlyph.GlyphOfJustice]: {\n\t\t\tname: 'Glyph of Justice',\n\t\t\tdescription: 'Reduces the mana cost of Seal of Justice by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofwrath.jpg',\n\t\t},\n\t\t[PaladinMinorGlyph.GlyphOfRighteousness]: {\n\t\t\tname: 'Glyph of Righteousness',\n\t\t\tdescription: 'Reduces the mana cost of Seal of Righteousness by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_righteousnessaura.jpg',\n\t\t},\n\t\t[PaladinMinorGlyph.GlyphOfTruth]: {\n\t\t\tname: 'Glyph of Truth',\n\t\t\tdescription: 'Reduces the mana cost of Seal of Truth by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofvengeance.jpg',\n\t\t},\n\t},\n};","import { PriestMajorGlyph, PriestMinorGlyph,PriestPrimeGlyph, PriestTalents } from '../proto/priest.js';\nimport { GlyphsConfig } from './glyphs_picker.js';\nimport { newTalentsConfig,TalentsConfig } from './talents_picker.js';\nimport PriestTalentJson from './trees/priest.json';\n\nexport const priestTalentsConfig: TalentsConfig<PriestTalents> = newTalentsConfig(PriestTalentJson);\n\nexport const priestGlyphsConfig: GlyphsConfig = {\n\tprimeGlyphs: {\n\t\t[PriestPrimeGlyph.GlyphOfDispersion]: {\n\t\t\tname: 'Glyph of Dispersion',\n\t\t\tdescription: 'Reduces the cooldown on Dispersion by 45 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_dispersion.jpg',\n\t\t},\n\t\t[PriestPrimeGlyph.GlyphOfFlashHeal]: {\n\t\t\tname: 'Glyph of Flash Heal',\n\t\t\tdescription: 'Increases the critical effect chance of your Flash Heal on targets at or below 25% health by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_flashheal.jpg',\n\t\t},\n\t\t[PriestPrimeGlyph.GlyphOfGuardianSpirit]: {\n\t\t\tname: 'Glyph of Guardian Spirit',\n\t\t\tdescription: 'Reduces the cooldown of your Guardian Spirit by 30 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_guardianspirit.jpg',\n\t\t},\n\t\t[PriestPrimeGlyph.GlyphOfLightwell]: {\n\t\t\tname: 'Glyph of Lightwell',\n\t\t\tdescription: 'Increases the total amount of charges of your Lightwell by 5.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_summonlightwell.jpg',\n\t\t},\n\t\t[PriestPrimeGlyph.GlyphOfMindFlay]: {\n\t\t\tname: 'Glyph of Mind Flay',\n\t\t\tdescription: 'Increases the damage done by your Mind Flay spell by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_siphonmana.jpg',\n\t\t},\n\t\t[PriestPrimeGlyph.GlyphOfPenance]: {\n\t\t\tname: 'Glyph of Penance',\n\t\t\tdescription: 'Reduces the cooldown of Penance by 2 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_penance.jpg',\n\t\t},\n\t\t[PriestPrimeGlyph.GlyphOfPowerWordBarrier]: {\n\t\t\tname: 'Glyph of Power Word: Barrier',\n\t\t\tdescription: 'Increases the healing received while under Power Word: Barrier by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_powerwordbarrier.jpg',\n\t\t},\n\t\t[PriestPrimeGlyph.GlyphOfPowerWordShield]: {\n\t\t\tname: 'Glyph of Power Word: Shield',\n\t\t\tdescription: 'Your Power Word: Shield also heals the target for 20% of the absorption amount.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_powerwordshield.jpg',\n\t\t},\n\t\t[PriestPrimeGlyph.GlyphOfPrayerOfHealing]: {\n\t\t\tname: 'Glyph of Prayer of Healing',\n\t\t\tdescription: 'Your Prayer of Healing spell also heals an additional 20% of its initial heal over 6 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_prayerofhealing02.jpg',\n\t\t},\n\t\t[PriestPrimeGlyph.GlyphOfRenew]: {\n\t\t\tname: 'Glyph of Renew',\n\t\t\tdescription: 'Increases the amount healed by your Renew by an additional 25%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_renew.jpg',\n\t\t},\n\t\t[PriestPrimeGlyph.GlyphOfShadowWordDeath]: {\n\t\t\tname: 'Glyph of Shadow Word: Death',\n\t\t\tdescription: 'If your Shadow Word: Death fails to kill the target at or below 25% health, your Shadow Word: Death\\'s cooldown is instantly reset. This effect cannot occur more often than once every 6 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonicfortitude.jpg',\n\t\t},\n\t\t[PriestPrimeGlyph.GlyphOfShadowWordPain]: {\n\t\t\tname: 'Glyph of Shadow Word: Pain',\n\t\t\tdescription: 'Increases the periodic damage of your Shadow Word: Pain by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowwordpain.jpg',\n\t\t},\n\t},\n\tmajorGlyphs: {\n\t\t[PriestMajorGlyph.GlyphOfCircleOfHealing]: {\n\t\t\tname: 'Glyph of Circle of Healing',\n\t\t\tdescription: 'Your Circle of Healing spell heals 1 additional target, but its mana cost is increased by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_circleofrenewal.jpg',\n\t\t},\n\t\t[PriestMajorGlyph.GlyphOfDesperation]: {\n\t\t\tname: 'Glyph of Desperation',\n\t\t\tdescription: 'Allows Pain Suppression and Guardian Spirit to be cast while stunned.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_painsupression.jpg',\n\t\t},\n\t\t[PriestMajorGlyph.GlyphOfDispelMagic]: {\n\t\t\tname: 'Glyph of Dispel Magic',\n\t\t\tdescription: 'Your Dispel Magic spell also heals your target for 3% of maximum health when you successfully dispel a magical effect.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_dispelmagic.jpg',\n\t\t},\n\t\t[PriestMajorGlyph.GlyphOfDivineAccuracy]: {\n\t\t\tname: 'Glyph of Divine Accuracy',\n\t\t\tdescription: 'Increases your chance to hit with your Smite and Holy Fire spells by 18%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_holyprotection.jpg',\n\t\t},\n\t\t[PriestMajorGlyph.GlyphOfFade]: {\n\t\t\tname: 'Glyph of Fade',\n\t\t\tdescription: 'Reduces the cooldown of your Fade spell by 9 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_magic_lesserinvisibilty.jpg',\n\t\t},\n\t\t[PriestMajorGlyph.GlyphOfFearWard]: {\n\t\t\tname: 'Glyph of Fear Ward',\n\t\t\tdescription: 'Reduces the cooldown and duration of Fear Ward by 60 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism.jpg',\n\t\t},\n\t\t[PriestMajorGlyph.GlyphOfHolyNova]: {\n\t\t\tname: 'Glyph of Holy Nova',\n\t\t\tdescription: 'Reduces the global cooldown of your Holy Nova by .5 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_holynova.jpg',\n\t\t},\n\t\t[PriestMajorGlyph.GlyphOfInnerFire]: {\n\t\t\tname: 'Glyph of Inner Fire',\n\t\t\tdescription: 'Increases the armor gained from your Inner Fire spell by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_innerfire.jpg',\n\t\t},\n\t\t[PriestMajorGlyph.GlyphOfMassDispel]: {\n\t\t\tname: 'Glyph of Mass Dispel',\n\t\t\tdescription: 'Reduces the cast time of Mass Dispel by 1 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_arcane_massdispel.jpg',\n\t\t},\n\t\t[PriestMajorGlyph.GlyphOfPrayerOfMending]: {\n\t\t\tname: 'Glyph of Prayer of Mending',\n\t\t\tdescription: 'The first charge of your Prayer of Mending heals for an additional 60%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_prayerofmendingtga.jpg',\n\t\t},\n\t\t[PriestMajorGlyph.GlyphOfPsychicHorror]: {\n\t\t\tname: 'Glyph of Psychic Horror',\n\t\t\tdescription: 'Reduces the cooldown of your Psychic Horror by 30 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_psychichorrors.jpg',\n\t\t},\n\t\t[PriestMajorGlyph.GlyphOfPsychicScream]: {\n\t\t\tname: 'Glyph of Psychic Scream',\n\t\t\tdescription: 'Targets of your Psychic Scream spell now tremble in place instead of fleeing in fear, but the cooldown of Psychic Scream is increased by 3 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_psychicscream.jpg',\n\t\t},\n\t\t[PriestMajorGlyph.GlyphOfScourgeImprisonment]: {\n\t\t\tname: 'Glyph of Scourge Imprisonment',\n\t\t\tdescription: 'Reduces the cast time of your Shackle Undead by 1.0 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_crusade.jpg',\n\t\t},\n\t\t[PriestMajorGlyph.GlyphOfSmite]: {\n\t\t\tname: 'Glyph of Smite',\n\t\t\tdescription: 'Your Smite spell inflicts an additional 20% damage against targets afflicted by Holy Fire.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_holysmite.jpg',\n\t\t},\n\t\t[PriestMajorGlyph.GlyphOfSpiritTap]: {\n\t\t\tname: 'Glyph of Spirit Tap',\n\t\t\tdescription: 'When you kill a target with your Shadow Word: Death that yields experience or honor, you receive 12% of your total mana over 12 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_requiem.jpg',\n\t\t},\n\t},\n\tminorGlyphs: {\n\t\t[PriestMinorGlyph.GlyphOfFading]: {\n\t\t\tname: 'Glyph of Fading',\n\t\t\tdescription: 'Reduces the mana cost of your Fade spell by 30%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mage_invisibility.jpg',\n\t\t},\n\t\t[PriestMinorGlyph.GlyphOfFortitude]: {\n\t\t\tname: 'Glyph of Fortitude',\n\t\t\tdescription: 'Reduces the mana cost of your Power Word: Fortitude spell by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_wordfortitude.jpg',\n\t\t},\n\t\t[PriestMinorGlyph.GlyphOfLevitate]: {\n\t\t\tname: 'Glyph of Levitate',\n\t\t\tdescription: 'Your Levitate spell no longer requires a reagent.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_layonhands.jpg',\n\t\t},\n\t\t[PriestMinorGlyph.GlyphOfShackleUndead]: {\n\t\t\tname: 'Glyph of Shackle Undead',\n\t\t\tdescription: 'Increases the range of your Shackle Undead spell by 5 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_slow.jpg',\n\t\t},\n\t\t[PriestMinorGlyph.GlyphOfShadow]: {\n\t\t\tname: 'Glyph of Shadow',\n\t\t\tdescription: 'Alters the appearance of your Shadowform.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_questionmark.jpg',\n\t\t},\n\t\t[PriestMinorGlyph.GlyphOfShadowProtection]: {\n\t\t\tname: 'Glyph of Shadow Protection',\n\t\t\tdescription: 'Increases the duration of your Shadow Protection spell by 10 min.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_prayerofshadowprotection.jpg',\n\t\t},\n\t\t[PriestMinorGlyph.GlyphOfShadowfiend]: {\n\t\t\tname: 'Glyph of Shadowfiend',\n\t\t\tdescription: 'Receive 5% of your maximum mana if your Shadowfiend dies from damage.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowfiend.jpg',\n\t\t},\n\t},\n};","import { RogueMajorGlyph, RogueMinorGlyph,RoguePrimeGlyph, RogueTalents } from '../proto/rogue.js';\nimport { GlyphsConfig } from './glyphs_picker.js';\nimport { newTalentsConfig,TalentsConfig } from './talents_picker.js';\nimport RogueTalentJson from './trees/rogue.json';\n\nexport const rogueTalentsConfig: TalentsConfig<RogueTalents> = newTalentsConfig(RogueTalentJson);\n\nexport const rogueGlyphsConfig: GlyphsConfig = {\n\tprimeGlyphs: {\n\t\t[RoguePrimeGlyph.GlyphOfAdrenalineRush]: {\n\t\t\tname: 'Glyph of Adrenaline Rush',\n\t\t\tdescription: 'Increases the duration of Adrenaline Rush by 5 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowworddominate.jpg',\n\t\t},\n\t\t[RoguePrimeGlyph.GlyphOfBackstab]: {\n\t\t\tname: 'Glyph of Backstab',\n\t\t\tdescription: 'Your Backstab critical strikes grant you 5 Energy.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_backstab.jpg',\n\t\t},\n\t\t[RoguePrimeGlyph.GlyphOfEviscerate]: {\n\t\t\tname: 'Glyph of Eviscerate',\n\t\t\tdescription: 'Increases the critical strike chance of Eviscerate by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_eviscerate.jpg',\n\t\t},\n\t\t[RoguePrimeGlyph.GlyphOfHemorrhage]: {\n\t\t\tname: 'Glyph of Hemorrhage',\n\t\t\tdescription: 'Your Hemorrhage ability also causes the target to bleed, dealing 40% of the direct strike\\'s damage over 24 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg',\n\t\t},\n\t\t[RoguePrimeGlyph.GlyphOfKillingSpree]: {\n\t\t\tname: 'Glyph of Killing Spree',\n\t\t\tdescription: 'Increases the bonus to your damage while Killing Spree is active by an additional 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_murderspree.jpg',\n\t\t},\n\t\t[RoguePrimeGlyph.GlyphOfMutilate]: {\n\t\t\tname: 'Glyph of Mutilate',\n\t\t\tdescription: 'Reduces the cost of Mutilate by 5 Energy.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_shadowstrikes.jpg',\n\t\t},\n\t\t[RoguePrimeGlyph.GlyphOfRevealingStrike]: {\n\t\t\tname: 'Glyph of Revealing Strike',\n\t\t\tdescription: 'Increases Revealing Strike\\'s bonus effectiveness to your finishing moves by an additional 10%',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_sword_97.jpg',\n\t\t},\n\t\t[RoguePrimeGlyph.GlyphOfRupture]: {\n\t\t\tname: 'Glyph of Rupture',\n\t\t\tdescription: 'Increases the duration of Rupture by 4 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_rupture.jpg',\n\t\t},\n\t\t[RoguePrimeGlyph.GlyphOfShadowDance]: {\n\t\t\tname: 'Glyph of Shadow Dance',\n\t\t\tdescription: 'Increases the duration of Shadow Dance by 2 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_shadowdance.jpg',\n\t\t},\n\t\t[RoguePrimeGlyph.GlyphOfSinisterStrike]: {\n\t\t\tname: 'Glyph of Sinister Strike',\n\t\t\tdescription: 'Your Sinister Strikes have a 20% chance to add an additional combo point.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_ritualofsacrifice.jpg',\n\t\t},\n\t\t[RoguePrimeGlyph.GlyphOfSliceAndDice]: {\n\t\t\tname: 'Glyph of Slice and Dice',\n\t\t\tdescription: 'Increases the duration of Slice and Dice by 6 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_slicedice.jpg',\n\t\t},\n\t\t[RoguePrimeGlyph.GlyphOfVendetta]: {\n\t\t\tname: 'Glyph of Vendetta',\n\t\t\tdescription: 'Increases the duration of your Vendetta ability by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_deadliness.jpg',\n\t\t},\n\t},\n\tmajorGlyphs: {\n\t\t[RogueMajorGlyph.GlyphOfAmbush]: {\n\t\t\tname: 'Glyph of Ambush',\n\t\t\tdescription: 'Increases the range on Ambush by 5 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_ambush.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfBladeFlurry]: {\n\t\t\tname: 'Glyph of Blade Flurry',\n\t\t\tdescription: 'Reduces the penalty to Energy generation while Blade Flurry is active by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_punishingblow.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfBlind]: {\n\t\t\tname: 'Glyph of Blind',\n\t\t\tdescription: 'Your Blind ability also removes all damage over time effects from the target.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_mindsteal.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfCloakOfShadows]: {\n\t\t\tname: 'Glyph of Cloak of Shadows',\n\t\t\tdescription: 'While Cloak of Shadows is active, you take 40% less physical damage.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_nethercloak.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfCripplingPoison]: {\n\t\t\tname: 'Glyph of Crippling Poison',\n\t\t\tdescription: 'Increases the chance to inflict your target with Crippling Poison by an additional 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_poisonsting.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfDeadlyThrow]: {\n\t\t\tname: 'Glyph of Deadly Throw',\n\t\t\tdescription: 'Increases the slowing effect on Deadly Throw by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_throwingknife_06.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfEvasion]: {\n\t\t\tname: 'Glyph of Evasion',\n\t\t\tdescription: 'Increases the duration of Evasion by 5 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowward.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfExposeArmor]: {\n\t\t\tname: 'Glyph of Expose Armor',\n\t\t\tdescription: 'Increases the duration of Expose Armor by 12 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_riposte.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfFanOfKnives]: {\n\t\t\tname: 'Glyph of Fan of Knives',\n\t\t\tdescription: 'Increases the radius of your Fan of Knives ability by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_fanofknives.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfFeint]: {\n\t\t\tname: 'Glyph of Feint',\n\t\t\tdescription: 'Reduces the Energy cost of Feint by 20.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_feint.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfGarrote]: {\n\t\t\tname: 'Glyph of Garrote',\n\t\t\tdescription: 'Increases the duration of your Garrote ability\\'s silence effect by 1.5 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_garrote.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfGouge]: {\n\t\t\tname: 'Glyph of Gouge',\n\t\t\tdescription: 'Your Gouge ability no longer requires that the target be facing you.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_gouge.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfKick]: {\n\t\t\tname: 'Glyph of Kick',\n\t\t\tdescription: 'Increases the cooldown of your Kick ability by 4 sec, but this cooldown is reduced by 6 sec when your Kick successfully interrupts a spell.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_kick.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfPreparation]: {\n\t\t\tname: 'Glyph of Preparation',\n\t\t\tdescription: 'Your Preparation ability also instantly resets the cooldown of Kick, Dismantle, and Smoke Bomb.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_preparation.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfSap]: {\n\t\t\tname: 'Glyph of Sap',\n\t\t\tdescription: 'Increases the duration of Sap against non-player targets by 80 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_sap.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfSprint]: {\n\t\t\tname: 'Glyph of Sprint',\n\t\t\tdescription: 'Increases the movement speed of your Sprint ability by an additional 30%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_sprint.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfTricksOfTheTrade]: {\n\t\t\tname: 'Glyph of Tricks of the Trade',\n\t\t\tdescription: 'Removes the Energy cost of your Tricks of the Trade ability but reduces the recipient\\'s damage bonus by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_tricksofthetrade.jpg',\n\t\t},\n\t\t[RogueMajorGlyph.GlyphOfVanish]: {\n\t\t\tname: 'Glyph of Vanish',\n\t\t\tdescription: 'Increases the duration of your Vanish effect by 2 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_vanish.jpg',\n\t\t},\n\t},\n\tminorGlyphs: {\n\t\t[RogueMinorGlyph.GlyphOfBlurredSpeed]: {\n\t\t\tname: 'Glyph of Blurred Speed',\n\t\t\tdescription: 'Enables you to walk on water while your Sprint ability is active.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_sprint.jpg',\n\t\t},\n\t\t[RogueMinorGlyph.GlyphOfDistract]: {\n\t\t\tname: 'Glyph of Distract',\n\t\t\tdescription: 'Increases the range of your Distract ability by 5 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_distract.jpg',\n\t\t},\n\t\t[RogueMinorGlyph.GlyphOfPickLock]: {\n\t\t\tname: 'Glyph of Pick Lock',\n\t\t\tdescription: 'Reduces the cast time of your Pick Lock ability by 100%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_moonkey.jpg',\n\t\t},\n\t\t[RogueMinorGlyph.GlyphOfPickPocket]: {\n\t\t\tname: 'Glyph of Pick Pocket',\n\t\t\tdescription: 'Increases the range of your Pick Pocket ability by 5 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_bag_11.jpg',\n\t\t},\n\t\t[RogueMinorGlyph.GlyphOfPoisons]: {\n\t\t\tname: 'Glyph of Poisons',\n\t\t\tdescription: 'You apply poisons to your weapons 50% faster.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/trade_brewpoison.jpg',\n\t\t},\n\t\t[RogueMinorGlyph.GlyphOfSafeFall]: {\n\t\t\tname: 'Glyph of Safe Fall',\n\t\t\tdescription: 'Increases the distance your Safe Fall ability allows you to fall without taking damage.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_feather_01.jpg',\n\t\t},\n\t},\n};","import { ShamanMajorGlyph, ShamanMinorGlyph,ShamanPrimeGlyph, ShamanTalents } from '../proto/shaman.js';\nimport { GlyphsConfig } from './glyphs_picker.js';\nimport { newTalentsConfig,TalentsConfig } from './talents_picker.js';\nimport ShamanTalentJson from './trees/shaman.json';\n\nexport const shamanTalentsConfig: TalentsConfig<ShamanTalents> = newTalentsConfig(ShamanTalentJson);\nexport const shamanGlyphsConfig: GlyphsConfig = {\n\tprimeGlyphs: {\n\t\t[ShamanPrimeGlyph.GlyphOfEarthShield]: {\n\t\t\tname: 'Glyph of Earth Shield',\n\t\t\tdescription: 'Increases the amount healed by your Earth Shield by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_skinofearth.jpg',\n\t\t},\n\t\t[ShamanPrimeGlyph.GlyphOfEarthlivingWeapon]: {\n\t\t\tname: 'Glyph of Earthliving Weapon',\n\t\t\tdescription: 'Increases the effectiveness of your Earthliving weapon\\'s periodic healing by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_unleashweapon_life.jpg',\n\t\t},\n\t\t[ShamanPrimeGlyph.GlyphOfFeralSpirit]: {\n\t\t\tname: 'Glyph of Feral Spirit',\n\t\t\tdescription: 'Your spirit wolves gain an additional 30% of your attack power.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_feralspirit.jpg',\n\t\t},\n\t\t[ShamanPrimeGlyph.GlyphOfFireElementalTotem]: {\n\t\t\tname: 'Glyph of Fire Elemental Totem',\n\t\t\tdescription: 'Reduces the cooldown of your Fire Elemental Totem by 5 min.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_elemental_totem.jpg',\n\t\t},\n\t\t[ShamanPrimeGlyph.GlyphOfFlameShock]: {\n\t\t\tname: 'Glyph of Flame Shock',\n\t\t\tdescription: 'Increases the duration of your Flame Shock by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_flameshock.jpg',\n\t\t},\n\t\t[ShamanPrimeGlyph.GlyphOfFlametongueWeapon]: {\n\t\t\tname: 'Glyph of Flametongue Weapon',\n\t\t\tdescription: 'Increases your spell critical strike chance by 2% on each of your weapons with Flametongue Weapon active.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_unleashweapon_flame.jpg',\n\t\t},\n\t\t[ShamanPrimeGlyph.GlyphOfLavaBurst]: {\n\t\t\tname: 'Glyph of Lava Burst',\n\t\t\tdescription: 'Your Lava Burst spell deals 10% more damage.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_lavaburst.jpg',\n\t\t},\n\t\t[ShamanPrimeGlyph.GlyphOfLavaLash]: {\n\t\t\tname: 'Glyph of Lava Lash',\n\t\t\tdescription: 'Increases the damage dealt by your Lava Lash ability by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_shaman_lavalash.jpg',\n\t\t},\n\t\t[ShamanPrimeGlyph.GlyphOfLightningBolt]: {\n\t\t\tname: 'Glyph of Lightning Bolt',\n\t\t\tdescription: 'Increases the damage dealt by Lightning Bolt by 4%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg',\n\t\t},\n\t\t[ShamanPrimeGlyph.GlyphOfRiptide]: {\n\t\t\tname: 'Glyph of Riptide',\n\t\t\tdescription: 'Increases the duration of Riptide by 40%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_riptide.jpg',\n\t\t},\n\t\t[ShamanPrimeGlyph.GlyphOfShocking]: {\n\t\t\tname: 'Glyph of Shocking',\n\t\t\tdescription: 'Reduces your global cooldown when casting your shock spells by 0.0 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_earthshock.jpg',\n\t\t},\n\t\t[ShamanPrimeGlyph.GlyphOfStormstrike]: {\n\t\t\tname: 'Glyph of Stormstrike',\n\t\t\tdescription: 'Increases the critical strike chance bonus from your Stormstrike ability by an additional 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_shaman_stormstrike.jpg',\n\t\t},\n\t\t[ShamanPrimeGlyph.GlyphOfUnleashedLightning]: {\n\t\t\tname: 'Glyph of Unleashed Lightning',\n\t\t\tdescription: 'Allows Lightning Bolt to be cast while moving.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg',\n\t\t},\n\t\t[ShamanPrimeGlyph.GlyphOfWaterShield]: {\n\t\t\tname: 'Glyph of Water Shield',\n\t\t\tdescription: 'Increases the passive mana regeneration of your Water Shield spell by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_shaman_watershield.jpg',\n\t\t},\n\t\t[ShamanPrimeGlyph.GlyphOfWindfuryWeapon]: {\n\t\t\tname: 'Glyph of Windfury Weapon',\n\t\t\tdescription: 'Increases the chance per swing for Windfury Weapon to trigger by 2%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_unleashweapon_wind.jpg',\n\t\t},\n\t},\n\tmajorGlyphs: {\n\t\t[ShamanMajorGlyph.GlyphOfChainHeal]: {\n\t\t\tname: 'Glyph of Chain Heal',\n\t\t\tdescription: 'Increases healing done by your Chain Heal spell to targets beyond the first by 15%, but decreases the amount received by the initial target by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingwavegreater.jpg',\n\t\t},\n\t\t[ShamanMajorGlyph.GlyphOfChainLightning]: {\n\t\t\tname: 'Glyph of Chain Lightning',\n\t\t\tdescription: 'Your Chain Lightning spell now strikes 2 additional targets, but deals 10% less initial damage.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_chainlightning.jpg',\n\t\t},\n\t\t[ShamanMajorGlyph.GlyphOfElementalMastery]: {\n\t\t\tname: 'Glyph of Elemental Mastery',\n\t\t\tdescription: 'While your Elemental Mastery ability is active, you take 20% less damage from all sources.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_wispheal.jpg',\n\t\t},\n\t\t[ShamanMajorGlyph.GlyphOfFireNova]: {\n\t\t\tname: 'Glyph of Fire Nova',\n\t\t\tdescription: 'Increases the radius of your Fire Nova spell by 5 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_firenova.jpg',\n\t\t},\n\t\t[ShamanMajorGlyph.GlyphOfFrostShock]: {\n\t\t\tname: 'Glyph of Frost Shock',\n\t\t\tdescription: 'Increases the duration of your Frost Shock by 2 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostshock.jpg',\n\t\t},\n\t\t[ShamanMajorGlyph.GlyphOfGhostWolf]: {\n\t\t\tname: 'Glyph of Ghost Wolf',\n\t\t\tdescription: 'Your Ghost Wolf form grants an additional 5% movement speed.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_spiritwolf.jpg',\n\t\t},\n\t\t[ShamanMajorGlyph.GlyphOfGroundingTotem]: {\n\t\t\tname: 'Glyph of Grounding Totem',\n\t\t\tdescription: 'Instead of absorbing a spell, your Grounding Totem reflects the next harmful spell back at its caster, but the cooldown of your Grounding Totem is increased by 35 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_groundingtotem.jpg',\n\t\t},\n\t\t[ShamanMajorGlyph.GlyphOfHealingStreamTotem]: {\n\t\t\tname: 'Glyph of Healing Stream Totem',\n\t\t\tdescription: 'Your Healing Stream Totem also increases the Fire, Frost, and Nature resistance of party and raid members within 30 yards by 85.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_spear_04.jpg',\n\t\t},\n\t\t[ShamanMajorGlyph.GlyphOfHealingWave]: {\n\t\t\tname: 'Glyph of Healing Wave',\n\t\t\tdescription: 'Your Healing Wave also heals you for 20% of the healing effect when you heal someone else.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingwavegreater.jpg',\n\t\t},\n\t\t[ShamanMajorGlyph.GlyphOfHex]: {\n\t\t\tname: 'Glyph of Hex',\n\t\t\tdescription: 'Reduces the cooldown of your Hex spell by 10 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_hex.jpg',\n\t\t},\n\t\t[ShamanMajorGlyph.GlyphOfLightningShield]: {\n\t\t\tname: 'Glyph of Lightning Shield',\n\t\t\tdescription: 'Your Lightning Shield can no longer drop below 3 charges from dealing damage to attackers.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightningshield.jpg',\n\t\t},\n\t\t[ShamanMajorGlyph.GlyphOfShamanisticRage]: {\n\t\t\tname: 'Glyph of Shamanistic Rage',\n\t\t\tdescription: 'Activating your Shamanistic Rage ability also cleanses you of all dispellable Magic debuffs.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_shamanrage.jpg',\n\t\t},\n\t\t[ShamanMajorGlyph.GlyphOfStoneclawTotem]: {\n\t\t\tname: 'Glyph of Stoneclaw Totem',\n\t\t\tdescription: 'Your Stoneclaw Totem also places a damage absorb shield on you, equal to 4 times the strength of the shield it places on your totems.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_stoneclawtotem.jpg',\n\t\t},\n\t\t[ShamanMajorGlyph.GlyphOfThunder]: {\n\t\t\tname: 'Glyph of Thunder',\n\t\t\tdescription: 'Reduces the cooldown on Thunderstorm by 10 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_thunderstorm.jpg',\n\t\t},\n\t\t[ShamanMajorGlyph.GlyphOfTotemicRecall]: {\n\t\t\tname: 'Glyph of Totemic Recall',\n\t\t\tdescription: 'Causes your Totemic Recall ability to return an additional 50% of the mana cost of any recalled totems.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_totemrecall.jpg',\n\t\t},\n\t},\n\tminorGlyphs: {\n\t\t[ShamanMinorGlyph.GlyphOfAstralRecall]: {\n\t\t\tname: 'Glyph of Astral Recall',\n\t\t\tdescription: 'Reduces the cooldown of your Astral Recall spell by 7.5 min.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_astralrecal.jpg',\n\t\t},\n\t\t[ShamanMinorGlyph.GlyphOfRenewedLife]: {\n\t\t\tname: 'Glyph of Renewed Life',\n\t\t\tdescription: 'Your Reincarnation spell no longer requires a reagent.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_improvedreincarnation.jpg',\n\t\t},\n\t\t[ShamanMinorGlyph.GlyphOfTheArcticWolf]: {\n\t\t\tname: 'Glyph of the Arctic Wolf',\n\t\t\tdescription: 'Alters the appearance of your Ghost Wolf transformation, causing it to resemble an arctic wolf.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mount_whitedirewolf.jpg',\n\t\t},\n\t\t[ShamanMinorGlyph.GlyphOfThunderstorm]: {\n\t\t\tname: 'Glyph of Thunderstorm',\n\t\t\tdescription: 'Increases the mana you receive from your Thunderstorm spell by 2%, but it no longer knocks enemies back or reduces their movement speed.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_thunderstorm.jpg',\n\t\t},\n\t\t[ShamanMinorGlyph.GlyphOfWaterBreathing]: {\n\t\t\tname: 'Glyph of Water Breathing',\n\t\t\tdescription: 'Your Water Breathing spell no longer requires a reagent.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonbreath.jpg',\n\t\t},\n\t\t[ShamanMinorGlyph.GlyphOfWaterWalking]: {\n\t\t\tname: 'Glyph of Water Walking',\n\t\t\tdescription: 'Your Water Walking spell no longer requires a reagent.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_windwalkon.jpg',\n\t\t},\n\t},\n};","import { WarlockMajorGlyph, WarlockMinorGlyph,WarlockPrimeGlyph, WarlockTalents } from '../proto/warlock.js';\nimport { GlyphsConfig } from './glyphs_picker.js';\nimport { newTalentsConfig,TalentsConfig } from './talents_picker.js';\nimport WarlockTalentJson from './trees/warlock.json';\n\nexport const warlockTalentsConfig: TalentsConfig<WarlockTalents> = newTalentsConfig(WarlockTalentJson);\n\nexport const warlockGlyphsConfig: GlyphsConfig = {\n\tprimeGlyphs: {\n\t\t[WarlockPrimeGlyph.GlyphOfBaneOfAgony]: {\n\t\t\tname: 'Glyph of Bane of Agony',\n\t\t\tdescription: 'Increases the duration of your Bane of Agony by 4 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_curseofsargeras.jpg',\n\t\t},\n\t\t[WarlockPrimeGlyph.GlyphOfChaosBolt]: {\n\t\t\tname: 'Glyph of Chaos Bolt',\n\t\t\tdescription: 'Reduces the cooldown on Chaos Bolt by 2 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warlock_chaosbolt.jpg',\n\t\t},\n\t\t[WarlockPrimeGlyph.GlyphOfConflagrate]: {\n\t\t\tname: 'Glyph of Conflagrate',\n\t\t\tdescription: 'Reduces the cooldown of your Conflagrate by 2 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_fireball.jpg',\n\t\t},\n\t\t[WarlockPrimeGlyph.GlyphOfCorruption]: {\n\t\t\tname: 'Glyph of Corruption',\n\t\t\tdescription: 'Your Corruption spell has a 4% chance to cause you to enter a Shadow Trance state after damaging the opponent. The Shadow Trance state reduces the casting time of your next Shadow Bolt spell by 100%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_abominationexplosion.jpg',\n\t\t},\n\t\t[WarlockPrimeGlyph.GlyphOfFelguard]: {\n\t\t\tname: 'Glyph of Felguard',\n\t\t\tdescription: 'Increases the damage done by your Felguard\\'s Legion Strike by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonfelguard.jpg',\n\t\t},\n\t\t[WarlockPrimeGlyph.GlyphOfHaunt]: {\n\t\t\tname: 'Glyph of Haunt',\n\t\t\tdescription: 'The bonus damage granted by your Haunt spell is increased by an additional 3%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warlock_haunt.jpg',\n\t\t},\n\t\t[WarlockPrimeGlyph.GlyphOfImmolate]: {\n\t\t\tname: 'Glyph of Immolate',\n\t\t\tdescription: 'Increases the periodic damage of your Immolate by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_immolation.jpg',\n\t\t},\n\t\t[WarlockPrimeGlyph.GlyphOfImp]: {\n\t\t\tname: 'Glyph of Imp',\n\t\t\tdescription: 'Increases the damage done by your Imp\\'s Firebolt spell by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonimp.jpg',\n\t\t},\n\t\t[WarlockPrimeGlyph.GlyphOfIncinerate]: {\n\t\t\tname: 'Glyph of Incinerate',\n\t\t\tdescription: 'Increases the damage done by Incinerate by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_burnout.jpg',\n\t\t},\n\t\t[WarlockPrimeGlyph.GlyphOfLashOfPain]: {\n\t\t\tname: 'Glyph of Lash of Pain',\n\t\t\tdescription: 'Increases the damage done by your Succubus\\' Lash of Pain by 25%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_curse.jpg',\n\t\t},\n\t\t[WarlockPrimeGlyph.GlyphOfMetamorphosis]: {\n\t\t\tname: 'Glyph of Metamorphosis',\n\t\t\tdescription: 'Increases the duration of your Metamorphosis by 6 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonform.jpg',\n\t\t},\n\t\t[WarlockPrimeGlyph.GlyphOfShadowburn]: {\n\t\t\tname: 'Glyph of Shadowburn',\n\t\t\tdescription: 'If your Shadowburn fails to kill the target at or below 20% health, your Shadowburn\\'s cooldown is instantly reset. This effect has a 6 sec cooldown.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_scourgebuild.jpg',\n\t\t},\n\t\t[WarlockPrimeGlyph.GlyphOfUnstableAffliction]: {\n\t\t\tname: 'Glyph of Unstable Affliction',\n\t\t\tdescription: 'Decreases the casting time of your Unstable Affliction by 0.2 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_unstableaffliction_3.jpg',\n\t\t},\n\t},\n\tmajorGlyphs: {\n\t\t[WarlockMajorGlyph.GlyphOfDeathCoilWl]: {\n\t\t\tname: 'Glyph of Death Coil',\n\t\t\tdescription: 'Increases the duration of your Death Coil by 0.5 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathcoil.jpg',\n\t\t},\n\t\t[WarlockMajorGlyph.GlyphOfDemonicCircle]: {\n\t\t\tname: 'Glyph of Demonic Circle',\n\t\t\tdescription: 'Reduces the cooldown on Demonic Circle by 4 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demoniccircleteleport.jpg',\n\t\t},\n\t\t[WarlockMajorGlyph.GlyphOfFear]: {\n\t\t\tname: 'Glyph of Fear',\n\t\t\tdescription: 'Your Fear causes the target to tremble in place instead of fleeing in fear, but now causes Fear to have a 5 sec cooldown.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_possession.jpg',\n\t\t},\n\t\t[WarlockMajorGlyph.GlyphOfFelhunter]: {\n\t\t\tname: 'Glyph of Felhunter',\n\t\t\tdescription: 'When your Felhunter uses Devour Magic, you will also be healed for that amount.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonfelhunter.jpg',\n\t\t},\n\t\t[WarlockMajorGlyph.GlyphOfHealthstone]: {\n\t\t\tname: 'Glyph of Healthstone',\n\t\t\tdescription: 'You receive 30% more healing from using a healthstone.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_stone_04.jpg',\n\t\t},\n\t\t[WarlockMajorGlyph.GlyphOfHowlOfTerror]: {\n\t\t\tname: 'Glyph of Howl of Terror',\n\t\t\tdescription: 'Reduces the cooldown on your Howl of Terror spell by 8 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathscream.jpg',\n\t\t},\n\t\t[WarlockMajorGlyph.GlyphOfLifeTap]: {\n\t\t\tname: 'Glyph of Life Tap',\n\t\t\tdescription: 'Reduces the global cooldown of your Life Tap by 0.5 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_burningspirit.jpg',\n\t\t},\n\t\t[WarlockMajorGlyph.GlyphOfSeduction]: {\n\t\t\tname: 'Glyph of Seduction',\n\t\t\tdescription: 'Your Succubus\\'s Seduction ability also removes all damage over time effects from the target.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_mindsteal.jpg',\n\t\t},\n\t\t[WarlockMajorGlyph.GlyphOfShadowBolt]: {\n\t\t\tname: 'Glyph of Shadow Bolt',\n\t\t\tdescription: 'Reduces the mana cost of your Shadow Bolt by 15%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowbolt.jpg',\n\t\t},\n\t\t[WarlockMajorGlyph.GlyphOfShadowflame]: {\n\t\t\tname: 'Glyph of Shadowflame',\n\t\t\tdescription: 'Your Shadowflame also applies a 70% movement speed slow to its victims.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warlock_shadowflame.jpg',\n\t\t},\n\t\t[WarlockMajorGlyph.GlyphOfSoulLink]: {\n\t\t\tname: 'Glyph of Soul Link',\n\t\t\tdescription: 'Increases the percentage of damage shared via your Soul Link by an additional 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_gathershadows.jpg',\n\t\t},\n\t\t[WarlockMajorGlyph.GlyphOfSoulSwap]: {\n\t\t\tname: 'Glyph of Soul Swap',\n\t\t\tdescription: 'Your Soul Swap leaves your damage-over-time spells behind on the target you Soul Swapped from, but gives Soul Swap a 30 sec cooldown.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warlock_soulswap.jpg',\n\t\t},\n\t\t[WarlockMajorGlyph.GlyphOfSoulstone]: {\n\t\t\tname: 'Glyph of Soulstone',\n\t\t\tdescription: 'Increases the amount of health you gain from resurrecting via a Soulstone by an additional 40%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_orb_04.jpg',\n\t\t},\n\t\t[WarlockMajorGlyph.GlyphOfVoidwalker]: {\n\t\t\tname: 'Glyph of Voidwalker',\n\t\t\tdescription: 'Increases your Voidwalker\\'s total health by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonvoidwalker.jpg',\n\t\t},\n\t},\n\tminorGlyphs: {\n\t\t[WarlockMinorGlyph.GlyphOfCurseOfExhaustion]: {\n\t\t\tname: 'Glyph of Curse of Exhaustion',\n\t\t\tdescription: 'Increases the range of your Curse of Exhaustion spell by 5 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_grimward.jpg',\n\t\t},\n\t\t[WarlockMinorGlyph.GlyphOfDrainSoul]: {\n\t\t\tname: 'Glyph of Drain Soul',\n\t\t\tdescription: 'Your Drain Soul restores 10% of your total mana after you kill a target that yields experience or honor.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_haunting.jpg',\n\t\t},\n\t\t[WarlockMinorGlyph.GlyphOfEyeOfKilrogg]: {\n\t\t\tname: 'Glyph of Eye of Kilrogg',\n\t\t\tdescription: 'Increases the movement speed of your Eye of Kilrogg by 50% and allows it to fly in areas where flying mounts are enabled.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_evileye.jpg',\n\t\t},\n\t\t[WarlockMinorGlyph.GlyphOfHealthFunnel]: {\n\t\t\tname: 'Glyph of Health Funnel',\n\t\t\tdescription: 'Reduces the pushback suffered from damaging attacks while channeling your Health Funnel spell by 100%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg',\n\t\t},\n\t\t[WarlockMinorGlyph.GlyphOfRitualOfSouls]: {\n\t\t\tname: 'Glyph of Ritual of Souls',\n\t\t\tdescription: 'Reduces the mana cost of your Ritual of Souls spell by 70%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadesofdarkness.jpg',\n\t\t},\n\t\t[WarlockMinorGlyph.GlyphOfSubjugateDemon]: {\n\t\t\tname: 'Glyph of Subjugate Demon',\n\t\t\tdescription: 'Reduces the cast time of your Subjugate Demon spell by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_enslavedemon.jpg',\n\t\t},\n\t\t[WarlockMinorGlyph.GlyphOfUnendingBreath]: {\n\t\t\tname: 'Glyph of Unending Breath',\n\t\t\tdescription: 'Increases the swim speed of targets affected by your Unending Breath spell by 20%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonbreath.jpg',\n\t\t},\n\t},\n};","import { WarriorMajorGlyph, WarriorMinorGlyph,WarriorPrimeGlyph, WarriorTalents } from '../proto/warrior.js';\nimport { GlyphsConfig } from './glyphs_picker.js';\nimport { newTalentsConfig,TalentsConfig } from './talents_picker.js';\nimport WarriorTalentJson from './trees/warrior.json';\n\nexport const warriorTalentsConfig: TalentsConfig<WarriorTalents> = newTalentsConfig(WarriorTalentJson);\n\nexport const warriorGlyphsConfig: GlyphsConfig = {\n\tprimeGlyphs: {\n\t\t[WarriorPrimeGlyph.GlyphOfBladestorm]: {\n\t\t\tname: 'Glyph of Bladestorm',\n\t\t\tdescription: 'Reduces the cooldown on Bladestorm by 15 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_bladestorm.jpg',\n\t\t},\n\t\t[WarriorPrimeGlyph.GlyphOfBloodthirst]: {\n\t\t\tname: 'Glyph of Bloodthirst',\n\t\t\tdescription: 'Increases the damage of Bloodthirst by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_bloodlust.jpg',\n\t\t},\n\t\t[WarriorPrimeGlyph.GlyphOfDevastate]: {\n\t\t\tname: 'Glyph of Devastate',\n\t\t\tdescription: 'Increases the critical strike chance of Devastate by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_sword_11.jpg',\n\t\t},\n\t\t[WarriorPrimeGlyph.GlyphOfMortalStrike]: {\n\t\t\tname: 'Glyph of Mortal Strike',\n\t\t\tdescription: 'Increases the damage of Mortal Strike by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_savageblow.jpg',\n\t\t},\n\t\t[WarriorPrimeGlyph.GlyphOfOverpower]: {\n\t\t\tname: 'Glyph of Overpower',\n\t\t\tdescription: 'Increases the damage of Overpower by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_meleedamage.jpg',\n\t\t},\n\t\t[WarriorPrimeGlyph.GlyphOfRagingBlow]: {\n\t\t\tname: 'Glyph of Raging Blow',\n\t\t\tdescription: 'Increases the critical strike chance of Raging Blow by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_swiftstrike.jpg',\n\t\t},\n\t\t[WarriorPrimeGlyph.GlyphOfRevenge]: {\n\t\t\tname: 'Glyph of Revenge',\n\t\t\tdescription: 'Increases the damage of Revenge by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_revenge.jpg',\n\t\t},\n\t\t[WarriorPrimeGlyph.GlyphOfShieldSlam]: {\n\t\t\tname: 'Glyph of Shield Slam',\n\t\t\tdescription: 'Increases the damage of Shield Slam by 10%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_shield_05.jpg',\n\t\t},\n\t\t[WarriorPrimeGlyph.GlyphOfSlam]: {\n\t\t\tname: 'Glyph of Slam',\n\t\t\tdescription: 'Increases the critical strike chance of Slam by 5%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_decisivestrike.jpg',\n\t\t},\n\t},\n\tmajorGlyphs: {\n\t\t[WarriorMajorGlyph.GlyphOfCleaving]: {\n\t\t\tname: 'Glyph of Cleaving',\n\t\t\tdescription: 'Increases the number of targets your Cleave hits by 1.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_cleave.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfColossusSmash]: {\n\t\t\tname: 'Glyph of Colossus Smash',\n\t\t\tdescription: 'Your Colossus Smash also applies the Sunder Armor effect to your target.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_colossussmash.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfDeathWish]: {\n\t\t\tname: 'Glyph of Death Wish',\n\t\t\tdescription: 'Death Wish no longer increases damage taken.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathpact.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfHeroicThrow]: {\n\t\t\tname: 'Glyph of Heroic Throw',\n\t\t\tdescription: 'Your Heroic Throw applies a stack of Sunder Armor.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_axe_66.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfIntercept]: {\n\t\t\tname: 'Glyph of Intercept',\n\t\t\tdescription: 'Increases the duration of your Intercept stun by 1 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_sprint.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfIntervene]: {\n\t\t\tname: 'Glyph of Intervene',\n\t\t\tdescription: 'Increases the number of attacks you intercept for your Intervene target by 1.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_victoryrush.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfLongCharge]: {\n\t\t\tname: 'Glyph of Long Charge',\n\t\t\tdescription: 'Increases the range of your Charge ability by 5 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_charge.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfPiercingHowl]: {\n\t\t\tname: 'Glyph of Piercing Howl',\n\t\t\tdescription: 'Increases the radius of Piercing Howl by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathscream.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfRapidCharge]: {\n\t\t\tname: 'Glyph of Rapid Charge',\n\t\t\tdescription: 'Reduces the cooldown of your Charge ability by 1 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_charge.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfResonatingPower]: {\n\t\t\tname: 'Glyph of Resonating Power',\n\t\t\tdescription: 'Reduces the rage cost of your Thunder Clap ability by 5.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_thunderclap.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfShieldWall]: {\n\t\t\tname: 'Glyph of Shield Wall',\n\t\t\tdescription: 'Shield Wall now reduces damage taken by an additional 20%, but its cooldown is increased by 2 min.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shieldwall.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfShockwave]: {\n\t\t\tname: 'Glyph of Shockwave',\n\t\t\tdescription: 'Reduces the cooldown on Shockwave by 3 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shockwave.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfSpellReflection]: {\n\t\t\tname: 'Glyph of Spell Reflection',\n\t\t\tdescription: 'Reduces the cooldown on Spell Reflection by 5 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shieldreflection.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfSunderArmor]: {\n\t\t\tname: 'Glyph of Sunder Armor',\n\t\t\tdescription: 'When you use Sunder Armor or Devastate, a second nearby target also receives Sunder Armor.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_sunder.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfSweepingStrikes]: {\n\t\t\tname: 'Glyph of Sweeping Strikes',\n\t\t\tdescription: 'Reduces the rage cost of your Sweeping Strikes ability by 100%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_slicedice.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfThunderClap]: {\n\t\t\tname: 'Glyph of Thunder Clap',\n\t\t\tdescription: 'Increases the radius of your Thunder Clap ability by 2 yards.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_thunderclap.jpg',\n\t\t},\n\t\t[WarriorMajorGlyph.GlyphOfVictoryRush]: {\n\t\t\tname: 'Glyph of Victory Rush',\n\t\t\tdescription: 'Increases the total healing provided by your Victory Rush by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_devastate.jpg',\n\t\t},\n\t},\n\tminorGlyphs: {\n\t\t[WarriorMinorGlyph.GlyphOfBattle]: {\n\t\t\tname: 'Glyph of Battle',\n\t\t\tdescription: 'Increases the duration by 2 min and area of effect by 50% of your Battle Shout.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_battleshout.jpg',\n\t\t},\n\t\t[WarriorMinorGlyph.GlyphOfBerserkerRage]: {\n\t\t\tname: 'Glyph of Berserker Rage',\n\t\t\tdescription: 'Berserker Rage generates 5 Rage when used.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_ancestralguardian.jpg',\n\t\t},\n\t\t[WarriorMinorGlyph.GlyphOfBloodyHealing]: {\n\t\t\tname: 'Glyph of Bloody Healing',\n\t\t\tdescription: 'Increases the healing you receive from Bloodthirst by 40%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_bloodlust.jpg',\n\t\t},\n\t\t[WarriorMinorGlyph.GlyphOfCommand]: {\n\t\t\tname: 'Glyph of Command',\n\t\t\tdescription: 'Increases the duration by 2 min and area of effect by 50% of your Commanding Shout.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_rallyingcry.jpg',\n\t\t},\n\t\t[WarriorMinorGlyph.GlyphOfDemoralizingShout]: {\n\t\t\tname: 'Glyph of Demoralizing Shout',\n\t\t\tdescription: 'Increases the duration by 15 sec and area of effect by 50% of your Demoralizing Shout.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_warcry.jpg',\n\t\t},\n\t\t[WarriorMinorGlyph.GlyphOfEnduringVictory]: {\n\t\t\tname: 'Glyph of Enduring Victory',\n\t\t\tdescription: 'Increases the window of opportunity in which you can use Victory Rush by 5 sec.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_devastate.jpg',\n\t\t},\n\t\t[WarriorMinorGlyph.GlyphOfFuriousSundering]: {\n\t\t\tname: 'Glyph of Furious Sundering',\n\t\t\tdescription: 'Reduces the cost of Sunder Armor by 50%.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_sunder.jpg',\n\t\t},\n\t\t[WarriorMinorGlyph.GlyphOfIntimidatingShout]: {\n\t\t\tname: 'Glyph of Intimidating Shout',\n\t\t\tdescription: 'All targets of your Intimidating Shout now tremble in place instead of fleeing in fear.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_golemthunderclap.jpg',\n\t\t},\n\t\t[WarriorMinorGlyph.GlyphOfShatteringThrow]: {\n\t\t\tname: 'Glyph of Shattering Throw',\n\t\t\tdescription: 'Your Shattering Throw is now instant and can be used in any stance, but it no longer removes invulnerabilities and cannot be used on players or player-controlled targets.',\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_questionmark.jpg',\n\t\t},\n\t},\n};","import { PlayerSpec } from '../player_spec.js';\nimport { Class, Spec } from '../proto/common.js';\nimport { SpecTalents, specTypeFunctions } from '../proto_utils/utils.js';\nimport { deathKnightGlyphsConfig, deathKnightTalentsConfig } from './death_knight.js';\nimport { druidGlyphsConfig, druidTalentsConfig } from './druid.js';\nimport { GlyphsConfig } from './glyphs_picker.js';\nimport { hunterGlyphsConfig, hunterTalentsConfig } from './hunter.js';\nimport { mageGlyphsConfig, mageTalentsConfig } from './mage.js';\nimport { paladinGlyphsConfig, paladinTalentsConfig } from './paladin.js';\nimport { priestGlyphsConfig, priestTalentsConfig } from './priest.js';\nimport { rogueGlyphsConfig, rogueTalentsConfig } from './rogue.js';\nimport { shamanGlyphsConfig, shamanTalentsConfig } from './shaman.js';\nimport { TalentsConfig } from './talents_picker.js';\nimport { warlockGlyphsConfig, warlockTalentsConfig } from './warlock.js';\nimport { warriorGlyphsConfig, warriorTalentsConfig } from './warrior.js';\n\nexport const classTalentsConfig: Record<Class, TalentsConfig<any>> = {\n\t[Class.ClassUnknown]: [],\n\t[Class.ClassDeathKnight]: deathKnightTalentsConfig,\n\t[Class.ClassDruid]: druidTalentsConfig,\n\t[Class.ClassShaman]: shamanTalentsConfig,\n\t[Class.ClassHunter]: hunterTalentsConfig,\n\t[Class.ClassMage]: mageTalentsConfig,\n\t[Class.ClassRogue]: rogueTalentsConfig,\n\t[Class.ClassPaladin]: paladinTalentsConfig,\n\t[Class.ClassPriest]: priestTalentsConfig,\n\t[Class.ClassWarlock]: warlockTalentsConfig,\n\t[Class.ClassWarrior]: warriorTalentsConfig,\n};\n\nexport const classGlyphsConfig: Record<Class, GlyphsConfig> = {\n\t[Class.ClassUnknown]: { primeGlyphs: [], majorGlyphs: [], minorGlyphs: [] },\n\t[Class.ClassDeathKnight]: deathKnightGlyphsConfig,\n\t[Class.ClassDruid]: druidGlyphsConfig,\n\t[Class.ClassShaman]: shamanGlyphsConfig,\n\t[Class.ClassHunter]: hunterGlyphsConfig,\n\t[Class.ClassMage]: mageGlyphsConfig,\n\t[Class.ClassRogue]: rogueGlyphsConfig,\n\t[Class.ClassPaladin]: paladinGlyphsConfig,\n\t[Class.ClassPriest]: priestGlyphsConfig,\n\t[Class.ClassWarlock]: warlockGlyphsConfig,\n\t[Class.ClassWarrior]: warriorGlyphsConfig,\n};\n\nexport function talentSpellIdsToTalentString(playerClass: Class, talentIds: Array<number>): string {\n\tconst talentsConfig = classTalentsConfig[playerClass];\n\n\tconst talentsStr = talentsConfig\n\t\t.map(treeConfig => {\n\t\t\tconst treeStr = treeConfig.talents\n\t\t\t\t.map(talentConfig => {\n\t\t\t\t\tconst spellIdIndex = talentConfig.spellIds.findIndex(spellId => talentIds.includes(spellId));\n\t\t\t\t\tif (spellIdIndex == -1) {\n\t\t\t\t\t\treturn '0';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn String(spellIdIndex + 1);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.join('')\n\t\t\t\t.replace(/0+$/g, '');\n\n\t\t\treturn treeStr;\n\t\t})\n\t\t.join('-')\n\t\t.replace(/-+$/g, '');\n\n\treturn talentsStr;\n}\n\nexport function playerTalentStringToProto<SpecType extends Spec>(playerSpec: PlayerSpec<SpecType>, talentString: string): SpecTalents<SpecType> {\n\tconst specFunctions = specTypeFunctions[playerSpec.specID];\n\tconst proto = specFunctions.talentsCreate() as SpecTalents<SpecType>;\n\tconst talentsConfig = classTalentsConfig[playerSpec.classID] as TalentsConfig<SpecTalents<SpecType>>;\n\n\treturn talentStringToProto(proto, talentString, talentsConfig);\n}\n\nexport function talentStringToProto<TalentsProto>(proto: TalentsProto, talentString: string, talentsConfig: TalentsConfig<TalentsProto>): TalentsProto {\n\ttalentString.split('-').forEach((treeString, treeIdx) => {\n\t\tconst treeConfig = talentsConfig[treeIdx];\n\t\t[...treeString].forEach((talentString, i) => {\n\t\t\tconst talentConfig = treeConfig.talents[i];\n\t\t\tconst points = parseInt(talentString);\n\t\t\tif (talentConfig.fieldName) {\n\t\t\t\tif (talentConfig.maxPoints == 1) {\n\t\t\t\t\t(proto[talentConfig.fieldName as keyof TalentsProto] as unknown as boolean) = points == 1;\n\t\t\t\t} else {\n\t\t\t\t\t(proto[talentConfig.fieldName as keyof TalentsProto] as unknown as number) = points;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\treturn proto;\n}\n\n// Note that this function will fail if any of the talent names are not defined. TODO: Remove that condition\n// once all talents are migrated to wrath and use all fields.\nexport function protoToTalentString<TalentsProto>(proto: TalentsProto, talentsConfig: TalentsConfig<TalentsProto>): string {\n\treturn talentsConfig\n\t\t.map(treeConfig => {\n\t\t\treturn treeConfig.talents\n\t\t\t\t.map(talentConfig => String(Number(proto[(talentConfig.fieldName as keyof TalentsProto)!])))\n\t\t\t\t.join('')\n\t\t\t\t.replace(/0+$/g, '');\n\t\t})\n\t\t.join('-')\n\t\t.replace(/-+$/g, '');\n}\n","import { ReforgeData } from './components/gear_picker';\nimport { getLanguageCode } from './constants/lang';\nimport * as Mechanics from './constants/mechanics';\nimport { MAX_PARTY_SIZE, Party } from './party';\nimport { PlayerClass } from './player_class';\nimport { PlayerSpec } from './player_spec';\nimport { PlayerSpecs } from './player_specs';\nimport {\n\tAuraStats as AuraStatsProto,\n\tPlayer as PlayerProto,\n\tPlayerStats,\n\tSpellStats as SpellStatsProto,\n\tStatWeightsResult,\n\tUnitMetadata as UnitMetadataProto,\n} from './proto/api';\nimport { APLRotation, APLRotation_Type as APLRotationType, SimpleRotation } from './proto/apl';\nimport {\n\tClass,\n\tConsumes,\n\tCooldowns,\n\tFaction,\n\tGemColor,\n\tGlyphs,\n\tHandType,\n\tHealingModel,\n\tIndividualBuffs,\n\tItemRandomSuffix,\n\tItemSlot,\n\tProfession,\n\tPseudoStat,\n\tRace,\n\tReforgeStat,\n\tSimDatabase,\n\tSpec,\n\tStat,\n\tUnitReference,\n\tUnitStats,\n} from './proto/common';\nimport {\n\tDungeonDifficulty,\n\tExpansion,\n\tRaidFilterOption,\n\tSourceFilterOption,\n\tUIEnchant as Enchant,\n\tUIGem as Gem,\n\tUIItem as Item,\n\tUIItem_FactionRestriction,\n} from './proto/ui';\nimport { ActionId } from './proto_utils/action_id';\nimport { Database } from './proto_utils/database';\nimport { EquippedItem, getWeaponDPS } from './proto_utils/equipped_item';\nimport { Gear, ItemSwapGear } from './proto_utils/gear';\nimport { gemMatchesSocket, isUnrestrictedGem } from './proto_utils/gems';\nimport { Stats } from './proto_utils/stats';\nimport {\n\tAL_CATEGORY_HARD_MODE,\n\tcanEquipEnchant,\n\tcanEquipItem,\n\tClassOptions,\n\tClassSpecs,\n\temptyUnitReference,\n\tenchantAppliesToItem,\n\tgetMetaGemEffectEP,\n\tgetTalentTree,\n\tgetTalentTreePoints,\n\tnewUnitReference,\n\traceToFaction,\n\tSpecClasses,\n\tSpecOptions,\n\tSpecRotation,\n\tSpecTalents,\n\tSpecTypeFunctions,\n\tspecTypeFunctions,\n\twithSpec,\n} from './proto_utils/utils';\nimport { Raid } from './raid';\nimport { Sim, SimSettingCategories } from './sim';\nimport { playerTalentStringToProto } from './talents/factory';\nimport { EventID, TypedEvent } from './typed_event';\nimport { stringComparator, sum } from './utils';\n\nexport interface AuraStats {\n\tdata: AuraStatsProto;\n\tid: ActionId;\n}\nexport interface SpellStats {\n\tdata: SpellStatsProto;\n\tid: ActionId;\n}\n\nexport class UnitMetadata {\n\tprivate name: string;\n\tprivate auras: Array<AuraStats>;\n\tprivate spells: Array<SpellStats>;\n\n\tconstructor() {\n\t\tthis.name = '';\n\t\tthis.auras = [];\n\t\tthis.spells = [];\n\t}\n\n\tgetName(): string {\n\t\treturn this.name;\n\t}\n\n\tgetAuras(): Array<AuraStats> {\n\t\treturn this.auras.slice();\n\t}\n\n\tgetSpells(): Array<SpellStats> {\n\t\treturn this.spells.slice();\n\t}\n\n\t// Returns whether any updates were made.\n\tasync update(metadata: UnitMetadataProto): Promise<boolean> {\n\t\tlet newSpells = metadata!.spells.map(spell => {\n\t\t\treturn {\n\t\t\t\tdata: spell,\n\t\t\t\tid: ActionId.fromProto(spell.id!),\n\t\t\t};\n\t\t});\n\t\tlet newAuras = metadata!.auras.map(aura => {\n\t\t\treturn {\n\t\t\t\tdata: aura,\n\t\t\t\tid: ActionId.fromProto(aura.id!),\n\t\t\t};\n\t\t});\n\n\t\tawait Promise.all([...newSpells, ...newAuras].map(newSpell => newSpell.id.fill().then(newId => (newSpell.id = newId))));\n\n\t\tnewSpells = newSpells.sort((a, b) => stringComparator(a.id.name, b.id.name));\n\t\tnewAuras = newAuras.sort((a, b) => stringComparator(a.id.name, b.id.name));\n\n\t\tlet anyUpdates = false;\n\t\tif (metadata.name != this.name) {\n\t\t\tthis.name = metadata.name;\n\t\t\tanyUpdates = true;\n\t\t}\n\t\tif (newSpells.length != this.spells.length || newSpells.some((newSpell, i) => !newSpell.id.equals(this.spells[i].id))) {\n\t\t\tthis.spells = newSpells;\n\t\t\tanyUpdates = true;\n\t\t}\n\t\tif (newAuras.length != this.auras.length || newAuras.some((newAura, i) => !newAura.id.equals(this.auras[i].id))) {\n\t\t\tthis.auras = newAuras;\n\t\t\tanyUpdates = true;\n\t\t}\n\n\t\treturn anyUpdates;\n\t}\n}\n\nexport class UnitMetadataList {\n\tprivate metadatas: Array<UnitMetadata>;\n\n\tconstructor() {\n\t\tthis.metadatas = [];\n\t}\n\n\tasync update(newMetadatas: Array<UnitMetadataProto>): Promise<boolean> {\n\t\tconst oldLen = this.metadatas.length;\n\n\t\tif (newMetadatas.length > oldLen) {\n\t\t\tfor (let i = oldLen; i < newMetadatas.length; i++) {\n\t\t\t\tthis.metadatas.push(new UnitMetadata());\n\t\t\t}\n\t\t} else if (newMetadatas.length < oldLen) {\n\t\t\tthis.metadatas = this.metadatas.slice(0, newMetadatas.length);\n\t\t}\n\n\t\tconst anyUpdates = await Promise.all(newMetadatas.map((metadata, i) => this.metadatas[i].update(metadata)));\n\n\t\treturn oldLen != this.metadatas.length || anyUpdates.some(v => v);\n\t}\n\n\tasList(): Array<UnitMetadata> {\n\t\treturn this.metadatas.slice();\n\t}\n}\n\nexport interface MeleeCritCapInfo {\n\tmeleeCrit: number;\n\tmeleeHit: number;\n\texpertise: number;\n\tsuppression: number;\n\tglancing: number;\n\thasOffhandWeapon: boolean;\n\tmeleeHitCap: number;\n\texpertiseCap: number;\n\tremainingMeleeHitCap: number;\n\tremainingExpertiseCap: number;\n\tbaseCritCap: number;\n\tspecSpecificOffset: number;\n\tplayerCritCapDelta: number;\n}\n\nexport type AutoRotationGenerator<SpecType extends Spec> = (player: Player<SpecType>) => APLRotation;\nexport type SimpleRotationGenerator<SpecType extends Spec> = (\n\tplayer: Player<SpecType>,\n\tsimpleRotation: SpecRotation<SpecType>,\n\tcooldowns: Cooldowns,\n) => APLRotation;\n\nexport interface PlayerConfig<SpecType extends Spec> {\n\tautoRotation: AutoRotationGenerator<SpecType>;\n\tsimpleRotation?: SimpleRotationGenerator<SpecType>;\n}\n\nconst SPEC_CONFIGS: Partial<Record<Spec, PlayerConfig<any>>> = {};\n\nexport function registerSpecConfig<SpecType extends Spec>(spec: SpecType, config: PlayerConfig<SpecType>) {\n\tSPEC_CONFIGS[spec] = config;\n}\n\nexport function getSpecConfig<SpecType extends Spec>(spec: SpecType): PlayerConfig<SpecType> {\n\tconst config = SPEC_CONFIGS[spec] as PlayerConfig<SpecType>;\n\tif (!config) {\n\t\tthrow new Error('No config registered for Spec: ' + spec);\n\t}\n\treturn config;\n}\n\n// Manages all the gear / consumes / other settings for a single Player.\nexport class Player<SpecType extends Spec> {\n\treadonly sim: Sim;\n\tprivate party: Party | null;\n\tprivate raid: Raid | null;\n\n\treadonly playerSpec: PlayerSpec<SpecType>;\n\treadonly playerClass: PlayerClass<SpecClasses<SpecType>>;\n\n\tprivate name = '';\n\tprivate buffs: IndividualBuffs = IndividualBuffs.create();\n\tprivate consumes: Consumes = Consumes.create();\n\tprivate bonusStats: Stats = new Stats();\n\tprivate gear: Gear = new Gear({});\n\t//private bulkEquipmentSpec: BulkEquipmentSpec = BulkEquipmentSpec.create();\n\tprivate enableItemSwap = false;\n\tprivate itemSwapGear: ItemSwapGear = new ItemSwapGear({});\n\tprivate race: Race;\n\tprivate profession1: Profession = 0;\n\tprivate profession2: Profession = 0;\n\taplRotation: APLRotation = APLRotation.create();\n\tprivate talentsString = '';\n\tprivate glyphs: Glyphs = Glyphs.create();\n\tprivate specOptions: SpecOptions<SpecType>;\n\tprivate reactionTime = 0;\n\tprivate channelClipDelay = 0;\n\tprivate inFrontOfTarget = false;\n\tprivate distanceFromTarget = 0;\n\tprivate darkIntentUptime = 100;\n\tprivate healingModel: HealingModel = HealingModel.create();\n\tprivate healingEnabled = false;\n\n\tprivate readonly autoRotationGenerator: AutoRotationGenerator<SpecType> | null = null;\n\tprivate readonly simpleRotationGenerator: SimpleRotationGenerator<SpecType> | null = null;\n\n\tprivate itemEPCache = new Array<Map<number, number>>();\n\tprivate gemEPCache = new Map<number, number>();\n\tprivate randomSuffixEPCache = new Map<number, number>();\n\tprivate enchantEPCache = new Map<number, number>();\n\tprivate talents: SpecTalents<SpecType> | null = null;\n\n\treadonly specTypeFunctions: SpecTypeFunctions<SpecType>;\n\n\tprivate static readonly numEpRatios = 6;\n\tprivate epRatios: Array<number> = new Array<number>(Player.numEpRatios).fill(0);\n\tprivate epWeights: Stats = new Stats();\n\tprivate currentStats: PlayerStats = PlayerStats.create();\n\tprivate metadata: UnitMetadata = new UnitMetadata();\n\tprivate petMetadatas: UnitMetadataList = new UnitMetadataList();\n\n\treadonly nameChangeEmitter = new TypedEvent<void>('PlayerName');\n\treadonly buffsChangeEmitter = new TypedEvent<void>('PlayerBuffs');\n\treadonly consumesChangeEmitter = new TypedEvent<void>('PlayerConsumes');\n\treadonly bonusStatsChangeEmitter = new TypedEvent<void>('PlayerBonusStats');\n\treadonly gearChangeEmitter = new TypedEvent<void>('PlayerGear');\n\treadonly itemSwapChangeEmitter = new TypedEvent<void>('PlayerItemSwap');\n\treadonly professionChangeEmitter = new TypedEvent<void>('PlayerProfession');\n\treadonly raceChangeEmitter = new TypedEvent<void>('PlayerRace');\n\treadonly rotationChangeEmitter = new TypedEvent<void>('PlayerRotation');\n\treadonly talentsChangeEmitter = new TypedEvent<void>('PlayerTalents');\n\treadonly glyphsChangeEmitter = new TypedEvent<void>('PlayerGlyphs');\n\treadonly specOptionsChangeEmitter = new TypedEvent<void>('PlayerSpecOptions');\n\treadonly inFrontOfTargetChangeEmitter = new TypedEvent<void>('PlayerInFrontOfTarget');\n\treadonly distanceFromTargetChangeEmitter = new TypedEvent<void>('PlayerDistanceFromTarget');\n\treadonly healingModelChangeEmitter = new TypedEvent<void>('PlayerHealingModel');\n\treadonly epWeightsChangeEmitter = new TypedEvent<void>('PlayerEpWeights');\n\treadonly miscOptionsChangeEmitter = new TypedEvent<void>('PlayerMiscOptions');\n\n\treadonly currentStatsEmitter = new TypedEvent<void>('PlayerCurrentStats');\n\treadonly epRatiosChangeEmitter = new TypedEvent<void>('PlayerEpRatios');\n\treadonly epRefStatChangeEmitter = new TypedEvent<void>('PlayerEpRefStat');\n\n\t// Emits when any of the above emitters emit.\n\treadonly changeEmitter: TypedEvent<void>;\n\n\tconstructor(spec: PlayerSpec<SpecType>, sim: Sim) {\n\t\tthis.sim = sim;\n\t\tthis.party = null;\n\t\tthis.raid = null;\n\n\t\tthis.playerSpec = spec;\n\t\tthis.playerClass = PlayerSpecs.getPlayerClass(spec);\n\n\t\tthis.race = this.playerClass.races[0];\n\t\tthis.specTypeFunctions = specTypeFunctions[this.getSpec()] as SpecTypeFunctions<SpecType>;\n\t\tthis.specOptions = this.specTypeFunctions.optionsCreate();\n\n\t\tconst specConfig = SPEC_CONFIGS[this.getSpec()] as PlayerConfig<SpecType>;\n\t\tif (!specConfig) {\n\t\t\tthrow new Error(`Could not find spec config for spec: ${spec.friendlyName}`);\n\t\t}\n\t\tthis.autoRotationGenerator = specConfig.autoRotation;\n\t\tif (specConfig.simpleRotation) {\n\t\t\tthis.simpleRotationGenerator = specConfig.simpleRotation;\n\t\t} else {\n\t\t\tthis.simpleRotationGenerator = null;\n\t\t}\n\n\t\tfor (let i = 0; i < ItemSlot.ItemSlotRanged + 1; ++i) {\n\t\t\tthis.itemEPCache[i] = new Map();\n\t\t}\n\n\t\tthis.changeEmitter = TypedEvent.onAny(\n\t\t\t[\n\t\t\t\tthis.nameChangeEmitter,\n\t\t\t\tthis.buffsChangeEmitter,\n\t\t\t\tthis.consumesChangeEmitter,\n\t\t\t\tthis.bonusStatsChangeEmitter,\n\t\t\t\tthis.gearChangeEmitter,\n\t\t\t\tthis.itemSwapChangeEmitter,\n\t\t\t\tthis.professionChangeEmitter,\n\t\t\t\tthis.raceChangeEmitter,\n\t\t\t\tthis.rotationChangeEmitter,\n\t\t\t\tthis.talentsChangeEmitter,\n\t\t\t\tthis.glyphsChangeEmitter,\n\t\t\t\tthis.specOptionsChangeEmitter,\n\t\t\t\tthis.miscOptionsChangeEmitter,\n\t\t\t\tthis.inFrontOfTargetChangeEmitter,\n\t\t\t\tthis.distanceFromTargetChangeEmitter,\n\t\t\t\tthis.healingModelChangeEmitter,\n\t\t\t\tthis.epWeightsChangeEmitter,\n\t\t\t\tthis.epRatiosChangeEmitter,\n\t\t\t\tthis.epRefStatChangeEmitter,\n\t\t\t],\n\t\t\t'PlayerChange',\n\t\t);\n\t}\n\n\tgetSpecIcon(): string {\n\t\treturn this.playerSpec.getIcon('medium');\n\t}\n\n\tgetPlayerSpec(): PlayerSpec<SpecType> {\n\t\treturn this.playerSpec;\n\t}\n\n\tgetSpec(): SpecType {\n\t\treturn this.getPlayerSpec().specID;\n\t}\n\n\tgetPlayerClass(): PlayerClass<SpecClasses<SpecType>> {\n\t\treturn this.playerClass;\n\t}\n\n\tgetClass(): SpecClasses<SpecType> {\n\t\treturn this.playerSpec.classID;\n\t}\n\n\tgetClassColor(): string {\n\t\treturn this.playerClass.hexColor;\n\t}\n\n\t// TODO: Cata - Check this\n\tisSpec<T extends Spec>(specId: T): this is Player<T> {\n\t\treturn (this.getSpec() as unknown) == specId;\n\t}\n\n\tisClass<T extends Class>(classId: T): this is Player<ClassSpecs<T>> {\n\t\treturn (this.getClass() as unknown) == classId;\n\t}\n\n\tgetParty(): Party | null {\n\t\treturn this.party;\n\t}\n\n\tgetRaid(): Raid | null {\n\t\treturn this.raid;\n\t}\n\n\t// Returns this player's index within its party [0-4].\n\tgetPartyIndex(): number {\n\t\tif (this.party == null) {\n\t\t\tthrow new Error(\"Can't get party index for player without a party!\");\n\t\t}\n\n\t\treturn this.party.getPlayers().indexOf(this);\n\t}\n\n\t// Returns this player's index within its raid [0-24].\n\tgetRaidIndex(): number {\n\t\tif (this.party == null) {\n\t\t\tthrow new Error(\"Can't get raid index for player without a party!\");\n\t\t}\n\n\t\treturn this.party.getIndex() * MAX_PARTY_SIZE + this.getPartyIndex();\n\t}\n\n\t// This should only ever be called from party.\n\tsetParty(newParty: Party | null) {\n\t\tif (newParty == null) {\n\t\t\tthis.party = null;\n\t\t\tthis.raid = null;\n\t\t} else {\n\t\t\tthis.party = newParty;\n\t\t\tthis.raid = newParty.raid;\n\t\t}\n\t}\n\n\tgetOtherPartyMembers(): Array<Player<any>> {\n\t\tif (this.party == null) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn this.party.getPlayers().filter(player => player != null && player != this) as Array<Player<any>>;\n\t}\n\n\t// Returns all items that this player can wear in the given slot.\n\tgetItems(slot: ItemSlot): Array<Item> {\n\t\treturn this.sim.db.getItems(slot).filter(item => canEquipItem(item, this.playerSpec, slot));\n\t}\n\n\t// Returns all random suffixes that this player would be interested in for the given base item.\n\tgetRandomSuffixes(item: Item): Array<ItemRandomSuffix> {\n\t\tconst allSuffixes = item.randomSuffixOptions.map(id => this.sim.db.getRandomSuffixById(id)!);\n\t\treturn allSuffixes.filter(suffix => this.computeRandomSuffixEP(suffix) > 0);\n\t}\n\n\t// Returns all reforgings that are valid with a given item\n\tgetAvailableReforgings(item: Item): ReforgeStat[] | undefined {\n\t\treturn this.sim.db.getAvailableReforges(item);\n\t}\n\n\t// Returns reforge given an id\n\tgetReforge(id: number): ReforgeStat | undefined {\n\t\treturn this.sim.db.getReforge(id);\n\t}\n\n\t// Returns all enchants that this player can wear in the given slot.\n\tgetEnchants(slot: ItemSlot): Array<Enchant> {\n\t\treturn this.sim.db.getEnchants(slot).filter(enchant => canEquipEnchant(enchant, this.playerSpec));\n\t}\n\n\t// Returns all gems that this player can wear of the given color.\n\tgetGems(socketColor?: GemColor): Array<Gem> {\n\t\treturn this.sim.db.getGems(socketColor);\n\t}\n\n\tgetEpWeights(): Stats {\n\t\treturn this.epWeights;\n\t}\n\n\tsetEpWeights(eventID: EventID, newEpWeights: Stats) {\n\t\tthis.epWeights = newEpWeights;\n\t\tthis.epWeightsChangeEmitter.emit(eventID);\n\n\t\tthis.gemEPCache = new Map();\n\t\tthis.enchantEPCache = new Map();\n\t\tthis.randomSuffixEPCache = new Map();\n\t\tfor (let i = 0; i < ItemSlot.ItemSlotRanged + 1; ++i) {\n\t\t\tthis.itemEPCache[i] = new Map();\n\t\t}\n\t}\n\n\tgetDefaultEpRatios(isTankSpec: boolean, isHealingSpec: boolean): Array<number> {\n\t\tconst defaultRatios = new Array(Player.numEpRatios).fill(0);\n\t\tif (isHealingSpec) {\n\t\t\t// By default only value HPS EP for healing spec\n\t\t\tdefaultRatios[1] = 1;\n\t\t} else if (isTankSpec) {\n\t\t\t// By default value TPS and DTPS EP equally for tanking spec\n\t\t\tdefaultRatios[2] = 1;\n\t\t\tdefaultRatios[3] = 1;\n\t\t} else {\n\t\t\t// By default only value DPS EP\n\t\t\tdefaultRatios[0] = 1;\n\t\t}\n\t\treturn defaultRatios;\n\t}\n\n\tgetEpRatios() {\n\t\treturn this.epRatios.slice();\n\t}\n\n\tsetEpRatios(eventID: EventID, newRatios: Array<number>) {\n\t\tthis.epRatios = newRatios;\n\t\tthis.epRatiosChangeEmitter.emit(eventID);\n\t}\n\n\tasync computeStatWeights(\n\t\teventID: EventID,\n\t\tepStats: Array<Stat>,\n\t\tepPseudoStats: Array<PseudoStat>,\n\t\tepReferenceStat: Stat,\n\t\tonProgress: (_: any) => void,\n\t): Promise<StatWeightsResult> {\n\t\tconst result = await this.sim.statWeights(this, epStats, epPseudoStats, epReferenceStat, onProgress);\n\t\treturn result;\n\t}\n\n\tgetCurrentStats(): PlayerStats {\n\t\treturn PlayerStats.clone(this.currentStats);\n\t}\n\n\tsetCurrentStats(eventID: EventID, newStats: PlayerStats) {\n\t\tthis.currentStats = newStats;\n\t\tthis.currentStatsEmitter.emit(eventID);\n\t}\n\n\tgetMetadata(): UnitMetadata {\n\t\treturn this.metadata;\n\t}\n\n\tgetPetMetadatas(): UnitMetadataList {\n\t\treturn this.petMetadatas;\n\t}\n\n\tasync updateMetadata(): Promise<boolean> {\n\t\tconst playerPromise = this.metadata.update(this.currentStats.metadata!);\n\t\tconst petsPromise = this.petMetadatas.update(this.currentStats.pets.map(p => p.metadata!));\n\t\tconst playerUpdated = await playerPromise;\n\t\tconst petsUpdated = await petsPromise;\n\t\treturn playerUpdated || petsUpdated;\n\t}\n\n\tgetName(): string {\n\t\treturn this.name;\n\t}\n\tsetName(eventID: EventID, newName: string) {\n\t\tif (newName != this.name) {\n\t\t\tthis.name = newName;\n\t\t\tthis.nameChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetLabel(): string {\n\t\tif (this.party) {\n\t\t\treturn `${this.name} (#${this.getRaidIndex() + 1})`;\n\t\t} else {\n\t\t\treturn this.name;\n\t\t}\n\t}\n\n\tgetRace(): Race {\n\t\treturn this.race;\n\t}\n\tsetRace(eventID: EventID, newRace: Race) {\n\t\tif (newRace != this.race) {\n\t\t\tthis.race = newRace;\n\t\t\tthis.raceChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\n\tgetProfession1(): Profession {\n\t\treturn this.profession1;\n\t}\n\tsetProfession1(eventID: EventID, newProfession: Profession) {\n\t\tif (newProfession != this.profession1) {\n\t\t\tthis.profession1 = newProfession;\n\t\t\tthis.professionChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\tgetProfession2(): Profession {\n\t\treturn this.profession2;\n\t}\n\tsetProfession2(eventID: EventID, newProfession: Profession) {\n\t\tif (newProfession != this.profession2) {\n\t\t\tthis.profession2 = newProfession;\n\t\t\tthis.professionChangeEmitter.emit(eventID);\n\t\t}\n\t}\n\tgetProfessions(): Array<Profession> {\n\t\treturn [this.profession1, this.profession2].filter(p => p != Profession.ProfessionUnknown);\n\t}\n\tsetProfessions(eventID: EventID, newProfessions: Array<Profession>) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.setProfession1(eventID, newProfessions[0] || Profession.ProfessionUnknown);\n\t\t\tthis.setProfession2(eventID, newProfessions[1] || Profession.ProfessionUnknown);\n\t\t});\n\t}\n\thasProfession(prof: Profession): boolean {\n\t\treturn this.getProfessions().includes(prof);\n\t}\n\tisBlacksmithing(): boolean {\n\t\treturn this.hasProfession(Profession.Blacksmithing);\n\t}\n\n\tgetFaction(): Faction {\n\t\treturn raceToFaction[this.getRace()];\n\t}\n\n\tgetBuffs(): IndividualBuffs {\n\t\t// Make a defensive copy\n\t\treturn IndividualBuffs.clone(this.buffs);\n\t}\n\n\tsetBuffs(eventID: EventID, newBuffs: IndividualBuffs) {\n\t\tif (IndividualBuffs.equals(this.buffs, newBuffs)) return;\n\n\t\t// Make a defensive copy\n\t\tthis.buffs = IndividualBuffs.clone(newBuffs);\n\t\tthis.buffsChangeEmitter.emit(eventID);\n\t}\n\n\tgetConsumes(): Consumes {\n\t\t// Make a defensive copy\n\t\treturn Consumes.clone(this.consumes);\n\t}\n\n\tsetConsumes(eventID: EventID, newConsumes: Consumes) {\n\t\tif (Consumes.equals(this.consumes, newConsumes)) return;\n\n\t\t// Make a defensive copy\n\t\tthis.consumes = Consumes.clone(newConsumes);\n\t\tthis.consumesChangeEmitter.emit(eventID);\n\t}\n\n\tcanDualWield2H(): boolean {\n\t\treturn this.getSpec() == Spec.SpecFuryWarrior && (this.getTalents() as SpecTalents<Spec.SpecFuryWarrior>).titansGrip;\n\t}\n\n\tequipItem(eventID: EventID, slot: ItemSlot, newItem: EquippedItem | null) {\n\t\tthis.setGear(eventID, this.gear.withEquippedItem(slot, newItem, this.canDualWield2H()));\n\t}\n\n\tgetEquippedItem(slot: ItemSlot): EquippedItem | null {\n\t\treturn this.gear.getEquippedItem(slot);\n\t}\n\n\tgetGear(): Gear {\n\t\treturn this.gear;\n\t}\n\n\tsetGear(eventID: EventID, newGear: Gear) {\n\t\tif (newGear.equals(this.gear)) return;\n\n\t\tthis.gear = newGear;\n\t\tthis.gearChangeEmitter.emit(eventID);\n\t}\n\n\tgetEnableItemSwap(): boolean {\n\t\treturn this.enableItemSwap;\n\t}\n\n\tsetEnableItemSwap(eventID: EventID, newEnableItemSwap: boolean) {\n\t\tif (newEnableItemSwap == this.enableItemSwap) return;\n\n\t\tthis.enableItemSwap = newEnableItemSwap;\n\t\tthis.itemSwapChangeEmitter.emit(eventID);\n\t}\n\n\tequipItemSwapitem(eventID: EventID, slot: ItemSlot, newItem: EquippedItem | null) {\n\t\tthis.setItemSwapGear(eventID, this.itemSwapGear.withEquippedItem(slot, newItem, this.canDualWield2H()));\n\t}\n\n\tgetItemSwapItem(slot: ItemSlot): EquippedItem | null {\n\t\treturn this.itemSwapGear.getEquippedItem(slot);\n\t}\n\n\tgetItemSwapGear(): ItemSwapGear {\n\t\treturn this.itemSwapGear;\n\t}\n\n\tsetItemSwapGear(eventID: EventID, newItemSwapGear: ItemSwapGear) {\n\t\tif (newItemSwapGear.equals(this.itemSwapGear)) return;\n\n\t\tthis.itemSwapGear = newItemSwapGear;\n\t\tthis.itemSwapChangeEmitter.emit(eventID);\n\t}\n\n\t/*\n\tsetBulkEquipmentSpec(eventID: EventID, newBulkEquipmentSpec: BulkEquipmentSpec) {\n\t\tif (BulkEquipmentSpec.equals(this.bulkEquipmentSpec, newBulkEquipmentSpec))\n\t\t\treturn;\n\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.bulkEquipmentSpec = newBulkEquipmentSpec;\n\t\t\tthis.bulkGearChangeEmitter.emit(eventID);\n\t\t});\n\t}\n\n\tgetBulkEquipmentSpec(): BulkEquipmentSpec {\n\t\treturn BulkEquipmentSpec.clone(this.bulkEquipmentSpec);\n\t}\n\t*/\n\n\tgetBonusStats(): Stats {\n\t\treturn this.bonusStats;\n\t}\n\n\tsetBonusStats(eventID: EventID, newBonusStats: Stats) {\n\t\tif (newBonusStats.equals(this.bonusStats)) return;\n\n\t\tthis.bonusStats = newBonusStats;\n\t\tthis.bonusStatsChangeEmitter.emit(eventID);\n\t}\n\n\tgetMeleeCritCapInfo(): MeleeCritCapInfo {\n\t\tconst meleeCrit = (this.currentStats.finalStats?.stats[Stat.StatMeleeCrit] || 0.0) / Mechanics.MELEE_CRIT_RATING_PER_CRIT_CHANCE;\n\t\tconst meleeHit = (this.currentStats.finalStats?.stats[Stat.StatMeleeHit] || 0.0) / Mechanics.MELEE_HIT_RATING_PER_HIT_CHANCE;\n\t\tconst expertise = (this.currentStats.finalStats?.stats[Stat.StatExpertise] || 0.0) / Mechanics.EXPERTISE_PER_QUARTER_PERCENT_REDUCTION / 4;\n\t\t//const agility = (this.currentStats.finalStats?.stats[Stat.StatAgility] || 0.0) / this.getClass();\n\t\tconst suppression = 4.8;\n\t\tconst glancing = 24.0;\n\n\t\tconst hasOffhandWeapon = this.getGear().getEquippedItem(ItemSlot.ItemSlotOffHand)?.item.weaponSpeed !== undefined;\n\t\t// Due to warrior HS bug, hit cap for crit cap calculation should be 8% instead of 27%\n\t\tconst meleeHitCap = hasOffhandWeapon && this.getClass() != Class.ClassWarrior ? 27.0 : 8.0;\n\t\tconst dodgeCap = 6.5;\n\t\tconst parryCap = this.getInFrontOfTarget() ? 14.0 : 0;\n\t\tconst expertiseCap = dodgeCap + parryCap;\n\n\t\tconst remainingMeleeHitCap = Math.max(meleeHitCap - meleeHit, 0.0);\n\t\tconst remainingDodgeCap = Math.max(dodgeCap - expertise, 0.0);\n\t\tconst remainingParryCap = Math.max(parryCap - expertise, 0.0);\n\t\tconst remainingExpertiseCap = remainingDodgeCap + remainingParryCap;\n\n\t\tlet specSpecificOffset = 0.0;\n\n\t\tif (this.getSpec() === Spec.SpecEnhancementShaman) {\n\t\t\t// Elemental Devastation uptime is near 100%\n\t\t\t// TODO: Cata - Check this\n\t\t\tconst ranks = (this as unknown as Player<Spec.SpecEnhancementShaman>).getTalents().elementalDevastation;\n\t\t\tspecSpecificOffset = 3.0 * ranks;\n\t\t}\n\n\t\tconst baseCritCap = 100.0 - glancing + suppression - remainingMeleeHitCap - remainingExpertiseCap - specSpecificOffset;\n\t\tconst playerCritCapDelta = meleeCrit - baseCritCap;\n\n\t\treturn {\n\t\t\tmeleeCrit,\n\t\t\tmeleeHit,\n\t\t\texpertise,\n\t\t\tsuppression,\n\t\t\tglancing,\n\t\t\thasOffhandWeapon,\n\t\t\tmeleeHitCap,\n\t\t\texpertiseCap,\n\t\t\tremainingMeleeHitCap,\n\t\t\tremainingExpertiseCap,\n\t\t\tbaseCritCap,\n\t\t\tspecSpecificOffset,\n\t\t\tplayerCritCapDelta,\n\t\t};\n\t}\n\n\tgetMeleeCritCap() {\n\t\treturn this.getMeleeCritCapInfo().playerCritCapDelta;\n\t}\n\n\tsetAplRotation(eventID: EventID, newRotation: APLRotation) {\n\t\tif (APLRotation.equals(newRotation, this.aplRotation)) return;\n\n\t\tthis.aplRotation = APLRotation.clone(newRotation);\n\t\tthis.rotationChangeEmitter.emit(eventID);\n\t}\n\n\tgetSimpleRotation(): SpecRotation<SpecType> {\n\t\tconst jsonStr = this.aplRotation.simple?.specRotationJson || '';\n\t\tif (!jsonStr) {\n\t\t\treturn this.specTypeFunctions.rotationCreate();\n\t\t}\n\n\t\ttry {\n\t\t\tconst json = JSON.parse(jsonStr);\n\t\t\treturn this.specTypeFunctions.rotationFromJson(json);\n\t\t} catch (e) {\n\t\t\tconsole.warn(`Error parsing rotation spec options: ${e}\\n\\nSpec options: '${jsonStr}'`);\n\t\t\treturn this.specTypeFunctions.rotationCreate();\n\t\t}\n\t}\n\n\tsetSimpleRotation(eventID: EventID, newRotation: SpecRotation<SpecType>) {\n\t\tif (this.specTypeFunctions.rotationEquals(newRotation, this.getSimpleRotation())) return;\n\n\t\tif (!this.aplRotation.simple) {\n\t\t\tthis.aplRotation.simple = SimpleRotation.create();\n\t\t}\n\t\tthis.aplRotation.simple.specRotationJson = JSON.stringify(this.specTypeFunctions.rotationToJson(newRotation));\n\n\t\tthis.rotationChangeEmitter.emit(eventID);\n\t}\n\n\tgetSimpleCooldowns(): Cooldowns {\n\t\t// Make a defensive copy\n\t\treturn Cooldowns.clone(this.aplRotation.simple?.cooldowns || Cooldowns.create());\n\t}\n\n\tsetSimpleCooldowns(eventID: EventID, newCooldowns: Cooldowns) {\n\t\tif (Cooldowns.equals(this.getSimpleCooldowns(), newCooldowns)) return;\n\n\t\tif (!this.aplRotation.simple) {\n\t\t\tthis.aplRotation.simple = SimpleRotation.create();\n\t\t}\n\t\tthis.aplRotation.simple.cooldowns = newCooldowns;\n\t\tthis.rotationChangeEmitter.emit(eventID);\n\t}\n\n\tgetRotationType(): APLRotationType {\n\t\tif (this.aplRotation.type == APLRotationType.TypeUnknown) {\n\t\t\treturn APLRotationType.TypeAPL;\n\t\t} else {\n\t\t\treturn this.aplRotation.type;\n\t\t}\n\t}\n\n\thasSimpleRotationGenerator(): boolean {\n\t\treturn this.simpleRotationGenerator != null;\n\t}\n\n\tgetResolvedAplRotation(): APLRotation {\n\t\tconst type = this.getRotationType();\n\t\tif (type == APLRotationType.TypeAuto && this.autoRotationGenerator) {\n\t\t\t// Clone to avoid modifying preset rotations, which are often returned directly.\n\t\t\tconst rot = APLRotation.clone(this.autoRotationGenerator(this));\n\t\t\trot.type = APLRotationType.TypeAuto;\n\t\t\treturn rot;\n\t\t} else if (type == APLRotationType.TypeSimple && this.simpleRotationGenerator) {\n\t\t\t// Clone to avoid modifying preset rotations, which are often returned directly.\n\t\t\tconst simpleRot = this.getSimpleRotation();\n\t\t\tconst rot = APLRotation.clone(this.simpleRotationGenerator(this, simpleRot, this.getSimpleCooldowns()));\n\t\t\trot.simple = this.aplRotation.simple;\n\t\t\trot.type = APLRotationType.TypeSimple;\n\t\t\treturn rot;\n\t\t} else {\n\t\t\treturn this.aplRotation;\n\t\t}\n\t}\n\n\tgetTalents(): SpecTalents<SpecType> {\n\t\tif (this.talents == null) {\n\t\t\tthis.talents = playerTalentStringToProto(this.playerSpec, this.talentsString) as SpecTalents<SpecType>;\n\t\t}\n\t\treturn this.talents!;\n\t}\n\n\tgetTalentsString(): string {\n\t\treturn this.talentsString;\n\t}\n\n\tsetTalentsString(eventID: EventID, newTalentsString: string) {\n\t\tif (newTalentsString == this.talentsString) return;\n\n\t\tthis.talentsString = newTalentsString;\n\t\tthis.talents = null;\n\t\tthis.talentsChangeEmitter.emit(eventID);\n\t}\n\n\tgetTalentTree(): number {\n\t\treturn getTalentTree(this.getTalentsString());\n\t}\n\n\tgetTalentTreePoints(): Array<number> {\n\t\treturn getTalentTreePoints(this.getTalentsString());\n\t}\n\n\tgetTalentTreeIcon(): string {\n\t\treturn this.playerSpec.getIcon('medium');\n\t}\n\n\tgetGlyphs(): Glyphs {\n\t\t// Make a defensive copy\n\t\treturn Glyphs.clone(this.glyphs);\n\t}\n\n\tsetGlyphs(eventID: EventID, newGlyphs: Glyphs) {\n\t\tif (Glyphs.equals(this.glyphs, newGlyphs)) return;\n\n\t\t// Make a defensive copy\n\t\tthis.glyphs = Glyphs.clone(newGlyphs);\n\t\tthis.glyphsChangeEmitter.emit(eventID);\n\t}\n\n\tgetPrimeGlyps(): Array<number> {\n\t\treturn [this.glyphs.prime1, this.glyphs.prime2, this.glyphs.prime3].filter(glyph => glyph != 0);\n\t}\n\n\tgetMajorGlyphs(): Array<number> {\n\t\treturn [this.glyphs.major1, this.glyphs.major2, this.glyphs.major3].filter(glyph => glyph != 0);\n\t}\n\n\tgetMinorGlyphs(): Array<number> {\n\t\treturn [this.glyphs.minor1, this.glyphs.minor2, this.glyphs.minor3].filter(glyph => glyph != 0);\n\t}\n\n\tgetAllGlyphs(): Array<number> {\n\t\treturn this.getPrimeGlyps().concat(this.getMajorGlyphs().concat(this.getMinorGlyphs()));\n\t}\n\n\tgetClassOptions(): ClassOptions<SpecType> {\n\t\treturn this.getSpecOptions().classOptions as ClassOptions<SpecType>;\n\t}\n\n\tsetClassOptions(eventID: EventID, newClassOptions: ClassOptions<SpecType>) {\n\t\tconst newSpecOptions = this.getSpecOptions();\n\t\tnewSpecOptions.classOptions = newClassOptions;\n\t\tif (this.specTypeFunctions.optionsEquals(newSpecOptions, this.specOptions)) return;\n\n\t\tthis.specOptions = this.specTypeFunctions.optionsCopy(newSpecOptions);\n\t\tthis.specOptionsChangeEmitter.emit(eventID);\n\t}\n\n\tgetSpecOptions(): SpecOptions<SpecType> {\n\t\treturn this.specTypeFunctions.optionsCopy(this.specOptions);\n\t}\n\n\tsetSpecOptions(eventID: EventID, newSpecOptions: SpecOptions<SpecType>) {\n\t\tif (this.specTypeFunctions.optionsEquals(newSpecOptions, this.specOptions)) return;\n\n\t\tthis.specOptions = this.specTypeFunctions.optionsCopy(newSpecOptions);\n\t\tthis.specOptionsChangeEmitter.emit(eventID);\n\t}\n\n\tgetReactionTime(): number {\n\t\treturn this.reactionTime;\n\t}\n\n\tsetReactionTime(eventID: EventID, newReactionTime: number) {\n\t\tif (newReactionTime == this.reactionTime) return;\n\n\t\tthis.reactionTime = newReactionTime;\n\t\tthis.miscOptionsChangeEmitter.emit(eventID);\n\t}\n\n\tgetChannelClipDelay(): number {\n\t\treturn this.channelClipDelay;\n\t}\n\n\tsetChannelClipDelay(eventID: EventID, newChannelClipDelay: number) {\n\t\tif (newChannelClipDelay == this.channelClipDelay) return;\n\n\t\tthis.channelClipDelay = newChannelClipDelay;\n\t\tthis.miscOptionsChangeEmitter.emit(eventID);\n\t}\n\n\tgetDarkIntentUptime() : number {\n\t\treturn this.darkIntentUptime;\n\t}\n\n\tsetDarkIntentUptime(eventID: EventID, newDarkIntentUptime: number) {\n\t\tif (newDarkIntentUptime == this.darkIntentUptime) return;\n\n\t\tthis.darkIntentUptime = newDarkIntentUptime;\n\t\tthis.miscOptionsChangeEmitter.emit(eventID);\n\t}\n\n\tgetInFrontOfTarget(): boolean {\n\t\treturn this.inFrontOfTarget;\n\t}\n\n\tsetInFrontOfTarget(eventID: EventID, newInFrontOfTarget: boolean) {\n\t\tif (newInFrontOfTarget == this.inFrontOfTarget) return;\n\n\t\tthis.inFrontOfTarget = newInFrontOfTarget;\n\t\tthis.inFrontOfTargetChangeEmitter.emit(eventID);\n\t}\n\n\tgetDistanceFromTarget(): number {\n\t\treturn this.distanceFromTarget;\n\t}\n\n\tsetDistanceFromTarget(eventID: EventID, newDistanceFromTarget: number) {\n\t\tif (newDistanceFromTarget == this.distanceFromTarget) return;\n\n\t\tthis.distanceFromTarget = newDistanceFromTarget;\n\t\tthis.distanceFromTargetChangeEmitter.emit(eventID);\n\t}\n\n\tsetDefaultHealingParams(hm: HealingModel) {\n\t\tconst boss = this.sim.encounter.primaryTarget;\n\t\tconst dualWield = boss.dualWield;\n\t\tif (hm.cadenceSeconds == 0) {\n\t\t\thm.cadenceSeconds = 1.5 * boss.swingSpeed;\n\t\t\tif (dualWield) {\n\t\t\t\thm.cadenceSeconds /= 2;\n\t\t\t}\n\t\t}\n\t\tif (hm.hps == 0) {\n\t\t\thm.hps = (0.175 * boss.minBaseDamage) / boss.swingSpeed;\n\t\t\tif (dualWield) {\n\t\t\t\thm.hps *= 1.5;\n\t\t\t}\n\t\t}\n\t}\n\n\tenableHealing() {\n\t\tthis.healingEnabled = true;\n\t\tconst hm = this.getHealingModel();\n\t\tif (hm.cadenceSeconds == 0 || hm.hps == 0) {\n\t\t\tthis.setDefaultHealingParams(hm);\n\t\t\tthis.setHealingModel(0, hm);\n\t\t}\n\t}\n\n\tgetHealingModel(): HealingModel {\n\t\t// Make a defensive copy\n\t\treturn HealingModel.clone(this.healingModel);\n\t}\n\n\tsetHealingModel(eventID: EventID, newHealingModel: HealingModel) {\n\t\tif (HealingModel.equals(this.healingModel, newHealingModel)) return;\n\n\t\t// Make a defensive copy\n\t\tthis.healingModel = HealingModel.clone(newHealingModel);\n\t\t// If we have enabled healing model and try to set 0s cadence or 0 incoming HPS, then set intelligent defaults instead based on boss parameters.\n\t\tif (this.healingEnabled) {\n\t\t\tthis.setDefaultHealingParams(this.healingModel);\n\t\t}\n\t\tthis.healingModelChangeEmitter.emit(eventID);\n\t}\n\n\tcomputeStatsEP(stats?: Stats): number {\n\t\tif (stats == undefined) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn stats.computeEP(this.epWeights);\n\t}\n\n\tcomputeGemEP(gem: Gem): number {\n\t\tif (this.gemEPCache.has(gem.id)) {\n\t\t\treturn this.gemEPCache.get(gem.id)!;\n\t\t}\n\n\t\tconst epFromStats = this.computeStatsEP(new Stats(gem.stats));\n\t\tconst epFromEffect = getMetaGemEffectEP(this.playerSpec, gem, Stats.fromProto(this.currentStats.finalStats));\n\t\tlet bonusEP = 0;\n\t\t// unique items are slightly worse than non-unique because you can have only one.\n\t\tif (gem.unique) {\n\t\t\tbonusEP -= 0.01;\n\t\t}\n\n\t\tconst ep = epFromStats + epFromEffect + bonusEP;\n\t\tthis.gemEPCache.set(gem.id, ep);\n\t\treturn ep;\n\t}\n\n\tcomputeEnchantEP(enchant: Enchant): number {\n\t\tif (this.enchantEPCache.has(enchant.effectId)) {\n\t\t\treturn this.enchantEPCache.get(enchant.effectId)!;\n\t\t}\n\n\t\tconst ep = this.computeStatsEP(new Stats(enchant.stats));\n\t\tthis.enchantEPCache.set(enchant.effectId, ep);\n\t\treturn ep;\n\t}\n\n\tcomputeRandomSuffixEP(randomSuffix: ItemRandomSuffix): number {\n\t\tif (this.randomSuffixEPCache.has(randomSuffix.id)) {\n\t\t\treturn this.randomSuffixEPCache.get(randomSuffix.id)!;\n\t\t}\n\n\t\tconst ep = this.computeStatsEP(new Stats(randomSuffix.stats));\n\t\tthis.randomSuffixEPCache.set(randomSuffix.id, ep);\n\t\treturn ep;\n\t}\n\n\tcomputeReforgingEP(reforging: ReforgeData): number {\n\t\tlet stats = new Stats([]);\n\t\treforging.fromStat.forEach(stat => {\n\t\t\tstats = stats.addStat(stat, reforging.fromAmount);\n\t\t});\n\t\treforging.toStat.forEach(stat => {\n\t\t\tstats = stats.addStat(stat, reforging.toAmount);\n\t\t});\n\t\treturn this.computeStatsEP(stats);\n\t}\n\n\tcomputeItemEP(item: Item, slot: ItemSlot): number {\n\t\tif (item == null) return 0;\n\n\t\tconst cached = this.itemEPCache[slot].get(item.id);\n\t\tif (cached !== undefined) return cached;\n\n\t\tlet itemStats = new Stats(item.stats);\n\t\tif (item.weaponSpeed > 0) {\n\t\t\tconst weaponDps = getWeaponDPS(item);\n\t\t\tif (slot == ItemSlot.ItemSlotMainHand) {\n\t\t\t\titemStats = itemStats.withPseudoStat(PseudoStat.PseudoStatMainHandDps, weaponDps);\n\t\t\t} else if (slot == ItemSlot.ItemSlotOffHand) {\n\t\t\t\titemStats = itemStats.withPseudoStat(PseudoStat.PseudoStatOffHandDps, weaponDps);\n\t\t\t} else if (slot == ItemSlot.ItemSlotRanged) {\n\t\t\t\titemStats = itemStats.withPseudoStat(PseudoStat.PseudoStatRangedDps, weaponDps);\n\t\t\t}\n\t\t}\n\n\t\t// For random suffix items, use the suffix option with the highest EP for the purposes of ranking items in the picker.\n\t\tlet maxSuffixEP = 0;\n\n\t\tif (item.randomSuffixOptions.length > 0) {\n\t\t\tconst suffixEPs = item.randomSuffixOptions.map(id => this.computeRandomSuffixEP(this.sim.db.getRandomSuffixById(id)!));\n\t\t\tmaxSuffixEP = (Math.max(...suffixEPs) * item.randPropPoints) / 10000;\n\t\t}\n\n\t\tlet ep = itemStats.computeEP(this.epWeights) + maxSuffixEP;\n\n\t\t// unique items are slightly worse than non-unique because you can have only one.\n\t\tif (item.unique) {\n\t\t\tep -= 0.01;\n\t\t}\n\n\t\t// Compare whether its better to match sockets + get socket bonus, or just use best gems.\n\t\tconst bestGemEPNotMatchingSockets = sum(\n\t\t\titem.gemSockets.map(socketColor => {\n\t\t\t\tconst gems = this.sim.db.getGems(socketColor).filter(gem => isUnrestrictedGem(gem, this.sim.getPhase()));\n\t\t\t\tif (gems.length > 0) {\n\t\t\t\t\treturn Math.max(...gems.map(gem => this.computeGemEP(gem)));\n\t\t\t\t} else {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tconst bestGemEPMatchingSockets =\n\t\t\tsum(\n\t\t\t\titem.gemSockets.map(socketColor => {\n\t\t\t\t\tconst gems = this.sim.db\n\t\t\t\t\t\t.getGems(socketColor)\n\t\t\t\t\t\t.filter(gem => isUnrestrictedGem(gem, this.sim.getPhase()) && gemMatchesSocket(gem, socketColor));\n\t\t\t\t\tif (gems.length > 0) {\n\t\t\t\t\t\treturn Math.max(...gems.map(gem => this.computeGemEP(gem)));\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t) + this.computeStatsEP(new Stats(item.socketBonus));\n\n\t\tep += Math.max(bestGemEPMatchingSockets, bestGemEPNotMatchingSockets);\n\n\t\tthis.itemEPCache[slot].set(item.id, ep);\n\t\treturn ep;\n\t}\n\n\tsetWowheadData(equippedItem: EquippedItem, elem: HTMLElement) {\n\t\tconst parts = [];\n\n\t\tconst lang = getLanguageCode();\n\t\tconst langPrefix = lang ? lang + '.' : '';\n\t\tparts.push(`domain=${langPrefix}cata`);\n\n\t\tconst isBlacksmithing = this.hasProfession(Profession.Blacksmithing);\n\t\tif (equippedItem.gems.length > 0) {\n\t\t\tparts.push(\n\t\t\t\t'gems=' +\n\t\t\t\t\tequippedItem\n\t\t\t\t\t\t.curGems(isBlacksmithing)\n\t\t\t\t\t\t.map(gem => (gem ? gem.id : 0))\n\t\t\t\t\t\t.join(':'),\n\t\t\t);\n\t\t}\n\t\tif (equippedItem.enchant != null) {\n\t\t\tparts.push('ench=' + equippedItem.enchant.effectId);\n\t\t}\n\t\tif (equippedItem.reforging > 0) {\n\t\t\tparts.push('forg=' + equippedItem.reforging);\n\t\t}\n\t\tparts.push(\n\t\t\t'pcs=' +\n\t\t\t\tthis.gear\n\t\t\t\t\t.asArray()\n\t\t\t\t\t.filter(ei => ei != null)\n\t\t\t\t\t.map(ei => ei!.item.id)\n\t\t\t\t\t.join(':'),\n\t\t);\n\n\t\tif (equippedItem.hasExtraSocket(isBlacksmithing)) {\n\t\t\tparts.push('sock');\n\t\t}\n\t\tparts.push('dataEnv=11');\n\t\telem.dataset.wowhead = parts.join('&');\n\t\telem.dataset.whtticon = 'false';\n\t}\n\n\tstatic ARMOR_SLOTS: Array<ItemSlot> = [\n\t\tItemSlot.ItemSlotHead,\n\t\tItemSlot.ItemSlotShoulder,\n\t\tItemSlot.ItemSlotChest,\n\t\tItemSlot.ItemSlotWrist,\n\t\tItemSlot.ItemSlotHands,\n\t\tItemSlot.ItemSlotLegs,\n\t\tItemSlot.ItemSlotWaist,\n\t\tItemSlot.ItemSlotFeet,\n\t];\n\n\tstatic WEAPON_SLOTS: Array<ItemSlot> = [ItemSlot.ItemSlotMainHand, ItemSlot.ItemSlotOffHand];\n\n\tstatic readonly DIFFICULTY_SRCS: Partial<Record<SourceFilterOption, DungeonDifficulty>> = {\n\t\t[SourceFilterOption.SourceDungeon]: DungeonDifficulty.DifficultyNormal,\n\t\t[SourceFilterOption.SourceDungeonH]: DungeonDifficulty.DifficultyHeroic,\n\t\t[SourceFilterOption.SourceRaid10]: DungeonDifficulty.DifficultyRaid10,\n\t\t[SourceFilterOption.SourceRaid10H]: DungeonDifficulty.DifficultyRaid10H,\n\t\t[SourceFilterOption.SourceRaid25]: DungeonDifficulty.DifficultyRaid25,\n\t\t[SourceFilterOption.SourceRaid25H]: DungeonDifficulty.DifficultyRaid25H,\n\t};\n\n\tstatic readonly HEROIC_TO_NORMAL: Partial<Record<DungeonDifficulty, DungeonDifficulty>> = {\n\t\t[DungeonDifficulty.DifficultyHeroic]: DungeonDifficulty.DifficultyNormal,\n\t\t[DungeonDifficulty.DifficultyRaid10H]: DungeonDifficulty.DifficultyRaid10,\n\t\t[DungeonDifficulty.DifficultyRaid25H]: DungeonDifficulty.DifficultyRaid25,\n\t};\n\n\tstatic readonly RAID_IDS: Partial<Record<RaidFilterOption, number>> = {\n\t\t[RaidFilterOption.RaidNaxxramas]: 3456,\n\t\t[RaidFilterOption.RaidEyeOfEternity]: 4500,\n\t\t[RaidFilterOption.RaidObsidianSanctum]: 4493,\n\t\t[RaidFilterOption.RaidVaultOfArchavon]: 4603,\n\t\t[RaidFilterOption.RaidUlduar]: 4273,\n\t\t[RaidFilterOption.RaidTrialOfTheCrusader]: 4722,\n\t\t[RaidFilterOption.RaidOnyxiasLair]: 2159,\n\t\t[RaidFilterOption.RaidIcecrownCitadel]: 4812,\n\t\t[RaidFilterOption.RaidRubySanctum]: 4987,\n\t};\n\n\tfilterItemData<T>(itemData: Array<T>, getItemFunc: (val: T) => Item, slot: ItemSlot): Array<T> {\n\t\tconst filters = this.sim.getFilters();\n\n\t\tconst filterItems = (itemData: Array<T>, filterFunc: (item: Item) => boolean) => {\n\t\t\treturn itemData.filter(itemElem => filterFunc(getItemFunc(itemElem)));\n\t\t};\n\n\t\tif (filters.factionRestriction != UIItem_FactionRestriction.UNSPECIFIED) {\n\t\t\titemData = filterItems(\n\t\t\t\titemData,\n\t\t\t\titem => item.factionRestriction == filters.factionRestriction || item.factionRestriction == UIItem_FactionRestriction.UNSPECIFIED,\n\t\t\t);\n\t\t}\n\n\t\tif (!filters.sources.includes(SourceFilterOption.SourceCrafting)) {\n\t\t\titemData = filterItems(itemData, item => !item.sources.some(itemSrc => itemSrc.source.oneofKind == 'crafted'));\n\t\t}\n\t\tif (!filters.sources.includes(SourceFilterOption.SourceQuest)) {\n\t\t\titemData = filterItems(itemData, item => !item.sources.some(itemSrc => itemSrc.source.oneofKind == 'quest'));\n\t\t}\n\n\t\tfor (const [srcOptionStr, difficulty] of Object.entries(Player.DIFFICULTY_SRCS)) {\n\t\t\tconst srcOption = parseInt(srcOptionStr) as SourceFilterOption;\n\t\t\tif (!filters.sources.includes(srcOption)) {\n\t\t\t\titemData = filterItems(\n\t\t\t\t\titemData,\n\t\t\t\t\titem => !item.sources.some(itemSrc => itemSrc.source.oneofKind == 'drop' && itemSrc.source.drop.difficulty == difficulty),\n\t\t\t\t);\n\n\t\t\t\tif (difficulty == DungeonDifficulty.DifficultyRaid10H || difficulty == DungeonDifficulty.DifficultyRaid25H) {\n\t\t\t\t\tconst normalDifficulty = Player.HEROIC_TO_NORMAL[difficulty];\n\t\t\t\t\titemData = filterItems(\n\t\t\t\t\t\titemData,\n\t\t\t\t\t\titem =>\n\t\t\t\t\t\t\t!item.sources.some(\n\t\t\t\t\t\t\t\titemSrc =>\n\t\t\t\t\t\t\t\t\titemSrc.source.oneofKind == 'drop' &&\n\t\t\t\t\t\t\t\t\titemSrc.source.drop.difficulty == normalDifficulty &&\n\t\t\t\t\t\t\t\t\titemSrc.source.drop.category == AL_CATEGORY_HARD_MODE,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!filters.raids.includes(RaidFilterOption.RaidVanilla)) {\n\t\t\titemData = filterItems(itemData, item => item.expansion != Expansion.ExpansionVanilla);\n\t\t}\n\t\tif (!filters.raids.includes(RaidFilterOption.RaidTbc)) {\n\t\t\titemData = filterItems(itemData, item => item.expansion != Expansion.ExpansionTbc);\n\t\t}\n\t\tfor (const [raidOptionStr, zoneId] of Object.entries(Player.RAID_IDS)) {\n\t\t\tconst raidOption = parseInt(raidOptionStr) as RaidFilterOption;\n\t\t\tif (!filters.raids.includes(raidOption)) {\n\t\t\t\titemData = filterItems(\n\t\t\t\t\titemData,\n\t\t\t\t\titem => !item.sources.some(itemSrc => itemSrc.source.oneofKind == 'drop' && itemSrc.source.drop.zoneId == zoneId),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (Player.ARMOR_SLOTS.includes(slot)) {\n\t\t\titemData = filterItems(itemData, item => {\n\t\t\t\tif (!filters.armorTypes.includes(item.armorType)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t} else if (Player.WEAPON_SLOTS.includes(slot)) {\n\t\t\titemData = filterItems(itemData, item => {\n\t\t\t\tif (!filters.weaponTypes.includes(item.weaponType)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (!filters.oneHandedWeapons && item.handType != HandType.HandTypeTwoHand) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (!filters.twoHandedWeapons && item.handType == HandType.HandTypeTwoHand) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst minSpeed = slot == ItemSlot.ItemSlotMainHand ? filters.minMhWeaponSpeed : filters.minOhWeaponSpeed;\n\t\t\t\tconst maxSpeed = slot == ItemSlot.ItemSlotMainHand ? filters.maxMhWeaponSpeed : filters.maxOhWeaponSpeed;\n\t\t\t\tif (minSpeed > 0 && item.weaponSpeed < minSpeed) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (maxSpeed > 0 && item.weaponSpeed > maxSpeed) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t} else if (slot == ItemSlot.ItemSlotRanged) {\n\t\t\titemData = filterItems(itemData, item => {\n\t\t\t\tif (!filters.rangedWeaponTypes.includes(item.rangedWeaponType)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst minSpeed = filters.minRangedWeaponSpeed;\n\t\t\t\tconst maxSpeed = filters.maxRangedWeaponSpeed;\n\t\t\t\tif (minSpeed > 0 && item.weaponSpeed < minSpeed) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (maxSpeed > 0 && item.weaponSpeed > maxSpeed) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\t\treturn itemData;\n\t}\n\n\tfilterEnchantData<T>(enchantData: Array<T>, getEnchantFunc: (val: T) => Enchant, slot: ItemSlot, currentEquippedItem: EquippedItem | null): Array<T> {\n\t\tif (!currentEquippedItem) {\n\t\t\treturn enchantData;\n\t\t}\n\n\t\t//const filters = this.sim.getFilters();\n\n\t\treturn enchantData.filter(enchantElem => {\n\t\t\tconst enchant = getEnchantFunc(enchantElem);\n\n\t\t\tif (!enchantAppliesToItem(enchant, currentEquippedItem.item)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tfilterGemData<T>(gemData: Array<T>, getGemFunc: (val: T) => Gem, slot: ItemSlot, socketColor: GemColor): Array<T> {\n\t\tconst filters = this.sim.getFilters();\n\n\t\tconst isJewelcrafting = this.hasProfession(Profession.Jewelcrafting);\n\t\treturn gemData.filter(gemElem => {\n\t\t\tconst gem = getGemFunc(gemElem);\n\t\t\tif (!isJewelcrafting && gem.requiredProfession == Profession.Jewelcrafting) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (filters.matchingGemsOnly && !gemMatchesSocket(gem, socketColor)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tmakeUnitReference(): UnitReference {\n\t\tif (this.party == null) {\n\t\t\treturn emptyUnitReference();\n\t\t} else {\n\t\t\treturn newUnitReference(this.getRaidIndex());\n\t\t}\n\t}\n\n\tprivate toDatabase(): SimDatabase {\n\t\tconst dbGear = this.getGear().toDatabase(this.sim.db);\n\t\tconst dbItemSwapGear = this.getItemSwapGear().toDatabase(this.sim.db);\n\t\treturn Database.mergeSimDatabases(dbGear, dbItemSwapGear);\n\t}\n\n\ttoProto(forExport?: boolean, forSimming?: boolean, exportCategories?: Array<SimSettingCategories>): PlayerProto {\n\t\tconst exportCategory = (cat: SimSettingCategories) => !exportCategories || exportCategories.length == 0 || exportCategories.includes(cat);\n\n\t\tconst gear = this.getGear();\n\t\tconst aplRotation = forSimming ? this.getResolvedAplRotation() : this.aplRotation;\n\n\t\tlet player = PlayerProto.create({\n\t\t\tclass: this.getClass(),\n\t\t\tdatabase: forExport ? undefined : this.toDatabase(),\n\t\t});\n\t\tif (exportCategory(SimSettingCategories.Gear)) {\n\t\t\tPlayerProto.mergePartial(player, {\n\t\t\t\tequipment: gear.asSpec(),\n\t\t\t\tbonusStats: this.getBonusStats().toProto(),\n\t\t\t\tenableItemSwap: this.getEnableItemSwap(),\n\t\t\t\titemSwap: this.getItemSwapGear().toProto(),\n\t\t\t});\n\t\t}\n\t\tif (exportCategory(SimSettingCategories.Talents)) {\n\t\t\tPlayerProto.mergePartial(player, {\n\t\t\t\ttalentsString: this.getTalentsString(),\n\t\t\t\tglyphs: this.getGlyphs(),\n\t\t\t});\n\t\t}\n\t\tif (exportCategory(SimSettingCategories.Rotation)) {\n\t\t\tPlayerProto.mergePartial(player, {\n\t\t\t\tcooldowns: Cooldowns.create({\n\t\t\t\t\thpPercentForDefensives: this.getSimpleCooldowns().hpPercentForDefensives,\n\t\t\t\t}),\n\t\t\t\trotation: aplRotation,\n\t\t\t});\n\t\t}\n\t\tif (exportCategory(SimSettingCategories.Consumes)) {\n\t\t\tPlayerProto.mergePartial(player, {\n\t\t\t\tconsumes: this.getConsumes(),\n\t\t\t});\n\t\t}\n\t\tif (exportCategory(SimSettingCategories.Miscellaneous)) {\n\t\t\tPlayerProto.mergePartial(player, {\n\t\t\t\tname: this.getName(),\n\t\t\t\trace: this.getRace(),\n\t\t\t\tprofession1: this.getProfession1(),\n\t\t\t\tprofession2: this.getProfession2(),\n\t\t\t\treactionTimeMs: this.getReactionTime(),\n\t\t\t\tchannelClipDelayMs: this.getChannelClipDelay(),\n\t\t\t\tinFrontOfTarget: this.getInFrontOfTarget(),\n\t\t\t\tdistanceFromTarget: this.getDistanceFromTarget(),\n\t\t\t\thealingModel: this.getHealingModel(),\n\t\t\t\tdarkIntentUptime: this.getDarkIntentUptime(),\n\t\t\t});\n\t\t\tplayer = withSpec(this.getSpec(), player, this.getSpecOptions());\n\t\t}\n\t\tif (exportCategory(SimSettingCategories.External)) {\n\t\t\tPlayerProto.mergePartial(player, {\n\t\t\t\tbuffs: this.getBuffs(),\n\t\t\t});\n\t\t}\n\t\treturn player;\n\t}\n\n\tfromProto(eventID: EventID, proto: PlayerProto, includeCategories?: Array<SimSettingCategories>) {\n\t\tconst loadCategory = (cat: SimSettingCategories) => !includeCategories || includeCategories.length == 0 || includeCategories.includes(cat);\n\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tif (loadCategory(SimSettingCategories.Gear)) {\n\t\t\t\tthis.setGear(eventID, proto.equipment ? this.sim.db.lookupEquipmentSpec(proto.equipment) : new Gear({}));\n\t\t\t\tthis.setEnableItemSwap(eventID, proto.enableItemSwap);\n\t\t\t\tthis.setItemSwapGear(eventID, proto.itemSwap ? this.sim.db.lookupItemSwap(proto.itemSwap) : new ItemSwapGear({}));\n\t\t\t\tthis.setBonusStats(eventID, Stats.fromProto(proto.bonusStats || UnitStats.create()));\n\t\t\t\t//this.setBulkEquipmentSpec(eventID, BulkEquipmentSpec.create()); // Do not persist the bulk equipment settings.\n\t\t\t}\n\t\t\tif (loadCategory(SimSettingCategories.Talents)) {\n\t\t\t\tthis.setTalentsString(eventID, proto.talentsString);\n\t\t\t\tthis.setGlyphs(eventID, proto.glyphs || Glyphs.create());\n\t\t\t}\n\t\t\tif (loadCategory(SimSettingCategories.Rotation)) {\n\t\t\t\tif (proto.rotation?.type == APLRotationType.TypeUnknown) {\n\t\t\t\t\tif (!proto.rotation) {\n\t\t\t\t\t\tproto.rotation = APLRotation.create();\n\t\t\t\t\t}\n\t\t\t\t\tproto.rotation.type = APLRotationType.TypeAuto;\n\t\t\t\t}\n\t\t\t\tthis.setAplRotation(eventID, proto.rotation || APLRotation.create());\n\t\t\t}\n\t\t\tif (loadCategory(SimSettingCategories.Consumes)) {\n\t\t\t\tthis.setConsumes(eventID, proto.consumes || Consumes.create());\n\t\t\t}\n\t\t\tif (loadCategory(SimSettingCategories.Miscellaneous)) {\n\t\t\t\tthis.setSpecOptions(eventID, this.specTypeFunctions.optionsFromPlayer(proto));\n\t\t\t\tthis.setName(eventID, proto.name);\n\t\t\t\tthis.setRace(eventID, proto.race);\n\t\t\t\tthis.setProfession1(eventID, proto.profession1);\n\t\t\t\tthis.setProfession2(eventID, proto.profession2);\n\t\t\t\tthis.setReactionTime(eventID, proto.reactionTimeMs);\n\t\t\t\tthis.setChannelClipDelay(eventID, proto.channelClipDelayMs);\n\t\t\t\tthis.setInFrontOfTarget(eventID, proto.inFrontOfTarget);\n\t\t\t\tthis.setDistanceFromTarget(eventID, proto.distanceFromTarget);\n\t\t\t\tthis.setHealingModel(eventID, proto.healingModel || HealingModel.create());\n\t\t\t\tthis.setDarkIntentUptime(eventID, proto.darkIntentUptime);\n\t\t\t}\n\t\t\tif (loadCategory(SimSettingCategories.External)) {\n\t\t\t\tthis.setBuffs(eventID, proto.buffs || IndividualBuffs.create());\n\t\t\t}\n\t\t});\n\t}\n\n\tclone(eventID: EventID): Player<SpecType> {\n\t\tconst newPlayer = new Player<SpecType>(this.playerSpec, this.sim);\n\t\tnewPlayer.fromProto(eventID, this.toProto());\n\t\treturn newPlayer;\n\t}\n\n\tapplySharedDefaults(eventID: EventID) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.setEnableItemSwap(eventID, false);\n\t\t\tthis.setItemSwapGear(eventID, new ItemSwapGear({}));\n\t\t\tthis.setReactionTime(eventID, 200);\n\t\t\tthis.setInFrontOfTarget(eventID, this.playerSpec.isTankSpec);\n\t\t\tthis.setHealingModel(\n\t\t\t\teventID,\n\t\t\t\tHealingModel.create({\n\t\t\t\t\tburstWindow: this.playerSpec.isTankSpec ? 6 : 0,\n\t\t\t\t}),\n\t\t\t);\n\t\t\tthis.setSimpleCooldowns(\n\t\t\t\teventID,\n\t\t\t\tCooldowns.create({\n\t\t\t\t\thpPercentForDefensives: this.playerSpec.isTankSpec ? 0.35 : 0,\n\t\t\t\t}),\n\t\t\t);\n\t\t\tthis.setBonusStats(eventID, new Stats());\n\n\t\t\tthis.setAplRotation(\n\t\t\t\teventID,\n\t\t\t\tAPLRotation.create({\n\t\t\t\t\ttype: APLRotationType.TypeAuto,\n\t\t\t\t}),\n\t\t\t);\n\t\t});\n\t}\n\n\tgetBaseMastery(): number {\n\t\tswitch(this.playerSpec.specID) {\n\t\t\tcase Spec.SpecFrostMage:\n\t\t\tcase Spec.SpecFuryWarrior:\n\t\t\t\treturn 2;\n\t\t\tdefault:\n\t\t\t\treturn 8;\n\t\t}\n\t}\n\n\tgetMasteryPerPointModifier(): number {\n\t\treturn Mechanics.masteryPercentPerPoint.get(this.getSpec()) || 0\n\t}\n}\n","import { Tooltip } from 'bootstrap';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { element, fragment } from 'tsx-vanilla';\n\nimport { ActionId } from '../proto_utils/action_id.js';\nimport { TypedEvent } from '../typed_event.js';\nimport { Input, InputConfig } from './input.js';\n\nexport enum IconEnumPickerDirection {\n\tVertical = 'vertical',\n\tHorizontal = 'Horizontal',\n}\n\nexport interface IconEnumValueConfig<ModObject, T> {\n\tvalue: T;\n\t// One of these should be set.\n\t// If actionId is set, shows the icon for that id.\n\t// If color is set, shows that color.\n\t// If iconUrl is set, shows that icon as grayscale\n\tactionId?: ActionId;\n\tcolor?: string;\n\ticonUrl?: string;\n\t// Text to be displayed on the icon.\n\ttext?: string;\n\t// Hover tooltip.\n\ttooltip?: string;\n\n\tshowWhen?: (obj: ModObject) => boolean;\n}\n\nexport interface IconEnumPickerConfig<ModObject, T> extends InputConfig<ModObject, T> {\n\tnumColumns?: number;\n\tvalues: Array<IconEnumValueConfig<ModObject, T>>;\n\t// Value that will be considered inactive.\n\tzeroValue: T;\n\t// Function for comparing two values.\n\t// Tooltip that will be shown whne hovering over the icon-picker-button\n\ttooltip?: string;\n\t// The direction the menu will open in relative to the root element\n\tdirection?: IconEnumPickerDirection;\n\tequals: (a: T, b: T) => boolean;\n\tbackupIconUrl?: (value: T) => ActionId;\n\tshowWhen?: (obj: ModObject) => boolean;\n}\n\n// Icon-based UI for picking enum values.\n// ModObject is the object being modified (Sim, Player, or Target).\nexport class IconEnumPicker<ModObject, T> extends Input<ModObject, T> {\n\tprivate readonly config: IconEnumPickerConfig<ModObject, T>;\n\n\tprivate currentValue: T;\n\tprivate storedValue: T | undefined;\n\n\tprivate readonly buttonElem: HTMLAnchorElement;\n\tprivate readonly buttonText: HTMLElement;\n\n\tconstructor(parent: HTMLElement, modObj: ModObject, config: IconEnumPickerConfig<ModObject, T>) {\n\t\tsuper(parent, 'icon-enum-picker-root', modObj, config);\n\t\tthis.rootElem.classList.add('icon-picker', (config.direction ?? 'vertical') === 'vertical' ? 'dropdown' : 'dropend');\n\t\tthis.config = config;\n\t\tthis.currentValue = this.config.zeroValue;\n\n\t\tthis.config.changedEvent(this.modObject).on(_ => {\n\t\t\tif (this.showWhen()) {\n\t\t\t\tthis.restoreValue();\n\t\t\t\tthis.rootElem.classList.remove('hide');\n\t\t\t} else {\n\t\t\t\tthis.storeValue();\n\t\t\t\tthis.rootElem.classList.add('hide');\n\t\t\t}\n\t\t});\n\n\t\tif (config.tooltip) {\n\t\t\tTooltip.getOrCreateInstance(this.rootElem, {\n\t\t\t\thtml: true,\n\t\t\t\ttitle: config.tooltip,\n\t\t\t});\n\t\t}\n\n\t\tthis.rootElem.appendChild(\n\t\t\t<>\n\t\t\t\t<a\n\t\t\t\t\thref=\"javascript:void(0)\"\n\t\t\t\t\tclassName=\"icon-picker-button\"\n\t\t\t\t\tattributes={{\n\t\t\t\t\t\t'aria-expanded': 'false',\n\t\t\t\t\t\trole: 'button',\n\t\t\t\t\t}}\n\t\t\t\t\tdataset={{\n\t\t\t\t\t\tbsToggle: 'dropdown',\n\t\t\t\t\t\twhtticon: 'false',\n\t\t\t\t\t\tdisableWowheadTouchTooltip: 'true',\n\t\t\t\t\t}}></a>\n\t\t\t\t<ul className=\"dropdown-menu\"></ul>\n\t\t\t\t<label className=\"form-label\"></label>\n\t\t\t</>,\n\t\t);\n\n\t\tthis.buttonElem = this.rootElem.querySelector('.icon-picker-button') as HTMLAnchorElement;\n\t\tthis.buttonText = this.rootElem.querySelector('label') as HTMLElement;\n\t\tconst dropdownMenu = this.rootElem.querySelector('.dropdown-menu') as HTMLElement;\n\n\t\tif (this.config.numColumns) dropdownMenu.style.gridTemplateColumns = `repeat(${this.config.numColumns}, 1fr)`;\n\n\t\tif (this.config.direction == IconEnumPickerDirection.Horizontal) dropdownMenu.style.gridAutoFlow = 'column';\n\n\t\tthis.config.values.forEach((valueConfig, _) => {\n\t\t\tconst optionContainer = document.createElement('li');\n\t\t\toptionContainer.classList.add('icon-dropdown-option', 'dropdown-option');\n\t\t\tdropdownMenu.appendChild(optionContainer);\n\n\t\t\tconst option = document.createElement('a');\n\t\t\toption.classList.add('icon-picker-button');\n\t\t\toption.dataset.whtticon = 'false';\n\t\t\toption.dataset.disableWowheadTouchTooltip = 'true';\n\t\t\toptionContainer.appendChild(option);\n\n\t\t\tconst updateOption = () => {\n\t\t\t\tthis.setImage(option, valueConfig);\n\t\t\t\tif (this.showValueWhen(valueConfig)) {\n\t\t\t\t\toptionContainer.classList.remove('hide');\n\t\t\t\t} else {\n\t\t\t\t\toptionContainer.classList.add('hide');\n\t\t\t\t\t// Zero out the picker if the selected option is hidden\n\t\t\t\t\tif (this.currentValue == valueConfig.value) {\n\t\t\t\t\t\tthis.setInputValue(this.config.zeroValue);\n\t\t\t\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.config.changedEvent(this.modObject).on(updateOption);\n\t\t\tupdateOption();\n\n\t\t\toption.addEventListener('click', event => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.currentValue = valueConfig.value;\n\t\t\t\tthis.storedValue = undefined;\n\t\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t\t});\n\n\t\t\tif (valueConfig.tooltip) {\n\t\t\t\tTooltip.getOrCreateInstance(option, {\n\t\t\t\t\thtml: true,\n\t\t\t\t\ttitle: valueConfig.tooltip,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.init();\n\t}\n\n\t/**\n\t * Stores value of current input and hides the element for later\n\t * restoration. Useful for events which trigger the element\n\t * on and off.\n\t */\n\tstoreValue() {\n\t\tif (typeof this.storedValue !== 'undefined') return;\n\n\t\tthis.storedValue = this.getInputValue();\n\t\tthis.setInputValue(this.config.zeroValue);\n\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t}\n\n\t/**\n\t * Restores value of current input and shows the element.\n\t */\n\trestoreValue() {\n\t\tif (typeof this.storedValue === 'undefined') return;\n\n\t\tthis.setInputValue(this.storedValue);\n\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\tthis.storedValue = undefined;\n\t}\n\n\tprivate setActionImage(elem: HTMLAnchorElement, actionId: ActionId) {\n\t\tactionId.fillAndSet(elem, true, true);\n\t}\n\n\tprivate setImage(elem: HTMLAnchorElement, valueConfig: IconEnumValueConfig<ModObject, T>) {\n\t\tif (valueConfig.showWhen && !valueConfig.showWhen(this.modObject)) {\n\t\t\telem.removeAttribute('href');\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionId = valueConfig.actionId;\n\t\tif (actionId) {\n\t\t\tthis.setActionImage(elem, actionId);\n\t\t\telem.style.filter = '';\n\t\t} else if (valueConfig.iconUrl) {\n\t\t\telem.style.backgroundImage = `url(${valueConfig.iconUrl})`;\n\t\t\telem.style.filter = 'grayscale(1)';\n\t\t} else {\n\t\t\telem.style.backgroundImage = '';\n\t\t\telem.style.filter = '';\n\t\t\telem.style.backgroundColor = valueConfig.color!;\n\t\t}\n\t}\n\n\tupdate() {\n\t\tsuper.update();\n\t\tthis.setActive(this.enabled && !this.config.equals(this.currentValue, this.config.zeroValue));\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.buttonElem;\n\t}\n\n\tgetInputValue(): T {\n\t\treturn this.currentValue;\n\t}\n\n\tsetInputValue(newValue: T) {\n\t\tthis.currentValue = newValue;\n\t\tthis.setActive(this.enabled && !this.config.equals(this.currentValue, this.config.zeroValue));\n\n\t\tthis.buttonText.textContent = '';\n\t\tthis.buttonText.style.display = 'none';\n\n\t\tconst valueConfig = this.config.values.find(valueConfig => this.config.equals(valueConfig.value, this.currentValue))!;\n\t\tif (valueConfig) {\n\t\t\tthis.setImage(this.buttonElem, valueConfig);\n\t\t\tif (valueConfig.text != undefined) {\n\t\t\t\tthis.buttonText.style.display = 'block';\n\t\t\t\tthis.buttonText.textContent = valueConfig.text;\n\t\t\t}\n\t\t} else if (this.config.backupIconUrl) {\n\t\t\tconst backupId = this.config.backupIconUrl(this.currentValue);\n\t\t\tthis.setActionImage(this.buttonElem, backupId);\n\t\t\tthis.setActive(false);\n\t\t}\n\t}\n\n\tsetActive(active: boolean) {\n\t\tif (active) this.buttonElem.classList.add('active');\n\t\telse this.buttonElem.classList.remove('active');\n\t}\n\n\tshowWhen(): boolean {\n\t\treturn (\n\t\t\t(!this.config.showWhen || this.config.showWhen(this.modObject)) &&\n\t\t\t!!this.config.values.find(\n\t\t\t\tvalueConfig => valueConfig.actionId && valueConfig.actionId != null && (!valueConfig.showWhen || valueConfig.showWhen(this.modObject)),\n\t\t\t)\n\t\t);\n\t}\n\n\tshowValueWhen(valueConfig: IconEnumValueConfig<ModObject, T>): boolean {\n\t\treturn (!valueConfig.actionId || valueConfig.actionId != null) && (!valueConfig.showWhen || valueConfig.showWhen(this.modObject));\n\t}\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { element, ref } from 'tsx-vanilla';\n\nimport { ActionId } from '../proto_utils/action_id.js';\nimport { TypedEvent } from '../typed_event.js';\nimport { isRightClick } from '../utils.js';\nimport { Input, InputConfig } from './input.js';\n\n// Data for creating an icon-based input component.\n//\n// E.g. one of these for arcane brilliance, another for kings, etc.\n// ModObject is the object being modified (Sim, Player, or Target).\n// ValueType is either number or boolean.\nexport interface IconPickerConfig<ModObject, ValueType> extends InputConfig<ModObject, ValueType> {\n\tactionId: ActionId;\n\n\t// The number of possible 'states' this icon can have. Most inputs will use 2\n\t// for a bi-state icon (on or off). 0 indicates an unlimited number of states.\n\tstates: number;\n\n\t// Only used if states >= 3.\n\timprovedId?: ActionId;\n\n\t// Only used if states >= 4.\n\timprovedId2?: ActionId;\n}\n\n// Icon-based UI for picking buffs / consumes / etc\n// ModObject is the object being modified (Sim, Player, or Target).\nexport class IconPicker<ModObject, ValueType> extends Input<ModObject, ValueType> {\n\tactive: boolean;\n\n\tprivate readonly config: IconPickerConfig<ModObject, ValueType>;\n\n\tprivate readonly rootAnchor: HTMLAnchorElement;\n\tprivate readonly improvedAnchor: HTMLAnchorElement;\n\tprivate readonly improvedAnchor2: HTMLAnchorElement;\n\tprivate readonly counterElem: HTMLElement;\n\n\tprivate currentValue: number;\n\tprivate storedValue: ValueType | undefined;\n\n\tconstructor(parent: HTMLElement, modObj: ModObject, config: IconPickerConfig<ModObject, ValueType>) {\n\t\tsuper(parent, 'icon-picker-root', modObj, config);\n\t\tthis.rootElem.classList.add('icon-picker');\n\t\tthis.active = false;\n\t\tthis.config = config;\n\t\tthis.currentValue = 0;\n\n\t\tthis.rootAnchor = document.createElement('a');\n\t\tthis.rootAnchor.classList.add('icon-picker-button');\n\t\tthis.rootAnchor.dataset.whtticon = 'false';\n\t\tthis.rootAnchor.dataset.disableWowheadTouchTooltip = 'true';\n\t\tthis.rootAnchor.target = '_blank';\n\t\tthis.rootElem.prepend(this.rootAnchor);\n\n\t\tconst useImprovedIcons = Boolean(this.config.improvedId);\n\t\tif (useImprovedIcons) {\n\t\t\tthis.rootAnchor.classList.add('use-improved-icons');\n\t\t}\n\t\tif (this.config.improvedId2) {\n\t\t\tthis.rootAnchor.classList.add('use-improved-icons2');\n\t\t}\n\t\tif (!useImprovedIcons && this.config.states > 2) {\n\t\t\tthis.rootAnchor.classList.add('use-counter');\n\t\t}\n\n\t\tconst ia = ref<HTMLAnchorElement>();\n\t\tconst ia2 = ref<HTMLAnchorElement>();\n\t\tconst ce = ref<HTMLSpanElement>();\n\t\tthis.rootAnchor.appendChild(\n\t\t\t<div className=\"icon-input-level-container\">\n\t\t\t\t<a\n\t\t\t\t\tref={ia}\n\t\t\t\t\tclassName=\"icon-picker-button icon-input-improved icon-input-improved1\"\n\t\t\t\t\tdataset={{ whtticon: 'false', disableWowheadTouchTooltip: 'true' }}></a>\n\t\t\t\t<a\n\t\t\t\t\tref={ia2}\n\t\t\t\t\tclassName=\"icon-picker-button icon-input-improved icon-input-improved2\"\n\t\t\t\t\tdataset={{ whtticon: 'false', disableWowheadTouchTooltip: 'true' }}></a>\n\t\t\t\t<span ref={ce} className={`icon-picker-label ${this.config.states > 2 ? '' : 'hide'}`}></span>\n\t\t\t</div>,\n\t\t);\n\n\t\tthis.improvedAnchor = ia.value!;\n\t\tthis.improvedAnchor2 = ia2.value!;\n\t\tthis.counterElem = ce.value!;\n\n\t\tif (this.config.states >= 3 && this.config.improvedId) {\n\t\t\tthis.config.improvedId.fillAndSet(this.improvedAnchor, true, true);\n\t\t}\n\t\tif (this.config.states >= 4 && this.config.improvedId2) {\n\t\t\tthis.config.improvedId2.fillAndSet(this.improvedAnchor2, true, true);\n\t\t}\n\n\t\tthis.config.changedEvent(this.modObject).on(_ => {\n\t\t\tthis.config.actionId.fillAndSet(this.rootAnchor, true, true);\n\n\t\t\tif (this.showWhen()) {\n\t\t\t\tthis.rootElem.classList.remove('hide');\n\t\t\t\tthis.restoreValue();\n\t\t\t} else {\n\t\t\t\tthis.storeValue();\n\t\t\t\tthis.rootElem.classList.add('hide');\n\t\t\t}\n\t\t});\n\n\t\tthis.init();\n\n\t\tthis.rootAnchor.addEventListener('click', event => {\n\t\t\tevent.preventDefault();\n\t\t\tthis.handleLeftClick();\n\t\t});\n\n\t\tthis.rootAnchor.addEventListener('contextmenu', event => {\n\t\t\tevent.preventDefault();\n\t\t});\n\t\tthis.rootAnchor.addEventListener('mousedown', event => {\n\t\t\tconst rightClick = isRightClick(event);\n\n\t\t\tif (rightClick) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.handleRightClick();\n\t\t\t}\n\t\t});\n\t}\n\n\thandleLeftClick() {\n\t\tif (this.config.states == 0 || this.currentValue + 1 < this.config.states) {\n\t\t\tthis.currentValue++;\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t} else if (this.currentValue > 0) {\n\t\t\t// roll over\n\t\t\tthis.currentValue = 0;\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t}\n\t}\n\n\thandleRightClick() {\n\t\tif (this.currentValue > 0) {\n\t\t\tthis.currentValue--;\n\t\t} else {\n\t\t\t// roll over\n\t\t\tif (this.config.states === 0) {\n\t\t\t\tthis.currentValue = 1;\n\t\t\t} else {\n\t\t\t\tthis.currentValue = this.config.states - 1;\n\t\t\t}\n\t\t}\n\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.rootAnchor;\n\t}\n\n\tgetInputValue(): ValueType {\n\t\tif (this.config.states == 2) {\n\t\t\treturn Boolean(this.currentValue) as unknown as ValueType;\n\t\t} else {\n\t\t\treturn this.currentValue as unknown as ValueType;\n\t\t}\n\t}\n\n\t// Returns the ActionId of the currently selected value, or null if none selected.\n\tgetActionId(): ActionId | null {\n\t\t// Go directly to source because during event propogation\n\t\t//  the internal `this.currentValue` may not yet have been updated.\n\t\tconst v = Number(this.config.getValue(this.modObject));\n\t\tif (v == 0) {\n\t\t\treturn null;\n\t\t} else if (v == 1) {\n\t\t\treturn this.config.actionId;\n\t\t} else if (v == 2 && this.config.improvedId) {\n\t\t\treturn this.config.improvedId;\n\t\t} else if (v == 3 && this.config.improvedId2) {\n\t\t\treturn this.config.improvedId2;\n\t\t} else {\n\t\t\treturn this.config.actionId;\n\t\t}\n\t}\n\n\tsetInputValue(newValue: ValueType) {\n\t\tthis.currentValue = Number(newValue);\n\n\t\tif (this.currentValue > 0) {\n\t\t\tthis.active = true;\n\t\t\tthis.rootAnchor.classList.add('active');\n\t\t\tthis.counterElem.classList.add('active');\n\t\t} else {\n\t\t\tthis.active = false;\n\t\t\tthis.rootAnchor.classList.remove('active');\n\t\t\tthis.counterElem.classList.remove('active');\n\t\t}\n\n\t\tif (this.config.states >= 3 && this.config.improvedId) {\n\t\t\tif (this.currentValue > 1) {\n\t\t\t\tthis.improvedAnchor.classList.add('active');\n\t\t\t} else {\n\t\t\t\tthis.improvedAnchor.classList.remove('active');\n\t\t\t}\n\t\t}\n\t\tif (this.config.states >= 4 && this.config.improvedId2) {\n\t\t\tif (this.currentValue > 2) {\n\t\t\t\tthis.improvedAnchor2.classList.add('active');\n\t\t\t\tthis.improvedAnchor.hidden = true;\n\t\t\t\tthis.improvedAnchor2.hidden = false;\n\t\t\t} else {\n\t\t\t\tthis.improvedAnchor2.classList.remove('active');\n\t\t\t\tthis.improvedAnchor.hidden = false;\n\t\t\t\tthis.improvedAnchor2.hidden = true;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.config.improvedId && (this.config.states > 3 || this.config.states == 0)) {\n\t\t\tthis.counterElem.textContent = String(this.currentValue);\n\t\t}\n\t}\n\n\t/**\n\t * Stores value of current input and hides the element for later\n\t * restoration. Useful for events which trigger the element\n\t * on and off.\n\t */\n\tstoreValue() {\n\t\tif (typeof this.storedValue !== 'undefined') return;\n\n\t\tthis.storedValue = this.getInputValue();\n\t\tthis.setInputValue(0 as ValueType);\n\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t}\n\n\t/**\n\t * Restores value of current input and shows the element.\n\t */\n\trestoreValue() {\n\t\tif (typeof this.storedValue === 'undefined') return;\n\n\t\tthis.setInputValue(this.storedValue);\n\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\tthis.storedValue = undefined;\n\t}\n\n\tshowWhen() {\n\t\treturn this.config.actionId != null && (!this.config.showWhen || this.config.showWhen(this.modObject));\n\t}\n}\n","import { Player } from '../player.js';\nimport { Spec } from '../proto/common.js';\nimport { ActionId } from '../proto_utils/action_id.js';\nimport { ClassOptions, SpecOptions, SpecRotation } from '../proto_utils/utils.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { BooleanPickerConfig } from './boolean_picker.js';\nimport { EnumPickerConfig, EnumValueConfig } from './enum_picker.js';\nimport { IconEnumPickerConfig, IconEnumValueConfig } from './icon_enum_picker.js';\nimport { IconPickerConfig } from './icon_picker.js';\nimport { MultiIconPickerConfig } from './multi_icon_picker.js';\nimport { NumberPickerConfig } from './number_picker.js';\n\nexport function makeMultiIconInput<ModObject>(\n\tinputs: Array<IconPickerConfig<ModObject, any>>,\n\tlabel: string,\n\tcategoryId?: ActionId,\n): MultiIconPickerConfig<ModObject> {\n\treturn {\n\t\tinputs: inputs,\n\t\tlabel: label,\n\t\tcategoryId: categoryId,\n\t\tshowWhen: p => inputs.filter(i => !i.showWhen || i.showWhen(p as ModObject)).length > 0,\n\t};\n}\n\n// Extend this to add player callbacks as optional config fields.\ninterface BasePlayerConfig<SpecType extends Spec, T> {\n\tgetValue?: (player: Player<SpecType>) => T;\n\tsetValue?: (eventID: EventID, player: Player<SpecType>, newVal: T) => void;\n\tchangeEmitter?: (player: Player<SpecType>) => TypedEvent<any>;\n\textraCssClasses?: Array<string>;\n\tshowWhen?: (player: Player<SpecType>) => boolean;\n}\n\n/////////////////////////////////////////////////////////////////////////////////\n//                                    BOOLEAN\n/////////////////////////////////////////////////////////////////////////////////\nexport interface TypedBooleanPickerConfig<ModObject> extends BooleanPickerConfig<ModObject> {\n\ttype: 'boolean';\n}\n\ninterface WrappedBooleanInputConfig<SpecType extends Spec, ModObject> extends BooleanPickerConfig<ModObject> {\n\tgetModObject: (player: Player<SpecType>) => ModObject;\n}\nfunction makeWrappedBooleanInput<SpecType extends Spec, ModObject>(\n\tconfig: WrappedBooleanInputConfig<SpecType, ModObject>,\n): TypedBooleanPickerConfig<Player<SpecType>> {\n\tconst getModObject = config.getModObject;\n\treturn {\n\t\ttype: 'boolean',\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: boolean) => config.setValue(eventID, getModObject(player), newValue),\n\t\tenableWhen: config.enableWhen ? (player: Player<SpecType>) => config.enableWhen!(getModObject(player)) : undefined,\n\t\tshowWhen: config.showWhen ? (player: Player<SpecType>) => config.showWhen!(getModObject(player)) : undefined,\n\t\textraCssClasses: config.extraCssClasses,\n\t};\n}\nexport interface PlayerBooleanInputConfig<SpecType extends Spec, Message> extends BasePlayerConfig<SpecType, boolean> {\n\tfieldName: keyof Message;\n\tlabel: string;\n\tlabelTooltip?: string;\n\tenableWhen?: (player: Player<SpecType>) => boolean;\n\tshowWhen?: (player: Player<SpecType>) => boolean;\n}\nexport function makeClassOptionsBooleanInput<SpecType extends Spec>(\n\tconfig: PlayerBooleanInputConfig<SpecType, ClassOptions<SpecType>>,\n): TypedBooleanPickerConfig<Player<SpecType>> {\n\treturn makeWrappedBooleanInput<SpecType, Player<SpecType>>({\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getClassOptions()[config.fieldName] as unknown as boolean),\n\t\tsetValue:\n\t\t\tconfig.setValue ||\n\t\t\t((eventID: EventID, player: Player<SpecType>, newVal: boolean) => {\n\t\t\t\tconst newMessage = player.getClassOptions();\n\t\t\t\t(newMessage[config.fieldName] as unknown as boolean) = newVal;\n\t\t\t\tplayer.setClassOptions(eventID, newMessage);\n\t\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t\textraCssClasses: config.extraCssClasses,\n\t});\n}\nexport function makeSpecOptionsBooleanInput<SpecType extends Spec>(\n\tconfig: PlayerBooleanInputConfig<SpecType, SpecOptions<SpecType>>,\n): TypedBooleanPickerConfig<Player<SpecType>> {\n\treturn makeWrappedBooleanInput<SpecType, Player<SpecType>>({\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSpecOptions()[config.fieldName] as unknown as boolean),\n\t\tsetValue:\n\t\t\tconfig.setValue ||\n\t\t\t((eventID: EventID, player: Player<SpecType>, newVal: boolean) => {\n\t\t\t\tconst newMessage = player.getSpecOptions();\n\t\t\t\t(newMessage[config.fieldName] as unknown as boolean) = newVal;\n\t\t\t\tplayer.setSpecOptions(eventID, newMessage);\n\t\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t\textraCssClasses: config.extraCssClasses,\n\t});\n}\nexport function makeRotationBooleanInput<SpecType extends Spec>(\n\tconfig: PlayerBooleanInputConfig<SpecType, SpecRotation<SpecType>>,\n): TypedBooleanPickerConfig<Player<SpecType>> {\n\treturn makeWrappedBooleanInput<SpecType, Player<SpecType>>({\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSimpleRotation()[config.fieldName] as unknown as boolean),\n\t\tsetValue:\n\t\t\tconfig.setValue ||\n\t\t\t((eventID: EventID, player: Player<SpecType>, newVal: boolean) => {\n\t\t\t\tconst newMessage = player.getSimpleRotation();\n\t\t\t\t(newMessage[config.fieldName] as unknown as boolean) = newVal;\n\t\t\t\tplayer.setSimpleRotation(eventID, newMessage);\n\t\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.rotationChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t\textraCssClasses: config.extraCssClasses,\n\t});\n}\n\n/////////////////////////////////////////////////////////////////////////////////\n//                                    NUMBER\n/////////////////////////////////////////////////////////////////////////////////\nexport interface TypedNumberPickerConfig<ModObject> extends NumberPickerConfig<ModObject> {\n\ttype: 'number';\n}\n\ninterface WrappedNumberInputConfig<SpecType extends Spec, ModObject> extends NumberPickerConfig<ModObject> {\n\tgetModObject: (player: Player<SpecType>) => ModObject;\n}\nfunction makeWrappedNumberInput<SpecType extends Spec, ModObject>(\n\tconfig: WrappedNumberInputConfig<SpecType, ModObject>,\n): TypedNumberPickerConfig<Player<SpecType>> {\n\tconst getModObject = config.getModObject;\n\treturn {\n\t\ttype: 'number',\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tfloat: config.float,\n\t\tpositive: config.positive,\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: number) => config.setValue(eventID, getModObject(player), newValue),\n\t\tenableWhen: config.enableWhen ? (player: Player<SpecType>) => config.enableWhen!(getModObject(player)) : undefined,\n\t\tshowWhen: config.showWhen ? (player: Player<SpecType>) => config.showWhen!(getModObject(player)) : undefined,\n\t\textraCssClasses: config.extraCssClasses,\n\t};\n}\nexport interface PlayerNumberInputConfig<SpecType extends Spec, Message> extends BasePlayerConfig<SpecType, number> {\n\tfieldName: keyof Message;\n\tlabel: string;\n\tlabelTooltip?: string;\n\tpercent?: boolean;\n\tfloat?: boolean;\n\tpositive?: boolean;\n\tenableWhen?: (player: Player<SpecType>) => boolean;\n\tshowWhen?: (player: Player<SpecType>) => boolean;\n\tchangeEmitter?: (player: Player<SpecType>) => TypedEvent<any>;\n}\nexport function makeClassOptionsNumberInput<SpecType extends Spec>(\n\tconfig: PlayerNumberInputConfig<SpecType, ClassOptions<SpecType>>,\n): TypedNumberPickerConfig<Player<SpecType>> {\n\tconst internalConfig = {\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tfloat: config.float,\n\t\tpositive: config.positive,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getClassOptions()[config.fieldName] as unknown as number),\n\t\tsetValue:\n\t\t\tconfig.setValue ||\n\t\t\t((eventID: EventID, player: Player<SpecType>, newVal: number) => {\n\t\t\t\tconst newMessage = player.getClassOptions();\n\t\t\t\t(newMessage[config.fieldName] as unknown as number) = newVal;\n\t\t\t\tplayer.setClassOptions(eventID, newMessage);\n\t\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t\textraCssClasses: config.extraCssClasses,\n\t};\n\tif (config.percent) {\n\t\tconst getValue = internalConfig.getValue;\n\t\tinternalConfig.getValue = (player: Player<SpecType>) => getValue(player) * 100;\n\t\tconst setValue = internalConfig.setValue;\n\t\tinternalConfig.setValue = (eventID: EventID, player: Player<SpecType>, newVal: number) => setValue(eventID, player, newVal / 100);\n\t}\n\treturn makeWrappedNumberInput<SpecType, Player<SpecType>>(internalConfig);\n}\nexport function makeSpecOptionsNumberInput<SpecType extends Spec>(\n\tconfig: PlayerNumberInputConfig<SpecType, SpecOptions<SpecType>>,\n): TypedNumberPickerConfig<Player<SpecType>> {\n\tconst internalConfig = {\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tfloat: config.float,\n\t\tpositive: config.positive,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSpecOptions()[config.fieldName] as unknown as number),\n\t\tsetValue:\n\t\t\tconfig.setValue ||\n\t\t\t((eventID: EventID, player: Player<SpecType>, newVal: number) => {\n\t\t\t\tconst newMessage = player.getSpecOptions();\n\t\t\t\t(newMessage[config.fieldName] as unknown as number) = newVal;\n\t\t\t\tplayer.setSpecOptions(eventID, newMessage);\n\t\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t\textraCssClasses: config.extraCssClasses,\n\t};\n\tif (config.percent) {\n\t\tconst getValue = internalConfig.getValue;\n\t\tinternalConfig.getValue = (player: Player<SpecType>) => getValue(player) * 100;\n\t\tconst setValue = internalConfig.setValue;\n\t\tinternalConfig.setValue = (eventID: EventID, player: Player<SpecType>, newVal: number) => setValue(eventID, player, newVal / 100);\n\t}\n\treturn makeWrappedNumberInput<SpecType, Player<SpecType>>(internalConfig);\n}\nexport function makeRotationNumberInput<SpecType extends Spec>(\n\tconfig: PlayerNumberInputConfig<SpecType, SpecRotation<SpecType>>,\n): TypedNumberPickerConfig<Player<SpecType>> {\n\tconst internalConfig = {\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tfloat: config.float,\n\t\tpositive: config.positive,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSimpleRotation()[config.fieldName] as unknown as number),\n\t\tsetValue:\n\t\t\tconfig.setValue ||\n\t\t\t((eventID: EventID, player: Player<SpecType>, newVal: number) => {\n\t\t\t\tconst newMessage = player.getSimpleRotation();\n\t\t\t\t(newMessage[config.fieldName] as unknown as number) = newVal;\n\t\t\t\tplayer.setSimpleRotation(eventID, newMessage);\n\t\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.rotationChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t\textraCssClasses: config.extraCssClasses,\n\t};\n\tif (config.percent) {\n\t\tconst getValue = internalConfig.getValue;\n\t\tinternalConfig.getValue = (player: Player<SpecType>) => getValue(player) * 100;\n\t\tconst setValue = internalConfig.setValue;\n\t\tinternalConfig.setValue = (eventID: EventID, player: Player<SpecType>, newVal: number) => setValue(eventID, player, newVal / 100);\n\t}\n\treturn makeWrappedNumberInput<SpecType, Player<SpecType>>(internalConfig);\n}\n\n/////////////////////////////////////////////////////////////////////////////////\n//                                    ENUM\n/////////////////////////////////////////////////////////////////////////////////\nexport interface TypedEnumPickerConfig<ModObject> extends EnumPickerConfig<ModObject> {\n\ttype: 'enum';\n}\n\ninterface WrappedEnumInputConfig<SpecType extends Spec, ModObject> extends EnumPickerConfig<ModObject> {\n\tgetModObject: (player: Player<SpecType>) => ModObject;\n}\nfunction makeWrappedEnumInput<SpecType extends Spec, ModObject>(config: WrappedEnumInputConfig<SpecType, ModObject>): TypedEnumPickerConfig<Player<SpecType>> {\n\tconst getModObject = config.getModObject;\n\treturn {\n\t\ttype: 'enum',\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tvalues: config.values,\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: number) => config.setValue(eventID, getModObject(player), newValue),\n\t\tenableWhen: config.enableWhen ? (player: Player<SpecType>) => config.enableWhen!(getModObject(player)) : undefined,\n\t\tshowWhen: config.showWhen ? (player: Player<SpecType>) => config.showWhen!(getModObject(player)) : undefined,\n\t};\n}\n\nexport interface PlayerEnumInputConfig<SpecType extends Spec, Message> {\n\tfieldName: keyof Message;\n\tlabel: string;\n\tlabelTooltip?: string;\n\tvalues: Array<EnumValueConfig>;\n\tgetValue?: (player: Player<SpecType>) => number;\n\tsetValue?: (eventID: EventID, player: Player<SpecType>, newValue: number) => void;\n\tenableWhen?: (player: Player<SpecType>) => boolean;\n\tshowWhen?: (player: Player<SpecType>) => boolean;\n\tchangeEmitter?: (player: Player<SpecType>) => TypedEvent<any>;\n}\n// T is unused, but kept to have the same interface as the icon enum inputs.\nexport function makeClassOptionsEnumInput<SpecType extends Spec, _T>(\n\tconfig: PlayerEnumInputConfig<SpecType, ClassOptions<SpecType>>,\n): TypedEnumPickerConfig<Player<SpecType>> {\n\treturn makeWrappedEnumInput<SpecType, Player<SpecType>>({\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tvalues: config.values,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getClassOptions()[config.fieldName] as unknown as number),\n\t\tsetValue:\n\t\t\tconfig.setValue ||\n\t\t\t((eventID: EventID, player: Player<SpecType>, newVal: number) => {\n\t\t\t\tconst newMessage = player.getClassOptions();\n\t\t\t\t(newMessage[config.fieldName] as unknown as number) = newVal;\n\t\t\t\tplayer.setClassOptions(eventID, newMessage);\n\t\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t});\n}\n// T is unused, but kept to have the same interface as the icon enum inputs.\nexport function makeSpecOptionsEnumInput<SpecType extends Spec, _T>(\n\tconfig: PlayerEnumInputConfig<SpecType, SpecOptions<SpecType>>,\n): TypedEnumPickerConfig<Player<SpecType>> {\n\treturn makeWrappedEnumInput<SpecType, Player<SpecType>>({\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tvalues: config.values,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSpecOptions()[config.fieldName] as unknown as number),\n\t\tsetValue:\n\t\t\tconfig.setValue ||\n\t\t\t((eventID: EventID, player: Player<SpecType>, newVal: number) => {\n\t\t\t\tconst newMessage = player.getSpecOptions();\n\t\t\t\t(newMessage[config.fieldName] as unknown as number) = newVal;\n\t\t\t\tplayer.setSpecOptions(eventID, newMessage);\n\t\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t});\n}\n// T is unused, but kept to have the same interface as the icon enum inputs.\nexport function makeRotationEnumInput<SpecType extends Spec, _T>(\n\tconfig: PlayerEnumInputConfig<SpecType, SpecRotation<SpecType>>,\n): TypedEnumPickerConfig<Player<SpecType>> {\n\treturn makeWrappedEnumInput<SpecType, Player<SpecType>>({\n\t\tlabel: config.label,\n\t\tlabelTooltip: config.labelTooltip,\n\t\tvalues: config.values,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSimpleRotation()[config.fieldName] as unknown as number),\n\t\tsetValue:\n\t\t\tconfig.setValue ||\n\t\t\t((eventID: EventID, player: Player<SpecType>, newVal: number) => {\n\t\t\t\tconst newMessage = player.getSimpleRotation();\n\t\t\t\t(newMessage[config.fieldName] as unknown as number) = newVal;\n\t\t\t\tplayer.setSimpleRotation(eventID, newMessage);\n\t\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.rotationChangeEmitter),\n\t\tenableWhen: config.enableWhen,\n\t\tshowWhen: config.showWhen,\n\t});\n}\n\n/////////////////////////////////////////////////////////////////////////////////\n//                                  ICON\n/////////////////////////////////////////////////////////////////////////////////\nexport interface TypedIconPickerConfig<ModObject, T> extends IconPickerConfig<ModObject, T> {\n\ttype: 'icon';\n}\n\ninterface WrappedIconInputConfig<SpecType extends Spec, ModObject, T> extends IconPickerConfig<ModObject, T> {\n\tgetModObject: (player: Player<SpecType>) => ModObject;\n}\nfunction makeWrappedIconInput<SpecType extends Spec, ModObject, T>(\n\tconfig: WrappedIconInputConfig<SpecType, ModObject, T>,\n): TypedIconPickerConfig<Player<SpecType>, T> {\n\tconst getModObject = config.getModObject;\n\treturn {\n\t\ttype: 'icon',\n\t\tactionId: config.actionId,\n\t\tstates: config.states,\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\n\t\tshowWhen: (player: Player<SpecType>) => !config.showWhen || (config.showWhen(getModObject(player)) as any),\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: T) => config.setValue(eventID, getModObject(player), newValue),\n\t\textraCssClasses: config.extraCssClasses,\n\t};\n}\n\ninterface WrappedTypedInputConfig<Message, ModObject, T> {\n\tgetModObject: (player: Player<any>) => ModObject;\n\tgetValue: (modObj: ModObject) => Message;\n\tsetValue: (eventID: EventID, modObj: ModObject, messageVal: Message) => void;\n\tchangeEmitter: (modObj: ModObject) => TypedEvent<any>;\n\textraCssClasses?: Array<string>;\n\n\tshowWhen?: (obj: ModObject) => boolean;\n\tgetFieldValue?: (modObj: ModObject) => T;\n\tsetFieldValue?: (eventID: EventID, modObj: ModObject, newValue: T) => void;\n}\n\nexport function makeBooleanIconInput<SpecType extends Spec, Message, ModObject>(\n\tconfig: WrappedTypedInputConfig<Message, ModObject, boolean>,\n\tactionId: ActionId,\n\tfieldName: keyof Message,\n\tvalue?: number,\n): TypedIconPickerConfig<Player<SpecType>, boolean> {\n\treturn makeWrappedIconInput<SpecType, ModObject, boolean>({\n\t\tgetModObject: config.getModObject,\n\t\tactionId: actionId,\n\t\tstates: 2,\n\t\tchangedEvent: config.changeEmitter,\n\t\tshowWhen: config.showWhen,\n\t\tgetValue:\n\t\t\tconfig.getFieldValue ||\n\t\t\t((modObj: ModObject) =>\n\t\t\t\tvalue ? (config.getValue(modObj)[fieldName] as unknown as number) == value : (config.getValue(modObj)[fieldName] as unknown as boolean)),\n\t\tsetValue:\n\t\t\tconfig.setFieldValue ||\n\t\t\t((eventID: EventID, modObj: ModObject, newValue: boolean) => {\n\t\t\t\tconst newMessage = config.getValue(modObj);\n\t\t\t\tif (value) {\n\t\t\t\t\tif (newValue) {\n\t\t\t\t\t\t(newMessage[fieldName] as unknown as number) = value;\n\t\t\t\t\t} else if ((newMessage[fieldName] as unknown as number) == value) {\n\t\t\t\t\t\t(newMessage[fieldName] as unknown as number) = 0;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t(newMessage[fieldName] as unknown as boolean) = newValue;\n\t\t\t\t}\n\t\t\t\tconfig.setValue(eventID, modObj, newMessage);\n\t\t\t}),\n\t\textraCssClasses: config.extraCssClasses,\n\t});\n}\n\nexport interface PlayerBooleanIconInputConfig<SpecType extends Spec, Message, T> extends BasePlayerConfig<SpecType, T> {\n\tfieldName: keyof Message;\n\tid: ActionId;\n\tvalue?: number;\n}\nexport function makeClassOptionsBooleanIconInput<SpecType extends Spec>(\n\tconfig: PlayerBooleanIconInputConfig<SpecType, ClassOptions<SpecType>, boolean>,\n): TypedIconPickerConfig<Player<SpecType>, boolean> {\n\treturn makeBooleanIconInput<SpecType, ClassOptions<SpecType>, Player<SpecType>>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\t\tgetValue: (player: Player<SpecType>) => player.getClassOptions(),\n\t\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newVal: ClassOptions<SpecType>) => player.setClassOptions(eventID, newVal),\n\t\t\tchangeEmitter: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\t\textraCssClasses: config.extraCssClasses,\n\t\t\tgetFieldValue: config.getValue,\n\t\t\tsetFieldValue: config.setValue,\n\t\t},\n\t\tconfig.id,\n\t\tconfig.fieldName,\n\t\tconfig.value,\n\t);\n}\nexport function makeSpecOptionsBooleanIconInput<SpecType extends Spec>(\n\tconfig: PlayerBooleanIconInputConfig<SpecType, SpecOptions<SpecType>, boolean>,\n): TypedIconPickerConfig<Player<SpecType>, boolean> {\n\treturn makeBooleanIconInput<SpecType, SpecOptions<SpecType>, Player<SpecType>>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\t\tgetValue: (player: Player<SpecType>) => player.getSpecOptions(),\n\t\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newVal: SpecOptions<SpecType>) => player.setSpecOptions(eventID, newVal),\n\t\t\tchangeEmitter: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\t\textraCssClasses: config.extraCssClasses,\n\t\t\tgetFieldValue: config.getValue,\n\t\t\tsetFieldValue: config.setValue,\n\t\t},\n\t\tconfig.id,\n\t\tconfig.fieldName,\n\t\tconfig.value,\n\t);\n}\n\nfunction makeNumberIconInput<SpecType extends Spec, Message, ModObject>(\n\tconfig: WrappedTypedInputConfig<Message, ModObject, number>,\n\tactionId: ActionId,\n\tfieldName: keyof Message,\n\tmultiplier?: number,\n): TypedIconPickerConfig<Player<SpecType>, number> {\n\treturn makeWrappedIconInput<SpecType, ModObject, number>({\n\t\tgetModObject: config.getModObject,\n\t\tactionId: actionId,\n\t\tstates: 0, // Must be assigned externally.\n\t\tchangedEvent: config.changeEmitter,\n\t\tgetValue: (modObj: ModObject) => config.getValue(modObj)[fieldName] as unknown as number,\n\t\tsetValue: (eventID: EventID, modObj: ModObject, newValue: number) => {\n\t\t\tconst newMessage = config.getValue(modObj);\n\t\t\tif (multiplier) {\n\t\t\t\tconst sign = newValue - (newMessage[fieldName] as unknown as number);\n\t\t\t\tnewValue += (multiplier - 1) * sign;\n\t\t\t}\n\t\t\tif (newValue < 0) {\n\t\t\t\tnewValue = 0;\n\t\t\t}\n\t\t\t(newMessage[fieldName] as unknown as number) = newValue;\n\t\t\tconfig.setValue(eventID, modObj, newMessage);\n\t\t},\n\t});\n}\nexport function makeTristateIconInput<SpecType extends Spec, Message, ModObject>(\n\tconfig: WrappedTypedInputConfig<Message, ModObject, number>,\n\tid: ActionId,\n\timpId: ActionId,\n\tfieldName: keyof Message,\n): TypedIconPickerConfig<Player<SpecType>, number> {\n\tconst input = makeNumberIconInput<SpecType, Message, ModObject>(config, id, fieldName);\n\tinput.states = 3;\n\tinput.improvedId = impId;\n\treturn input;\n}\nexport function makeQuadstateIconInput<SpecType extends Spec, Message, ModObject>(\n\tconfig: WrappedTypedInputConfig<Message, ModObject, number>,\n\tid: ActionId,\n\timpId: ActionId,\n\timpId2: ActionId,\n\tfieldName: keyof Message,\n): TypedIconPickerConfig<Player<SpecType>, number> {\n\tconst input = makeNumberIconInput<SpecType, Message, ModObject>(config, id, fieldName);\n\tinput.states = 4;\n\tinput.improvedId = impId;\n\tinput.improvedId2 = impId2;\n\treturn input;\n}\nexport function makeMultistateIconInput<SpecType extends Spec, Message, ModObject>(\n\tconfig: WrappedTypedInputConfig<Message, ModObject, number>,\n\tid: ActionId,\n\tnumStates: number,\n\tfieldName: keyof Message,\n\tmultiplier?: number,\n): TypedIconPickerConfig<Player<SpecType>, number> {\n\tconst input = makeNumberIconInput<SpecType, Message, ModObject>(config, id, fieldName, multiplier);\n\tinput.states = numStates;\n\treturn input;\n}\n\nexport interface TypedIconEnumPickerConfig<ModObject, T> extends IconEnumPickerConfig<ModObject, T> {\n\ttype: 'iconEnum';\n}\n\ninterface WrappedEnumIconInputConfig<SpecType extends Spec, ModObject, T> extends IconEnumPickerConfig<ModObject, T> {\n\tgetModObject: (player: Player<SpecType>) => ModObject;\n}\nfunction makeWrappedEnumIconInput<SpecType extends Spec, ModObject, T>(\n\tconfig: WrappedEnumIconInputConfig<SpecType, ModObject, T>,\n): TypedIconEnumPickerConfig<Player<SpecType>, T> {\n\tconst getModObject = config.getModObject;\n\treturn {\n\t\ttype: 'iconEnum',\n\t\tnumColumns: config.numColumns,\n\t\tvalues: config.values.map(value => {\n\t\t\tif (value.showWhen) {\n\t\t\t\tconst showWhen = value.showWhen;\n\t\t\t\tvalue.showWhen = ((player: Player<SpecType>) => showWhen(getModObject(player))) as any;\n\t\t\t}\n\t\t\treturn value as unknown as IconEnumValueConfig<Player<SpecType>, T>;\n\t\t}),\n\t\tequals: config.equals,\n\t\tshowWhen: (player: Player<SpecType>): boolean => !config.showWhen || (config.showWhen(getModObject(player)) as any),\n\t\tzeroValue: config.zeroValue,\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: T) => config.setValue(eventID, getModObject(player), newValue),\n\t\textraCssClasses: config.extraCssClasses,\n\t};\n}\n\nexport interface PlayerEnumIconInputConfig<SpecType extends Spec, Message, T> extends BasePlayerConfig<SpecType, T> {\n\tfieldName: keyof Message;\n\tvalues: Array<IconEnumValueConfig<Player<SpecType>, T>>;\n\tnumColumns?: number;\n}\nexport function makeClassOptionsEnumIconInput<SpecType extends Spec, T>(\n\tconfig: PlayerEnumIconInputConfig<SpecType, ClassOptions<SpecType>, T>,\n): TypedIconEnumPickerConfig<Player<SpecType>, T> {\n\treturn makeWrappedEnumIconInput<SpecType, Player<SpecType>, T>({\n\t\tnumColumns: config.numColumns || 1,\n\t\tvalues: config.values,\n\t\tequals: (a: T, b: T) => a == b,\n\t\tshowWhen: config.showWhen,\n\t\tzeroValue: 0 as unknown as T,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getClassOptions()[config.fieldName] as unknown as T),\n\t\tsetValue:\n\t\t\tconfig.setValue ||\n\t\t\t((eventID: EventID, player: Player<SpecType>, newVal: T) => {\n\t\t\t\tconst newMessage = player.getClassOptions();\n\t\t\t\t(newMessage[config.fieldName] as unknown as T) = newVal;\n\t\t\t\tplayer.setClassOptions(eventID, newMessage);\n\t\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\textraCssClasses: config.extraCssClasses,\n\t});\n}\nexport function makeSpecOptionsEnumIconInput<SpecType extends Spec, T>(\n\tconfig: PlayerEnumIconInputConfig<SpecType, SpecOptions<SpecType>, T>,\n): TypedIconEnumPickerConfig<Player<SpecType>, T> {\n\treturn makeWrappedEnumIconInput<SpecType, Player<SpecType>, T>({\n\t\tnumColumns: config.numColumns || 1,\n\t\tvalues: config.values,\n\t\tequals: (a: T, b: T) => a == b,\n\t\tshowWhen: config.showWhen,\n\t\tzeroValue: 0 as unknown as T,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSpecOptions()[config.fieldName] as unknown as T),\n\t\tsetValue:\n\t\t\tconfig.setValue ||\n\t\t\t((eventID: EventID, player: Player<SpecType>, newVal: T) => {\n\t\t\t\tconst newMessage = player.getSpecOptions();\n\t\t\t\t(newMessage[config.fieldName] as unknown as T) = newVal;\n\t\t\t\tplayer.setSpecOptions(eventID, newMessage);\n\t\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\n\t\textraCssClasses: config.extraCssClasses,\n\t});\n}\nexport function makeRotationEnumIconInput<SpecType extends Spec, T>(\n\tconfig: PlayerEnumIconInputConfig<SpecType, SpecRotation<SpecType>, T>,\n): TypedIconEnumPickerConfig<Player<SpecType>, T> {\n\treturn makeWrappedEnumIconInput<SpecType, Player<SpecType>, T>({\n\t\tnumColumns: config.numColumns || 1,\n\t\tvalues: config.values,\n\t\tequals: (a: T, b: T) => a == b,\n\t\tshowWhen: config.showWhen,\n\t\tzeroValue: 0 as unknown as T,\n\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSimpleRotation()[config.fieldName] as unknown as T),\n\t\tsetValue:\n\t\t\tconfig.setValue ||\n\t\t\t((eventID: EventID, player: Player<SpecType>, newVal: T) => {\n\t\t\t\tconst newMessage = player.getSimpleRotation();\n\t\t\t\t(newMessage[config.fieldName] as unknown as T) = newVal;\n\t\t\t\tplayer.setSimpleRotation(eventID, newMessage);\n\t\t\t}),\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.rotationChangeEmitter),\n\t\textraCssClasses: config.extraCssClasses,\n\t});\n}\n","import { Party } from '../party.js';\nimport { Player } from '../player';\nimport { Consumes, Debuffs, Faction, IndividualBuffs, PartyBuffs, RaidBuffs, Spec } from '../proto/common.js';\nimport { ActionId } from '../proto_utils/action_id.js';\nimport { Raid } from '../raid';\nimport { EventID, TypedEvent } from '../typed_event';\nimport { IconEnumPicker } from './icon_enum_picker';\nimport { IconPicker } from './icon_picker';\nimport * as InputHelpers from './input_helpers';\n\n// Component Functions\n\nexport type IconInputConfig<ModObject, T> = InputHelpers.TypedIconPickerConfig<ModObject, T> | InputHelpers.TypedIconEnumPickerConfig<ModObject, T>;\n\nexport const buildIconInput = <SpecType extends Spec>(parent: HTMLElement, player: Player<SpecType>, inputConfig: IconInputConfig<Player<SpecType>, any>) => {\n\tif (inputConfig.type == 'icon') {\n\t\treturn new IconPicker<Player<SpecType>, any>(parent, player, inputConfig);\n\t} else if (inputConfig.type == 'iconEnum') {\n\t\treturn new IconEnumPicker<Player<SpecType>, any>(parent, player, inputConfig);\n\t} else {\n\t\tthrow new Error('Unsupported input type');\n\t}\n};\n\nexport function withLabel<ModObject, T>(config: IconInputConfig<ModObject, T>, label: string): IconInputConfig<ModObject, T> {\n\tconfig.label = label;\n\treturn config;\n}\n\ninterface BooleanInputConfig<T> {\n\tactionId: ActionId;\n\tfieldName: keyof T;\n\tvalue?: number;\n\tfaction?: Faction;\n\tshowWhen?: (player: Player<any>) => boolean;\n}\n\nexport function makeBooleanRaidBuffInput<SpecType extends Spec>(\n\tconfig: BooleanInputConfig<RaidBuffs>,\n): InputHelpers.TypedIconPickerConfig<Player<SpecType>, boolean> {\n\treturn InputHelpers.makeBooleanIconInput<any, RaidBuffs, Player<SpecType>>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\t\tshowWhen: (player: Player<SpecType>) => !config.faction || config.faction == player.getFaction(),\n\t\t\tgetValue: (player: Player<SpecType>) => player.getRaid()!.getBuffs(),\n\t\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newVal: RaidBuffs) => player.getRaid()!.setBuffs(eventID, newVal),\n\t\t\tchangeEmitter: (player: Player<SpecType>) => TypedEvent.onAny([player.getRaid()!.buffsChangeEmitter, player.raceChangeEmitter]),\n\t\t},\n\t\tconfig.actionId,\n\t\tconfig.fieldName,\n\t\tconfig.value,\n\t);\n}\nexport function makeBooleanPartyBuffInput<SpecType extends Spec>(\n\tconfig: BooleanInputConfig<PartyBuffs>,\n): InputHelpers.TypedIconPickerConfig<Player<SpecType>, boolean> {\n\treturn InputHelpers.makeBooleanIconInput<any, PartyBuffs, Party>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player.getParty()!,\n\t\t\tgetValue: (party: Party) => party.getBuffs(),\n\t\t\tsetValue: (eventID: EventID, party: Party, newVal: PartyBuffs) => party.setBuffs(eventID, newVal),\n\t\t\tchangeEmitter: (party: Party) => party.buffsChangeEmitter,\n\t\t},\n\t\tconfig.actionId,\n\t\tconfig.fieldName,\n\t\tconfig.value,\n\t);\n}\n\nexport function makeBooleanIndividualBuffInput<SpecType extends Spec>(\n\tconfig: BooleanInputConfig<IndividualBuffs>,\n): InputHelpers.TypedIconPickerConfig<Player<SpecType>, boolean> {\n\treturn InputHelpers.makeBooleanIconInput<any, IndividualBuffs, Player<SpecType>>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\t\tshowWhen: (player: Player<SpecType>) => !config.faction || config.faction == player.getFaction(),\n\t\t\tgetValue: (player: Player<SpecType>) => player.getBuffs(),\n\t\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newVal: IndividualBuffs) => player.setBuffs(eventID, newVal),\n\t\t\tchangeEmitter: (player: Player<SpecType>) => TypedEvent.onAny([player.buffsChangeEmitter, player.raceChangeEmitter]),\n\t\t},\n\t\tconfig.actionId,\n\t\tconfig.fieldName,\n\t\tconfig.value,\n\t);\n}\n\nexport function makeBooleanConsumeInput<SpecType extends Spec>(\n\tconfig: BooleanInputConfig<Consumes>,\n): InputHelpers.TypedIconPickerConfig<Player<SpecType>, boolean> {\n\treturn InputHelpers.makeBooleanIconInput<any, Consumes, Player<SpecType>>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\t\tgetValue: (player: Player<SpecType>) => player.getConsumes(),\n\t\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newVal: Consumes) => player.setConsumes(eventID, newVal),\n\t\t\tchangeEmitter: (player: Player<SpecType>) => TypedEvent.onAny([player.consumesChangeEmitter, player.professionChangeEmitter]),\n\t\t\tshowWhen: (player: Player<SpecType>) => !config.showWhen || config.showWhen(player),\n\t\t},\n\t\tconfig.actionId,\n\t\tconfig.fieldName,\n\t\tconfig.value,\n\t);\n}\nexport function makeBooleanDebuffInput<SpecType extends Spec>(\n\tconfig: BooleanInputConfig<Debuffs>,\n): InputHelpers.TypedIconPickerConfig<Player<SpecType>, boolean> {\n\treturn InputHelpers.makeBooleanIconInput<any, Debuffs, Player<SpecType>>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\t\tgetValue: (player: Player<SpecType>) => player.getRaid()!.getDebuffs(),\n\t\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newVal: Debuffs) => player.getRaid()!.setDebuffs(eventID, newVal),\n\t\t\tchangeEmitter: (player: Player<SpecType>) => TypedEvent.onAny([player.getRaid()!.debuffsChangeEmitter]),\n\t\t},\n\t\tconfig.actionId,\n\t\tconfig.fieldName,\n\t\tconfig.value,\n\t);\n}\n\ninterface TristateInputConfig<T> {\n\tactionId: ActionId;\n\timpId: ActionId;\n\tfieldName: keyof T;\n\tfaction?: Faction;\n}\n\nexport function makeTristateRaidBuffInput<SpecType extends Spec>(\n\tconfig: TristateInputConfig<RaidBuffs>,\n): InputHelpers.TypedIconPickerConfig<Player<SpecType>, number> {\n\treturn InputHelpers.makeTristateIconInput<any, RaidBuffs, Player<SpecType>>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\t\tshowWhen: (player: Player<SpecType>) => !config.faction || config.faction == player.getFaction(),\n\t\t\tgetValue: (player: Player<SpecType>) => player.getRaid()!.getBuffs(),\n\t\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newVal: RaidBuffs) => player.getRaid()!.setBuffs(eventID, newVal),\n\t\t\tchangeEmitter: (player: Player<SpecType>) => TypedEvent.onAny([player.getRaid()!.buffsChangeEmitter, player.raceChangeEmitter]),\n\t\t},\n\t\tconfig.actionId,\n\t\tconfig.impId,\n\t\tconfig.fieldName,\n\t);\n}\n\nexport function makeTristateIndividualBuffInput<SpecType extends Spec>(\n\tconfig: TristateInputConfig<IndividualBuffs>,\n): InputHelpers.TypedIconPickerConfig<Player<SpecType>, number> {\n\treturn InputHelpers.makeTristateIconInput<any, IndividualBuffs, Player<SpecType>>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\t\tshowWhen: (player: Player<SpecType>) => !config.faction || config.faction == player.getFaction(),\n\t\t\tgetValue: (player: Player<SpecType>) => player.getBuffs(),\n\t\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newVal: IndividualBuffs) => player.setBuffs(eventID, newVal),\n\t\t\tchangeEmitter: (player: Player<SpecType>) => TypedEvent.onAny([player.buffsChangeEmitter, player.raceChangeEmitter]),\n\t\t},\n\t\tconfig.actionId,\n\t\tconfig.impId,\n\t\tconfig.fieldName,\n\t);\n}\n\nexport function makeTristateDebuffInput<SpecType extends Spec>(\n\tconfig: TristateInputConfig<Debuffs>,\n): InputHelpers.TypedIconPickerConfig<Player<SpecType>, number> {\n\treturn InputHelpers.makeTristateIconInput<any, Debuffs, Raid>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player.getRaid()!,\n\t\t\tgetValue: (raid: Raid) => raid.getDebuffs(),\n\t\t\tsetValue: (eventID: EventID, raid: Raid, newVal: Debuffs) => raid.setDebuffs(eventID, newVal),\n\t\t\tchangeEmitter: (raid: Raid) => raid.debuffsChangeEmitter,\n\t\t},\n\t\tconfig.actionId,\n\t\tconfig.impId,\n\t\tconfig.fieldName,\n\t);\n}\n\ninterface QuadStateInputConfig<T> {\n\tactionId: ActionId;\n\timpId: ActionId;\n\timpId2: ActionId;\n\tfieldName: keyof T;\n\tfaction?: Faction;\n}\n\nexport function makeQuadstateDebuffInput<SpecType extends Spec>(\n\tconfig: QuadStateInputConfig<Debuffs>,\n): InputHelpers.TypedIconPickerConfig<Player<SpecType>, number> {\n\treturn InputHelpers.makeQuadstateIconInput<any, Debuffs, Raid>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player.getRaid()!,\n\t\t\tgetValue: (raid: Raid) => raid.getDebuffs(),\n\t\t\tsetValue: (eventID: EventID, raid: Raid, newVal: Debuffs) => raid.setDebuffs(eventID, newVal),\n\t\t\tchangeEmitter: (raid: Raid) => raid.debuffsChangeEmitter,\n\t\t},\n\t\tconfig.actionId,\n\t\tconfig.impId,\n\t\tconfig.impId2,\n\t\tconfig.fieldName,\n\t);\n}\n\ninterface MultiStateInputConfig<T> {\n\tactionId: ActionId;\n\tnumStates: number;\n\tfieldName: keyof T;\n\tmultiplier?: number;\n\tfaction?: Faction;\n}\n\nexport function makeMultistateRaidBuffInput<SpecType extends Spec>(\n\tconfig: MultiStateInputConfig<RaidBuffs>,\n): InputHelpers.TypedIconPickerConfig<Player<SpecType>, number> {\n\treturn InputHelpers.makeMultistateIconInput<any, RaidBuffs, Player<SpecType>>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\t\tshowWhen: (player: Player<SpecType>) => !config.faction || config.faction == player.getFaction(),\n\t\t\tgetValue: (player: Player<SpecType>) => player.getRaid()!.getBuffs(),\n\t\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newVal: RaidBuffs) => player.getRaid()!.setBuffs(eventID, newVal),\n\t\t\tchangeEmitter: (player: Player<SpecType>) => TypedEvent.onAny([player.getRaid()!.buffsChangeEmitter, player.raceChangeEmitter]),\n\t\t},\n\t\tconfig.actionId,\n\t\tconfig.numStates,\n\t\tconfig.fieldName,\n\t\tconfig.multiplier,\n\t);\n}\nexport function makeMultistatePartyBuffInput<SpecType extends Spec>(\n\tactionId: ActionId,\n\tnumStates: number,\n\tfieldName: keyof PartyBuffs,\n): InputHelpers.TypedIconPickerConfig<Player<SpecType>, number> {\n\treturn InputHelpers.makeMultistateIconInput<any, PartyBuffs, Party>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player.getParty()!,\n\t\t\tgetValue: (party: Party) => party.getBuffs(),\n\t\t\tsetValue: (eventID: EventID, party: Party, newVal: PartyBuffs) => party.setBuffs(eventID, newVal),\n\t\t\tchangeEmitter: (party: Party) => party.buffsChangeEmitter,\n\t\t},\n\t\tactionId,\n\t\tnumStates,\n\t\tfieldName,\n\t);\n}\nexport function makeMultistateIndividualBuffInput<SpecType extends Spec>(\n\tconfig: MultiStateInputConfig<IndividualBuffs>,\n): InputHelpers.TypedIconPickerConfig<Player<SpecType>, number> {\n\treturn InputHelpers.makeMultistateIconInput<any, IndividualBuffs, Player<SpecType>>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\t\tshowWhen: (player: Player<SpecType>) => !config.faction || config.faction == player.getFaction(),\n\t\t\tgetValue: (player: Player<SpecType>) => player.getBuffs(),\n\t\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newVal: IndividualBuffs) => player.setBuffs(eventID, newVal),\n\t\t\tchangeEmitter: (player: Player<SpecType>) => TypedEvent.onAny([player.buffsChangeEmitter, player.raceChangeEmitter]),\n\t\t},\n\t\tconfig.actionId,\n\t\tconfig.numStates,\n\t\tconfig.fieldName,\n\t\tconfig.multiplier,\n\t);\n}\n\nexport function makeMultistateMultiplierIndividualBuffInput<SpecType extends Spec>(\n\tactionId: ActionId,\n\tnumStates: number,\n\tmultiplier: number,\n\tfieldName: keyof IndividualBuffs,\n): InputHelpers.TypedIconPickerConfig<Player<SpecType>, number> {\n\treturn InputHelpers.makeMultistateIconInput<any, IndividualBuffs, Player<SpecType>>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player,\n\t\t\tgetValue: (player: Player<SpecType>) => player.getBuffs(),\n\t\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newVal: IndividualBuffs) => player.setBuffs(eventID, newVal),\n\t\t\tchangeEmitter: (player: Player<SpecType>) => player.buffsChangeEmitter,\n\t\t},\n\t\tactionId,\n\t\tnumStates,\n\t\tfieldName,\n\t\tmultiplier,\n\t);\n}\n\nexport function makeMultistateMultiplierDebuffInput<SpecType extends Spec>(\n\tactionId: ActionId,\n\tnumStates: number,\n\tmultiplier: number,\n\tfieldName: keyof Debuffs,\n): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\n\treturn InputHelpers.makeMultistateIconInput<any, Debuffs, Raid>(\n\t\t{\n\t\t\tgetModObject: (player: Player<SpecType>) => player.getRaid()!,\n\t\t\tgetValue: (raid: Raid) => raid.getDebuffs(),\n\t\t\tsetValue: (eventID: EventID, raid: Raid, newVal: Debuffs) => raid.setDebuffs(eventID, newVal),\n\t\t\tchangeEmitter: (raid: Raid) => raid.debuffsChangeEmitter,\n\t\t},\n\t\tactionId,\n\t\tnumStates,\n\t\tfieldName,\n\t\tmultiplier,\n\t);\n}\n\n// interface EnumInputConfig<ModObject, Message, T> {\n// \tfieldName: keyof Message\n// \tvalues: Array<IconEnumValueConfig<ModObject, T>>\n// \tdirection?: IconEnumPickerDirection\n// \tnumColumns?: number\n// \tfaction?: Faction\n// }\n\n// export function makeEnumIndividualBuffInput<SpecType extends Spec>(config: EnumInputConfig<Player<SpecType>, IndividualBuffs, number>): InputHelpers.TypedIconEnumPickerConfig<Player<SpecType>, number> {\n// \treturn InputHelpers.makeEnumIconInput<any, IndividualBuffs, Player<SpecType>, number>({\n// \t\tgetModObject: (player: Player<SpecType>) => player,\n// \t\tshowWhen: (player: Player<SpecType>) =>\n// \t\t\t(!config.faction || config.faction == player.getFaction()),\n// \t\tgetValue: (player: Player<SpecType>) => player.getBuffs(),\n// \t\tsetValue: (eventID: EventID, player: Player<SpecType>, newVal: IndividualBuffs) => player.setBuffs(eventID, newVal),\n// \t\tchangeEmitter: (player: Player<SpecType>) => TypedEvent.onAny([player.buffsChangeEmitter, player.raceChangeEmitter]),\n// \t}, config.fieldName, config.values, config.numColumns, config.direction || IconEnumPickerDirection.Vertical)\n// };\n","import { Player } from '../player.js';\nimport { ActionId } from '../proto_utils/action_id.js';\nimport { SimUI } from '../sim_ui.js';\nimport { TypedEvent } from '../typed_event.js';\nimport { isRightClick } from '../utils.js';\n\nimport { Component } from './component.js';\nimport { IconPicker, IconPickerConfig } from './icon_picker.js';\n\nexport interface MultiIconPickerItemConfig<ModObject> extends IconPickerConfig<ModObject, any> {\n}\n\nexport interface MultiIconPickerConfig<ModObject> {\n\tinputs: Array<MultiIconPickerItemConfig<ModObject>>,\n\tlabel?: string,\n\tcategoryId?: ActionId,\n\tshowWhen?: (obj: Player<any>) => boolean,\n}\n\n// Icon-based UI for a dropdown with multiple icon pickers.\n// ModObject is the object being modified (Sim, Player, or Target).\nexport class MultiIconPicker<ModObject> extends Component {\n\tprivate readonly config: MultiIconPickerConfig<ModObject>;\n\n\tprivate currentValue: ActionId | null;\n\n\tprivate readonly buttonElem: HTMLAnchorElement;\n\tprivate readonly dropdownMenu: HTMLElement;\n\n\tprivate readonly pickers: Array<IconPicker<ModObject, any>>;\n\n\tconstructor(parent: HTMLElement, modObj: ModObject, config: MultiIconPickerConfig<ModObject>, simUI: SimUI) {\n\t\tsuper(parent, 'multi-icon-picker-root');\n\t\tthis.rootElem.classList.add('icon-picker');\n\t\tthis.config = config;\n\t\tthis.currentValue = null;\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"dropend\">\n\t\t\t\t<a\n\t\t\t\t\tclass=\"icon-picker-button\"\n\t\t\t\t\trole=\"button\"\n\t\t\t\t\tdata-bs-toggle=\"dropdown\"\n\t\t\t\t\taria-expanded=\"false\"\n\t\t\t\t\tdata-disable-wowhead-touch-tooltip='true'\n\t\t\t\t\tdata-whtticon='false'\n\t\t\t\t></a>\n\t\t\t\t<ul class=\"dropdown-menu\"></ul>\n\t\t\t</div>\n\t\t\t<label class=\"multi-icon-picker-label form-label\"></label>\n    `;\n\n\t\tconst labelElem = this.rootElem.querySelector('.multi-icon-picker-label') as HTMLElement;\n\t\tif (config.label) {\n\t\t\tlabelElem.textContent = config.label;\n\t\t} else {\n\t\t\tlabelElem.remove();\n\t\t}\n\n\t\tthis.buttonElem = this.rootElem.querySelector('.icon-picker-button') as HTMLAnchorElement;\n\t\tthis.dropdownMenu = this.rootElem.querySelector('.dropdown-menu') as HTMLElement;\n\n\t\tthis.buttonElem.addEventListener('hide.bs.dropdown', event => {\n\t\t\tif (event.hasOwnProperty('clickEvent'))\n\t\t\t\tevent.preventDefault();\n\t\t})\n\n\t\tthis.buttonElem.addEventListener('contextmenu', event => {\n\t\t\tevent.preventDefault();\n\t\t});\n\n\t\tthis.buttonElem.addEventListener('mousedown', event => {\n\t\t\tconst rightClick = isRightClick(event);\n\n\t\t\tif (rightClick) {\n\t\t\t\tthis.clearPicker();\n\t\t\t}\n\t\t});\n\n\t\tthis.buildBlankOption();\n\n\t\tthis.pickers = config.inputs.map((pickerConfig, _i) => {\n\t\t\tconst optionContainer = document.createElement('li');\n\t\t\toptionContainer.classList.add('icon-picker-option', 'dropdown-option');\n\t\t\tthis.dropdownMenu.appendChild(optionContainer);\n\n\t\t\treturn new IconPicker(optionContainer, modObj, pickerConfig);\n\t\t});\n\t\tsimUI.sim.waitForInit().then(() => this.updateButtonImage());\n\t\tsimUI.changeEmitter.on(() => this.updateButtonImage());\n\t\tsimUI.changeEmitter.on(() => {\n\t\t\tconst show = !this.config.showWhen || this.config.showWhen(simUI.sim.raid.getPlayer(0)!);\n\t\t\tif (show) {\n\t\t\t\tthis.rootElem.classList.remove('hide');\n\t\t\t} else {\n\t\t\t\tthis.rootElem.classList.add('hide');\n\t\t\t}\n\t\t})\n\t}\n\n\tprivate buildBlankOption() {\n\t\tconst listItem = document.createElement('li');\n\t\tthis.dropdownMenu.appendChild(listItem);\n\n\t\tconst option = document.createElement('a');\n\t\toption.classList.add('icon-dropdown-option', 'dropdown-option');\n\t\tlistItem.appendChild(option);\n\n\t\toption.addEventListener('click', () => this.clearPicker());\n\t}\n\n\tprivate clearPicker() {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.pickers.forEach((picker) => {\n\t\t\t\tpicker.setInputValue(null)\n\t\t\t\tpicker.inputChanged(TypedEvent.nextEventID());\n\t\t\t});\n\t\t\tthis.updateButtonImage();\n\t\t})\n\t}\n\n\tprivate updateButtonImage() {\n\t\tthis.currentValue = this.getMaxValue();\n\n\t\tif (this.currentValue) {\n\t\t\tthis.buttonElem.classList.add('active');\n\t\t\tif (this.config.categoryId != null) {\n\t\t\t\tthis.config.categoryId.fillAndSet(this.buttonElem, false, true);\n\t\t\t} else {\n\t\t\t\tthis.currentValue.fillAndSet(this.buttonElem, false, true);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.buttonElem.classList.remove('active');\n\t\t\tif (this.config.categoryId != null) {\n\t\t\t\tthis.config.categoryId.fillAndSet(this.buttonElem, false, true);\n\t\t\t} else {\n\t\t\t\tthis.buttonElem.style.backgroundImage = '';\n\t\t\t}\n\t\t\tthis.buttonElem.removeAttribute(\"href\");\n\t\t}\n\t}\n\n\tprivate getMaxValue(): ActionId | null {\n\t\treturn this.pickers.map(picker => picker.getActionId()).filter(id => id != null)[0] || null;\n\t}\n}\n","import { Faction, Stat, TristateEffect } from '../../proto/common';\nimport { ActionId } from '../../proto_utils/action_id';\nimport {\n\tmakeBooleanDebuffInput,\n\tmakeBooleanIndividualBuffInput,\n\tmakeBooleanPartyBuffInput,\n\tmakeBooleanRaidBuffInput,\n\tmakeMultistateIndividualBuffInput,\n\tmakeMultistateMultiplierIndividualBuffInput,\n\tmakeMultistatePartyBuffInput,\n\tmakeMultistateRaidBuffInput,\n\tmakeQuadstateDebuffInput,\n\tmakeTristateDebuffInput,\n\tmakeTristateIndividualBuffInput,\n\tmakeTristateRaidBuffInput,\n\twithLabel,\n} from '../icon_inputs';\nimport { IconPicker } from '../icon_picker';\nimport * as InputHelpers from '../input_helpers';\nimport { MultiIconPicker } from '../multi_icon_picker';\nimport { IconPickerStatOption, PickerStatOptions } from './stat_options';\n\n///////////////////////////////////////////////////////////////////////////\n//                                 RAID BUFFS\n///////////////////////////////////////////////////////////////////////////\n\nexport const AllStatsBuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(20217), fieldName: 'blessingOfKings' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(1126), fieldName: 'markOfTheWild' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromItemId(63140), fieldName: 'drumsOfTheBurningWild' }),\n\t],\n\t'Stats',\n);\n\nexport const ArmorBuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(465), fieldName: 'devotionAura' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(8071), fieldName: 'stoneskinTotem' }),\n\t],\n\t'Armor',\n);\n\nexport const AttackPowerPercentBuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(19740), fieldName: 'blessingOfMight' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(53138), fieldName: 'abominationsMight' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(30808), fieldName: 'unleashedRage' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(19506), fieldName: 'trueshotAura' }),\n\t],\n\t'Atk Pwr %',\n);\n\nexport const Bloodlust = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(2825), fieldName: 'bloodlust' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(80353), fieldName: 'timeWarp' }),\n\t],\n\t\"Lust\",\n);\n\n\nexport const DamagePercentBuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(31876), fieldName: 'communion' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(82930), fieldName: 'arcaneTactics' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(34460), fieldName: 'ferociousInspiration' }),\n\t],\n\t'+3% Dmg',\n);\n\n// TODO: Look at these, what we want and how to structure them for multiple available \n// export const DefensiveCooldownBuff = InputHelpers.makeMultiIconInput(\n// \t[\n// \t\tmakeMultistateIndividualBuffInput({ actionId: ActionId.fromSpellId(6940), numStates: 11, fieldName: 'handOfSacrifices' }),\n// \t\tmakeMultistateIndividualBuffInput({ actionId: ActionId.fromSpellId(53530), numStates: 11, fieldName: 'divineGuardians' }),\n// \t\tmakeMultistateIndividualBuffInput({ actionId: ActionId.fromSpellId(33206), numStates: 11, fieldName: 'painSuppressions' }),\n// \t\tmakeMultistateIndividualBuffInput({ actionId: ActionId.fromSpellId(47788), numStates: 11, fieldName: 'guardianSpirits' }),\n// \t],\n// \t'Defensive CDs',\n// );\n\nexport const SpellHasteBuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(15473), fieldName: 'shadowForm' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(24858), fieldName: 'moonkinForm' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(3738), fieldName: 'wrathOfAirTotem' }),\n\t],\n\t'Spell Haste',\n);\n\nexport const ManaBuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(1459), fieldName: 'arcaneBrilliance' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(54424), fieldName: 'felIntelligence' }),\n\t],\n\t'Mana',\n);\n\nexport const CritBuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(17007), fieldName: 'leaderOfThePack' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(51470), fieldName: 'elementalOath' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(51701), fieldName: 'honorAmongThieves' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(29801), fieldName: 'rampage' }),\n\t],\n\t'Crit %',\n);\n\nexport const MeleeHasteBuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(55610), fieldName: 'icyTalons' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(8512), fieldName: 'windfuryTotem' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(53290), fieldName: 'huntingParty' }),\n\t],\n\t'Melee Haste',\n);\n\nexport const MP5Buff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(19740), fieldName: 'blessingOfMight' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(54424), fieldName: 'felIntelligence' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(5675), fieldName: 'manaSpringTotem' }),\n\t],\n\t'MP5',\n);\n\nexport const ReplenishmentBuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanIndividualBuffInput({ actionId: ActionId.fromSpellId(34914), fieldName: 'vampiricTouch' }),\n\t\tmakeBooleanIndividualBuffInput({ actionId: ActionId.fromSpellId(31876), fieldName: 'communion' }),\n\t\tmakeBooleanIndividualBuffInput({ actionId: ActionId.fromSpellId(48544), fieldName: 'revitalize' }),\n\t\tmakeBooleanIndividualBuffInput({ actionId: ActionId.fromSpellId(30295), fieldName: 'soulLeach' }),\n\t\tmakeBooleanIndividualBuffInput({ actionId: ActionId.fromSpellId(86508), fieldName: 'enduringWinter' }),\n\t],\n\t'Replen',\n);\n\nexport const ResistanceBuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(19891), fieldName: 'resistanceAura'}),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(8184), fieldName: 'elementalResistanceTotem'}),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(20043), fieldName: 'aspectOfTheWild' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(27683), fieldName: 'shadowProtection' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(20217), fieldName: 'blessingOfKings'}),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(1126), fieldName: 'markOfTheWild'}),\n\t],\n\t'Resistances',\n);\n\nexport const SpellPowerBuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(47236), fieldName: 'demonicPact' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(77746), fieldName: 'totemicWrath' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(1459), fieldName: 'arcaneBrilliance' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(8227), fieldName: 'flametongueTotem' }),\n\t],\n\t'Spell Power',\n);\n\nexport const StaminaBuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(21562), fieldName: 'powerWordFortitude' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(6307), fieldName: 'bloodPact' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(469), fieldName: 'commandingShout' }),\n\t],\n\t'Stamina',\n);\n\nexport const StrengthAndAgilityBuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(8075), fieldName: 'strengthOfEarthTotem' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(57330), fieldName: 'hornOfWinter' }),\n\t\tmakeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(6673), fieldName: 'battleShout' }),\n\t],\n\t'Str/Agi',\n);\n\n// Misc Buffs\nexport const RetributionAura = makeBooleanRaidBuffInput({ actionId: ActionId.fromSpellId(7294), fieldName: 'retributionAura' });\nexport const ManaTideTotem = makeMultistateRaidBuffInput({actionId: ActionId.fromSpellId(16190), numStates: 5, fieldName: 'manaTideTotemCount'});\nexport const Innervate = makeMultistateIndividualBuffInput({ actionId: ActionId.fromSpellId(29166), numStates: 11, fieldName: 'innervateCount' });\nexport const PowerInfusion = makeMultistateIndividualBuffInput({ actionId: ActionId.fromSpellId(10060), numStates: 11, fieldName: 'powerInfusionCount' });\nexport const FocusMagic = makeBooleanIndividualBuffInput({ actionId: ActionId.fromSpellId(54648), fieldName: 'focusMagic' });\nexport const TricksOfTheTrade = makeMultistateIndividualBuffInput({ actionId: ActionId.fromSpellId(57933), numStates: 20, fieldName: 'tricksOfTheTradeCount' });\nexport const UnholyFrenzy = makeMultistateIndividualBuffInput({ actionId: ActionId.fromSpellId(49016), numStates: 11, fieldName: 'unholyFrenzyCount' });\nexport const DarkIntent = makeBooleanIndividualBuffInput({actionId: ActionId.fromSpellId(85759), fieldName: 'darkIntent'})\n\n///////////////////////////////////////////////////////////////////////////\n//                                 DEBUFFS\n///////////////////////////////////////////////////////////////////////////\n\nexport const MajorArmorDebuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(7386), fieldName: 'sunderArmor' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(8647), fieldName: 'exposeArmor' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(770), fieldName: 'faerieFire' }),\n\t\tmakeBooleanDebuffInput({actionId: ActionId.fromSpellId(35387), fieldName: 'corrosiveSpit'})\n\t],\n\t'Major ArP',\n);\n\nexport const DamageReduction = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(26016), fieldName: 'vindication' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(26016), fieldName: 'curseOfWeakness' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(26016), fieldName: 'demoralizingRoar' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(26016), fieldName: 'scarletFever' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(26016), fieldName: 'demoralizingShout' }),\n\t],\n\t'-Dmg %',\n);\n\nexport const BleedDebuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(29859), fieldName: 'bloodFrenzy' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(33878), fieldName: 'mangle' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(57386), fieldName: 'stampede' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(16511), fieldName: 'hemorrhage' }),\n\t],\n\t'Bleed',\n);\n\nexport const SpellCritDebuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(12873), fieldName: 'criticalMass' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(17801), fieldName: 'shadowAndFlame' }),\n\t],\n\t'Spell Crit',\n);\n\nexport const MeleeAttackSpeedDebuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(6343), fieldName: 'thunderClap' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(59921), fieldName: 'frostFever' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(53696), fieldName: 'judgementsOfTheJust' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(48484), fieldName: 'infectedWounds' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(8042), fieldName: 'earthShock' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(50285), fieldName: 'dustCloud' }),\n\t],\n\t'Atk Speed',\n);\n\nexport const PhysicalDamageDebuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(29859), fieldName: 'bloodFrenzy' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(58413), fieldName: 'savageCombat' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(81328), fieldName: 'brittleBones' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(55749), fieldName: 'acidSpit' }),\n\t],\n\t'Phys Vuln',\n);\n\nexport const SpellDamageDebuff = InputHelpers.makeMultiIconInput(\n\t[\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(51160), fieldName: 'ebonPlaguebringer' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(48506), fieldName: 'earthAndMoon' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(1490), fieldName: 'curseOfElements' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(58410), fieldName: 'masterPoisoner' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(34889), fieldName: 'fireBreath' }),\n\t\tmakeBooleanDebuffInput({ actionId: ActionId.fromSpellId(24844), fieldName: 'lightningBreath' }),\n\t],\n\t'Spell Dmg',\n);\n\nexport const JudgementOfLight = makeBooleanDebuffInput({ actionId: ActionId.fromSpellId(20271), fieldName: 'judgement' });\n\n///////////////////////////////////////////////////////////////////////////\n//                                 CONFIGS\n///////////////////////////////////////////////////////////////////////////\n\nexport const RAID_BUFFS_CONFIG = [\n\t// Standard buffs\n\t{\n\t\tconfig: AllStatsBuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [],\n\t},\n\t{\n\t\tconfig: ArmorBuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatArmor],\n\t},\n\t{\n\t\tconfig: StaminaBuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatStamina],\n\t},\n\t{\n\t\tconfig: StrengthAndAgilityBuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatStrength, Stat.StatAgility],\n\t},\n\t{\n\t\tconfig: ManaBuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatMana],\n\t},\n\t{\n\t\tconfig: AttackPowerPercentBuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatAttackPower, Stat.StatRangedAttackPower],\n\t},\n\t{\n\t\tconfig: CritBuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatMeleeCrit, Stat.StatSpellCrit],\n\t},\n\t{\n\t\tconfig: MeleeHasteBuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatMeleeHaste],\n\t},\n\t{\n\t\tconfig: SpellPowerBuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatSpellPower],\n\t},\n\t{\n\t\tconfig: SpellHasteBuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatSpellHaste],\n\t},\n\t{\n\t\tconfig: DamagePercentBuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatAttackPower, Stat.StatRangedAttackPower, Stat.StatSpellPower],\n\t},\n\t{\n\t\tconfig: ResistanceBuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatNatureResistance, Stat.StatShadowResistance, Stat.StatFrostResistance],\n\t},\n\t{\n\t\tconfig: MP5Buff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatMP5],\n\t},\n\t{\n\t\tconfig: ReplenishmentBuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatMP5],\n\t},\n\t{\n\t\tconfig: Bloodlust,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatMeleeHaste, Stat.StatSpellHaste],\n\t},\n] as PickerStatOptions[];\n\nexport const RAID_BUFFS_MISC_CONFIG = [\n\t{\n\t\tconfig: DarkIntent,\n\t\tpicker: IconPicker,\n\t\tstats: [Stat.StatMeleeHaste, Stat.StatSpellHaste],\n\t},\n\t{\n\t\tconfig: FocusMagic,\n\t\tpicker: IconPicker,\n\t\tstats: [Stat.StatSpellCrit],\n\t},\n\t{\n\t\tconfig: RetributionAura,\n\t\tpicker: IconPicker,\n\t\tstats: [Stat.StatArmor],\n\t},\n\t{\n\t\tconfig: ManaTideTotem,\n\t\tpicker: IconPicker,\n\t\tstats: [Stat.StatMP5],\n\t},\n\t{\n\t\tconfig: Innervate,\n\t\tpicker: IconPicker,\n\t\tstats: [Stat.StatMP5],\n\t},\n\t{\n\t\tconfig: PowerInfusion,\n\t\tpicker: IconPicker,\n\t\tstats: [Stat.StatMP5, Stat.StatSpellPower],\n\t},\n\t{\n\t\tconfig: TricksOfTheTrade,\n\t\tpicker: IconPicker,\n\t\tstats: [Stat.StatAttackPower, Stat.StatRangedAttackPower, Stat.StatSpellPower],\n\t},\n\t{\n\t\tconfig: UnholyFrenzy,\n\t\tpicker: IconPicker,\n\t\tstats: [Stat.StatAttackPower, Stat.StatRangedAttackPower],\n\t},\n] as IconPickerStatOption[];\n\nexport const DEBUFFS_CONFIG = [\n\t{\n\t\tconfig: MajorArmorDebuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatAttackPower, Stat.StatRangedAttackPower],\n\t},\n\t{\n\t\tconfig: PhysicalDamageDebuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatAttackPower, Stat.StatRangedAttackPower],\n\t},\n\t{\n\t\tconfig: BleedDebuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatAttackPower, Stat.StatRangedAttackPower],\n\t},\n\t{\n\t\tconfig: SpellDamageDebuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatSpellPower],\n\t},\n\t{\n\t\tconfig: SpellCritDebuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatSpellCrit],\n\t},\n\t{\n\t\tconfig: DamageReduction,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatArmor],\n\t},\n\t{\n\t\tconfig: MeleeAttackSpeedDebuff,\n\t\tpicker: MultiIconPicker,\n\t\tstats: [Stat.StatArmor],\n\t},\n] as PickerStatOptions[];\n\nexport const DEBUFFS_MISC_CONFIG = [\n\t{\n\t\tconfig: JudgementOfLight,\n\t\tpicker: IconPicker,\n\t\tstats: [Stat.StatStamina],\n\t},\n] as IconPickerStatOption[];\n","import { EventID, TypedEvent } from '../typed_event.js';\n\nimport { Input, InputConfig } from './input.js';\n\nexport interface EnumValueConfig {\n\tname: string,\n\tvalue: number,\n\ttooltip?: string,\n}\n\nexport interface EnumPickerConfig<ModObject> extends InputConfig<ModObject, number> {\n\tvalues: Array<EnumValueConfig>;\n}\n\nexport class EnumPicker<ModObject> extends Input<ModObject, number> {\n\tprivate readonly selectElem: HTMLSelectElement;\n\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: EnumPickerConfig<ModObject>) {\n\t\tsuper(parent, 'enum-picker-root', modObject, config);\n\n\t\tthis.selectElem = document.createElement('select');\n\t\tthis.selectElem.classList.add('enum-picker-selector', 'form-select');\n\n\t\tconfig.values.forEach((value) => {\n\t\t\tconst option = document.createElement('option');\n\t\t\toption.value = String(value.value);\n\t\t\toption.textContent = value.name;\n\t\t\tthis.selectElem.appendChild(option);\n\n\t\t\tif (value.tooltip) {\n\t\t\t\toption.title = value.tooltip;\n\t\t\t}\n\t\t});\n\t\tthis.rootElem.appendChild(this.selectElem);\n\n\t\tthis.init();\n\n\t\tthis.selectElem.addEventListener('change', event => {\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t});\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.selectElem;\n\t}\n\n\tgetInputValue(): number {\n\t\treturn parseInt(this.selectElem.value);\n\t}\n\n\tsetInputValue(newValue: number) {\n\t\tthis.selectElem.value = String(newValue);\n\t}\n}\n","import { BooleanPicker } from '../components/boolean_picker.js';\nimport { EnumPicker } from '../components/enum_picker.js';\nimport { Player } from '../player.js';\nimport { ItemSlot, UnitReference } from '../proto/common.js';\nimport { emptyUnitReference } from '../proto_utils/utils.js';\nimport { Sim } from '../sim.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\n\nexport function makeShow1hWeaponsSelector(parent: HTMLElement, sim: Sim): BooleanPicker<Sim> {\n\treturn new BooleanPicker<Sim>(parent, sim, {\n\t\textraCssClasses: ['show-1h-weapons-selector', 'mb-0'],\n\t\tlabel: '1H',\n\t\tinline: true,\n\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\n\t\tgetValue: (sim: Sim) => sim.getFilters().oneHandedWeapons,\n\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\tconst filters = sim.getFilters();\n\t\t\tfilters.oneHandedWeapons = newValue;\n\t\t\tsim.setFilters(eventID, filters);\n\t\t},\n\t});\n}\n\nexport function makeShow2hWeaponsSelector(parent: HTMLElement, sim: Sim): BooleanPicker<Sim> {\n\treturn new BooleanPicker<Sim>(parent, sim, {\n\t\textraCssClasses: ['show-2h-weapons-selector', 'mb-0'],\n\t\tlabel: '2H',\n\t\tinline: true,\n\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\n\t\tgetValue: (sim: Sim) => sim.getFilters().twoHandedWeapons,\n\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\tconst filters = sim.getFilters();\n\t\t\tfilters.twoHandedWeapons = newValue;\n\t\t\tsim.setFilters(eventID, filters);\n\t\t},\n\t});\n}\n\nexport function makeShowMatchingGemsSelector(parent: HTMLElement, sim: Sim): BooleanPicker<Sim> {\n\treturn new BooleanPicker<Sim>(parent, sim, {\n\t\textraCssClasses: ['show-matching-gems-selector', 'input-inline', 'mb-0'],\n\t\tlabel: 'Match Socket',\n\t\tinline: true,\n\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\n\t\tgetValue: (sim: Sim) => sim.getFilters().matchingGemsOnly,\n\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\tconst filters = sim.getFilters();\n\t\t\tfilters.matchingGemsOnly = newValue;\n\t\t\tsim.setFilters(eventID, filters);\n\t\t},\n\t});\n}\n\nexport function makeShowEPValuesSelector(parent: HTMLElement, sim: Sim): BooleanPicker<Sim> {\n\treturn new BooleanPicker<Sim>(parent, sim, {\n\t\textraCssClasses: ['show-ep-values-selector', 'input-inline', 'mb-0'],\n\t\tlabel: 'Show EP',\n\t\tinline: true,\n\t\tchangedEvent: (sim: Sim) => sim.showEPValuesChangeEmitter,\n\t\tgetValue: (sim: Sim) => sim.getShowEPValues(),\n\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\tsim.setShowEPValues(eventID, newValue);\n\t\t},\n\t});\n}\n\nexport function makePhaseSelector(parent: HTMLElement, sim: Sim): EnumPicker<Sim> {\n\treturn new EnumPicker<Sim>(parent, sim, {\n\t\textraCssClasses: ['phase-selector'],\n\t\tvalues: [\n\t\t\t{ name: 'Prepatch', value: 0 },\n\t\t\t{ name: 'Phase 1 (Cataclysm)', value: 1 }\n\t\t],\n\t\tchangedEvent: (sim: Sim) => sim.phaseChangeEmitter,\n\t\tgetValue: (sim: Sim) => sim.getPhase(),\n\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\n\t\t\tsim.setPhase(eventID, newValue);\n\t\t},\n\t});\n}\n\nexport const ReactionTime = {\n\ttype: 'number' as const,\n\tlabel: 'Reaction Time',\n\tlabelTooltip: 'Reaction time of the player, in milliseconds. Used with certain APL values (such as \\'Aura Is Active With Reaction Time\\').',\n\tchangedEvent: (player: Player<any>) => player.miscOptionsChangeEmitter,\n\tgetValue: (player: Player<any>) => player.getReactionTime(),\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tplayer.setReactionTime(eventID, newValue);\n\t},\n};\n\nexport const ChannelClipDelay = {\n\ttype: 'number' as const,\n\tlabel: 'Channel Clip Delay',\n\tlabelTooltip: 'Clip delay following channeled spells, in milliseconds. This delay occurs following any full or partial channel ending after the GCD becomes available, due to the player not being able to queue the next spell.',\n\tchangedEvent: (player: Player<any>) => player.miscOptionsChangeEmitter,\n\tgetValue: (player: Player<any>) => player.getChannelClipDelay(),\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tplayer.setChannelClipDelay(eventID, newValue);\n\t},\n};\n\nexport const DarkIntentUptime = {\n\ttype: 'number' as const,\n\tlabel: 'Dark Intent Uptime',\n\tlabelTooltip: '% uptime on Dark Intent on the player (Only the stacking damage component)',\n\tchangedEvent: (player: Player<any>) => TypedEvent.onAny([player.buffsChangeEmitter, player.miscOptionsChangeEmitter]),\n\tgetValue: (player: Player<any>) => player.getDarkIntentUptime(),\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tplayer.setDarkIntentUptime(eventID, newValue);\n\t},\n\tshowWhen: (player: Player<any>) => {\n\t\treturn player.getBuffs().darkIntent\n\t},\n}\n\nexport const InFrontOfTarget = {\n\ttype: 'boolean' as const,\n\tlabel: 'In Front of Target',\n\tlabelTooltip: 'Stand in front of the target, causing Blocks and Parries to be included in the attack table.',\n\tchangedEvent: (player: Player<any>) => player.inFrontOfTargetChangeEmitter,\n\tgetValue: (player: Player<any>) => player.getInFrontOfTarget(),\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: boolean) => {\n\t\tplayer.setInFrontOfTarget(eventID, newValue);\n\t},\n};\n\nexport const DistanceFromTarget = {\n\ttype: 'number' as const,\n\tlabel: 'Distance From Target',\n\tlabelTooltip: 'Distance from targets, in yards. Used to calculate travel time for certain spells.',\n\tchangedEvent: (player: Player<any>) => player.distanceFromTargetChangeEmitter,\n\tgetValue: (player: Player<any>) => player.getDistanceFromTarget(),\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tplayer.setDistanceFromTarget(eventID, newValue);\n\t},\n};\n\nexport const TankAssignment = {\n\ttype: 'enum' as const,\n\textraCssClasses: [\n\t\t'tank-selector',\n\t\t'threat-metrics',\n\t\t'within-raid-sim-hide',\n\t],\n\tlabel: 'Tank Assignment',\n\tlabelTooltip: 'Determines which mobs will be tanked. Most mobs default to targeting the Main Tank, but in preset multi-target encounters this is not always true.',\n\tvalues: [\n\t\t{ name: 'None', value: -1 },\n\t\t{ name: 'Main Tank', value: 0 },\n\t\t{ name: 'Tank 2', value: 1 },\n\t\t{ name: 'Tank 3', value: 2 },\n\t\t{ name: 'Tank 4', value: 3 },\n\t],\n\tchangedEvent: (player: Player<any>) => player.getRaid()!.tanksChangeEmitter,\n\tgetValue: (player: Player<any>) => (player.getRaid()?.getTanks() || []).findIndex(tank => UnitReference.equals(tank, player.makeUnitReference())),\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tconst newTanks = [];\n\t\tif (newValue != -1) {\n\t\t\tfor (let i = 0; i < newValue; i++) {\n\t\t\t\tnewTanks.push(emptyUnitReference());\n\t\t\t}\n\t\t\tnewTanks.push(player.makeUnitReference());\n\t\t}\n\t\tplayer.getRaid()!.setTanks(eventID, newTanks);\n\t},\n};\n\nexport const IncomingHps = {\n\ttype: 'number' as const,\n\tlabel: 'Incoming HPS',\n\tlabelTooltip: `\n\t\t<p>Average amount of healing received per second. Used for calculating chance of death.</p>\n\t\t<p>If set to 0, defaults to 17.5% of the primary target's base DPS.</p>\n\t`,\n\tchangedEvent: (player: Player<any>) => player.getRaid()!.changeEmitter,\n\tgetValue: (player: Player<any>) => player.getHealingModel().hps,\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tconst healingModel = player.getHealingModel();\n\t\thealingModel.hps = newValue;\n\t\tplayer.setHealingModel(eventID, healingModel);\n\t},\n\tenableWhen: (player: Player<any>) => (player.getRaid()?.getTanks() || []).find(tank => UnitReference.equals(tank, player.makeUnitReference())) != null,\n};\n\nexport const HealingCadence = {\n\ttype: 'number' as const,\n\tfloat: true,\n\tlabel: 'Healing Cadence',\n\tlabelTooltip: `\n\t\t<p>How often the incoming heal 'ticks', in seconds. Generally, longer durations favor Effective Hit Points (EHP) for minimizing Chance of Death, while shorter durations favor avoidance.</p>\n\t\t<p>Example: if Incoming HPS is set to 1000 and this is set to 1s, then every 1s a heal will be received for 1000. If this is instead set to 2s, then every 2s a heal will be recieved for 2000.</p>\n\t\t<p>If set to 0, defaults to 1.5 times the primary target's base swing timer, and half that for dual wielding targets.</p>\n\t`,\n\tchangedEvent: (player: Player<any>) => player.getRaid()!.changeEmitter,\n\tgetValue: (player: Player<any>) => player.getHealingModel().cadenceSeconds,\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tconst healingModel = player.getHealingModel();\n\t\thealingModel.cadenceSeconds = newValue;\n\t\tplayer.setHealingModel(eventID, healingModel);\n\t},\n\tenableWhen: (player: Player<any>) => (player.getRaid()?.getTanks() || []).find(tank => UnitReference.equals(tank, player.makeUnitReference())) != null,\n};\n\nexport const HealingCadenceVariation = {\n\ttype: 'number' as const,\n\tfloat: true,\n\tlabel: 'Cadence +/-',\n\tlabelTooltip: `\n\t\t<p>Magnitude of random variation in healing intervals, in seconds.</p>\n\t\t<p>Example: if Healing Cadence is set to 1s with 0.5s variation, then the interval between successive heals will vary uniformly between 0.5 and 1.5s. If the variation is instead set to 2s, then 50% of healing intervals will fall between 0s and 1s, and the other 50% will fall between 1s and 3s.</p>\n\t\t<p>The amount of healing per 'tick' is automatically scaled up or down based on the randomized time since the last tick, so as to keep HPS constant.</p>\n\t`,\n\tchangedEvent: (player: Player<any>) => player.getRaid()!.changeEmitter,\n\tgetValue: (player: Player<any>) => player.getHealingModel().cadenceVariation,\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tconst healingModel = player.getHealingModel();\n\t\thealingModel.cadenceVariation = newValue;\n\t\tplayer.setHealingModel(eventID, healingModel);\n\t},\n\tenableWhen: (player: Player<any>) => (player.getRaid()?.getTanks() || []).find(tank => UnitReference.equals(tank, player.makeUnitReference())) != null,\n};\n\nexport const BurstWindow = {\n\ttype: 'number' as const,\n\tfloat: false,\n\tlabel: 'TMI Burst Window',\n\tlabelTooltip: `\n\t\t<p>Size in whole seconds of the burst window for calculating TMI. It is important to use a consistent setting when comparing this metric.</p>\n\t\t<p>Default is 6 seconds. If set to 0, TMI calculations are disabled.</p>\n\t`,\n\tchangedEvent: (player: Player<any>) => player.getRaid()!.changeEmitter,\n\tgetValue: (player: Player<any>) => player.getHealingModel().burstWindow,\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tconst healingModel = player.getHealingModel();\n\t\thealingModel.burstWindow = newValue;\n\t\tplayer.setHealingModel(eventID, healingModel);\n\t},\n\tenableWhen: (player: Player<any>) => (player.getRaid()?.getTanks() || []).find(tank => UnitReference.equals(tank, player.makeUnitReference())) != null,\n};\n\nexport const HpPercentForDefensives = {\n\ttype: 'number' as const,\n\tfloat: true,\n\tlabel: 'HP % for Defensive CDs',\n\tlabelTooltip: `\n\t\t<p>% of Maximum Health, below which defensive cooldowns are allowed to be used.</p>\n\t\t<p>If set to 0, this restriction is disabled.</p>\n\t`,\n\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\n\tgetValue: (player: Player<any>) => player.getSimpleCooldowns().hpPercentForDefensives * 100,\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tconst cooldowns = player.getSimpleCooldowns();\n\t\tcooldowns.hpPercentForDefensives = newValue / 100;\n\t\tplayer.setSimpleCooldowns(eventID, cooldowns);\n\t},\n};\n\nexport const InspirationUptime = {\n\ttype: 'number' as const,\n\tfloat: true,\n\tlabel: 'Inspiration % Uptime',\n\tlabelTooltip: `\n\t\t<p>% average of Encounter Duration, during which you have the Inspiration buff.</p>\n\t\t<p>If set to 0, the buff isn't applied.</p>\n\t`,\n\tchangedEvent: (player: Player<any>) => player.healingModelChangeEmitter,\n\tgetValue: (player: Player<any>) => player.getHealingModel().inspirationUptime * 100,\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\tconst healingModel = player.getHealingModel();\n\t\thealingModel.inspirationUptime = newValue / 100;\n\t\tplayer.setHealingModel(eventID, healingModel);\n\t},\n};\n","import { EventID, TypedEvent } from '../typed_event.js';\nimport { Input, InputConfig } from './input.js';\n\n/**\n * Data for creating a number picker.\n */\nexport interface NumberPickerConfig<ModObject> extends InputConfig<ModObject, number> {\n\tfloat?: boolean;\n\tpositive?: boolean;\n}\n\n// UI element for picking an arbitrary number field.\nexport class NumberPicker<ModObject> extends Input<ModObject, number> {\n\tprivate readonly inputElem: HTMLInputElement;\n\tprivate float: boolean;\n\tprivate positive: boolean;\n\n\tconstructor(parent: HTMLElement | null, modObject: ModObject, config: NumberPickerConfig<ModObject>) {\n\t\tsuper(parent, 'number-picker-root', modObject, config);\n\t\tthis.float = config.float || false;\n\t\tthis.positive = config.positive || false;\n\n\t\tthis.inputElem = document.createElement('input');\n\t\tthis.inputElem.type = 'text';\n\t\tthis.inputElem.classList.add('form-control', 'number-picker-input');\n\n\t\tif (this.positive) {\n\t\t\tthis.inputElem.onchange = e => {\n\t\t\t\tif (this.float) {\n\t\t\t\t\tthis.inputElem.value = Math.abs(parseFloat(this.inputElem.value)).toFixed(2);\n\t\t\t\t} else {\n\t\t\t\t\tthis.inputElem.value = Math.abs(parseInt(this.inputElem.value)).toString();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tthis.rootElem.appendChild(this.inputElem);\n\t\tthis.init();\n\n\t\tthis.inputElem.addEventListener('change', event => {\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t});\n\n\t\tthis.inputElem.addEventListener('input', event => {\n\t\t\tthis.updateSize();\n\t\t});\n\t\tthis.updateSize();\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.inputElem;\n\t}\n\n\tgetInputValue(): number {\n\t\tif (this.float) {\n\t\t\treturn parseFloat(this.inputElem.value || '') || 0;\n\t\t} else {\n\t\t\treturn parseInt(this.inputElem.value || '') || 0;\n\t\t}\n\t}\n\n\tsetInputValue(newValue: number) {\n\t\tif (this.float) this.inputElem.value = newValue.toFixed(2);\n\t\telse this.inputElem.value = String(newValue);\n\t}\n\n\tprivate updateSize() {\n\t\tconst newSize = Math.max(3, this.inputElem.value.length);\n\t\tif (this.inputElem.size != newSize) this.inputElem.size = newSize;\n\t}\n}\n","import { Popover, Tooltip } from 'bootstrap';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { element, fragment, ref } from 'tsx-vanilla';\n\nimport { Player } from '..//player.js';\nimport { Class, PseudoStat, Stat, TristateEffect } from '..//proto/common.js';\nimport { getClassStatName, masterySpellIDs, masterySpellNames, statOrder } from '..//proto_utils/names.js';\nimport { Stats } from '..//proto_utils/stats.js';\nimport { EventID, TypedEvent } from '..//typed_event.js';\nimport * as Mechanics from '../constants/mechanics.js';\nimport { ActionId } from '../proto_utils/action_id';\nimport { Component } from './component.js';\nimport { NumberPicker } from './number_picker';\n\nexport type StatMods = { base?:Stats, gear?:Stats, talents?: Stats, buffs?: Stats, consumes?: Stats, final?: Stats, stats?: Array<Stat> };\nexport type StatWrites = { base:Stats, gear:Stats, talents: Stats, buffs: Stats, consumes: Stats, final: Stats, stats: Array<Stat> };\n\nexport class CharacterStats extends Component {\n\treadonly stats: Array<Stat>;\n\treadonly valueElems: Array<HTMLTableCellElement>;\n\treadonly meleeCritCapValueElem: HTMLTableCellElement | undefined;\n\tmasteryElem: HTMLTableCellElement | undefined;\n\n\tprivate readonly player: Player<any>;\n\tprivate readonly modifyDisplayStats?: (player: Player<any>) => StatMods;\n\tprivate readonly overwriteDisplayStats?: (player: Player<any>) => StatWrites;\n\n\tconstructor(parent: HTMLElement, player: Player<any>, stats: Array<Stat>, modifyDisplayStats?: (player: Player<any>) => StatMods, overwriteDisplayStats?: (player: Player<any>) => StatWrites) {\n\t\tsuper(parent, 'character-stats-root');\n\t\tthis.stats = statOrder.filter(stat => stats.includes(stat));\n\t\tthis.player = player;\n\t\tthis.modifyDisplayStats = modifyDisplayStats;\n\t\tthis.overwriteDisplayStats = overwriteDisplayStats;\n\n\t\tconst label = document.createElement('label');\n\t\tlabel.classList.add('character-stats-label');\n\t\tlabel.textContent = 'Stats';\n\t\tthis.rootElem.appendChild(label);\n\n\t\tconst table = document.createElement('table');\n\t\ttable.classList.add('character-stats-table');\n\t\tthis.rootElem.appendChild(table);\n\n\t\tthis.valueElems = [];\n\t\tthis.stats.forEach(stat => {\n\t\t\tconst statName = getClassStatName(stat, player.getClass());\n\n\t\t\tconst row = (\n\t\t\t\t<tr className=\"character-stats-table-row\">\n\t\t\t\t\t<td className=\"character-stats-table-label\">\n\t\t\t\t\t\t{statName}\n\t\t\t\t\t\t{stat == Stat.StatMastery && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t{masterySpellNames.get(this.player.getSpec())}\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</td>\n\t\t\t\t\t<td className=\"character-stats-table-value\">{this.bonusStatsLink(stat)}</td>\n\t\t\t\t</tr>\n\t\t\t);\n\n\t\t\ttable.appendChild(row);\n\n\t\t\tconst valueElem = row.getElementsByClassName('character-stats-table-value')[0] as HTMLTableCellElement;\n\t\t\tthis.valueElems.push(valueElem);\n\t\t});\n\n\t\tif (this.shouldShowMeleeCritCap(player)) {\n\t\t\tconst row = (\n\t\t\t\t<tr className=\"character-stats-table-row\">\n\t\t\t\t\t<td className=\"character-stats-table-label\">Melee Crit Cap</td>\n\t\t\t\t\t<td className=\"character-stats-table-value\"></td>\n\t\t\t\t</tr>\n\t\t\t);\n\n\t\t\ttable.appendChild(row);\n\t\t\tthis.meleeCritCapValueElem = row.getElementsByClassName('character-stats-table-value')[0] as HTMLTableCellElement;\n\t\t} else {\n\t\t\tthis.meleeCritCapValueElem = undefined;\n\t\t}\n\n\t\tthis.updateStats(player);\n\t\tTypedEvent.onAny([player.currentStatsEmitter, player.sim.changeEmitter, player.talentsChangeEmitter]).on(() => {\n\t\t\tthis.updateStats(player);\n\t\t});\n\t}\n\n\tprivate updateStats(player: Player<any>) {\n\t\tconst playerStats = player.getCurrentStats();\n\n\t\tconst statMods = this.modifyDisplayStats\n\t\t\t? this.modifyDisplayStats(this.player)\n\t\t\t: {\n\t\t\t  };\n\n\t\tconst baseStats = Stats.fromProto(playerStats.baseStats);\n\t\tconst gearStats = Stats.fromProto(playerStats.gearStats);\n\t\tconst talentsStats = Stats.fromProto(playerStats.talentsStats);\n\t\tconst buffsStats = Stats.fromProto(playerStats.buffsStats);\n\t\tconst consumesStats = Stats.fromProto(playerStats.consumesStats);\n\t\tconst debuffStats = this.getDebuffStats();\n\t\tconst bonusStats = player.getBonusStats();\n\n\t\tlet baseDelta = baseStats.add(statMods.base || new Stats());\n\t\tlet gearDelta = gearStats.subtract(baseStats).subtract(bonusStats).add(statMods.gear || new Stats());\n\t\tlet talentsDelta = talentsStats.subtract(gearStats).add(statMods.talents || new Stats());\n\t\tlet buffsDelta = buffsStats.subtract(talentsStats).add(statMods.buffs || new Stats());\n\t\tlet consumesDelta = consumesStats.subtract(buffsStats).add(statMods.consumes || new Stats());\n\n\t\tlet finalStats = Stats.fromProto(playerStats.finalStats)\n\t\t\t.add(statMods.base || new Stats())\n\t\t\t.add(statMods.gear || new Stats())\n\t\t\t.add(statMods.talents || new Stats())\n\t\t\t.add(statMods.buffs || new Stats())\n\t\t\t.add(statMods.consumes || new Stats())\n\t\t\t.add(statMods.final || new Stats())\n\t\t\t.add(debuffStats);\n\n\t\tif (this.overwriteDisplayStats) {\n\t\t\tconst statOverwrites = this.overwriteDisplayStats(this.player);\n\t\t\tif (statOverwrites.stats) {\n\t\t\t\tstatOverwrites.stats.forEach((stat, _) => {\n\t\t\t\t\tbaseDelta = baseDelta.withStat(stat, statOverwrites.base.getStat(stat))\n\t\t\t\t\tgearDelta = gearDelta.withStat(stat, statOverwrites.gear.getStat(stat))\n\t\t\t\t\ttalentsDelta = talentsDelta.withStat(stat, statOverwrites.talents.getStat(stat))\n\t\t\t\t\tbuffsDelta = buffsDelta.withStat(stat, statOverwrites.buffs.getStat(stat))\n\t\t\t\t\tconsumesDelta = consumesDelta.withStat(stat, statOverwrites.consumes.getStat(stat))\n\t\t\t\t\tfinalStats = finalStats.withStat(stat, statOverwrites.final.getStat(stat))\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tconst masteryPoints =\n\t\t\tthis.player.getBaseMastery() + (playerStats.finalStats?.stats[Stat.StatMastery] || 0) / Mechanics.MASTERY_RATING_PER_MASTERY_POINT;\n\n\t\tthis.stats.forEach((stat, idx) => {\n\t\t\tconst bonusStatValue = bonusStats.getStat(stat);\n\t\t\tlet contextualKlass: string;\n\t\t\tif (bonusStatValue == 0) {\n\t\t\t\tcontextualKlass = 'text-white';\n\t\t\t} else if (bonusStatValue > 0) {\n\t\t\t\tcontextualKlass = 'text-success';\n\t\t\t} else {\n\t\t\t\tcontextualKlass = 'text-danger';\n\t\t\t}\n\n\t\t\tconst statLinkElemRef = ref<HTMLAnchorElement>();\n\n\t\t\tconst valueElem = (\n\t\t\t\t<div className=\"stat-value-link-container\">\n\t\t\t\t\t<a href=\"javascript:void(0)\" className={`stat-value-link ${contextualKlass}`} attributes={{ role: 'button' }} ref={statLinkElemRef}>\n\t\t\t\t\t\t{`${this.statDisplayString(finalStats, finalStats, stat, true)} `}\n\t\t\t\t\t</a>\n\t\t\t\t\t{stat == Stat.StatMastery && (\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref={ActionId.makeSpellUrl(masterySpellIDs.get(this.player.getSpec()) || 0)}\n\t\t\t\t\t\t\tclassName={`stat-value-link-mastery ${contextualKlass}`}\n\t\t\t\t\t\t\tattributes={{ role: 'button' }}>\n\t\t\t\t\t\t\t{`${(masteryPoints * this.player.getMasteryPerPointModifier()).toFixed(2)}%`}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t);\n\n\t\t\tconst statLinkElem = statLinkElemRef.value!;\n\n\t\t\tthis.valueElems[idx].querySelector('.stat-value-link-container')?.remove();\n\t\t\tthis.valueElems[idx].prepend(valueElem);\n\n\t\t\tconst tooltipContent = (\n\t\t\t\t<div>\n\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Base:</span>\n\t\t\t\t\t\t<span>{this.statDisplayString(baseStats, baseDelta, stat, true)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Gear:</span>\n\t\t\t\t\t\t<span>{this.statDisplayString(gearStats, gearDelta, stat)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Talents:</span>\n\t\t\t\t\t\t<span>{this.statDisplayString(talentsStats, talentsDelta, stat)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Buffs:</span>\n\t\t\t\t\t\t<span>{this.statDisplayString(buffsStats, buffsDelta, stat)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Consumes:</span>\n\t\t\t\t\t\t<span>{this.statDisplayString(consumesStats, consumesDelta, stat)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t{debuffStats.getStat(stat) != 0 && (\n\t\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t\t<span>Debuffs:</span>\n\t\t\t\t\t\t\t<span>{this.statDisplayString(debuffStats, debuffStats, stat)}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t{bonusStatValue != 0 && (\n\t\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t\t<span>Bonus:</span>\n\t\t\t\t\t\t\t<span>{this.statDisplayString(bonusStats, bonusStats, stat)}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Total:</span>\n\t\t\t\t\t\t<span>{this.statDisplayString(finalStats, finalStats, stat, true)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\t\t\tTooltip.getOrCreateInstance(statLinkElem, {\n\t\t\t\ttitle: tooltipContent,\n\t\t\t\thtml: true,\n\t\t\t});\n\t\t});\n\n\t\tif (this.meleeCritCapValueElem) {\n\t\t\tconst meleeCritCapInfo = player.getMeleeCritCapInfo();\n\n\t\t\tconst valueElem = (\n\t\t\t\t<a href=\"javascript:void(0)\" className=\"stat-value-link\" attributes={{ role: 'button' }}>\n\t\t\t\t\t{`${this.meleeCritCapDisplayString(player, finalStats)} `}\n\t\t\t\t</a>\n\t\t\t);\n\n\t\t\tconst capDelta = meleeCritCapInfo.playerCritCapDelta;\n\t\t\tif (capDelta == 0) {\n\t\t\t\tvalueElem.classList.add('text-white');\n\t\t\t} else if (capDelta > 0) {\n\t\t\t\tvalueElem.classList.add('text-danger');\n\t\t\t} else if (capDelta < 0) {\n\t\t\t\tvalueElem.classList.add('text-success');\n\t\t\t}\n\n\t\t\tthis.meleeCritCapValueElem.querySelector('.stat-value-link')?.remove();\n\t\t\tthis.meleeCritCapValueElem.prepend(valueElem);\n\n\t\t\tconst tooltipContent = (\n\t\t\t\t<div>\n\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Glancing:</span>\n\t\t\t\t\t\t<span>{`${meleeCritCapInfo.glancing.toFixed(2)}%`}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Suppression:</span>\n\t\t\t\t\t\t<span>{`${meleeCritCapInfo.suppression.toFixed(2)}%`}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>To Hit Cap:</span>\n\t\t\t\t\t\t<span>{`${meleeCritCapInfo.remainingMeleeHitCap.toFixed(2)}%`}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>To Exp Cap:</span>\n\t\t\t\t\t\t<span>{`${meleeCritCapInfo.remainingExpertiseCap.toFixed(2)}%`}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t{meleeCritCapInfo.specSpecificOffset != 0 && (\n\t\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t\t<span>Spec Offsets:</span>\n\t\t\t\t\t\t\t<span>{`${meleeCritCapInfo.specSpecificOffset.toFixed(2)}%`}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Final Crit Cap:</span>\n\t\t\t\t\t\t<span>{`${meleeCritCapInfo.baseCritCap.toFixed(2)}%`}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<hr />\n\t\t\t\t\t<div className=\"character-stats-tooltip-row\">\n\t\t\t\t\t\t<span>Can Raise By:</span>\n\t\t\t\t\t\t<span>{`${(meleeCritCapInfo.remainingExpertiseCap + meleeCritCapInfo.remainingMeleeHitCap).toFixed(2)}%`}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t);\n\n\t\t\tTooltip.getOrCreateInstance(valueElem, {\n\t\t\t\ttitle: tooltipContent,\n\t\t\t\thtml: true,\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate statDisplayString(stats: Stats, deltaStats: Stats, stat: Stat, includeBase?: boolean): string {\n\t\tlet rawValue = deltaStats.getStat(stat);\n\n\t\tif (stat == Stat.StatBlockValue) {\n\t\t\trawValue *= stats.getPseudoStat(PseudoStat.PseudoStatBlockValueMultiplier) || 1;\n\t\t}\n\n\t\tlet displayStr = String(Math.round(rawValue));\n\n\t\tif (stat == Stat.StatMeleeHit) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.MELEE_HIT_RATING_PER_HIT_CHANCE).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatSpellHit) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.SPELL_HIT_RATING_PER_HIT_CHANCE).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatMeleeCrit || stat == Stat.StatSpellCrit) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.SPELL_CRIT_RATING_PER_CRIT_CHANCE).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatMeleeHaste) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.HASTE_RATING_PER_HASTE_PERCENT).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatSpellHaste) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.HASTE_RATING_PER_HASTE_PERCENT).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatArmorPenetration) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.ARMOR_PEN_PER_PERCENT_ARMOR).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatExpertise) {\n\t\t\t// As of 06/20, Blizzard has changed Expertise to no longer truncate at quarter percent intervals. Note that\n\t\t\t// in-game character sheet tooltips will still display the truncated values, but it has been tested to behave\n\t\t\t// continuously in reality since the patch.\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.EXPERTISE_PER_QUARTER_PERCENT_REDUCTION / 4).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatDefense) {\n\t\t\tdisplayStr += ` (${(Mechanics.CHARACTER_LEVEL * 5 + Math.floor(rawValue / Mechanics.DEFENSE_RATING_PER_DEFENSE)).toFixed(0)})`;\n\t\t} else if (stat == Stat.StatBlock) {\n\t\t\t// TODO: Figure out how to display these differently for the components than the final value\n\t\t\t//displayStr += ` (${(rawValue / Mechanics.BLOCK_RATING_PER_BLOCK_CHANCE).toFixed(2)}%)`;\n\t\t\tdisplayStr += ` (${(\n\t\t\t\trawValue / Mechanics.BLOCK_RATING_PER_BLOCK_CHANCE +\n\t\t\t\tMechanics.MISS_DODGE_PARRY_BLOCK_CRIT_CHANCE_PER_DEFENSE * Math.floor(stats.getStat(Stat.StatDefense) / Mechanics.DEFENSE_RATING_PER_DEFENSE) +\n\t\t\t\t5.0\n\t\t\t).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatDodge) {\n\t\t\t//displayStr += ` (${(rawValue / Mechanics.DODGE_RATING_PER_DODGE_CHANCE).toFixed(2)}%)`;\n\t\t\tdisplayStr += ` (${(stats.getPseudoStat(PseudoStat.PseudoStatDodge) * 100).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatParry) {\n\t\t\t//displayStr += ` (${(rawValue / Mechanics.PARRY_RATING_PER_PARRY_CHANCE).toFixed(2)}%)`;\n\t\t\tdisplayStr += ` (${(stats.getPseudoStat(PseudoStat.PseudoStatParry) * 100).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatResilience) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.RESILIENCE_RATING_PER_CRIT_REDUCTION_CHANCE).toFixed(2)}%)`;\n\t\t} else if (stat == Stat.StatMastery) {\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.MASTERY_RATING_PER_MASTERY_POINT + (includeBase ? this.player.getBaseMastery() : 0)).toFixed(2)} Points)`;\n\t\t}\n\n\t\treturn displayStr;\n\t}\n\n\tprivate getDebuffStats(): Stats {\n\t\tlet debuffStats = new Stats();\n\n\t\tconst debuffs = this.player.sim.raid.getDebuffs();\n\t\tif (debuffs.criticalMass || debuffs.shadowAndFlame) {\n\t\t\tdebuffStats = debuffStats.addStat(Stat.StatSpellCrit, 5 * Mechanics.SPELL_CRIT_RATING_PER_CRIT_CHANCE);\n\t\t}\n\n\t\treturn debuffStats;\n\t}\n\n\tprivate bonusStatsLink(stat: Stat): HTMLElement {\n\t\tconst statName = getClassStatName(stat, this.player.getClass());\n\n\t\tconst link = (\n\t\t\t<a href=\"javascript:void(0)\" className=\"add-bonus-stats text-white ms-2\" dataset={{ bsToggle: 'popover' }} attributes={{ role: 'button' }}>\n\t\t\t\t<i className=\"fas fa-plus-minus\"></i>\n\t\t\t</a>\n\t\t);\n\n\t\tTooltip.getOrCreateInstance(link.children[0], { title: `Bonus ${statName}` });\n\n\t\tlet popover: Popover | null = null;\n\n\t\tconst picker = new NumberPicker(null, this.player, {\n\t\t\tlabel: `Bonus ${statName}`,\n\t\t\textraCssClasses: ['mb-0'],\n\t\t\tchangedEvent: (player: Player<any>) => player.bonusStatsChangeEmitter,\n\t\t\tgetValue: (player: Player<any>) => player.getBonusStats().getStat(stat),\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\t\t\tconst bonusStats = player.getBonusStats().withStat(stat, newValue);\n\t\t\t\tplayer.setBonusStats(eventID, bonusStats);\n\t\t\t\tpopover?.hide();\n\t\t\t},\n\t\t});\n\n\t\tpopover = Popover.getOrCreateInstance(link, {\n\t\t\tcustomClass: 'bonus-stats-popover',\n\t\t\tplacement: 'right',\n\t\t\tfallbackPlacements: ['left'],\n\t\t\tsanitize: false,\n\t\t\thtml: true,\n\t\t\tcontent: picker.rootElem,\n\t\t});\n\n\t\treturn link as HTMLElement;\n\t}\n\n\tprivate shouldShowMeleeCritCap(player: Player<any>): boolean {\n\t\treturn player.getPlayerSpec().isMeleeDpsSpec;\n\t}\n\n\tprivate meleeCritCapDisplayString(player: Player<any>, finalStats: Stats): string {\n\t\tconst playerCritCapDelta = player.getMeleeCritCap();\n\n\t\tif (playerCritCapDelta === 0.0) {\n\t\t\treturn 'Exact';\n\t\t}\n\n\t\tconst prefix = playerCritCapDelta > 0 ? 'Over by ' : 'Under by ';\n\t\treturn `${prefix} ${Math.abs(playerCritCapDelta).toFixed(2)}%`;\n\t}\n}\n","import { JsonObject } from '@protobuf-ts/runtime';\n\nimport { IndividualSimUI } from '../individual_sim_ui';\nimport { Class, EquipmentSpec, Glyphs, ItemSlot, ItemSpec, Profession, Race, Spec } from '../proto/common';\nimport { IndividualSimSettings } from '../proto/ui';\nimport { Database } from '../proto_utils/database';\nimport { classNames, nameToClass, nameToProfession, nameToRace } from '../proto_utils/names';\nimport { SimSettingCategories } from '../sim';\nimport { SimUI } from '../sim_ui';\nimport { classGlyphsConfig, talentSpellIdsToTalentString } from '../talents/factory';\nimport { GlyphConfig } from '../talents/glyphs_picker';\nimport { TypedEvent } from '../typed_event';\nimport { buf2hex, getEnumValues } from '../utils';\nimport { BaseModal } from './base_modal';\n\ndeclare let pako: any;\n\nexport abstract class Importer extends BaseModal {\n\tprotected readonly textElem: HTMLTextAreaElement;\n\tprotected readonly descriptionElem: HTMLElement;\n\tprotected readonly importButton: HTMLButtonElement;\n\tprivate readonly includeFile: boolean;\n\n\tconstructor(parent: HTMLElement, simUI: SimUI, title: string, includeFile: boolean) {\n\t\tsuper(parent, 'importer', { title: title, footer: true });\n\t\tthis.includeFile = includeFile;\n\t\tconst uploadInputId = 'upload-input-' + title.toLowerCase().replaceAll(' ', '-');\n\n\t\tthis.body.innerHTML = `\n\t\t\t<div class=\"import-description\"></div>\n\t\t\t<textarea spellCheck=\"false\" class=\"importer-textarea form-control\"></textarea>\n\t\t`;\n\t\tthis.footer!.innerHTML = `\n\t\t\t${\n\t\t\t\tthis.includeFile\n\t\t\t\t\t? `\n\t\t\t\t<label for=\"${uploadInputId}\" class=\"importer-button btn btn-primary upload-button me-2\">\n\t\t\t\t\t<i class=\"fas fa-file-arrow-up\"></i>\n\t\t\t\t\tUpload File\n\t\t\t\t</label>\n\t\t\t\t<input type=\"file\" id=\"${uploadInputId}\" class=\"importer-upload-input d-none\" hidden>\n\t\t\t`\n\t\t\t\t\t: ''\n\t\t\t}\n\t\t\t<button class=\"importer-button btn btn-primary import-button\">\n\t\t\t\t<i class=\"fa fa-download\"></i>\n\t\t\t\tImport\n\t\t\t</button>\n\t\t`;\n\n\t\tthis.textElem = this.rootElem.getElementsByClassName('importer-textarea')[0] as HTMLTextAreaElement;\n\t\tthis.descriptionElem = this.rootElem.getElementsByClassName('import-description')[0] as HTMLElement;\n\n\t\tif (this.includeFile) {\n\t\t\tconst uploadInput = this.rootElem.getElementsByClassName('importer-upload-input')[0] as HTMLButtonElement;\n\t\t\tuploadInput.addEventListener('change', async event => {\n\t\t\t\tconst data: string = await (event as any).target.files[0].text();\n\t\t\t\tthis.textElem.textContent = data;\n\t\t\t});\n\t\t}\n\n\t\tthis.importButton = this.rootElem.getElementsByClassName('import-button')[0] as HTMLButtonElement;\n\t\tthis.importButton.addEventListener('click', _event => {\n\t\t\ttry {\n\t\t\t\tthis.onImport(this.textElem.value || '');\n\t\t\t} catch (error) {\n\t\t\t\talert('Import error: ' + error);\n\t\t\t}\n\t\t});\n\t}\n\n\tabstract onImport(data: string): void;\n\n\tprotected async finishIndividualImport<SpecType extends Spec>(\n\t\tsimUI: IndividualSimUI<SpecType>,\n\t\tcharClass: Class,\n\t\trace: Race,\n\t\tequipmentSpec: EquipmentSpec,\n\t\ttalentsStr: string,\n\t\tglyphs: Glyphs | null,\n\t\tprofessions: Array<Profession>,\n\t): Promise<void> {\n\t\tif (charClass != simUI.player.getClass()) {\n\t\t\tthrow new Error(`Wrong Class! Expected ${simUI.player.getPlayerClass().friendlyName} but found ${classNames.get(charClass)}!`);\n\t\t}\n\n\t\tawait Database.loadLeftoversIfNecessary(equipmentSpec);\n\n\t\tconst gear = simUI.sim.db.lookupEquipmentSpec(equipmentSpec);\n\n\t\tconst expectedEnchantIds = equipmentSpec.items.map(item => item.enchant);\n\t\tconst foundEnchantIds = gear.asSpec().items.map(item => item.enchant);\n\t\tconst missingEnchants = expectedEnchantIds.filter(expectedId => expectedId != 0 && !foundEnchantIds.includes(expectedId));\n\n\t\tconst expectedItemIds = equipmentSpec.items.map(item => item.id);\n\t\tconst foundItemIds = gear.asSpec().items.map(item => item.id);\n\t\tconst missingItems = expectedItemIds.filter(expectedId => !foundItemIds.includes(expectedId));\n\n\t\t// Now update settings using the parsed values.\n\t\tconst eventID = TypedEvent.nextEventID();\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tsimUI.player.setRace(eventID, race);\n\t\t\tsimUI.player.setGear(eventID, gear);\n\t\t\tif (talentsStr && talentsStr != '--') {\n\t\t\t\tsimUI.player.setTalentsString(eventID, talentsStr);\n\t\t\t}\n\t\t\tif (glyphs) {\n\t\t\t\tsimUI.player.setGlyphs(eventID, glyphs);\n\t\t\t}\n\t\t\tif (professions.length > 0) {\n\t\t\t\tsimUI.player.setProfessions(eventID, professions);\n\t\t\t}\n\t\t});\n\n\t\tthis.close();\n\n\t\tif (missingItems.length == 0 && missingEnchants.length == 0) {\n\t\t\talert('Import successful!');\n\t\t} else {\n\t\t\talert(\n\t\t\t\t'Import successful, but the following IDs were not found in the sim database:' +\n\t\t\t\t\t(missingItems.length == 0 ? '' : '\\n\\nItems: ' + missingItems.join(', ')) +\n\t\t\t\t\t(missingEnchants.length == 0 ? '' : '\\n\\nEnchants: ' + missingEnchants.join(', ')),\n\t\t\t);\n\t\t}\n\t}\n}\n\ninterface UrlParseData {\n\tsettings: IndividualSimSettings;\n\tcategories: Array<SimSettingCategories>;\n}\n\n// For now this just holds static helpers to match the exporter, so it doesn't extend Importer.\nexport class IndividualLinkImporter {\n\t// Exclude UISettings by default, since most users don't intend to export those.\n\tstatic readonly DEFAULT_CATEGORIES = getEnumValues(SimSettingCategories).filter(c => c != SimSettingCategories.UISettings) as Array<SimSettingCategories>;\n\n\tstatic readonly CATEGORY_PARAM = 'i';\n\tstatic readonly CATEGORY_KEYS: Map<SimSettingCategories, string> = (() => {\n\t\tconst map = new Map();\n\t\t// Use single-letter abbreviations since these will be included in sim links.\n\t\tmap.set(SimSettingCategories.Gear, 'g');\n\t\tmap.set(SimSettingCategories.Talents, 't');\n\t\tmap.set(SimSettingCategories.Rotation, 'r');\n\t\tmap.set(SimSettingCategories.Consumes, 'c');\n\t\tmap.set(SimSettingCategories.Miscellaneous, 'm');\n\t\tmap.set(SimSettingCategories.External, 'x');\n\t\tmap.set(SimSettingCategories.Encounter, 'e');\n\t\tmap.set(SimSettingCategories.UISettings, 'u');\n\t\treturn map;\n\t})();\n\n\tstatic tryParseUrlLocation(location: Location): UrlParseData | null {\n\t\tlet hash = location.hash;\n\t\tif (hash.length <= 1) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Remove leading '#'\n\t\thash = hash.substring(1);\n\t\tconst binary = atob(hash);\n\t\tconst bytes = new Uint8Array(binary.length);\n\t\tfor (let i = 0; i < bytes.length; i++) {\n\t\t\tbytes[i] = binary.charCodeAt(i);\n\t\t}\n\n\t\tconst settingsBytes = pako.inflate(bytes);\n\t\tconst settings = IndividualSimSettings.fromBinary(settingsBytes);\n\n\t\tlet exportCategories = IndividualLinkImporter.DEFAULT_CATEGORIES;\n\t\tconst urlParams = new URLSearchParams(window.location.search);\n\t\tif (urlParams.has(IndividualLinkImporter.CATEGORY_PARAM)) {\n\t\t\tconst categoryChars = urlParams.get(IndividualLinkImporter.CATEGORY_PARAM)!.split('');\n\t\t\texportCategories = categoryChars\n\t\t\t\t.map(char => [...IndividualLinkImporter.CATEGORY_KEYS.entries()].find(e => e[1] == char))\n\t\t\t\t.filter(e => e)\n\t\t\t\t.map(e => e![0]);\n\t\t}\n\n\t\treturn {\n\t\t\tsettings: settings,\n\t\t\tcategories: exportCategories,\n\t\t};\n\t}\n}\n\nexport class IndividualJsonImporter<SpecType extends Spec> extends Importer {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, simUI, 'JSON Import', true);\n\t\tthis.simUI = simUI;\n\n\t\tthis.descriptionElem.innerHTML = `\n\t\t\t<p>Import settings from a JSON file, which can be created using the JSON Export feature.</p>\n\t\t\t<p>To import, upload the file or paste the text below, then click, 'Import'.</p>\n\t\t`;\n\t}\n\n\tasync onImport(data: string) {\n\t\tconst proto = IndividualSimSettings.fromJsonString(data, { ignoreUnknownFields: true });\n\t\tif (proto.player?.equipment) {\n\t\t\tawait Database.loadLeftoversIfNecessary(proto.player.equipment);\n\t\t}\n\t\tif (this.simUI.isWithinRaidSim) {\n\t\t\tif (proto.player) {\n\t\t\t\tthis.simUI.player.fromProto(TypedEvent.nextEventID(), proto.player);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.simUI.fromProto(TypedEvent.nextEventID(), proto);\n\t\t}\n\t\tthis.close();\n\t}\n}\n\nexport class Individual80UImporter<SpecType extends Spec> extends Importer {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, simUI, '80 Upgrades Import', true);\n\t\tthis.simUI = simUI;\n\n\t\tthis.descriptionElem.innerHTML = `\n\t\t\t<p>\n\t\t\t\tImport settings from <a href=\"https://eightyupgrades.com\" target=\"_blank\">Eighty Upgrades</a>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThis feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the output from the site's export option below and click, 'Import'.\n\t\t\t</p>\n\t\t`;\n\t}\n\n\tonImport(data: string) {\n\t\tconst importJson = JSON.parse(data);\n\n\t\t// Parse all the settings.\n\t\tconst charClass = nameToClass((importJson?.character?.gameClass as string) || '');\n\t\tif (charClass == Class.ClassUnknown) {\n\t\t\tthrow new Error('Could not parse Class!');\n\t\t}\n\n\t\tconst race = nameToRace((importJson?.character?.race as string) || '');\n\t\tif (race == Race.RaceUnknown) {\n\t\t\tthrow new Error('Could not parse Race!');\n\t\t}\n\n\t\tlet talentsStr = '';\n\t\tif (importJson?.talents?.length > 0) {\n\t\t\tconst talentIds = (importJson.talents as Array<any>).map(talentJson => talentJson.spellId);\n\t\t\ttalentsStr = talentSpellIdsToTalentString(charClass, talentIds);\n\t\t}\n\n\t\tconst equipmentSpec = EquipmentSpec.create();\n\t\t(importJson.items as Array<any>).forEach(itemJson => {\n\t\t\tconst itemSpec = ItemSpec.create();\n\t\t\titemSpec.id = itemJson.id;\n\t\t\tif (itemJson.enchant?.id) {\n\t\t\t\titemSpec.enchant = itemJson.enchant.id;\n\t\t\t}\n\t\t\tif (itemJson.gems) {\n\t\t\t\titemSpec.gems = (itemJson.gems as Array<any>).filter(gemJson => gemJson?.id).map(gemJson => gemJson.id);\n\t\t\t}\n\t\t\tequipmentSpec.items.push(itemSpec);\n\t\t});\n\n\t\tconst gear = this.simUI.sim.db.lookupEquipmentSpec(equipmentSpec);\n\n\t\tthis.finishIndividualImport(this.simUI, charClass, race, equipmentSpec, talentsStr, null, []);\n\t}\n}\n\nexport class IndividualWowheadGearPlannerImporter<SpecType extends Spec> extends Importer {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, simUI, 'Wowhead Import', true);\n\t\tthis.simUI = simUI;\n\n\t\tthis.descriptionElem.innerHTML = `\n\t\t\t<p>\n\t\t\t\tImport settings from <a href=\"https://www.wowhead.com/cata/gear-planner\" target=\"_blank\">Wowhead Gear Planner</a>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThis feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the gear planner link below and click, 'Import'.\n\t\t\t</p>\n\t\t`;\n\t}\n\n\tonImport(url: string) {\n\t\tconst match = url.match(/www\\.wowhead\\.com\\/cata\\/gear-planner\\/([a-z\\-]+)\\/([a-z\\-]+)\\/([a-zA-Z0-9_\\-]+)/);\n\t\tif (!match) {\n\t\t\tthrow new Error(`Invalid WCL URL ${url}, must look like \"https://www.wowhead.com/cata/gear-planner/CLASS/RACE/XXXX\"`);\n\t\t}\n\n\t\t// Parse all the settings.\n\t\tconst charClass = nameToClass(match[1].replaceAll('-', ''));\n\t\tif (charClass == Class.ClassUnknown) {\n\t\t\tthrow new Error('Could not parse Class: ' + match[1]);\n\t\t}\n\n\t\tconst race = nameToRace(match[2].replaceAll('-', ''));\n\t\tif (race == Race.RaceUnknown) {\n\t\t\tthrow new Error('Could not parse Race: ' + match[2]);\n\t\t}\n\n\t\tconst base64Data = match[3].replaceAll('_', '/').replaceAll('-', '+');\n\t\t//console.log('Base64: ' + base64Data);\n\t\tconst data = Uint8Array.from(atob(base64Data), c => c.charCodeAt(0));\n\t\t//console.log('Hex: ' + buf2hex(data));\n\n\t\t// Binary schema\n\t\t// Byte 00: ??\n\t\t// Byte 01: ?? Seems related to aesthetics (e.g. body type)\n\t\t// Byte 02: 8-bit Player Level\n\t\t// Byte 03: 8-bit length of talents bytes\n\t\t// Next N Bytes: Talents in hex string format\n\n\t\t// Talent hex string looks like '230005232100330150323102505321f03f023203001f'\n\t\t// Just like regular wowhead talents string except 'f' instead of '-'.\n\t\tconst numTalentBytes = data[3];\n\t\tconst talentBytes = data.subarray(4, 4 + numTalentBytes);\n\t\tconst talentsHexStr = buf2hex(talentBytes);\n\t\t//console.log('Talents hex: ' + talentsHexStr);\n\t\tconst talentsStr = talentsHexStr.split('f').slice(0, 3).join('-');\n\t\t//console.log('Talents: ' + talentsStr);\n\n\t\tlet cur = 4 + numTalentBytes;\n\t\tconst numGlyphBytes = data[cur];\n\t\tcur++;\n\t\tconst glyphBytes = data.subarray(cur, cur + numGlyphBytes);\n\t\tconst gearBytes = data.subarray(cur + numGlyphBytes);\n\t\t//console.log(`Glyphs have ${numGlyphBytes} bytes: ${buf2hex(glyphBytes)}`);\n\t\t//console.log(`Remaining ${gearBytes.length} bytes: ${buf2hex(gearBytes)}`);\n\n\t\t// First byte in glyphs section seems to always be 0x30\n\t\tcur = 1;\n\t\tlet hasGlyphs = false;\n\t\tconst d = '0123456789abcdefghjkmnpqrstvwxyz';\n\t\tconst glyphStr = String.fromCharCode(...glyphBytes);\n\t\tconst glyphIds = [0, 0, 0, 0, 0, 0];\n\t\twhile (cur < glyphBytes.length) {\n\t\t\t// First byte for each glyph is 0x3z, where z is the glyph position.\n\t\t\t// 0, 1, 2 are major glyphs, 3, 4, 5 are minor glyphs.\n\t\t\tconst glyphPosition = d.indexOf(glyphStr[cur]);\n\t\t\tcur++;\n\n\t\t\t// For some reason, wowhead uses the spell IDs for the glyphs and\n\t\t\t// applies a ridiculous hashing scheme.\n\t\t\tconst spellId =\n\t\t\t\t0 +\n\t\t\t\t(d.indexOf(glyphStr[cur + 0]) << 15) +\n\t\t\t\t(d.indexOf(glyphStr[cur + 1]) << 10) +\n\t\t\t\t(d.indexOf(glyphStr[cur + 2]) << 5) +\n\t\t\t\t(d.indexOf(glyphStr[cur + 3]) << 0);\n\t\t\tconst itemId = this.simUI.sim.db.glyphSpellToItemId(spellId);\n\t\t\t//console.log(`Glyph position: ${glyphPosition}, spellID: ${spellId}`);\n\n\t\t\thasGlyphs = true;\n\t\t\tglyphIds[glyphPosition] = itemId;\n\t\t\tcur += 4;\n\t\t}\n\t\tconst glyphs = Glyphs.create({\n\t\t\tmajor1: glyphIds[0],\n\t\t\tmajor2: glyphIds[1],\n\t\t\tmajor3: glyphIds[2],\n\t\t\tminor1: glyphIds[3],\n\t\t\tminor2: glyphIds[4],\n\t\t\tminor3: glyphIds[5],\n\t\t});\n\n\t\t// Binary schema for each item:\n\t\t// 8-bit slotNumber, high bit = is enchanted\n\t\t// 8-bit upper 3 bits for gem count\n\t\t// 16-bit item id\n\t\t// if enchant bit is set:\n\t\t//   8-bit ??, possibly enchant position for multiple enchants?\n\t\t//   16-bit enchant id\n\t\t// for each gem:\n\t\t//   8-bit upper 3 bits for gem position\n\t\t//   16-bit gem item id\n\t\tconst equipmentSpec = EquipmentSpec.create();\n\t\tcur = 0;\n\t\twhile (cur < gearBytes.length) {\n\t\t\tconst itemSpec = ItemSpec.create();\n\t\t\tconst slotId = gearBytes[cur] & 0b00111111;\n\t\t\tconst isEnchanted = Boolean(gearBytes[cur] & 0b10000000);\n\t\t\tconst randomEnchant = Boolean(gearBytes[cur] & 0b01000000);\n\t\t\tcur++;\n\n\t\t\tconst numGems = (gearBytes[cur] & 0b11100000) >> 5;\n\t\t\tconst highid = gearBytes[cur] & 0b00011111;\n\t\t\tcur++;\n\n\t\t\titemSpec.id = (highid << 16) + (gearBytes[cur] << 8) + gearBytes[cur + 1];\n\t\t\tcur += 2;\n\t\t\t//console.log(`Slot ID: ${slotId}, isEnchanted: ${isEnchanted}, numGems: ${numGems}, itemID: ${itemSpec.id}`);\n\n\t\t\tif (isEnchanted) {\n\t\t\t\t// Note: this is the enchant SPELL id, not the effect ID.\n\t\t\t\tconst enchantSpellId = (gearBytes[cur] << 16) + (gearBytes[cur + 1] << 8) + gearBytes[cur + 2];\n\t\t\t\titemSpec.enchant = this.simUI.sim.db.enchantSpellIdToEffectId(enchantSpellId);\n\t\t\t\tcur += 3;\n\t\t\t\t//console.log(`Enchant ID: ${itemSpec.enchant}. Spellid: ${enchantSpellId}`);\n\t\t\t}\n\n\t\t\tfor (let gemIdx = 0; gemIdx < numGems; gemIdx++) {\n\t\t\t\tconst gemPosition = (gearBytes[cur] & 0b11100000) >> 5;\n\t\t\t\tconst highgemid = gearBytes[cur] & 0b00011111;\n\t\t\t\tcur++;\n\n\t\t\t\tconst gemId = (highgemid << 16) + (gearBytes[cur] << 8) + gearBytes[cur + 1];\n\t\t\t\tcur += 2;\n\t\t\t\t//console.log(`Gem position: ${gemPosition}, gemID: ${gemId}`);\n\n\t\t\t\tif (!itemSpec.gems) {\n\t\t\t\t\titemSpec.gems = [];\n\t\t\t\t}\n\t\t\t\twhile (itemSpec.gems.length < gemPosition) {\n\t\t\t\t\titemSpec.gems.push(0);\n\t\t\t\t}\n\t\t\t\titemSpec.gems[gemPosition] = gemId;\n\t\t\t}\n\n\t\t\t// Ignore tabard / shirt slots\n\t\t\tconst itemSlotEntry = Object.entries(IndividualWowheadGearPlannerImporter.slotIDs).find(e => e[1] == slotId);\n\t\t\tif (itemSlotEntry != null) {\n\t\t\t\tequipmentSpec.items.push(itemSpec);\n\t\t\t}\n\t\t}\n\t\tconst gear = this.simUI.sim.db.lookupEquipmentSpec(equipmentSpec);\n\n\t\tthis.finishIndividualImport(this.simUI, charClass, race, equipmentSpec, talentsStr, hasGlyphs ? glyphs : null, []);\n\t}\n\n\tstatic slotIDs: Record<ItemSlot, number> = {\n\t\t[ItemSlot.ItemSlotHead]: 1,\n\t\t[ItemSlot.ItemSlotNeck]: 2,\n\t\t[ItemSlot.ItemSlotShoulder]: 3,\n\t\t[ItemSlot.ItemSlotBack]: 15,\n\t\t[ItemSlot.ItemSlotChest]: 5,\n\t\t[ItemSlot.ItemSlotWrist]: 9,\n\t\t[ItemSlot.ItemSlotHands]: 10,\n\t\t[ItemSlot.ItemSlotWaist]: 6,\n\t\t[ItemSlot.ItemSlotLegs]: 7,\n\t\t[ItemSlot.ItemSlotFeet]: 8,\n\t\t[ItemSlot.ItemSlotFinger1]: 11,\n\t\t[ItemSlot.ItemSlotFinger2]: 12,\n\t\t[ItemSlot.ItemSlotTrinket1]: 13,\n\t\t[ItemSlot.ItemSlotTrinket2]: 14,\n\t\t[ItemSlot.ItemSlotMainHand]: 16,\n\t\t[ItemSlot.ItemSlotOffHand]: 17,\n\t\t[ItemSlot.ItemSlotRanged]: 18,\n\t};\n}\n\nexport class IndividualAddonImporter<SpecType extends Spec> extends Importer {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, simUI, 'Addon Import', true);\n\t\tthis.simUI = simUI;\n\n\t\tthis.descriptionElem.innerHTML = `\n\t\t\t<p>\n\t\t\t\tImport settings from the <a href=\"https://www.curseforge.com/wow/addons/wowsimsexporter\" target=\"_blank\">WoWSims Importer In-Game Addon</a>.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tThis feature imports gear, race, talents, glyphs, and professions. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the output from the addon below and click, 'Import'.\n\t\t\t</p>\n\t\t`;\n\t}\n\n\tasync onImport(data: string) {\n\t\tconst importJson = JSON.parse(data);\n\n\t\t// Parse all the settings.\n\t\tconst charClass = nameToClass((importJson['class'] as string) || '');\n\t\tif (charClass == Class.ClassUnknown) {\n\t\t\tthrow new Error('Could not parse Class!');\n\t\t}\n\n\t\tconst race = nameToRace((importJson['race'] as string) || '');\n\t\tif (race == Race.RaceUnknown) {\n\t\t\tthrow new Error('Could not parse Race!');\n\t\t}\n\n\t\tconst professions = (importJson['professions'] as Array<{ name: string; level: number }>).map(profData => nameToProfession(profData.name));\n\t\tprofessions.forEach((prof, i) => {\n\t\t\tif (prof == Profession.ProfessionUnknown) {\n\t\t\t\tthrow new Error(`Could not parse profession '${importJson['professions'][i]}'`);\n\t\t\t}\n\t\t});\n\n\t\tconst talentsStr = (importJson['talents'] as string) || '';\n\t\tconst glyphsConfig = classGlyphsConfig[charClass];\n\n\t\tconst db = await Database.get();\n\t\tconst majorGlyphIDs = (importJson['glyphs']['major'] as Array<string | JsonObject>).map(g => glyphToID(g, db, glyphsConfig.majorGlyphs));\n\t\tconst minorGlyphIDs = (importJson['glyphs']['minor'] as Array<string | JsonObject>).map(g => glyphToID(g, db, glyphsConfig.minorGlyphs));\n\n\t\tconst glyphs = Glyphs.create({\n\t\t\tmajor1: majorGlyphIDs[0] || 0,\n\t\t\tmajor2: majorGlyphIDs[1] || 0,\n\t\t\tmajor3: majorGlyphIDs[2] || 0,\n\t\t\tminor1: minorGlyphIDs[0] || 0,\n\t\t\tminor2: minorGlyphIDs[1] || 0,\n\t\t\tminor3: minorGlyphIDs[2] || 0,\n\t\t});\n\n\t\tconst gearJson = importJson['gear'];\n\t\tgearJson.items = (gearJson.items as Array<any>).filter(item => item != null);\n\t\t(gearJson.items as Array<any>).forEach(item => {\n\t\t\tif (item.gems) {\n\t\t\t\titem.gems = (item.gems as Array<any>).map(gem => gem || 0);\n\t\t\t}\n\t\t});\n\t\tconst equipmentSpec = EquipmentSpec.fromJson(gearJson);\n\n\t\tthis.finishIndividualImport(this.simUI, charClass, race, equipmentSpec, talentsStr, glyphs, professions);\n\t}\n}\n\nfunction glyphNameToID(glyphName: string, glyphsConfig: Record<number, GlyphConfig>): number {\n\tif (!glyphName) {\n\t\treturn 0;\n\t}\n\n\tfor (const glyphIDStr in glyphsConfig) {\n\t\tif (glyphsConfig[glyphIDStr].name == glyphName) {\n\t\t\treturn parseInt(glyphIDStr);\n\t\t}\n\t}\n\tthrow new Error(`Unknown glyph name '${glyphName}'`);\n}\n\nfunction glyphToID(glyph: string | JsonObject, db: Database, glyphsConfig: Record<number, GlyphConfig>): number {\n\tif (typeof glyph === 'string') {\n\t\t// Legacy version: AddOn exports Glyphs by name (string) only. Names must be in English.\n\t\treturn glyphNameToID(glyph, glyphsConfig);\n\t}\n\t// New version exports glyph information in a table that includes the name and the glyph spell ID.\n\treturn db.glyphSpellToItemId(glyph['spellID'] as number);\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { element, ref } from 'tsx-vanilla';\n\nimport * as Mechanics from '../constants/mechanics';\nimport { IndividualSimUI } from '../individual_sim_ui';\nimport { RaidSimRequest } from '../proto/api';\nimport { PseudoStat, Spec, Stat } from '../proto/common';\nimport { IndividualSimSettings } from '../proto/ui';\nimport { raceNames } from '../proto_utils/names';\nimport { UnitStat } from '../proto_utils/stats';\nimport { SimSettingCategories } from '../sim';\nimport { SimUI } from '../sim_ui';\nimport { EventID, TypedEvent } from '../typed_event';\nimport { arrayEquals, downloadString, getEnumValues, jsonStringifyWithFlattenedPaths } from '../utils';\nimport { BaseModal } from './base_modal';\nimport { BooleanPicker } from './boolean_picker';\nimport { CopyButton } from './copy_button';\nimport { IndividualLinkImporter, IndividualWowheadGearPlannerImporter } from './importers';\n\ndeclare let pako: any;\n\ninterface ExporterOptions {\n\ttitle: string;\n\theader?: boolean;\n\tallowDownload?: boolean;\n}\n\nexport abstract class Exporter extends BaseModal {\n\tprivate readonly textElem: HTMLElement;\n\tprotected readonly changedEvent: TypedEvent<void> = new TypedEvent();\n\n\tconstructor(parent: HTMLElement, simUI: SimUI, options: ExporterOptions) {\n\t\tsuper(parent, 'exporter', { title: options.title, header: true, footer: true });\n\n\t\tthis.body.innerHTML = `\n\t\t\t<textarea spellCheck=\"false\" class=\"exporter-textarea form-control\"></textarea>\n\t\t`;\n\t\tthis.textElem = this.rootElem.getElementsByClassName('exporter-textarea')[0] as HTMLElement;\n\n\t\tnew CopyButton(this.footer!, {\n\t\t\textraCssClasses: ['btn-primary', 'me-2'],\n\t\t\tgetContent: () => this.textElem.innerHTML,\n\t\t\ttext: 'Copy',\n\t\t\ttooltip: 'Copy to clipboard',\n\t\t});\n\n\t\tif (options.allowDownload) {\n\t\t\tconst downloadBtnRef = ref<HTMLButtonElement>();\n\t\t\tthis.footer!.appendChild(\n\t\t\t\t<button className=\"exporter-button btn btn-primary download-button\" ref={downloadBtnRef}>\n\t\t\t\t\t<i className=\"fa fa-download me-1\"></i>\n\t\t\t\t\tDownload\n\t\t\t\t</button>,\n\t\t\t);\n\n\t\t\tconst downloadButton = downloadBtnRef.value!;\n\t\t\tdownloadButton.addEventListener('click', _event => {\n\t\t\t\tconst data = this.textElem.textContent!;\n\t\t\t\tdownloadString(data, 'wowsims.json');\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected init() {\n\t\tthis.changedEvent.on(() => this.updateContent());\n\t\tthis.updateContent();\n\t}\n\n\tprivate updateContent() {\n\t\tthis.textElem.textContent = this.getData();\n\t}\n\n\tabstract getData(): string;\n}\n\nexport class IndividualLinkExporter<SpecType extends Spec> extends Exporter {\n\tprivate static readonly exportPickerConfigs: Array<{\n\t\tcategory: SimSettingCategories;\n\t\tlabel: string;\n\t\tlabelTooltip: string;\n\t}> = [\n\t\t{\n\t\t\tcategory: SimSettingCategories.Gear,\n\t\t\tlabel: 'Gear',\n\t\t\tlabelTooltip: 'Also includes bonus stats and weapon swaps.',\n\t\t},\n\t\t{\n\t\t\tcategory: SimSettingCategories.Talents,\n\t\t\tlabel: 'Talents',\n\t\t\tlabelTooltip: 'Talents and Glyphs.',\n\t\t},\n\t\t{\n\t\t\tcategory: SimSettingCategories.Rotation,\n\t\t\tlabel: 'Rotation',\n\t\t\tlabelTooltip: 'Includes everything found in the Rotation tab.',\n\t\t},\n\t\t{\n\t\t\tcategory: SimSettingCategories.Consumes,\n\t\t\tlabel: 'Consumes',\n\t\t\tlabelTooltip: 'Flask, pots, food, etc.',\n\t\t},\n\t\t{\n\t\t\tcategory: SimSettingCategories.External,\n\t\t\tlabel: 'Buffs & Debuffs',\n\t\t\tlabelTooltip: 'All settings which are applied by other raid members.',\n\t\t},\n\t\t{\n\t\t\tcategory: SimSettingCategories.Miscellaneous,\n\t\t\tlabel: 'Misc',\n\t\t\tlabelTooltip: 'Spec-specific settings, front/back of target, distance from target, etc.',\n\t\t},\n\t\t{\n\t\t\tcategory: SimSettingCategories.Encounter,\n\t\t\tlabel: 'Encounter',\n\t\t\tlabelTooltip: 'Fight-related settings.',\n\t\t},\n\t\t// Intentionally exclude UISettings category here, because users almost\n\t\t// never intend to export them and it messes with other users' settings.\n\t\t// If they REALLY want to export UISettings, just use the JSON exporter.\n\t];\n\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\tprivate readonly exportCategories: Record<SimSettingCategories, boolean>;\n\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, simUI, { title: 'Sharable Link' });\n\t\tthis.simUI = simUI;\n\n\t\tconst exportCategories: Partial<Record<SimSettingCategories, boolean>> = {};\n\t\t(getEnumValues(SimSettingCategories) as Array<SimSettingCategories>).forEach(\n\t\t\tcat => (exportCategories[cat] = IndividualLinkImporter.DEFAULT_CATEGORIES.includes(cat)),\n\t\t);\n\t\tthis.exportCategories = exportCategories as Record<SimSettingCategories, boolean>;\n\n\t\tconst pickersContainer = document.createElement('div');\n\t\tpickersContainer.classList.add('link-exporter-pickers');\n\t\tthis.body.prepend(pickersContainer);\n\n\t\tIndividualLinkExporter.exportPickerConfigs.forEach(exportConfig => {\n\t\t\tconst category = exportConfig.category;\n\t\t\tnew BooleanPicker(pickersContainer, this, {\n\t\t\t\tlabel: exportConfig.label,\n\t\t\t\tlabelTooltip: exportConfig.labelTooltip,\n\t\t\t\tinline: true,\n\t\t\t\tgetValue: () => this.exportCategories[category],\n\t\t\t\tsetValue: (eventID: EventID, modObj: IndividualLinkExporter<SpecType>, newValue: boolean) => {\n\t\t\t\t\tthis.exportCategories[category] = newValue;\n\t\t\t\t\tthis.changedEvent.emit(eventID);\n\t\t\t\t},\n\t\t\t\tchangedEvent: () => this.changedEvent,\n\t\t\t});\n\t\t});\n\n\t\tthis.init();\n\t}\n\n\tgetData(): string {\n\t\treturn IndividualLinkExporter.createLink(\n\t\t\tthis.simUI,\n\t\t\t(getEnumValues(SimSettingCategories) as Array<SimSettingCategories>).filter(c => this.exportCategories[c]),\n\t\t);\n\t}\n\n\tstatic createLink(simUI: IndividualSimUI<any>, exportCategories?: Array<SimSettingCategories>): string {\n\t\tif (!exportCategories) {\n\t\t\texportCategories = IndividualLinkImporter.DEFAULT_CATEGORIES;\n\t\t}\n\n\t\tconst proto = simUI.toProto(exportCategories);\n\n\t\tconst protoBytes = IndividualSimSettings.toBinary(proto);\n\t\tconst deflated = pako.deflate(protoBytes, { to: 'string' });\n\t\tconst encoded = btoa(String.fromCharCode(...deflated));\n\n\t\tconst linkUrl = new URL(window.location.href);\n\t\tlinkUrl.hash = encoded;\n\t\tif (arrayEquals(exportCategories, IndividualLinkImporter.DEFAULT_CATEGORIES)) {\n\t\t\tlinkUrl.searchParams.delete(IndividualLinkImporter.CATEGORY_PARAM);\n\t\t} else {\n\t\t\tconst categoryCharString = exportCategories.map(c => IndividualLinkImporter.CATEGORY_KEYS.get(c)).join('');\n\t\t\tlinkUrl.searchParams.set(IndividualLinkImporter.CATEGORY_PARAM, categoryCharString);\n\t\t}\n\t\treturn linkUrl.toString();\n\t}\n}\n\nexport class IndividualJsonExporter<SpecType extends Spec> extends Exporter {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, simUI, { title: 'JSON Export', allowDownload: true });\n\t\tthis.simUI = simUI;\n\t\tthis.init();\n\t}\n\n\tgetData(): string {\n\t\treturn jsonStringifyWithFlattenedPaths(IndividualSimSettings.toJson(this.simUI.toProto()), 2, (value, path) => {\n\t\t\tif (['stats', 'pseudoStats'].includes(path[path.length - 1])) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (['player', 'equipment', 'items'].every((v, i) => path[i] == v)) {\n\t\t\t\treturn path.length > 3;\n\t\t\t}\n\n\t\t\tif (path[0] == 'player' && path[1] == 'rotation' && ['prepullActions', 'priorityList'].includes(path[2])) {\n\t\t\t\treturn path.length > 3;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t});\n\t}\n}\n\nexport class IndividualWowheadGearPlannerExporter<SpecType extends Spec> extends Exporter {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, simUI, { title: 'Wowhead Export', allowDownload: true });\n\t\tthis.simUI = simUI;\n\t\tthis.init();\n\t}\n\n\tgetData(): string {\n\t\tconst player = this.simUI.player;\n\n\t\tconst classStr = player.getPlayerClass().friendlyName.replaceAll(/\\s/, '-').toLowerCase();\n\t\tconst raceStr = raceNames.get(player.getRace())!.replaceAll(/\\s/, '-').toLowerCase();\n\t\tconst url = `https://www.wowhead.com/cata/gear-planner/${classStr}/${raceStr}/`;\n\n\t\t// See comments on the importer for how the binary formatting is structured.\n\t\tlet bytes: Array<number> = [];\n\t\tbytes.push(6);\n\t\tbytes.push(0);\n\t\tbytes.push(Mechanics.CHARACTER_LEVEL);\n\n\t\tlet talentsStr = player.getTalentsString().replaceAll('-', 'f') + 'f';\n\t\tif (talentsStr.length % 2 == 1) {\n\t\t\ttalentsStr += '0';\n\t\t}\n\t\t//console.log('Talents str: ' + talentsStr);\n\t\tbytes.push(talentsStr.length / 2);\n\t\tfor (let i = 0; i < talentsStr.length; i += 2) {\n\t\t\tbytes.push(parseInt(talentsStr.substring(i, i + 2), 16));\n\t\t}\n\n\t\tconst glyphBytes: Array<number> = [];\n\t\tlet glyphStr = '';\n\t\tconst glyphs = player.getGlyphs();\n\t\tconst d = '0123456789abcdefghjkmnpqrstvwxyz';\n\t\tconst addGlyph = (glyphItemId: number, glyphPosition: number) => {\n\t\t\tconst spellId = this.simUI.sim.db.glyphItemToSpellId(glyphItemId);\n\t\t\tif (!spellId) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tglyphStr += d[glyphPosition];\n\t\t\tglyphStr += d[(spellId >> 15) & 0b00011111];\n\t\t\tglyphStr += d[(spellId >> 10) & 0b00011111];\n\t\t\tglyphStr += d[(spellId >> 5) & 0b00011111];\n\t\t\tglyphStr += d[(spellId >> 0) & 0b00011111];\n\t\t};\n\t\taddGlyph(glyphs.prime1, 0);\n\t\taddGlyph(glyphs.prime2, 1);\n\t\taddGlyph(glyphs.prime3, 2);\n\t\taddGlyph(glyphs.major1, 3);\n\t\taddGlyph(glyphs.major2, 4);\n\t\taddGlyph(glyphs.major3, 5);\n\t\taddGlyph(glyphs.minor1, 6);\n\t\taddGlyph(glyphs.minor2, 7);\n\t\taddGlyph(glyphs.minor3, 8);\n\t\tif (glyphStr) {\n\t\t\tglyphBytes.push(0x30);\n\t\t\tfor (let i = 0; i < glyphStr.length; i++) {\n\t\t\t\tglyphBytes.push(glyphStr.charCodeAt(i));\n\t\t\t}\n\t\t}\n\t\tbytes.push(glyphBytes.length);\n\t\tbytes = bytes.concat(glyphBytes);\n\n\t\tconst to2Bytes = (val: number): Array<number> => {\n\t\t\treturn [(val & 0xff00) >> 8, val & 0x00ff];\n\t\t};\n\n\t\tconst gear = player.getGear();\n\t\tconst isBlacksmithing = player.isBlacksmithing();\n\t\tgear.getItemSlots()\n\t\t\t.sort((slot1, slot2) => IndividualWowheadGearPlannerImporter.slotIDs[slot1] - IndividualWowheadGearPlannerImporter.slotIDs[slot2])\n\t\t\t.forEach(itemSlot => {\n\t\t\t\tconst item = gear.getEquippedItem(itemSlot);\n\t\t\t\tif (!item) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet slotId = IndividualWowheadGearPlannerImporter.slotIDs[itemSlot];\n\t\t\t\tif (item.enchant) {\n\t\t\t\t\tslotId = slotId | 0b10000000;\n\t\t\t\t}\n\t\t\t\tbytes.push(slotId);\n\t\t\t\tbytes.push(item.curEquippedGems(isBlacksmithing).length << 5);\n\t\t\t\tbytes = bytes.concat(to2Bytes(item.item.id));\n\n\t\t\t\tif (item.enchant) {\n\t\t\t\t\tbytes.push(0);\n\t\t\t\t\tbytes = bytes.concat(to2Bytes(item.enchant.spellId));\n\t\t\t\t}\n\n\t\t\t\titem.gems.slice(0, item.numSockets(isBlacksmithing)).forEach((gem, i) => {\n\t\t\t\t\tif (gem) {\n\t\t\t\t\t\tbytes.push(i << 5);\n\t\t\t\t\t\tbytes = bytes.concat(to2Bytes(gem.id));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t//console.log('Hex: ' + buf2hex(new Uint8Array(bytes)));\n\t\tconst binaryString = String.fromCharCode(...bytes);\n\t\tconst b64encoded = btoa(binaryString);\n\t\tconst b64converted = b64encoded.replaceAll('/', '_').replaceAll('+', '-').replace(/=+$/, '');\n\n\t\treturn url + b64converted;\n\t}\n}\n\nexport class Individual80UEPExporter<SpecType extends Spec> extends Exporter {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, simUI, { title: '80Upgrades EP Export', allowDownload: true });\n\t\tthis.simUI = simUI;\n\t\tthis.init();\n\t}\n\n\tgetData(): string {\n\t\tconst player = this.simUI.player;\n\t\tconst epValues = player.getEpWeights();\n\t\tconst allUnitStats = UnitStat.getAll();\n\n\t\tconst namesToWeights: Record<string, number> = {};\n\t\tallUnitStats.forEach(stat => {\n\t\t\tconst statName = Individual80UEPExporter.getName(stat);\n\t\t\tconst weight = epValues.getUnitStat(stat);\n\t\t\tif (weight == 0 || statName == '') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Need to add together stats with the same name (e.g. hit/crit/haste).\n\t\t\tif (namesToWeights[statName]) {\n\t\t\t\tnamesToWeights[statName] += weight;\n\t\t\t} else {\n\t\t\t\tnamesToWeights[statName] = weight;\n\t\t\t}\n\t\t});\n\n\t\treturn (\n\t\t\t`https://eightyupgrades.com/ep/import?name=${encodeURIComponent(`${player.getPlayerSpec().friendlyName} WoWSims Weights`)}` +\n\t\t\tObject.keys(namesToWeights)\n\t\t\t\t.map(statName => `&${statName}=${namesToWeights[statName].toFixed(3)}`)\n\t\t\t\t.join('')\n\t\t);\n\t}\n\n\tstatic getName(stat: UnitStat): string {\n\t\tif (stat.isStat()) {\n\t\t\treturn Individual80UEPExporter.statNames[stat.getStat()];\n\t\t} else {\n\t\t\treturn Individual80UEPExporter.pseudoStatNames[stat.getPseudoStat()] || '';\n\t\t}\n\t}\n\n\tstatic statNames: Record<Stat, string> = {\n\t\t[Stat.StatStrength]: 'strength',\n\t\t[Stat.StatAgility]: 'agility',\n\t\t[Stat.StatStamina]: 'stamina',\n\t\t[Stat.StatIntellect]: 'intellect',\n\t\t[Stat.StatSpirit]: 'spirit',\n\t\t[Stat.StatSpellPower]: 'spellDamage',\n\t\t[Stat.StatMP5]: 'mp5',\n\t\t[Stat.StatSpellHit]: 'hitRating',\n\t\t[Stat.StatSpellCrit]: 'critRating',\n\t\t[Stat.StatSpellHaste]: 'hasteRating',\n\t\t[Stat.StatSpellPenetration]: 'spellPen',\n\t\t[Stat.StatAttackPower]: 'attackPower',\n\t\t[Stat.StatMeleeHit]: 'hitRating',\n\t\t[Stat.StatMeleeCrit]: 'critRating',\n\t\t[Stat.StatMeleeHaste]: 'hasteRating',\n\t\t[Stat.StatArmorPenetration]: 'armorPenRating',\n\t\t[Stat.StatExpertise]: 'expertiseRating',\n\t\t[Stat.StatMana]: 'mana',\n\t\t[Stat.StatArmor]: 'armor',\n\t\t[Stat.StatRangedAttackPower]: 'attackPower',\n\t\t[Stat.StatDefense]: 'defenseRating',\n\t\t[Stat.StatBlock]: 'blockRating',\n\t\t[Stat.StatBlockValue]: 'blockValue',\n\t\t[Stat.StatDodge]: 'dodgeRating',\n\t\t[Stat.StatParry]: 'parryRating',\n\t\t[Stat.StatResilience]: 'resilienceRating',\n\t\t[Stat.StatHealth]: 'health',\n\t\t[Stat.StatArcaneResistance]: 'arcaneResistance',\n\t\t[Stat.StatFireResistance]: 'fireResistance',\n\t\t[Stat.StatFrostResistance]: 'frostResistance',\n\t\t[Stat.StatNatureResistance]: 'natureResistance',\n\t\t[Stat.StatShadowResistance]: 'shadowResistance',\n\t\t[Stat.StatBonusArmor]: 'armorBonus',\n\t\t[Stat.StatMastery]: 'mastery',\n\t};\n\tstatic pseudoStatNames: Partial<Record<PseudoStat, string>> = {\n\t\t[PseudoStat.PseudoStatMainHandDps]: 'dps',\n\t\t[PseudoStat.PseudoStatRangedDps]: 'rangedDps',\n\t};\n}\n\nexport class IndividualPawnEPExporter<SpecType extends Spec> extends Exporter {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, simUI, { title: 'Pawn EP Export', allowDownload: true });\n\t\tthis.simUI = simUI;\n\t\tthis.init();\n\t}\n\n\tgetData(): string {\n\t\tconst player = this.simUI.player;\n\t\tconst epValues = player.getEpWeights();\n\t\tconst allUnitStats = UnitStat.getAll();\n\n\t\tconst namesToWeights: Record<string, number> = {};\n\t\tallUnitStats.forEach(stat => {\n\t\t\tconst statName = IndividualPawnEPExporter.getName(stat);\n\t\t\tconst weight = epValues.getUnitStat(stat);\n\t\t\tif (weight == 0 || statName == '') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Need to add together stats with the same name (e.g. hit/crit/haste).\n\t\t\tif (namesToWeights[statName]) {\n\t\t\t\tnamesToWeights[statName] += weight;\n\t\t\t} else {\n\t\t\t\tnamesToWeights[statName] = weight;\n\t\t\t}\n\t\t});\n\n\t\treturn (\n\t\t\t`( Pawn: v1: \"${player.getPlayerSpec().friendlyName} WoWSims Weights\": Class=${player.getPlayerClass().friendlyName},` +\n\t\t\tObject.keys(namesToWeights)\n\t\t\t\t.map(statName => `${statName}=${namesToWeights[statName].toFixed(3)}`)\n\t\t\t\t.join(',') +\n\t\t\t' )'\n\t\t);\n\t}\n\n\tstatic getName(stat: UnitStat): string {\n\t\tif (stat.isStat()) {\n\t\t\treturn IndividualPawnEPExporter.statNames[stat.getStat()];\n\t\t} else {\n\t\t\treturn IndividualPawnEPExporter.pseudoStatNames[stat.getPseudoStat()] || '';\n\t\t}\n\t}\n\n\tstatic statNames: Record<Stat, string> = {\n\t\t[Stat.StatStrength]: 'Strength',\n\t\t[Stat.StatAgility]: 'Agility',\n\t\t[Stat.StatStamina]: 'Stamina',\n\t\t[Stat.StatIntellect]: 'Intellect',\n\t\t[Stat.StatSpirit]: 'Spirit',\n\t\t[Stat.StatSpellPower]: 'SpellDamage',\n\t\t[Stat.StatMP5]: 'Mp5',\n\t\t[Stat.StatSpellHit]: 'HitRating',\n\t\t[Stat.StatSpellCrit]: 'CritRating',\n\t\t[Stat.StatSpellHaste]: 'HasteRating',\n\t\t[Stat.StatSpellPenetration]: 'SpellPen',\n\t\t[Stat.StatAttackPower]: 'Ap',\n\t\t[Stat.StatMeleeHit]: 'HitRating',\n\t\t[Stat.StatMeleeCrit]: 'CritRating',\n\t\t[Stat.StatMeleeHaste]: 'HasteRating',\n\t\t[Stat.StatArmorPenetration]: 'ArmorPenetration',\n\t\t[Stat.StatExpertise]: 'ExpertiseRating',\n\t\t[Stat.StatMana]: 'Mana',\n\t\t[Stat.StatArmor]: 'Armor',\n\t\t[Stat.StatRangedAttackPower]: 'Ap',\n\t\t[Stat.StatDefense]: 'DefenseRating',\n\t\t[Stat.StatBlock]: 'BlockRating',\n\t\t[Stat.StatBlockValue]: 'BlockValue',\n\t\t[Stat.StatDodge]: 'DodgeRating',\n\t\t[Stat.StatParry]: 'ParryRating',\n\t\t[Stat.StatResilience]: 'ResilienceRating',\n\t\t[Stat.StatHealth]: 'Health',\n\t\t[Stat.StatArcaneResistance]: 'ArcaneResistance',\n\t\t[Stat.StatFireResistance]: 'FireResistance',\n\t\t[Stat.StatFrostResistance]: 'FrostResistance',\n\t\t[Stat.StatNatureResistance]: 'NatureResistance',\n\t\t[Stat.StatShadowResistance]: 'ShadowResistance',\n\t\t[Stat.StatBonusArmor]: 'Armor2',\n\t\t[Stat.StatMastery]: 'mastery',\n\t};\n\tstatic pseudoStatNames: Partial<Record<PseudoStat, string>> = {\n\t\t[PseudoStat.PseudoStatMainHandDps]: 'MeleeDps',\n\t\t[PseudoStat.PseudoStatRangedDps]: 'RangedDps',\n\t};\n}\n\nexport class IndividualCLIExporter<SpecType extends Spec> extends Exporter {\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\n\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parent, simUI, { title: 'CLI Export', allowDownload: true });\n\t\tthis.simUI = simUI;\n\t\tthis.init();\n\t}\n\n\tgetData(): string {\n\t\tconst raidSimJson: any = RaidSimRequest.toJson(this.simUI.sim.makeRaidSimRequest(false));\n\t\tdelete raidSimJson.raid?.parties[0]?.players[0]?.database;\n\t\treturn JSON.stringify(raidSimJson, null, 2);\n\t}\n}\n","import {\n\tUIEnchant as Enchant,\n} from '../proto/ui.js';\n\nlet descriptionsPromise: Promise<Record<number, string>> | null = null;\nfunction fetchEnchantDescriptions(): Promise<Record<number, string>> {\n\tif (descriptionsPromise == null) {\n\t\tdescriptionsPromise = fetch('/cata/assets/enchants/descriptions.json')\n\t\t\t.then(response => response.json())\n\t\t\t.then(json => {\n\t\t\t\tconst descriptionsMap: Record<number, string> = {};\n\t\t\t\tfor (let idStr in json) {\n\t\t\t\t\tdescriptionsMap[parseInt(idStr)] = json[idStr];\n\t\t\t\t}\n\t\t\t\treturn descriptionsMap;\n\t\t\t});\n\t}\n\treturn descriptionsPromise;\n}\n\nexport async function getEnchantDescription(enchant: Enchant): Promise<string> {\n\tconst descriptionsMap = await fetchEnchantDescriptions();\n\treturn descriptionsMap[enchant.effectId] || enchant.name;\n}\n\n// Returns a string uniquely identifying the enchant.\nexport function getUniqueEnchantString(enchant: Enchant): string {\n\treturn enchant.effectId + '-' + enchant.type;\n}\n","import { Player } from '../player.js';\nimport { ItemSlot } from '../proto/common.js';\nimport { RaidFilterOption, SourceFilterOption, UIItem_FactionRestriction } from '../proto/ui.js';\nimport { armorTypeNames, raidNames, rangedWeaponTypeNames, sourceNames, weaponTypeNames } from '../proto_utils/names.js';\nimport { Sim } from '../sim.js';\nimport { EventID } from '../typed_event.js';\nimport { BaseModal } from './base_modal.js';\nimport { BooleanPicker } from './boolean_picker.js';\nimport { EnumPicker } from './enum_picker.js';\nimport { NumberPicker } from './number_picker.js';\n\nconst factionRestrictionsToLabels: Record<UIItem_FactionRestriction, string> = {\n\t[UIItem_FactionRestriction.UNSPECIFIED]: 'None',\n\t[UIItem_FactionRestriction.ALLIANCE_ONLY]: 'Alliance only',\n\t[UIItem_FactionRestriction.HORDE_ONLY]: 'Horde only',\n};\n\nexport class FiltersMenu extends BaseModal {\n\tconstructor(rootElem: HTMLElement, player: Player<any>, slot: ItemSlot) {\n\t\tsuper(rootElem, 'filters-menu', { size: 'md', title: 'Filters' });\n\n\t\tlet section = this.newSection('Factions');\n\n\t\tnew EnumPicker(section, player.sim, {\n\t\t\tlabel: 'Faction Restrictions',\n\t\t\tvalues: [UIItem_FactionRestriction.UNSPECIFIED, UIItem_FactionRestriction.ALLIANCE_ONLY, UIItem_FactionRestriction.HORDE_ONLY].map(restriction => {\n\t\t\t\treturn {\n\t\t\t\t\tname: factionRestrictionsToLabels[restriction],\n\t\t\t\t\tvalue: restriction,\n\t\t\t\t};\n\t\t\t}),\n\t\t\tchangedEvent: sim => sim.filtersChangeEmitter,\n\t\t\tgetValue: (sim: Sim) => sim.getFilters().factionRestriction,\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: UIItem_FactionRestriction) => {\n\t\t\t\tconst newFilters = sim.getFilters();\n\t\t\t\tnewFilters.factionRestriction = newValue;\n\t\t\t\tsim.setFilters(eventID, newFilters);\n\t\t\t},\n\t\t});\n\n\t\tsection = this.newSection('Source');\n\t\tsection.classList.add('filters-menu-section-bool-list');\n\t\tconst sources = Sim.ALL_SOURCES.filter(s => s != SourceFilterOption.SourceUnknown);\n\t\tsources.forEach(source => {\n\t\t\tnew BooleanPicker<Sim>(section, player.sim, {\n\t\t\t\tlabel: sourceNames.get(source),\n\t\t\t\tinline: true,\n\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\n\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().sources.includes(source),\n\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\t\t\tconst filters = sim.getFilters();\n\t\t\t\t\tif (newValue) {\n\t\t\t\t\t\tfilters.sources.push(source);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfilters.sources = filters.sources.filter(v => v != source);\n\t\t\t\t\t}\n\t\t\t\t\tsim.setFilters(eventID, filters);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tsection = this.newSection('Raids');\n\t\tsection.classList.add('filters-menu-section-bool-list');\n\t\tconst raids = Sim.ALL_RAIDS.filter(s => s != RaidFilterOption.RaidUnknown);\n\t\traids.forEach(raid => {\n\t\t\tnew BooleanPicker<Sim>(section, player.sim, {\n\t\t\t\tlabel: raidNames.get(raid),\n\t\t\t\tinline: true,\n\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\n\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().raids.includes(raid),\n\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\t\t\tconst filters = sim.getFilters();\n\t\t\t\t\tif (newValue) {\n\t\t\t\t\t\tfilters.raids.push(raid);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfilters.raids = filters.raids.filter(v => v != raid);\n\t\t\t\t\t}\n\t\t\t\t\tsim.setFilters(eventID, filters);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tif (Player.ARMOR_SLOTS.includes(slot)) {\n\t\t\tconst armorTypes = player.getPlayerClass().armorTypes;\n\n\t\t\tif (armorTypes.length > 1) {\n\t\t\t\tconst section = this.newSection('Armor Type');\n\t\t\t\tsection.classList.add('filters-menu-section-bool-list');\n\n\t\t\t\tarmorTypes.forEach(armorType => {\n\t\t\t\t\tnew BooleanPicker<Sim>(section, player.sim, {\n\t\t\t\t\t\tlabel: armorTypeNames.get(armorType),\n\t\t\t\t\t\tinline: true,\n\t\t\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\n\t\t\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().armorTypes.includes(armorType),\n\t\t\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\t\t\t\t\tconst filters = sim.getFilters();\n\t\t\t\t\t\t\tif (newValue) {\n\t\t\t\t\t\t\t\tfilters.armorTypes.push(armorType);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfilters.armorTypes = filters.armorTypes.filter(at => at != armorType);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsim.setFilters(eventID, filters);\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (Player.WEAPON_SLOTS.includes(slot)) {\n\t\t\tconst weaponTypeSection = this.newSection('Weapon Type');\n\t\t\tweaponTypeSection.classList.add('filters-menu-section-bool-list');\n\t\t\tconst weaponTypes = player.getPlayerClass().weaponTypes.map(ewt => ewt.weaponType);\n\n\t\t\tweaponTypes.forEach(weaponType => {\n\t\t\t\tnew BooleanPicker<Sim>(weaponTypeSection, player.sim, {\n\t\t\t\t\tlabel: weaponTypeNames.get(weaponType),\n\t\t\t\t\tinline: true,\n\t\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\n\t\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().weaponTypes.includes(weaponType),\n\t\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\t\t\t\tconst filters = sim.getFilters();\n\t\t\t\t\t\tif (newValue) {\n\t\t\t\t\t\t\tfilters.weaponTypes.push(weaponType);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfilters.weaponTypes = filters.weaponTypes.filter(at => at != weaponType);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsim.setFilters(eventID, filters);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tconst weaponSpeedSection = this.newSection('Weapon Speed');\n\t\t\tweaponSpeedSection.classList.add('filters-menu-section-number-list');\n\t\t\tnew NumberPicker<Sim>(weaponSpeedSection, player.sim, {\n\t\t\t\tlabel: 'Min MH Speed',\n\t\t\t\t//labelTooltip: 'Maximum speed for the mainhand weapon. If 0, no maximum value is applied.',\n\t\t\t\tfloat: true,\n\t\t\t\tpositive: true,\n\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\n\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().minMhWeaponSpeed,\n\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\n\t\t\t\t\tconst filters = sim.getFilters();\n\t\t\t\t\tfilters.minMhWeaponSpeed = newValue;\n\t\t\t\t\tsim.setFilters(eventID, filters);\n\t\t\t\t},\n\t\t\t});\n\t\t\tnew NumberPicker<Sim>(weaponSpeedSection, player.sim, {\n\t\t\t\tlabel: 'Max MH Speed',\n\t\t\t\t//labelTooltip: 'Maximum speed for the mainhand weapon. If 0, no maximum value is applied.',\n\t\t\t\tfloat: true,\n\t\t\t\tpositive: true,\n\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\n\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().maxMhWeaponSpeed,\n\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\n\t\t\t\t\tconst filters = sim.getFilters();\n\t\t\t\t\tfilters.maxMhWeaponSpeed = newValue;\n\t\t\t\t\tsim.setFilters(eventID, filters);\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (player.getSpec().canDualWield) {\n\t\t\t\tnew NumberPicker<Sim>(weaponSpeedSection, player.sim, {\n\t\t\t\t\tlabel: 'Min OH Speed',\n\t\t\t\t\t//labelTooltip: 'Minimum speed for the offhand weapon. If 0, no minimum value is applied.',\n\t\t\t\t\tfloat: true,\n\t\t\t\t\tpositive: true,\n\t\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\n\t\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().minOhWeaponSpeed,\n\t\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\n\t\t\t\t\t\tconst filters = sim.getFilters();\n\t\t\t\t\t\tfilters.minOhWeaponSpeed = newValue;\n\t\t\t\t\t\tsim.setFilters(eventID, filters);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tnew NumberPicker<Sim>(weaponSpeedSection, player.sim, {\n\t\t\t\t\tlabel: 'Max OH Speed',\n\t\t\t\t\t//labelTooltip: 'Maximum speed for the offhand weapon. If 0, no maximum value is applied.',\n\t\t\t\t\tfloat: true,\n\t\t\t\t\tpositive: true,\n\t\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\n\t\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().maxOhWeaponSpeed,\n\t\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\n\t\t\t\t\t\tconst filters = sim.getFilters();\n\t\t\t\t\t\tfilters.maxOhWeaponSpeed = newValue;\n\t\t\t\t\t\tsim.setFilters(eventID, filters);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (slot == ItemSlot.ItemSlotRanged) {\n\t\t\tconst rangedweapontypes = player.getPlayerClass().rangedWeaponTypes;\n\t\t\tif (rangedweapontypes.length <= 1) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst rangedWeaponTypeSection = this.newSection('Ranged Weapon Type');\n\t\t\trangedWeaponTypeSection.classList.add('filters-menu-section-bool-list');\n\n\t\t\trangedweapontypes.forEach(rangedWeaponType => {\n\t\t\t\tnew BooleanPicker<Sim>(rangedWeaponTypeSection, player.sim, {\n\t\t\t\t\tlabel: rangedWeaponTypeNames.get(rangedWeaponType),\n\t\t\t\t\tinline: true,\n\t\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\n\t\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().rangedWeaponTypes.includes(rangedWeaponType),\n\t\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\t\t\t\tconst filters = sim.getFilters();\n\t\t\t\t\t\tif (newValue) {\n\t\t\t\t\t\t\tfilters.rangedWeaponTypes.push(rangedWeaponType);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfilters.rangedWeaponTypes = filters.rangedWeaponTypes.filter(at => at != rangedWeaponType);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsim.setFilters(eventID, filters);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tconst rangedWeaponSpeedSection = this.newSection('Ranged Weapon Speed');\n\t\t\trangedWeaponSpeedSection.classList.add('filters-menu-section-number-list');\n\t\t\tnew NumberPicker<Sim>(rangedWeaponSpeedSection, player.sim, {\n\t\t\t\tlabel: 'Min Ranged Speed',\n\t\t\t\t//labelTooltip: 'Maximum speed for the ranged weapon. If 0, no maximum value is applied.',\n\t\t\t\tfloat: true,\n\t\t\t\tpositive: true,\n\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\n\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().minRangedWeaponSpeed,\n\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\n\t\t\t\t\tconst filters = sim.getFilters();\n\t\t\t\t\tfilters.minRangedWeaponSpeed = newValue;\n\t\t\t\t\tsim.setFilters(eventID, filters);\n\t\t\t\t},\n\t\t\t});\n\t\t\tnew NumberPicker<Sim>(rangedWeaponSpeedSection, player.sim, {\n\t\t\t\tlabel: 'Max Ranged Speed',\n\t\t\t\t//labelTooltip: 'Maximum speed for the ranged weapon. If 0, no maximum value is applied.',\n\t\t\t\tfloat: true,\n\t\t\t\tpositive: true,\n\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\n\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().maxRangedWeaponSpeed,\n\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\n\t\t\t\t\tconst filters = sim.getFilters();\n\t\t\t\t\tfilters.maxRangedWeaponSpeed = newValue;\n\t\t\t\t\tsim.setFilters(eventID, filters);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate newSection(name: string): HTMLElement {\n\t\tconst section = document.createElement('div');\n\t\tsection.classList.add('menu-section');\n\t\tthis.body.appendChild(section);\n\t\tsection.innerHTML = `\n\t\t\t<div class=\"menu-section-header\">\n\t\t\t\t<h6 class=\"menu-section-title\">${name}</h6>\n\t\t\t</div>\n\t\t\t<div class=\"menu-section-content\"></div>\n\t\t`;\n\t\treturn section.getElementsByClassName('menu-section-content')[0] as HTMLElement;\n\t}\n}\n","// Based on clusterize\r\n/* Clusterize.js - v1.0.0 - 2023-01-22\r\n http://NeXTs.github.com/Clusterize.js/\r\n Copyright (c) 2015 Denis Lukov; Licensed MIT */\r\n\r\ninterface ClusterizeCallbacks {\r\n    clusterWillChange?: () => void;\r\n    clusterChanged?: () => void;\r\n    scrollingProgress?: (n:number) => void;\r\n}\r\n\r\ninterface ClusterizeParams {\r\n    rows: Element[];\r\n    scroll_elem: HTMLElement;\r\n    content_elem: HTMLElement;\r\n\r\n    rows_in_block?: number;\r\n    blocks_in_cluster?: number;\r\n    show_no_data_row?: boolean;\r\n    no_data_class?:string;\r\n    no_data_text?:string;\r\n    keep_parity?:boolean;\r\n    tag?:keyof HTMLElementTagNameMap;\r\n    callbacks?: ClusterizeCallbacks;\r\n    item_height?:number;\r\n}\r\n\r\nlet defaults = {\r\n    rows_in_block: 50,\r\n    blocks_in_cluster: 4,\r\n    tag: null,\r\n    show_no_data_row: true,\r\n    no_data_class: 'clusterize-no-data',\r\n    no_data_text: 'No data',\r\n    keep_parity: true,\r\n    callbacks: {}\r\n}\r\n\r\nfunction getStyle(prop:string, elem:HTMLElement) {\r\n    return window.getComputedStyle(elem)[prop as any]\r\n}\r\n\r\ninterface ClusterizeOptions {\r\n    rows_in_block: number;\r\n    blocks_in_cluster: number;\r\n    show_no_data_row: boolean;\r\n    no_data_class:string;\r\n    no_data_text:string;\r\n    keep_parity:boolean;\r\n    tag:keyof HTMLElementTagNameMap | null;\r\n    callbacks: ClusterizeCallbacks;\r\n\r\n    cluster_height: number;\r\n    item_height: number;\r\n    content_tag: string;\r\n\r\n    block_height: number;\r\n    scroll_top: number;\r\n    rows_in_cluster: number;\r\n}\r\n\r\ninterface ClusterizeDatasource {\r\n    getNumberOfRows: () => number;\r\n    generateRows: (startIdx: number, endIdx: number) => Element[];\r\n}\r\n\r\nexport class Clusterize {\r\n    private options: ClusterizeOptions;\r\n    private scroll_elem: Element;\r\n    private content_elem: HTMLElement;\r\n    private displayedRows: Element[];\r\n\r\n    private last_cluster = 0;\r\n    private scroll_debounce = 0;\r\n    private pointer_events_set = false;\r\n    private resize_debounce = 0;\r\n\r\n    private ds: ClusterizeDatasource;\r\n    private cache = {};\r\n\r\n    constructor(ds: ClusterizeDatasource, params: ClusterizeParams) {\r\n        this.options = {\r\n            rows_in_block: params.rows_in_block !== undefined ? params.rows_in_block : defaults.rows_in_block,\r\n            blocks_in_cluster: params.blocks_in_cluster !== undefined ? params.blocks_in_cluster : defaults.blocks_in_cluster,\r\n            show_no_data_row: params.show_no_data_row !== undefined ? params.show_no_data_row : defaults.show_no_data_row,\r\n            no_data_class: params.no_data_class !== undefined ? params.no_data_class : defaults.no_data_class,\r\n            no_data_text: params.no_data_text !== undefined ? params.no_data_text : defaults.no_data_text,\r\n            keep_parity: params.keep_parity !== undefined ? params.keep_parity : defaults.keep_parity,\r\n            tag: params.tag !== undefined ? params.tag : defaults.tag,\r\n            callbacks: params.callbacks !== undefined ? params.callbacks : defaults.callbacks,\r\n            cluster_height: 0,\r\n            item_height: params.item_height !== undefined ? params.item_height : 0,\r\n            content_tag: '',\r\n            block_height: 0,\r\n            scroll_top: 0,\r\n            rows_in_cluster: 0,\r\n        }\r\n\r\n        this.ds = ds;\r\n        this.displayedRows = params.rows;\r\n        this.scroll_elem = params.scroll_elem;\r\n        this.content_elem = params.content_elem;\r\n\r\n        // tabindex forces the browser to keep focus on the scrolling list, fixes #11\r\n        if(!this.content_elem.hasAttribute('tabindex'))\r\n            this.content_elem.setAttribute('tabindex', '0');\r\n  \r\n        let scroll_top = this.scroll_elem.scrollTop;\r\n  \r\n        // append initial data\r\n        this.getRowsHeight(params.rows);\r\n        this.insertToDom(params.rows, this.cache);\r\n  \r\n        // restore the scroll position\r\n        this.scroll_elem.scrollTop = scroll_top;\r\n    \r\n        // adding scroll handler\r\n        this.scroll_elem.addEventListener('scroll', this.scrollEv.bind(this));\r\n        window.addEventListener('resize', this.resizeEv.bind(this));\r\n    }\r\n\r\n    destroy(clean? : boolean) {\r\n        this.scroll_elem.removeEventListener('scroll', this.scrollEv.bind(this));\r\n        window.removeEventListener('resize', this.resizeEv.bind(this));\r\n        if (clean)\r\n            this.setContentElemRows(this.generateEmptyRow());\r\n    }\r\n\r\n    dispose() {\r\n        this.destroy();\r\n    }\r\n\r\n    refresh(force?: boolean) {\r\n        if(this.getRowsHeight(this.displayedRows) || force)\r\n            this.update();\r\n    }\r\n\r\n    update() {\r\n        let scroll_top = this.scroll_elem.scrollTop;\r\n        if(this.ds.getNumberOfRows() * this.options.item_height < scroll_top) {\r\n            this.scroll_elem.scrollTop = 0;\r\n            this.last_cluster = 0;\r\n        }\r\n        this.insertToDom(this.displayedRows, this.cache);\r\n        this.scroll_elem.scrollTop = scroll_top;\r\n    }\r\n\r\n    elementUpdate(cb: (e: Element) => void) {\r\n        for (let r of this.displayedRows) {\r\n            cb(r);\r\n        }\r\n    }\r\n\r\n    getScrollProgress() {\r\n        return this.options.scroll_top / (this.ds.getNumberOfRows() * this.options.item_height) * 100 || 0;\r\n    }\r\n\r\n    private scrollEv() {\r\n        // fixes scrolling issue on Mac #3\r\n        let is_mac = navigator.platform.toLowerCase().indexOf('mac') + 1;\r\n        if (is_mac) {\r\n            if (!this.pointer_events_set) \r\n                this.content_elem.style.pointerEvents = 'none';\r\n            this.pointer_events_set = true;\r\n            clearTimeout(this.scroll_debounce);\r\n            this.scroll_debounce = window.setTimeout(() => {\r\n                this.content_elem.style.pointerEvents = 'auto';\r\n                this.pointer_events_set = false;\r\n            }, 50);\r\n        }\r\n        if (this.last_cluster != (this.last_cluster = this.getClusterNum(this.ds.getNumberOfRows())))\r\n            this.insertToDom(this.displayedRows, this.cache);\r\n        if (this.options.callbacks.scrollingProgress)\r\n            this.options.callbacks.scrollingProgress(this.getScrollProgress());\r\n    };\r\n\r\n    private resizeEv() {\r\n        clearTimeout(this.resize_debounce);\r\n        this.resize_debounce = window.setTimeout(this.refresh.bind(this), 100);\r\n    }\r\n\r\n    private insertToDom(rows: Element[], cache: any) {\r\n        // explore row's height\r\n        if(!this.options.cluster_height) {\r\n            this.exploreEnvironment(rows, cache);\r\n        }\r\n        let data = this.generate();\r\n        let this_cluster_rows = data.rows;\r\n        this.displayedRows = data.rows;\r\n        let this_cluster_content_changed = this.checkChanges('data', this_cluster_rows, cache);\r\n        let top_offset_changed = this.checkChanges('top', data.top_offset, cache);\r\n        let only_bottom_offset_changed = this.checkChanges('bottom', data.bottom_offset, cache);\r\n        let callbacks = this.options.callbacks;\r\n        let layout: Element[] = [];\r\n\r\n        if(this_cluster_content_changed || top_offset_changed) {\r\n            if(data.top_offset) {\r\n                if (this.options.keep_parity) {\r\n                    let parity = this.renderExtraTag('keep-parity');\r\n                    parity.hidden = true;\r\n                    layout.push(parity);\r\n                }\r\n                layout.push(this.renderExtraTag('top-space', data.top_offset));\r\n            }\r\n            layout.push(...this_cluster_rows);\r\n            data.bottom_offset && layout.push(this.renderExtraTag('bottom-space', data.bottom_offset));\r\n            callbacks.clusterWillChange && callbacks.clusterWillChange();\r\n            this.setContentElemRows(layout);\r\n            this.options.content_tag == 'ol' && this.content_elem.setAttribute('start', data.rows_above.toString());\r\n            this.content_elem.style.counterIncrement = 'clusterize-counter ' + (data.rows_above-1);\r\n            callbacks.clusterChanged && callbacks.clusterChanged();\r\n        } else if(only_bottom_offset_changed) {\r\n            (this.content_elem.lastChild as HTMLElement).style.height = data.bottom_offset + 'px';\r\n        }\r\n    }\r\n\r\n    // get tag name, content tag name, tag height, calc cluster height\r\n    private exploreEnvironment(rows: Element[], cache: any) {\r\n        let opts = this.options;\r\n        opts.content_tag = this.content_elem.tagName.toLowerCase();\r\n        if (!rows.length)\r\n            return;\r\n        if (this.content_elem.children.length <= 1)\r\n            this.setContentElemRows([rows[0], rows[0], rows[0]]);\r\n        if (!opts.tag)\r\n            opts.tag = this.content_elem.children[0].tagName.toLowerCase() as keyof HTMLElementTagNameMap;\r\n            this.getRowsHeight(rows);\r\n    }\r\n\r\n    private setContentElemRows(rows: Element[]) {\r\n        this.content_elem.innerHTML = ``;\r\n        this.content_elem.append(...rows);\r\n    }\r\n\r\n    private getRowsHeight(rows: Element[]) {\r\n        let opts = this.options;\r\n        let prev_item_height = opts.item_height;\r\n        opts.cluster_height = 0;\r\n        let nodes = this.content_elem.children;\r\n        if (rows.length && nodes.length) {\r\n            let node = nodes[Math.floor(nodes.length / 2)] as HTMLElement;\r\n            opts.item_height = node.offsetHeight;\r\n            // consider table's border-spacing\r\n            if(opts.tag == 'tr' && getStyle('borderCollapse', this.content_elem) != 'collapse')\r\n                opts.item_height += parseInt(getStyle('borderSpacing', this.content_elem), 10) || 0;\r\n            // consider margins (and margins collapsing)\r\n            if(opts.tag != 'tr') {\r\n                let marginTop = parseInt(getStyle('marginTop', node), 10) || 0;\r\n                let marginBottom = parseInt(getStyle('marginBottom', node), 10) || 0;\r\n                opts.item_height += Math.max(marginTop, marginBottom);\r\n            }\r\n        }\r\n        opts.block_height = opts.item_height * opts.rows_in_block;\r\n        opts.rows_in_cluster = opts.blocks_in_cluster * opts.rows_in_block;\r\n        opts.cluster_height = opts.blocks_in_cluster * opts.block_height;\r\n        return prev_item_height != opts.item_height;\r\n    }\r\n\r\n    // generate cluster for current scroll position\r\n    private generate() {\r\n        let opts = this.options;\r\n        let rows_len = this.ds.getNumberOfRows();\r\n        if (rows_len < opts.rows_in_block) {\r\n            let rows = this.ds.generateRows(0, rows_len);\r\n            return {\r\n                top_offset: 0,\r\n                bottom_offset: 0,\r\n                rows_above: 0,\r\n                rows: rows_len ? rows : this.generateEmptyRow()\r\n            }\r\n        }\r\n        let items_start = Math.max((opts.rows_in_cluster - opts.rows_in_block) * this.getClusterNum(rows_len), 0),\r\n          items_end = items_start + opts.rows_in_cluster,\r\n          top_offset = Math.max(items_start * opts.item_height, 0),\r\n          bottom_offset = Math.max((rows_len - items_end) * opts.item_height, 0),\r\n          this_cluster_rows = [],\r\n          rows_above = items_start;\r\n        if(top_offset < 1) {\r\n            rows_above++;\r\n        }\r\n        this_cluster_rows = this.ds.generateRows(items_start, items_end);\r\n        return {\r\n            top_offset: top_offset,\r\n            bottom_offset: bottom_offset,\r\n            rows_above: rows_above,\r\n            rows: this_cluster_rows\r\n        }\r\n    }\r\n\r\n    // generate empty row if no data provided\r\n    private generateEmptyRow() : Element[] {\r\n        let opts = this.options;\r\n        if(!opts.tag || !opts.show_no_data_row) \r\n            return [];\r\n        let empty_row = document.createElement(opts.tag);\r\n        let no_data_content = document.createTextNode(opts.no_data_text), td;\r\n        empty_row.className = opts.no_data_class;\r\n        if(opts.tag == 'tr') {\r\n            td = document.createElement('td');\r\n            // fixes #53\r\n            td.colSpan = 100;\r\n            td.appendChild(no_data_content);\r\n        }\r\n        empty_row.appendChild(td || no_data_content);\r\n        return [empty_row];\r\n    }\r\n\r\n    // get current cluster number\r\n    private getClusterNum(num_rows: number) {\r\n        let opts = this.options;\r\n        opts.scroll_top = this.scroll_elem.scrollTop;\r\n        let cluster_divider = Math.max(opts.cluster_height - opts.block_height, 1);\r\n        let current_cluster = Math.floor(opts.scroll_top / cluster_divider);\r\n        let max_cluster = Math.floor((num_rows * opts.item_height) / cluster_divider);\r\n        return Math.min(current_cluster, max_cluster);\r\n    }\r\n\r\n    private renderExtraTag(class_name: string, height?: number) {\r\n        let tag = document.createElement(this.options.tag!);\r\n        let clusterize_prefix = 'clusterize-';\r\n\r\n        tag.className = [clusterize_prefix + 'extra-row', clusterize_prefix + class_name].join(' ');\r\n        tag.style.marginTop = '0';\r\n        tag.style.marginBottom = '0';\r\n        height && (tag.style.height = height + 'px');\r\n        return tag;\r\n    }\r\n\r\n    private checkChanges(type: string, value: any, cache: any) {\r\n        var changed = value != cache[type];\r\n        cache[type] = value;\r\n        return changed;\r\n    }\r\n}","import { Tooltip } from 'bootstrap';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { element, fragment, ref } from 'tsx-vanilla';\n\nimport { setItemQualityCssClass } from '../css_utils';\nimport { IndividualSimUI } from '../individual_sim_ui.js';\nimport { Player } from '../player';\nimport { Class, GemColor, ItemQuality, ItemRandomSuffix, ItemSlot, ItemSpec, ItemType, ReforgeStat, Stat } from '../proto/common';\nimport { DatabaseFilters, RepFaction, UIEnchant as Enchant, UIGem as Gem, UIItem as Item, UIItem_FactionRestriction } from '../proto/ui.js';\nimport { ActionId } from '../proto_utils/action_id';\nimport { getEnchantDescription, getUniqueEnchantString } from '../proto_utils/enchants';\nimport { EquippedItem } from '../proto_utils/equipped_item';\nimport { gemMatchesSocket, getEmptyGemSocketIconUrl } from '../proto_utils/gems';\nimport { difficultyNames, professionNames, REP_FACTION_NAMES, REP_LEVEL_NAMES, shortSecondaryStatNames, slotNames } from '../proto_utils/names.js';\nimport { Stats } from '../proto_utils/stats';\nimport { Sim } from '../sim.js';\nimport { SimUI } from '../sim_ui';\nimport { EventID, TypedEvent } from '../typed_event';\nimport { formatDeltaTextElem } from '../utils';\nimport { BaseModal } from './base_modal';\nimport { Component } from './component';\nimport { FiltersMenu } from './filters_menu';\nimport {\n\tmakePhaseSelector,\n\tmakeShow1hWeaponsSelector,\n\tmakeShow2hWeaponsSelector,\n\tmakeShowEPValuesSelector,\n\tmakeShowMatchingGemsSelector,\n} from './other_inputs';\nimport { Clusterize } from './virtual_scroll/clusterize.js';\n\nconst EP_TOOLTIP = `\n\tEP (Equivalence Points) is way of comparing items by multiplying the raw stats of an item with your current stat weights.\n\tMore EP does not necessarily mean more DPS, as EP doesn't take into account stat caps and non-linear stat calculations.\n`;\n\nconst createHeroicLabel = () => {\n\treturn <span className=\"heroic-label\">[H]</span>;\n};\n\nconst createGemContainer = (socketColor: GemColor, gem: Gem | null) => {\n\tconst gemIconElem = ref<HTMLImageElement>();\n\n\tconst gemContainer = (\n\t\t<div className=\"gem-socket-container\">\n\t\t\t<img ref={gemIconElem} className={`gem-icon ${gem == null ? 'hide' : ''}`} />\n\t\t\t<img className=\"socket-icon\" src={getEmptyGemSocketIconUrl(socketColor)} />\n\t\t</div>\n\t);\n\n\tif (gem != null) {\n\t\tActionId.fromItemId(gem.id)\n\t\t\t.fill()\n\t\t\t.then(filledId => {\n\t\t\t\tgemIconElem.value!.src = filledId.iconUrl;\n\t\t\t});\n\t}\n\treturn gemContainer;\n};\n\nexport class GearPicker extends Component {\n\t// ItemSlot is used as the index\n\treadonly itemPickers: Array<ItemPicker>;\n\n\tconstructor(parent: HTMLElement, simUI: SimUI, player: Player<any>) {\n\t\tsuper(parent, 'gear-picker-root');\n\n\t\tconst leftSide = document.createElement('div');\n\t\tleftSide.classList.add('gear-picker-left', 'tab-panel-col');\n\t\tthis.rootElem.appendChild(leftSide);\n\n\t\tconst rightSide = document.createElement('div');\n\t\trightSide.classList.add('gear-picker-right', 'tab-panel-col');\n\t\tthis.rootElem.appendChild(rightSide);\n\n\t\tconst leftItemPickers = [\n\t\t\tItemSlot.ItemSlotHead,\n\t\t\tItemSlot.ItemSlotNeck,\n\t\t\tItemSlot.ItemSlotShoulder,\n\t\t\tItemSlot.ItemSlotBack,\n\t\t\tItemSlot.ItemSlotChest,\n\t\t\tItemSlot.ItemSlotWrist,\n\t\t\tItemSlot.ItemSlotMainHand,\n\t\t\tItemSlot.ItemSlotOffHand,\n\t\t\tItemSlot.ItemSlotRanged,\n\t\t].map(slot => new ItemPicker(leftSide, simUI, player, slot));\n\n\t\tconst rightItemPickers = [\n\t\t\tItemSlot.ItemSlotHands,\n\t\t\tItemSlot.ItemSlotWaist,\n\t\t\tItemSlot.ItemSlotLegs,\n\t\t\tItemSlot.ItemSlotFeet,\n\t\t\tItemSlot.ItemSlotFinger1,\n\t\t\tItemSlot.ItemSlotFinger2,\n\t\t\tItemSlot.ItemSlotTrinket1,\n\t\t\tItemSlot.ItemSlotTrinket2,\n\t\t].map(slot => new ItemPicker(rightSide, simUI, player, slot));\n\n\t\tthis.itemPickers = leftItemPickers.concat(rightItemPickers).sort((a, b) => a.slot - b.slot);\n\t}\n}\n\nexport class ItemRenderer extends Component {\n\tprivate readonly player: Player<any>;\n\n\treadonly iconElem: HTMLAnchorElement;\n\treadonly nameElem: HTMLAnchorElement;\n\treadonly enchantElem: HTMLAnchorElement;\n\treadonly reforgeElem: HTMLAnchorElement;\n\treadonly socketsContainerElem: HTMLElement;\n\n\tconstructor(parent: HTMLElement, root: HTMLElement, player: Player<any>) {\n\t\tsuper(parent, 'item-picker-root', root);\n\t\tthis.player = player;\n\n\t\tconst iconElem = ref<HTMLAnchorElement>();\n\t\tconst nameElem = ref<HTMLAnchorElement>();\n\t\tconst enchantElem = ref<HTMLAnchorElement>();\n\t\tconst reforgeElem = ref<HTMLAnchorElement>();\n\t\tconst sce = ref<HTMLDivElement>();\n\t\tthis.rootElem.appendChild(\n\t\t\t<>\n\t\t\t\t<a ref={iconElem} className=\"item-picker-icon\" href=\"javascript:void(0)\" attributes={{ role: 'button' }}>\n\t\t\t\t\t<div ref={sce} className=\"item-picker-sockets-container\"></div>\n\t\t\t\t</a>\n\t\t\t\t<div className=\"item-picker-labels-container\">\n\t\t\t\t\t<a ref={nameElem} className=\"item-picker-name\" href=\"javascript:void(0)\" attributes={{ role: 'button' }}></a>\n\t\t\t\t\t<a ref={enchantElem} className=\"item-picker-enchant\" href=\"javascript:void(0)\" attributes={{ role: 'button' }}></a>\n\t\t\t\t\t<a ref={reforgeElem} className=\"item-picker-reforge\" href=\"javascript:void(0)\" attributes={{ role: 'button' }}></a>\n\t\t\t\t</div>\n\t\t\t</>,\n\t\t);\n\n\t\tthis.iconElem = iconElem.value!;\n\t\tthis.nameElem = nameElem.value!;\n\t\tthis.reforgeElem = reforgeElem.value!;\n\t\tthis.enchantElem = enchantElem.value!;\n\t\tthis.socketsContainerElem = sce.value!;\n\t}\n\n\tclear() {\n\t\tthis.nameElem.removeAttribute('data-wowhead');\n\t\tthis.nameElem.removeAttribute('href');\n\t\tthis.iconElem.removeAttribute('data-wowhead');\n\t\tthis.iconElem.removeAttribute('href');\n\t\tthis.enchantElem.removeAttribute('data-wowhead');\n\t\tthis.enchantElem.removeAttribute('href');\n\t\tthis.iconElem.removeAttribute('href');\n\n\t\tthis.iconElem.style.backgroundImage = '';\n\t\tthis.enchantElem.innerText = '';\n\t\tthis.reforgeElem.innerText = '';\n\t\tthis.socketsContainerElem.innerText = '';\n\t\tthis.nameElem.textContent = '';\n\t}\n\n\tupdate(newItem: EquippedItem) {\n\t\tthis.nameElem.textContent = newItem.item.name;\n\n\t\tif (newItem.randomSuffix) {\n\t\t\tthis.nameElem.textContent += ' ' + newItem.randomSuffix.name;\n\t\t}\n\n\t\tif (newItem.item.heroic) {\n\t\t\tthis.nameElem.insertAdjacentElement('beforeend', createHeroicLabel());\n\t\t} else {\n\t\t\tthis.nameElem.querySelector('.heroic-label')?.remove();\n\t\t}\n\n\t\tif (newItem._reforging !== 0) {\n\t\t\tconst reforge = this.player.getReforge(newItem.reforging);\n\t\t\tif (reforge) {\n\t\t\t\tthis.reforgeElem.innerText = `Reforged ${shortSecondaryStatNames.get(reforge?.fromStat[0])} > ${shortSecondaryStatNames.get(\n\t\t\t\t\treforge?.toStat[0],\n\t\t\t\t)}`;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.reforgeElem.innerText = '';\n\t\t}\n\n\t\tsetItemQualityCssClass(this.nameElem, newItem.item.quality);\n\n\t\tthis.player.setWowheadData(newItem, this.iconElem);\n\t\tthis.player.setWowheadData(newItem, this.nameElem);\n\t\tnewItem\n\t\t\t.asActionId()\n\t\t\t.fill()\n\t\t\t.then(filledId => {\n\t\t\t\tfilledId.setBackgroundAndHref(this.iconElem);\n\t\t\t\tfilledId.setWowheadHref(this.nameElem);\n\t\t\t});\n\n\t\tif (newItem.enchant) {\n\t\t\tgetEnchantDescription(newItem.enchant).then(description => {\n\t\t\t\tthis.enchantElem.textContent = description;\n\t\t\t});\n\t\t\t// Make enchant text hover have a tooltip.\n\t\t\tif (newItem.enchant.spellId) {\n\t\t\t\tthis.enchantElem.href = ActionId.makeSpellUrl(newItem.enchant.spellId);\n\t\t\t\tthis.enchantElem.dataset.wowhead = `domain=cata&spell=${newItem.enchant.spellId}`;\n\t\t\t} else {\n\t\t\t\tthis.enchantElem.href = ActionId.makeItemUrl(newItem.enchant.itemId);\n\t\t\t\tthis.enchantElem.dataset.wowhead = `domain=cata&item=${newItem.enchant.itemId}`;\n\t\t\t}\n\t\t\tthis.enchantElem.dataset.whtticon = 'false';\n\t\t}\n\n\t\tnewItem.allSocketColors().forEach((socketColor, gemIdx) => {\n\t\t\tconst gemContainer = createGemContainer(socketColor, newItem.gems[gemIdx]);\n\n\t\t\tif (gemIdx == newItem.numPossibleSockets - 1 && [ItemType.ItemTypeWrist, ItemType.ItemTypeHands].includes(newItem.item.type)) {\n\t\t\t\tconst updateProfession = () => {\n\t\t\t\t\tif (this.player.isBlacksmithing()) {\n\t\t\t\t\t\tgemContainer.classList.remove('hide');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tgemContainer.classList.add('hide');\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tthis.player.professionChangeEmitter.on(updateProfession);\n\t\t\t\tupdateProfession();\n\t\t\t}\n\t\t\tthis.socketsContainerElem.appendChild(gemContainer);\n\t\t});\n\t}\n}\n\nexport class ItemPicker extends Component {\n\treadonly slot: ItemSlot;\n\n\tprivate readonly simUI: SimUI;\n\tprivate readonly player: Player<any>;\n\n\tprivate readonly itemElem: ItemRenderer;\n\n\t// All items and enchants that are eligible for this slot\n\tprivate _items: Array<Item> = [];\n\tprivate _enchants: Array<Enchant> = [];\n\tprivate _equippedItem: EquippedItem | null = null;\n\n\tconstructor(parent: HTMLElement, simUI: SimUI, player: Player<any>, slot: ItemSlot) {\n\t\tsuper(parent, 'item-picker-root');\n\t\tthis.slot = slot;\n\t\tthis.simUI = simUI;\n\t\tthis.player = player;\n\t\tthis.itemElem = new ItemRenderer(parent, this.rootElem, player);\n\n\t\tthis.item = player.getEquippedItem(slot);\n\t\tplayer.sim.waitForInit().then(() => {\n\t\t\tthis._items = this.player.getItems(this.slot);\n\t\t\tthis._enchants = this.player.getEnchants(this.slot);\n\n\t\t\tconst gearData = {\n\t\t\t\tequipItem: (eventID: EventID, equippedItem: EquippedItem | null) => {\n\t\t\t\t\tthis.player.equipItem(eventID, this.slot, equippedItem);\n\t\t\t\t},\n\t\t\t\tgetEquippedItem: () => this.player.getEquippedItem(this.slot),\n\t\t\t\tchangeEvent: player.gearChangeEmitter,\n\t\t\t};\n\n\t\t\tconst openGearSelector = (event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.openSelectorModal(SelectorModalTabs.Items, gearData);\n\t\t\t};\n\t\t\tconst openEnchantSelector = (event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.openSelectorModal(SelectorModalTabs.Enchants, gearData);\n\t\t\t};\n\t\t\tconst openReforgeSelector = (event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tthis.openSelectorModal(SelectorModalTabs.Reforging, gearData);\n\t\t\t};\n\n\t\t\tthis.itemElem.iconElem.addEventListener('click', openGearSelector);\n\t\t\tthis.itemElem.nameElem.addEventListener('click', openGearSelector);\n\t\t\tthis.itemElem.reforgeElem.addEventListener('click', openReforgeSelector);\n\t\t\tthis.itemElem.enchantElem.addEventListener('click', openEnchantSelector);\n\t\t});\n\n\t\tplayer.gearChangeEmitter.on(() => {\n\t\t\tthis.item = player.getEquippedItem(slot);\n\t\t});\n\t\tplayer.professionChangeEmitter.on(() => {\n\t\t\tif (this._equippedItem != null) {\n\t\t\t\tthis.player.setWowheadData(this._equippedItem, this.itemElem.iconElem);\n\t\t\t}\n\t\t});\n\t}\n\n\tset item(newItem: EquippedItem | null) {\n\t\t// Clear everything first\n\t\tthis.itemElem.clear();\n\t\tthis.itemElem.nameElem.textContent = slotNames.get(this.slot) ?? '';\n\t\tsetItemQualityCssClass(this.itemElem.nameElem, null);\n\n\t\tif (newItem != null) {\n\t\t\tthis.itemElem.update(newItem);\n\t\t} else {\n\t\t\tthis.itemElem.iconElem.style.backgroundImage = `url('${getEmptySlotIconUrl(this.slot)}')`;\n\t\t}\n\n\t\tthis._equippedItem = newItem;\n\t}\n\n\tprivate openSelectorModal(tab: SelectorModalTabs, gearData: GearData) {\n\t\tnew SelectorModal(this.simUI.rootElem, this.simUI, this.player, {\n\t\t\tselectedTab: tab,\n\t\t\tslot: this.slot,\n\t\t\tequippedItem: this._equippedItem,\n\t\t\teligibleItems: this._items,\n\t\t\teligibleEnchants: this._enchants,\n\t\t\tgearData: gearData,\n\t\t});\n\t}\n}\n\nexport class IconItemSwapPicker extends Component {\n\tprivate readonly iconAnchor: HTMLAnchorElement;\n\tprivate readonly socketsContainerElem: HTMLElement;\n\tprivate readonly player: Player<any>;\n\tprivate readonly slot: ItemSlot;\n\n\t// All items and enchants that are eligible for this slot\n\tprivate _items: Array<Item> = [];\n\tprivate _enchants: Array<Enchant> = [];\n\n\tconstructor(parent: HTMLElement, simUI: SimUI, player: Player<any>, slot: ItemSlot) {\n\t\tsuper(parent, 'icon-picker-root');\n\t\tthis.rootElem.classList.add('icon-picker');\n\t\tthis.player = player;\n\t\tthis.slot = slot;\n\n\t\tthis.iconAnchor = document.createElement('a');\n\t\tthis.iconAnchor.classList.add('icon-picker-button');\n\t\tthis.iconAnchor.target = '_blank';\n\t\tthis.rootElem.prepend(this.iconAnchor);\n\n\t\tthis.socketsContainerElem = document.createElement('div');\n\t\tthis.socketsContainerElem.classList.add('item-picker-sockets-container');\n\t\tthis.iconAnchor.appendChild(this.socketsContainerElem);\n\n\t\tplayer.sim.waitForInit().then(() => {\n\t\t\tthis._items = this.player.getItems(slot);\n\t\t\tthis._enchants = this.player.getEnchants(slot);\n\t\t\tconst gearData = {\n\t\t\t\tequipItem: (eventID: EventID, newItem: EquippedItem | null) => {\n\t\t\t\t\tplayer.equipItemSwapitem(eventID, this.slot, newItem);\n\t\t\t\t},\n\t\t\t\tgetEquippedItem: () => player.getItemSwapItem(this.slot),\n\t\t\t\tchangeEvent: player.itemSwapChangeEmitter,\n\t\t\t};\n\n\t\t\tthis.iconAnchor.addEventListener('click', (event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tnew SelectorModal(simUI.rootElem, simUI, this.player, {\n\t\t\t\t\tselectedTab: SelectorModalTabs.Items,\n\t\t\t\t\tslot: this.slot,\n\t\t\t\t\tequippedItem: this.player.getItemSwapGear().getEquippedItem(slot),\n\t\t\t\t\teligibleItems: this._items,\n\t\t\t\t\teligibleEnchants: this._enchants,\n\t\t\t\t\tgearData: gearData,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tplayer.itemSwapChangeEmitter.on(() => {\n\t\t\tthis.update(player.getItemSwapGear().getEquippedItem(slot));\n\t\t});\n\t}\n\n\tupdate(newItem: EquippedItem | null) {\n\t\tthis.iconAnchor.style.backgroundImage = `url('${getEmptySlotIconUrl(this.slot)}')`;\n\t\tthis.iconAnchor.removeAttribute('data-wowhead');\n\t\tthis.iconAnchor.href = '#';\n\t\tthis.socketsContainerElem.innerText = '';\n\n\t\tif (newItem) {\n\t\t\tthis.iconAnchor.classList.add('active');\n\n\t\t\tnewItem.asActionId().fillAndSet(this.iconAnchor, true, true);\n\t\t\tthis.player.setWowheadData(newItem, this.iconAnchor);\n\n\t\t\tnewItem.allSocketColors().forEach((socketColor, gemIdx) => {\n\t\t\t\tthis.socketsContainerElem.appendChild(createGemContainer(socketColor, newItem.gems[gemIdx]));\n\t\t\t});\n\t\t} else {\n\t\t\tthis.iconAnchor.classList.remove('active');\n\t\t}\n\t}\n}\n\nexport interface GearData {\n\tequipItem: (eventID: EventID, equippedItem: EquippedItem | null) => void;\n\tgetEquippedItem: () => EquippedItem | null;\n\tchangeEvent: TypedEvent<any>;\n}\n\nexport enum SelectorModalTabs {\n\tItems = 'Items',\n\tEnchants = 'Enchants',\n\tReforging = 'Reforging',\n\tGem1 = 'Gem1',\n\tGem2 = 'Gem2',\n\tGem3 = 'Gem3',\n}\n\ninterface SelectorModalConfig {\n\tselectedTab: SelectorModalTabs;\n\tslot: ItemSlot;\n\tequippedItem: EquippedItem | null;\n\teligibleItems: Array<Item>;\n\teligibleEnchants: Array<Enchant>;\n\tgearData: GearData;\n}\n\nexport class SelectorModal extends BaseModal {\n\tprivate readonly simUI: SimUI;\n\tprivate player: Player<any>;\n\tprivate config: SelectorModalConfig;\n\tprivate ilists: ItemList<any>[];\n\tprivate updateReforgeList: (newReforgeData: Array<ReforgeData & { ep: number }>) => void;\n\n\tprivate readonly tabsElem: HTMLElement;\n\tprivate readonly contentElem: HTMLElement;\n\n\tconstructor(parent: HTMLElement, simUI: SimUI, player: Player<any>, config: SelectorModalConfig) {\n\t\tsuper(parent, 'selector-modal');\n\n\t\tthis.simUI = simUI;\n\t\tthis.player = player;\n\t\tthis.config = config;\n\t\tthis.ilists = [];\n\t\tthis.updateReforgeList = (_newReforgeData: Array<ReforgeData & { ep: number }>) => {\n\t\t\treturn;\n\t\t};\n\n\t\twindow.scrollTo({ top: 0 });\n\n\t\tthis.header!.insertAdjacentElement('afterbegin', <ul className=\"nav nav-tabs selector-modal-tabs\"></ul>);\n\n\t\tthis.body.appendChild(<div className=\"tab-content selector-modal-tab-content\"></div>);\n\n\t\tthis.tabsElem = this.rootElem.querySelector('.selector-modal-tabs') as HTMLElement;\n\t\tthis.contentElem = this.rootElem.querySelector('.selector-modal-tab-content') as HTMLElement;\n\n\t\tthis.setData();\n\n\t\tthis.body.appendChild(\n\t\t\t<div className=\"d-flex align-items-center form-text mt-3\">\n\t\t\t\t<i className=\"fas fa-circle-exclamation fa-xl me-2\"></i>\n\t\t\t\t<span>\n\t\t\t\t\tIf gear is missing, check the selected phase and your gear filters.\n\t\t\t\t\t<br />\n\t\t\t\t\tIf the problem persists, save any un-saved data, click the\n\t\t\t\t\t<i className=\"fas fa-cog mx-1\"></i>\n\t\t\t\t\tto open your sim options, then click the \"Restore Defaults\".\n\t\t\t\t</span>\n\t\t\t</div>,\n\t\t);\n\t}\n\n\t// Could be 'Items' 'Enchants' or 'Gem1'-'Gem3'\n\topenTabName(name: string) {\n\t\tArray.from(this.tabsElem.getElementsByClassName('selector-modal-item-tab')).forEach(elem => {\n\t\t\tif (elem.getAttribute('data-content-id') == name + '-tab') {\n\t\t\t\t(elem as HTMLElement).click();\n\t\t\t}\n\t\t});\n\t}\n\n\topenTab(idx: number) {\n\t\tconst elems = this.tabsElem.getElementsByClassName('selector-modal-item-tab');\n\t\t(elems[idx] as HTMLElement).click();\n\t}\n\n\tsetData() {\n\t\tthis.tabsElem.innerText = '';\n\t\tthis.contentElem.innerText = '';\n\n\t\tconst { slot, equippedItem, eligibleItems, eligibleEnchants, gearData } = this.config;\n\n\t\tthis.addTab<Item>(\n\t\t\t'Items',\n\t\t\teligibleItems.map(item => {\n\t\t\t\treturn {\n\t\t\t\t\titem: item,\n\t\t\t\t\tid: item.id,\n\t\t\t\t\tactionId: ActionId.fromItem(item),\n\t\t\t\t\tname: item.name,\n\t\t\t\t\tquality: item.quality,\n\t\t\t\t\theroic: item.heroic,\n\t\t\t\t\tphase: item.phase,\n\t\t\t\t\tbaseEP: this.player.computeItemEP(item, slot),\n\t\t\t\t\tignoreEPFilter: false,\n\t\t\t\t\tonEquip: (eventID, item: Item) => {\n\t\t\t\t\t\tconst equippedItem = gearData.getEquippedItem();\n\t\t\t\t\t\tif (equippedItem) {\n\t\t\t\t\t\t\tgearData.equipItem(eventID, equippedItem.withItem(item));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tgearData.equipItem(eventID, new EquippedItem(item));\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}),\n\t\t\titem => this.player.computeItemEP(item, slot),\n\t\t\tequippedItem => equippedItem?.item,\n\t\t\tGemColor.GemColorUnknown,\n\t\t\teventID => {\n\t\t\t\tgearData.equipItem(eventID, null);\n\t\t\t\tthis.removeTabs('Gem');\n\t\t\t\tthis.removeTabs('Random Suffixes');\n\t\t\t},\n\t\t);\n\n\t\tthis.addTab<Enchant>(\n\t\t\t'Enchants',\n\t\t\teligibleEnchants.map(enchant => {\n\t\t\t\treturn {\n\t\t\t\t\titem: enchant,\n\t\t\t\t\tid: enchant.effectId,\n\t\t\t\t\tactionId: enchant.itemId ? ActionId.fromItemId(enchant.itemId) : ActionId.fromSpellId(enchant.spellId),\n\t\t\t\t\tname: enchant.name,\n\t\t\t\t\tquality: enchant.quality,\n\t\t\t\t\tphase: enchant.phase || 1,\n\t\t\t\t\tbaseEP: this.player.computeStatsEP(new Stats(enchant.stats)),\n\t\t\t\t\tignoreEPFilter: true,\n\t\t\t\t\theroic: false,\n\t\t\t\t\tonEquip: (eventID, enchant: Enchant) => {\n\t\t\t\t\t\tconst equippedItem = gearData.getEquippedItem();\n\t\t\t\t\t\tif (equippedItem) gearData.equipItem(eventID, equippedItem.withEnchant(enchant));\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}),\n\t\t\tenchant => this.player.computeEnchantEP(enchant),\n\t\t\tequippedItem => equippedItem?.enchant,\n\t\t\tGemColor.GemColorUnknown,\n\t\t\teventID => {\n\t\t\t\tconst equippedItem = gearData.getEquippedItem();\n\t\t\t\tif (equippedItem) gearData.equipItem(eventID, equippedItem.withEnchant(null));\n\t\t\t},\n\t\t);\n\n\t\tthis.addRandomSuffixTab(equippedItem, gearData);\n\t\tthis.addReforgingTab(gearData.getEquippedItem(), gearData);\n\t\tthis.addGemTabs(slot, equippedItem, gearData);\n\t}\n\n\tprotected override onShow(e: Event) {\n\t\t// Only refresh opened tab\n\t\tconst t = e.target! as HTMLElement;\n\t\tconst tab = t.querySelector<HTMLElement>('.active')!.dataset.contentId!;\n\t\tif (tab.includes('Item')) {\n\t\t\tthis.ilists[0].sizeRefresh();\n\t\t} else if (tab.includes('Enchant')) {\n\t\t\tthis.ilists[1].sizeRefresh();\n\t\t}\n\t}\n\n\tprivate addGemTabs(slot: ItemSlot, equippedItem: EquippedItem | null, gearData: GearData) {\n\t\tif (equippedItem == undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst socketBonusEP = this.player.computeStatsEP(new Stats(equippedItem.item.socketBonus)) / (equippedItem.item.gemSockets.length || 1);\n\t\tequippedItem.curSocketColors(this.player.isBlacksmithing()).forEach((socketColor, socketIdx) => {\n\t\t\tthis.addTab<Gem>(\n\t\t\t\t'Gem ' + (socketIdx + 1),\n\t\t\t\tthis.player.getGems(socketColor).map((gem: Gem) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\titem: gem,\n\t\t\t\t\t\tid: gem.id,\n\t\t\t\t\t\tactionId: ActionId.fromItemId(gem.id),\n\t\t\t\t\t\tname: gem.name,\n\t\t\t\t\t\tquality: gem.quality,\n\t\t\t\t\t\tphase: gem.phase,\n\t\t\t\t\t\theroic: false,\n\t\t\t\t\t\tbaseEP: this.player.computeStatsEP(new Stats(gem.stats)),\n\t\t\t\t\t\tignoreEPFilter: true,\n\t\t\t\t\t\tonEquip: (eventID, gem: Gem) => {\n\t\t\t\t\t\t\tconst equippedItem = gearData.getEquippedItem();\n\t\t\t\t\t\t\tif (equippedItem) gearData.equipItem(eventID, equippedItem.withGem(gem, socketIdx));\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\tgem => {\n\t\t\t\t\tlet gemEP = this.player.computeGemEP(gem);\n\t\t\t\t\tif (gemMatchesSocket(gem, socketColor)) {\n\t\t\t\t\t\tgemEP += socketBonusEP;\n\t\t\t\t\t}\n\t\t\t\t\treturn gemEP;\n\t\t\t\t},\n\t\t\t\tequippedItem => equippedItem?.gems[socketIdx],\n\t\t\t\tsocketColor,\n\t\t\t\teventID => {\n\t\t\t\t\tconst equippedItem = gearData.getEquippedItem();\n\t\t\t\t\tif (equippedItem) gearData.equipItem(eventID, equippedItem.withGem(null, socketIdx));\n\t\t\t\t},\n\t\t\t\ttabAnchor => {\n\t\t\t\t\tconst gemContainer = createGemContainer(socketColor, null);\n\t\t\t\t\ttabAnchor.appendChild(gemContainer);\n\t\t\t\t\ttabAnchor.classList.add('selector-modal-tab-gem');\n\n\t\t\t\t\tconst gemElem = tabAnchor.querySelector('.gem-icon') as HTMLElement;\n\t\t\t\t\tconst emptySocketUrl = getEmptyGemSocketIconUrl(socketColor);\n\n\t\t\t\t\tconst updateGemIcon = () => {\n\t\t\t\t\t\tconst equippedItem = gearData.getEquippedItem();\n\t\t\t\t\t\tconst gem = equippedItem?.gems[socketIdx];\n\n\t\t\t\t\t\tif (gem) {\n\t\t\t\t\t\t\tgemElem.classList.remove('hide');\n\t\t\t\t\t\t\tActionId.fromItemId(gem.id)\n\t\t\t\t\t\t\t\t.fill()\n\t\t\t\t\t\t\t\t.then(filledId => {\n\t\t\t\t\t\t\t\t\tgemElem.setAttribute('src', filledId.iconUrl);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tgemElem.classList.add('hide');\n\t\t\t\t\t\t\tgemElem.setAttribute('src', emptySocketUrl);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tgearData.changeEvent.on(updateGemIcon);\n\t\t\t\t\tthis.addOnDisposeCallback(() => gearData.changeEvent.off(updateGemIcon));\n\t\t\t\t\tupdateGemIcon();\n\t\t\t\t},\n\t\t\t);\n\t\t});\n\t}\n\n\tprivate addRandomSuffixTab(equippedItem: EquippedItem | null, gearData: GearData) {\n\t\tif (equippedItem == undefined || equippedItem.item.randomSuffixOptions.length == 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst itemProto = equippedItem.item;\n\n\t\tthis.addTab<ItemRandomSuffix>(\n\t\t\t'Random Suffixes',\n\t\t\tthis.player.getRandomSuffixes(itemProto).map((randomSuffix: ItemRandomSuffix) => {\n\t\t\t\treturn {\n\t\t\t\t\titem: randomSuffix,\n\t\t\t\t\tid: randomSuffix.id,\n\t\t\t\t\tactionId: ActionId.fromRandomSuffix(itemProto, randomSuffix),\n\t\t\t\t\tname: randomSuffix.name,\n\t\t\t\t\tquality: itemProto.quality,\n\t\t\t\t\tphase: itemProto.phase,\n\t\t\t\t\theroic: false,\n\t\t\t\t\tbaseEP: this.player.computeRandomSuffixEP(randomSuffix),\n\t\t\t\t\tignoreEPFilter: true,\n\t\t\t\t\tonEquip: (eventID, randomSuffix: ItemRandomSuffix) => {\n\t\t\t\t\t\tconst equippedItem = gearData.getEquippedItem();\n\n\t\t\t\t\t\tif (equippedItem) gearData.equipItem(eventID, equippedItem.withRandomSuffix(randomSuffix));\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}),\n\t\t\trandomSuffix => this.player.computeRandomSuffixEP(randomSuffix),\n\t\t\tequippedItem => equippedItem?.randomSuffix,\n\t\t\tGemColor.GemColorUnknown,\n\t\t\teventID => {\n\t\t\t\tconst equippedItem = gearData.getEquippedItem();\n\t\t\t\tif (equippedItem) gearData.equipItem(eventID, equippedItem.withRandomSuffix(null));\n\t\t\t},\n\t\t);\n\t}\n\n\tprivate prepareReforgeData(reforge: ReforgeStat, item: EquippedItem): ReforgeData & { ep: number } {\n\t\tconst itemProto = item.item;\n\n\t\tconst fromAmount = Math.ceil(-itemProto.stats[reforge.fromStat[0]] * reforge.multiplier);\n\t\tconst toAmount = Math.floor(itemProto.stats[reforge.fromStat[0]] * reforge.multiplier);\n\t\tconst forge = {\n\t\t\treforge,\n\t\t\titem,\n\t\t\tfromStat: reforge.fromStat,\n\t\t\ttoAmount,\n\t\t\ttoStat: reforge.toStat,\n\t\t\treforgeId: reforge.id,\n\t\t\tfromAmount,\n\t\t};\n\n\t\tconst ep = this.player.computeReforgingEP(forge);\n\t\treturn {\n\t\t\t...forge,\n\t\t\tep,\n\t\t};\n\t}\n\n\tprivate addReforgingTab(equippedItem: EquippedItem | null, gearData: GearData) {\n\t\tif (equippedItem == undefined) {\n\t\t\treturn;\n\t\t}\n\t\tif (equippedItem.randomSuffix !== null) {\n\t\t\tequippedItem._item.stats = equippedItem.randomSuffix.stats.map(stat =>\n\t\t\t\tstat > 0 ? Math.floor((stat * equippedItem._item.randPropPoints) / 10000) : stat,\n\t\t\t);\n\t\t}\n\t\tconst itemProto = equippedItem.item;\n\n\t\tthis.player.gearChangeEmitter.on(() => {\n\t\t\tconst newItem = this.player.getGear().getEquippedItem(this.config.slot);\n\n\t\t\tif (newItem !== null) {\n\t\t\t\tif (newItem.randomSuffix !== null) {\n\t\t\t\t\tnewItem._item.stats = newItem.randomSuffix.stats.map(stat => (stat > 0 ? Math.floor((stat * newItem._item.randPropPoints) / 10000) : stat));\n\t\t\t\t}\n\t\t\t\tconst reforgings = this.player.getAvailableReforgings(newItem._item) ?? [];\n\n\t\t\t\tthis.updateReforgeList(\n\t\t\t\t\treforgings\n\t\t\t\t\t\t?.map(reforge => {\n\t\t\t\t\t\t\treturn this.prepareReforgeData(reforge, newItem);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.sort((a, b) => b.ep - a.ep) ?? [],\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t\tconst reforgings = this.player.getAvailableReforgings(itemProto);\n\t\tthis.addReforgeTabs(\n\t\t\t'Reforging',\n\t\t\treforgings\n\t\t\t\t?.map(reforge => {\n\t\t\t\t\treturn this.prepareReforgeData(reforge, equippedItem);\n\t\t\t\t})\n\t\t\t\t.sort((a, b) => b.ep - a.ep) ?? [],\n\t\t\t(item, id) => {\n\t\t\t\tgearData.equipItem(id, item);\n\t\t\t\treturn;\n\t\t\t},\n\t\t);\n\t}\n\tprivate addReforgeTabs(label: string, reforgeData: Array<ReforgeData>, onAdd: (item: EquippedItem, EventId: EventID) => void) {\n\t\tif (reforgeData.length == 0) {\n\t\t\t//return;\n\t\t}\n\n\t\tconst tabContentId = (label + '-tab').split(' ').join('');\n\t\tconst selected = label === this.config.selectedTab;\n\n\t\tconst tabAnchor = ref<HTMLAnchorElement>();\n\t\tthis.tabsElem.appendChild(\n\t\t\t<li className=\"nav-item\">\n\t\t\t\t<a\n\t\t\t\t\tref={tabAnchor}\n\t\t\t\t\tclassName={`nav-link selector-modal-item-tab ${selected ? 'active' : ''}`}\n\t\t\t\t\tdataset={{\n\t\t\t\t\t\tlabel: label,\n\t\t\t\t\t\tcontentId: tabContentId,\n\t\t\t\t\t\tbsToggle: 'tab',\n\t\t\t\t\t\tbsTarget: `#${tabContentId}`,\n\t\t\t\t\t}}\n\t\t\t\t\tattributes={{\n\t\t\t\t\t\trole: 'tab',\n\t\t\t\t\t\t'aria-selected': selected,\n\t\t\t\t\t}}\n\t\t\t\t\ttype=\"button\"></a>\n\t\t\t</li>,\n\t\t);\n\t\ttabAnchor.value!.textContent = label;\n\t\t// Tab content for Reforges\n\t\tconst tabContent = (\n\t\t\t<div id={tabContentId} className={`selector-modal-tab-pane tab-pane fade ${selected ? 'active show' : ''}`}>\n\t\t\t\t<div className=\"selector-modal-list-labels\">\n\t\t\t\t\t<label className=\"item-label\">\n\t\t\t\t\t\t<small>Reforge</small>\n\t\t\t\t\t</label>\n\t\t\t\t\t<label className=\"reforge-label\">\n\t\t\t\t\t\t<small>To</small>\n\t\t\t\t\t</label>\n\t\t\t\t\t<label className=\"ep-label\">\n\t\t\t\t\t\t<small>EP</small>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<ul className=\"selector-modal-list\"></ul>\n\t\t\t</div>\n\t\t);\n\t\tconst updateReforgeList = (newReforgeData: ReforgeData[]) => {\n\t\t\tconst listElement = document.querySelector(`#${tabContentId} .selector-modal-list`);\n\t\t\tif (listElement) {\n\t\t\t\t// Clear the current list\n\t\t\t\tlistElement.innerHTML = '';\n\t\t\t\tnewReforgeData.forEach(data => {\n\t\t\t\t\tconst listItem = document.createElement('li');\n\t\t\t\t\tlistItem.className = `selector-modal-list-item reforge ${data.reforgeId == data.item.reforging ? 'selected' : ''}`;\n\t\t\t\t\tlistItem.setAttribute('data-reforge-id', data.reforgeId.toString());\n\t\t\t\t\tlistItem.onclick = () => {\n\t\t\t\t\t\tif (data.item.reforging !== data.reforgeId) {\n\t\t\t\t\t\t\tonAdd(data.item.withReforge(data.reforgeId), TypedEvent.nextEventID());\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tonAdd(data.item.withItem(data.item.item), TypedEvent.nextEventID());\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tconst lossSpan = document.createElement('span');\n\t\t\t\t\tlossSpan.className = 'loss';\n\t\t\t\t\tlossSpan.textContent = `${data.fromAmount} ${shortSecondaryStatNames.get(data.fromStat[0])}`;\n\t\t\t\t\tlistItem.appendChild(lossSpan);\n\n\t\t\t\t\tconst gainSpan = document.createElement('span');\n\t\t\t\t\tgainSpan.className = 'gain';\n\t\t\t\t\tgainSpan.textContent = `+${data.toAmount} ${shortSecondaryStatNames.get(data.toStat[0])}`;\n\t\t\t\t\tlistItem.appendChild(gainSpan);\n\t\t\t\t\tconst ep = this.player.computeReforgingEP(data);\n\t\t\t\t\tconst epSpan = document.createElement('span');\n\t\t\t\t\tepSpan.className = `selector-modal-list-item-ep ${ep < 0 ? 'loss' : 'gain'}`;\n\t\t\t\t\tepSpan.textContent = `${ep > 0 ? '+' : ''}${Number(ep.toFixed(2)).toString()}`;\n\t\t\t\t\tlistItem.appendChild(epSpan);\n\n\t\t\t\t\tlistElement.appendChild(listItem);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t\tthis.contentElem.appendChild(tabContent);\n\t\tthis.updateReforgeList = updateReforgeList;\n\n\t\t// Initial\n\t\tupdateReforgeList(reforgeData);\n\t}\n\n\t/**\n\t * Adds one of the tabs for the item selector menu.\n\t *\n\t * T is expected to be Item, Enchant, or Gem. Tab menus for all 3 looks extremely\n\t * similar so this function uses extra functions to do it generically.\n\t */\n\tprivate addTab<T>(\n\t\tlabel: string,\n\t\titemData: Array<ItemData<T>>,\n\t\tcomputeEP: (item: T) => number,\n\t\tequippedToItemFn: (equippedItem: EquippedItem | null) => T | null | undefined,\n\t\tsocketColor: GemColor,\n\t\tonRemove: (eventID: EventID) => void,\n\t\tsetTabContent?: (tabElem: HTMLAnchorElement) => void,\n\t) {\n\t\tif (itemData.length == 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { slot, gearData } = this.config;\n\t\tconst tabContentId = (label + '-tab').split(' ').join('');\n\t\tconst selected = label === this.config.selectedTab;\n\n\t\tconst tabAnchor = ref<HTMLAnchorElement>();\n\t\tthis.tabsElem.appendChild(\n\t\t\t<li className=\"nav-item\">\n\t\t\t\t<a\n\t\t\t\t\tref={tabAnchor}\n\t\t\t\t\tclassName={`nav-link selector-modal-item-tab ${selected ? 'active' : ''}`}\n\t\t\t\t\tdataset={{\n\t\t\t\t\t\tlabel: label,\n\t\t\t\t\t\tcontentId: tabContentId,\n\t\t\t\t\t\tbsToggle: 'tab',\n\t\t\t\t\t\tbsTarget: `#${tabContentId}`,\n\t\t\t\t\t}}\n\t\t\t\t\tattributes={{\n\t\t\t\t\t\trole: 'tab',\n\t\t\t\t\t\t'aria-selected': selected,\n\t\t\t\t\t}}\n\t\t\t\t\ttype=\"button\"></a>\n\t\t\t</li>,\n\t\t);\n\n\t\tif (setTabContent) {\n\t\t\tsetTabContent(tabAnchor.value!);\n\t\t} else {\n\t\t\ttabAnchor.value!.textContent = label;\n\t\t}\n\n\t\t// TODO: do we need this check here?\n\t\tif (itemData.length == 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst ilist = new ItemList<T>(\n\t\t\tthis.contentElem,\n\t\t\tthis.simUI,\n\t\t\tthis.config,\n\t\t\tthis.player,\n\t\t\tlabel,\n\t\t\titemData,\n\t\t\tcomputeEP,\n\t\t\tequippedToItemFn,\n\t\t\tsocketColor,\n\t\t\tonRemove,\n\t\t\t(itemData: ItemData<T>) => {\n\t\t\t\tconst item = itemData.item;\n\t\t\t\titemData.onEquip(TypedEvent.nextEventID(), item);\n\n\t\t\t\t// If the item changes, then gem slots and random suffix options will also change, so remove and recreate these tabs.\n\t\t\t\tif (Item.is(item)) {\n\t\t\t\t\tthis.removeTabs('Random Suffixes');\n\t\t\t\t\tthis.addRandomSuffixTab(gearData.getEquippedItem(), gearData);\n\t\t\t\t\tthis.removeTabs('Gem');\n\t\t\t\t\tthis.addGemTabs(slot, gearData.getEquippedItem(), gearData);\n\t\t\t\t\tthis.removeTabs('Reforging');\n\t\t\t\t\tthis.addReforgingTab(gearData.getEquippedItem(), gearData);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\n\t\tconst invokeUpdate = () => {\n\t\t\tilist.updateSelected();\n\t\t};\n\t\tconst applyFilter = () => {\n\t\t\tilist.applyFilters();\n\t\t};\n\t\tconst hideOrShowEPValues = () => {\n\t\t\tilist.hideOrShowEPValues();\n\t\t};\n\t\t// Add event handlers\n\t\tgearData.changeEvent.on(invokeUpdate);\n\n\t\tthis.player.sim.phaseChangeEmitter.on(applyFilter);\n\t\tthis.player.sim.filtersChangeEmitter.on(applyFilter);\n\t\tthis.player.sim.showEPValuesChangeEmitter.on(hideOrShowEPValues);\n\n\t\tthis.addOnDisposeCallback(() => {\n\t\t\tgearData.changeEvent.off(invokeUpdate);\n\t\t\tthis.player.sim.phaseChangeEmitter.off(applyFilter);\n\t\t\tthis.player.sim.filtersChangeEmitter.off(applyFilter);\n\t\t\tthis.player.sim.showEPValuesChangeEmitter.off(hideOrShowEPValues);\n\t\t\tilist.dispose();\n\t\t});\n\n\t\ttabAnchor.value!.addEventListener('shown.bs.tab', _event => {\n\t\t\tilist.sizeRefresh();\n\t\t});\n\n\t\tthis.ilists.push(ilist);\n\t}\n\n\tprivate removeTabs(labelSubstring: string) {\n\t\tconst tabElems = Array.prototype.slice\n\t\t\t.call(this.tabsElem.getElementsByClassName('selector-modal-item-tab'))\n\t\t\t.filter(tab => tab.dataset.label.includes(labelSubstring));\n\n\t\tconst contentElems = tabElems.map(tabElem => document.getElementById(tabElem.dataset.contentId!)).filter(tabElem => Boolean(tabElem));\n\n\t\ttabElems.forEach(elem => elem.parentElement.remove());\n\t\tcontentElems.forEach(elem => elem!.remove());\n\t}\n}\n\nexport interface ItemData<T> {\n\titem: T;\n\tname: string;\n\tid: number;\n\tactionId: ActionId;\n\tquality: ItemQuality;\n\tphase: number;\n\tbaseEP: number;\n\tignoreEPFilter: boolean;\n\theroic: boolean;\n\tonEquip: (eventID: EventID, item: T) => void;\n}\nexport interface ReforgeData {\n\titem: EquippedItem;\n\treforge: ReforgeStat;\n\tfromStat: Stat[];\n\ttoStat: Stat[];\n\tfromAmount: number;\n\ttoAmount: number;\n\treforgeId: number;\n}\n\ninterface ItemDataWithIdx<T> {\n\tidx: number;\n\tdata: ItemData<T>;\n}\n\nconst emptySlotIcons: Record<ItemSlot, string> = {\n\t[ItemSlot.ItemSlotHead]: '/cata/assets/item_slots/head.jpg',\n\t[ItemSlot.ItemSlotNeck]: '/cata/assets/item_slots/neck.jpg',\n\t[ItemSlot.ItemSlotShoulder]: '/cata/assets/item_slots/shoulders.jpg',\n\t[ItemSlot.ItemSlotBack]: '/cata/assets/item_slots/shirt.jpg',\n\t[ItemSlot.ItemSlotChest]: '/cata/assets/item_slots/chest.jpg',\n\t[ItemSlot.ItemSlotWrist]: '/cata/assets/item_slots/wrists.jpg',\n\t[ItemSlot.ItemSlotHands]: '/cata/assets/item_slots/hands.jpg',\n\t[ItemSlot.ItemSlotWaist]: '/cata/assets/item_slots/waist.jpg',\n\t[ItemSlot.ItemSlotLegs]: '/cata/assets/item_slots/legs.jpg',\n\t[ItemSlot.ItemSlotFeet]: '/cata/assets/item_slots/feet.jpg',\n\t[ItemSlot.ItemSlotFinger1]: '/cata/assets/item_slots/finger.jpg',\n\t[ItemSlot.ItemSlotFinger2]: '/cata/assets/item_slots/finger.jpg',\n\t[ItemSlot.ItemSlotTrinket1]: '/cata/assets/item_slots/trinket.jpg',\n\t[ItemSlot.ItemSlotTrinket2]: '/cata/assets/item_slots/trinket.jpg',\n\t[ItemSlot.ItemSlotMainHand]: '/cata/assets/item_slots/mainhand.jpg',\n\t[ItemSlot.ItemSlotOffHand]: '/cata/assets/item_slots/offhand.jpg',\n\t[ItemSlot.ItemSlotRanged]: '/cata/assets/item_slots/ranged.jpg',\n};\nexport function getEmptySlotIconUrl(slot: ItemSlot): string {\n\treturn emptySlotIcons[slot];\n}\n\nexport class ItemList<T> {\n\tprivate listElem: HTMLElement;\n\tprivate readonly player: Player<any>;\n\tprivate label: string;\n\tprivate slot: ItemSlot;\n\tprivate itemData: Array<ItemData<T>>;\n\tprivate itemsToDisplay: Array<number>;\n\tprivate currentFilters: DatabaseFilters;\n\tprivate searchInput: HTMLInputElement;\n\tprivate socketColor: GemColor;\n\tprivate computeEP: (item: T) => number;\n\tprivate equippedToItemFn: (equippedItem: EquippedItem | null) => T | null | undefined;\n\tprivate gearData: GearData;\n\tprivate tabContent: Element;\n\tprivate onItemClick: (itemData: ItemData<T>) => void;\n\tprivate scroller: Clusterize;\n\n\tconstructor(\n\t\tparent: HTMLElement,\n\t\tsimUI: SimUI,\n\t\tconfig: SelectorModalConfig,\n\t\tplayer: Player<any>,\n\t\tlabel: string,\n\t\titemData: Array<ItemData<T>>,\n\t\tcomputeEP: (item: T) => number,\n\t\tequippedToItemFn: (equippedItem: EquippedItem | null) => T | null | undefined,\n\t\tsocketColor: GemColor,\n\t\tonRemove: (eventID: EventID) => void,\n\t\tonItemClick: (itemData: ItemData<T>) => void,\n\t) {\n\t\tthis.label = label;\n\t\tthis.player = player;\n\t\tthis.itemData = itemData;\n\t\tthis.socketColor = socketColor;\n\t\tthis.computeEP = computeEP;\n\t\tthis.equippedToItemFn = equippedToItemFn;\n\t\tthis.onItemClick = onItemClick;\n\n\t\tconst { slot, gearData } = config;\n\t\tthis.slot = slot;\n\t\tthis.gearData = gearData;\n\t\tthis.currentFilters = this.player.sim.getFilters();\n\n\t\tconst tabContentId = (label + '-tab').split(' ').join('');\n\t\tconst selected = label === config.selectedTab;\n\n\t\tconst epButton = ref<HTMLButtonElement>();\n\t\tthis.tabContent = (\n\t\t\t<div id={tabContentId} className={`selector-modal-tab-pane tab-pane fade ${selected ? 'active show' : ''}`}>\n\t\t\t\t<div className=\"selector-modal-filters\">\n\t\t\t\t\t<input className=\"selector-modal-search form-control\" type=\"text\" placeholder=\"Search...\" />\n\t\t\t\t\t{label == 'Items' && <button className=\"selector-modal-filters-button btn btn-primary\">Filters</button>}\n\t\t\t\t\t<div className=\"selector-modal-phase-selector\"></div>\n\t\t\t\t\t<div className=\"sim-input selector-modal-boolean-option selector-modal-show-1h-weapons\"></div>\n\t\t\t\t\t<div className=\"sim-input selector-modal-boolean-option selector-modal-show-2h-weapons\"></div>\n\t\t\t\t\t<div className=\"sim-input selector-modal-boolean-option selector-modal-show-matching-gems\"></div>\n\t\t\t\t\t<div className=\"sim-input selector-modal-boolean-option selector-modal-show-ep-values\"></div>\n\t\t\t\t\t<button className=\"selector-modal-simall-button btn btn-warning\">Add to Batch Sim</button>\n\t\t\t\t\t<button className=\"selector-modal-remove-button btn btn-danger\">Unequip Item</button>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"selector-modal-list-labels\">\n\t\t\t\t\t<label className=\"item-label\">\n\t\t\t\t\t\t<small>Item</small>\n\t\t\t\t\t</label>\n\t\t\t\t\t<label className=\"source-label\">\n\t\t\t\t\t\t<small>Source</small>\n\t\t\t\t\t</label>\n\t\t\t\t\t<label className=\"ep-label\">\n\t\t\t\t\t\t<small>EP</small>\n\t\t\t\t\t\t<i className=\"fa-solid fa-plus-minus fa-2xs\"></i>\n\t\t\t\t\t\t<button ref={epButton} className=\"btn btn-link p-0 ms-1\">\n\t\t\t\t\t\t\t<i className=\"far fa-question-circle fa-lg\"></i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</label>\n\t\t\t\t\t<label className=\"favorite-label\"></label>\n\t\t\t\t</div>\n\t\t\t\t<ul className=\"selector-modal-list\"></ul>\n\t\t\t</div>\n\t\t);\n\n\t\tparent.appendChild(this.tabContent);\n\n\t\tnew Tooltip(epButton.value!, {\n\t\t\ttitle: EP_TOOLTIP,\n\t\t});\n\n\t\tmakeShow1hWeaponsSelector(this.tabContent.getElementsByClassName('selector-modal-show-1h-weapons')[0] as HTMLElement, player.sim);\n\t\tmakeShow2hWeaponsSelector(this.tabContent.getElementsByClassName('selector-modal-show-2h-weapons')[0] as HTMLElement, player.sim);\n\t\tif (!(label == 'Items' && (slot == ItemSlot.ItemSlotMainHand || (slot == ItemSlot.ItemSlotOffHand && player.getClass() == Class.ClassWarrior)))) {\n\t\t\t(this.tabContent.getElementsByClassName('selector-modal-show-1h-weapons')[0] as HTMLElement).style.display = 'none';\n\t\t\t(this.tabContent.getElementsByClassName('selector-modal-show-2h-weapons')[0] as HTMLElement).style.display = 'none';\n\t\t}\n\n\t\tmakeShowEPValuesSelector(this.tabContent.getElementsByClassName('selector-modal-show-ep-values')[0] as HTMLElement, player.sim);\n\n\t\tmakeShowMatchingGemsSelector(this.tabContent.getElementsByClassName('selector-modal-show-matching-gems')[0] as HTMLElement, player.sim);\n\t\tif (!label.startsWith('Gem')) {\n\t\t\t(this.tabContent.getElementsByClassName('selector-modal-show-matching-gems')[0] as HTMLElement).style.display = 'none';\n\t\t}\n\n\t\tmakePhaseSelector(this.tabContent.getElementsByClassName('selector-modal-phase-selector')[0] as HTMLElement, player.sim);\n\n\t\tif (label == 'Items') {\n\t\t\tconst filtersButton = this.tabContent.getElementsByClassName('selector-modal-filters-button')[0] as HTMLElement;\n\t\t\tfiltersButton.addEventListener('click', () => new FiltersMenu(parent, player, slot));\n\t\t}\n\n\t\tthis.listElem = this.tabContent.getElementsByClassName('selector-modal-list')[0] as HTMLElement;\n\n\t\tthis.itemsToDisplay = [];\n\n\t\tthis.scroller = new Clusterize(\n\t\t\t{\n\t\t\t\tgetNumberOfRows: () => {\n\t\t\t\t\treturn this.itemsToDisplay.length;\n\t\t\t\t},\n\t\t\t\tgenerateRows: (startIdx, endIdx) => {\n\t\t\t\t\tconst items = [];\n\t\t\t\t\tfor (let i = startIdx; i < endIdx; ++i) {\n\t\t\t\t\t\tif (i >= this.itemsToDisplay.length) break;\n\t\t\t\t\t\titems.push(this.createItemElem({ idx: this.itemsToDisplay[i], data: this.itemData[this.itemsToDisplay[i]] }));\n\t\t\t\t\t}\n\t\t\t\t\treturn items;\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\trows: [],\n\t\t\t\tscroll_elem: this.listElem,\n\t\t\t\tcontent_elem: this.listElem,\n\t\t\t\titem_height: 56,\n\t\t\t\tshow_no_data_row: false,\n\t\t\t\tno_data_text: '',\n\t\t\t\ttag: 'li',\n\t\t\t\trows_in_block: 16,\n\t\t\t\tblocks_in_cluster: 2,\n\t\t\t},\n\t\t);\n\n\t\tconst removeButton = this.tabContent.getElementsByClassName('selector-modal-remove-button')[0] as HTMLButtonElement;\n\t\tremoveButton.addEventListener('click', _event => {\n\t\t\tonRemove(TypedEvent.nextEventID());\n\t\t});\n\n\t\tif (label.startsWith('Enchants')) {\n\t\t\tremoveButton.textContent = 'Remove Enchant';\n\t\t} else if (label.startsWith('Gem')) {\n\t\t\tremoveButton.textContent = 'Remove Gem';\n\t\t}\n\n\t\tthis.updateSelected();\n\n\t\tthis.searchInput = this.tabContent.getElementsByClassName('selector-modal-search')[0] as HTMLInputElement;\n\t\tthis.searchInput.addEventListener('input', () => this.applyFilters());\n\n\t\tconst simAllButton = this.tabContent.getElementsByClassName('selector-modal-simall-button')[0] as HTMLButtonElement;\n\t\tif (label == 'Items') {\n\t\t\tsimAllButton.hidden = !player.sim.getShowExperimental();\n\t\t\tplayer.sim.showExperimentalChangeEmitter.on(() => {\n\t\t\t\tsimAllButton.hidden = !player.sim.getShowExperimental();\n\t\t\t});\n\t\t\tsimAllButton.addEventListener('click', _event => {\n\t\t\t\tif (simUI instanceof IndividualSimUI) {\n\t\t\t\t\tconst itemSpecs = Array<ItemSpec>();\n\t\t\t\t\tconst isRangedOrTrinket =\n\t\t\t\t\t\tthis.slot == ItemSlot.ItemSlotRanged || this.slot == ItemSlot.ItemSlotTrinket1 || this.slot == ItemSlot.ItemSlotTrinket2;\n\n\t\t\t\t\tconst curItem = this.equippedToItemFn(this.player.getEquippedItem(this.slot));\n\t\t\t\t\tlet curEP = 0;\n\t\t\t\t\tif (curItem != null) {\n\t\t\t\t\t\tcurEP = this.computeEP(curItem);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const i of this.itemsToDisplay) {\n\t\t\t\t\t\tconst idata = this.itemData[i];\n\t\t\t\t\t\tif (!isRangedOrTrinket && curEP > 0 && idata.baseEP < curEP / 2) {\n\t\t\t\t\t\t\tcontinue; // If we have EPs on current item, dont sim items with less than half the EP.\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Add any item that is either >0 EP or a trinket/ranged item.\n\t\t\t\t\t\tif (idata.baseEP > 0 || isRangedOrTrinket) {\n\t\t\t\t\t\t\titemSpecs.push(ItemSpec.create({ id: idata.id }));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tsimUI.bt.addItems(itemSpecs);\n\t\t\t\t\t// TODO: should we open the bulk sim UI or should we run in the background showing progress, and then sort the items in the picker?\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\t// always hide non-items from being added to batch.\n\t\t\tsimAllButton.hidden = true;\n\t\t}\n\t}\n\n\tpublic sizeRefresh() {\n\t\tthis.scroller.refresh(true);\n\t\tthis.applyFilters();\n\t}\n\n\tpublic dispose() {\n\t\tthis.scroller.dispose();\n\t}\n\n\tpublic updateSelected() {\n\t\tconst newEquippedItem = this.gearData.getEquippedItem();\n\t\tconst newItem = this.equippedToItemFn(newEquippedItem);\n\n\t\tconst newItemId = newItem ? (this.label == 'Enchants' ? (newItem as unknown as Enchant).effectId : (newItem as unknown as Item | Gem).id) : 0;\n\t\tconst newEP = newItem ? this.computeEP(newItem) : 0;\n\n\t\tthis.scroller.elementUpdate(item => {\n\t\t\tconst idx = (item as HTMLElement).dataset.idx!;\n\t\t\tconst itemData = this.itemData[parseFloat(idx)];\n\t\t\tif (itemData.id == newItemId) item.classList.add('active');\n\t\t\telse item.classList.remove('active');\n\n\t\t\tconst epDeltaElem = item.getElementsByClassName('selector-modal-list-item-ep-delta')[0] as HTMLSpanElement;\n\t\t\tif (epDeltaElem) {\n\t\t\t\tepDeltaElem.textContent = '';\n\t\t\t\tif (itemData.item) {\n\t\t\t\t\tconst listItemEP = this.computeEP(itemData.item);\n\t\t\t\t\tif (newEP != listItemEP) {\n\t\t\t\t\t\tformatDeltaTextElem(epDeltaElem, newEP, listItemEP, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic applyFilters() {\n\t\tthis.currentFilters = this.player.sim.getFilters();\n\t\tlet itemIdxs = new Array<number>(this.itemData.length);\n\t\tfor (let i = 0; i < this.itemData.length; ++i) {\n\t\t\titemIdxs[i] = i;\n\t\t}\n\n\t\tconst currentEquippedItem = this.player.getEquippedItem(this.slot);\n\n\t\tif (this.label == 'Items') {\n\t\t\titemIdxs = this.player.filterItemData(itemIdxs, i => this.itemData[i].item as unknown as Item, this.slot);\n\t\t} else if (this.label == 'Enchants') {\n\t\t\titemIdxs = this.player.filterEnchantData(itemIdxs, i => this.itemData[i].item as unknown as Enchant, this.slot, currentEquippedItem);\n\t\t} else if (this.label.startsWith('Gem')) {\n\t\t\titemIdxs = this.player.filterGemData(itemIdxs, i => this.itemData[i].item as unknown as Gem, this.slot, this.socketColor);\n\t\t}\n\n\t\titemIdxs = itemIdxs.filter(i => {\n\t\t\tconst listItemData = this.itemData[i];\n\n\t\t\tif (listItemData.phase > this.player.sim.getPhase()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.searchInput.value.length > 0) {\n\t\t\t\tconst searchQuery = this.searchInput.value\n\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t.replaceAll(/[^a-zA-Z0-9\\s]/g, '')\n\t\t\t\t\t.split(' ');\n\t\t\t\tconst name = listItemData.name.toLowerCase().replaceAll(/[^a-zA-Z0-9\\s]/g, '');\n\n\t\t\t\tlet include = true;\n\t\t\t\tsearchQuery.forEach(v => {\n\t\t\t\t\tif (!name.includes(v)) include = false;\n\t\t\t\t});\n\t\t\t\tif (!include) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\n\t\tlet sortFn: (itemA: T, itemB: T) => number;\n\t\tif (this.slot == ItemSlot.ItemSlotTrinket1 || this.slot == ItemSlot.ItemSlotTrinket2) {\n\t\t\t// Trinket EP is weird so just sort by ilvl instead.\n\t\t\tsortFn = (itemA, itemB) => (itemB as unknown as Item).ilvl - (itemA as unknown as Item).ilvl;\n\t\t} else {\n\t\t\tsortFn = (itemA, itemB) => {\n\t\t\t\tconst diff = this.computeEP(itemB) - this.computeEP(itemA);\n\t\t\t\t// if EP is same, sort by ilvl\n\t\t\t\tif (Math.abs(diff) < 0.01) return (itemB as unknown as Item).ilvl - (itemA as unknown as Item).ilvl;\n\t\t\t\treturn diff;\n\t\t\t};\n\t\t}\n\n\t\titemIdxs = itemIdxs.sort((dataA, dataB) => {\n\t\t\tconst itemA = this.itemData[dataA];\n\t\t\tconst itemB = this.itemData[dataB];\n\t\t\tif (this.isItemFavorited(itemA) && !this.isItemFavorited(itemB)) return -1;\n\t\t\tif (this.isItemFavorited(itemB) && !this.isItemFavorited(itemA)) return 1;\n\n\t\t\treturn sortFn(itemA.item, itemB.item);\n\t\t});\n\n\t\tthis.itemsToDisplay = itemIdxs;\n\t\tthis.scroller.update();\n\n\t\tthis.hideOrShowEPValues();\n\t}\n\n\tpublic hideOrShowEPValues() {\n\t\tconst labels = this.tabContent.getElementsByClassName('ep-label');\n\t\tconst container = this.tabContent.getElementsByClassName('selector-modal-list');\n\t\tconst show = this.player.sim.getShowEPValues();\n\t\tconst display = show ? '' : 'none';\n\n\t\tfor (const label of labels) {\n\t\t\t(label as HTMLElement).style.display = display;\n\t\t}\n\n\t\tfor (const c of container) {\n\t\t\tif (show) c.classList.remove('hide-ep');\n\t\t\telse c.classList.add('hide-ep');\n\t\t}\n\t}\n\n\tprivate createItemElem(item: ItemDataWithIdx<T>): JSX.Element {\n\t\tconst itemData = item.data;\n\t\tconst itemEP = this.computeEP(itemData.item);\n\n\t\tconst equippedItem = this.equippedToItemFn(this.gearData.getEquippedItem());\n\t\tconst equippedItemID = equippedItem\n\t\t\t? this.label == 'Enchants'\n\t\t\t\t? (equippedItem as unknown as Enchant).effectId\n\t\t\t\t: (equippedItem as unknown as Item).id\n\t\t\t: 0;\n\t\tconst equippedItemEP = equippedItem ? this.computeEP(equippedItem) : 0;\n\n\t\tconst nameElem = ref<HTMLLabelElement>();\n\t\tconst anchorElem = ref<HTMLAnchorElement>();\n\t\tconst iconElem = ref<HTMLImageElement>();\n\t\tconst listItemElem = (\n\t\t\t<li className={`selector-modal-list-item ${equippedItemID == itemData.id ? 'active' : ''}`} dataset={{ idx: item.idx.toString() }}>\n\t\t\t\t<div className=\"selector-modal-list-label-cell\">\n\t\t\t\t\t<a className=\"selector-modal-list-item-link\" ref={anchorElem} dataset={{ whtticon: 'false' }}>\n\t\t\t\t\t\t<img className=\"selector-modal-list-item-icon\" ref={iconElem}></img>\n\t\t\t\t\t\t<label className=\"selector-modal-list-item-name\" ref={nameElem}>\n\t\t\t\t\t\t\t{itemData.name}\n\t\t\t\t\t\t\t{itemData.heroic && createHeroicLabel()}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</li>\n\t\t);\n\n\t\tif (this.label == 'Items') {\n\t\t\tlistItemElem.appendChild(\n\t\t\t\t<div className=\"selector-modal-list-item-source-container\">{this.getSourceInfo(itemData.item as unknown as Item, this.player.sim)}</div>,\n\t\t\t);\n\t\t}\n\n\t\tif (this.slot != ItemSlot.ItemSlotTrinket1 && this.slot != ItemSlot.ItemSlotTrinket2) {\n\t\t\tlistItemElem.appendChild(\n\t\t\t\t<div className=\"selector-modal-list-item-ep\">\n\t\t\t\t\t<span className=\"selector-modal-list-item-ep-value\">{itemEP < 9.95 ? itemEP.toFixed(1).toString() : Math.round(itemEP).toString()}</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclassName=\"selector-modal-list-item-ep-delta\"\n\t\t\t\t\t\tref={e => itemData.item && equippedItemEP != itemEP && formatDeltaTextElem(e, equippedItemEP, itemEP, 0)}></span>\n\t\t\t\t</div>,\n\t\t\t);\n\t\t}\n\n\t\tconst favoriteElem = ref<HTMLButtonElement>();\n\t\tlistItemElem.appendChild(\n\t\t\t<div>\n\t\t\t\t<button\n\t\t\t\t\tclassName=\"selector-modal-list-item-favorite btn btn-link p-0\"\n\t\t\t\t\tref={favoriteElem}\n\t\t\t\t\tonclick={() => setFavorite(listItemElem.dataset.fav == 'false')}>\n\t\t\t\t\t<i className=\"fa-star fa-xl\"></i>\n\t\t\t\t</button>\n\t\t\t</div>,\n\t\t);\n\n\t\tanchorElem.value!.addEventListener('click', (event: Event) => {\n\t\t\tevent.preventDefault();\n\t\t\tif (event.target === favoriteElem.value) return false;\n\t\t\tthis.onItemClick(itemData);\n\t\t});\n\n\t\titemData.actionId.fill().then(filledId => {\n\t\t\tfilledId.setWowheadHref(anchorElem.value!);\n\t\t\ticonElem.value!.src = filledId.iconUrl;\n\t\t});\n\n\t\tsetItemQualityCssClass(nameElem.value!, itemData.quality);\n\n\t\tnew Tooltip(favoriteElem.value!, {\n\t\t\ttitle: 'Add to favorites',\n\t\t});\n\t\tconst setFavorite = (isFavorite: boolean) => {\n\t\t\tconst filters = this.player.sim.getFilters();\n\t\t\tif (this.label == 'Items') {\n\t\t\t\tconst favId = itemData.id;\n\t\t\t\tif (isFavorite) {\n\t\t\t\t\tfilters.favoriteItems.push(favId);\n\t\t\t\t} else {\n\t\t\t\t\tconst favIdx = filters.favoriteItems.indexOf(favId);\n\t\t\t\t\tif (favIdx != -1) {\n\t\t\t\t\t\tfilters.favoriteItems.splice(favIdx, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (this.label == 'Enchants') {\n\t\t\t\tconst favId = getUniqueEnchantString(itemData.item as unknown as Enchant);\n\t\t\t\tif (isFavorite) {\n\t\t\t\t\tfilters.favoriteEnchants.push(favId);\n\t\t\t\t} else {\n\t\t\t\t\tconst favIdx = filters.favoriteEnchants.indexOf(favId);\n\t\t\t\t\tif (favIdx != -1) {\n\t\t\t\t\t\tfilters.favoriteEnchants.splice(favIdx, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (this.label.startsWith('Gem')) {\n\t\t\t\tconst favId = itemData.id;\n\t\t\t\tif (isFavorite) {\n\t\t\t\t\tfilters.favoriteGems.push(favId);\n\t\t\t\t} else {\n\t\t\t\t\tconst favIdx = filters.favoriteGems.indexOf(favId);\n\t\t\t\t\tif (favIdx != -1) {\n\t\t\t\t\t\tfilters.favoriteGems.splice(favIdx, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfavoriteElem.value!.children[0].classList.toggle('fas');\n\t\t\tfavoriteElem.value!.children[0].classList.toggle('far');\n\t\t\tlistItemElem.dataset.fav = isFavorite.toString();\n\n\t\t\tthis.player.sim.setFilters(TypedEvent.nextEventID(), filters);\n\t\t};\n\n\t\tconst isFavorite = this.isItemFavorited(itemData);\n\n\t\tif (isFavorite) {\n\t\t\tfavoriteElem.value!.children[0].classList.add('fas');\n\t\t\tlistItemElem.dataset.fav = 'true';\n\t\t} else {\n\t\t\tfavoriteElem.value!.children[0].classList.add('far');\n\t\t\tlistItemElem.dataset.fav = 'false';\n\t\t}\n\n\t\treturn listItemElem;\n\t}\n\n\tprivate isItemFavorited(itemData: ItemData<T>): boolean {\n\t\tif (this.label == 'Items') {\n\t\t\treturn this.currentFilters.favoriteItems.includes(itemData.id);\n\t\t} else if (this.label == 'Enchants') {\n\t\t\treturn this.currentFilters.favoriteEnchants.includes(getUniqueEnchantString(itemData.item as unknown as Enchant));\n\t\t} else if (this.label.startsWith('Gem')) {\n\t\t\treturn this.currentFilters.favoriteGems.includes(itemData.id);\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate getSourceInfo(item: Item, sim: Sim): JSX.Element {\n\t\tconst makeAnchor = (href: string, inner: string | JSX.Element) => {\n\t\t\treturn (\n\t\t\t\t<a href={href} target=\"_blank\" dataset={{ whtticon: 'false' }}>\n\t\t\t\t\t<small>{inner}</small>\n\t\t\t\t</a>\n\t\t\t);\n\t\t};\n\n\t\tif (!item.sources || item.sources.length == 0) {\n\t\t\tif (item.randomSuffixOptions.length) {\n\t\t\t\treturn makeAnchor(`${ActionId.makeItemUrl(item.id)}#dropped-by`, 'World Drop');\n\t\t\t}\n\n\t\t\treturn <></>;\n\t\t}\n\n\t\tlet source = item.sources[0];\n\t\tif (source.source.oneofKind == 'crafted') {\n\t\t\tconst src = source.source.crafted;\n\n\t\t\tif (src.spellId) {\n\t\t\t\treturn makeAnchor(ActionId.makeSpellUrl(src.spellId), professionNames.get(src.profession) ?? 'Unknown');\n\t\t\t}\n\t\t\treturn makeAnchor(ActionId.makeItemUrl(item.id), professionNames.get(src.profession) ?? 'Unknown');\n\t\t} else if (source.source.oneofKind == 'drop') {\n\t\t\tconst src = source.source.drop;\n\t\t\tconst zone = sim.db.getZone(src.zoneId);\n\t\t\tconst npc = sim.db.getNpc(src.npcId);\n\t\t\tif (!zone) {\n\t\t\t\tthrow new Error('No zone found for item: ' + item);\n\t\t\t}\n\n\t\t\tconst category = src.category ? ` - ${src.category}` : '';\n\t\t\tif (npc) {\n\t\t\t\treturn makeAnchor(\n\t\t\t\t\tActionId.makeNpcUrl(npc.id),\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{zone.name} ({difficultyNames.get(src.difficulty) ?? 'Unknown'})\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t{npc.name + category}\n\t\t\t\t\t</span>,\n\t\t\t\t);\n\t\t\t} else if (src.otherName) {\n\t\t\t\treturn makeAnchor(\n\t\t\t\t\tActionId.makeZoneUrl(zone.id),\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{zone.name}\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t{src.otherName}\n\t\t\t\t\t</span>,\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn makeAnchor(ActionId.makeZoneUrl(zone.id), zone.name);\n\t\t} else if (source.source.oneofKind == 'quest' && source.source.quest.name) {\n\t\t\tconst src = source.source.quest;\n\t\t\treturn makeAnchor(\n\t\t\t\tActionId.makeQuestUrl(src.id),\n\t\t\t\t<span>\n\t\t\t\t\tQuest\n\t\t\t\t\t{item.factionRestriction == UIItem_FactionRestriction.ALLIANCE_ONLY && (\n\t\t\t\t\t\t<img src=\"/cata/assets/img/alliance.png\" className=\"ms-1\" width=\"15\" height=\"15\" />\n\t\t\t\t\t)}\n\t\t\t\t\t{item.factionRestriction == UIItem_FactionRestriction.HORDE_ONLY && (\n\t\t\t\t\t\t<img src=\"/cata/assets/img/horde.png\" className=\"ms-1\" width=\"15\" height=\"15\" />\n\t\t\t\t\t)}\n\t\t\t\t\t<br />\n\t\t\t\t\t{src.name}\n\t\t\t\t</span>,\n\t\t\t);\n\t\t} else if ((source = item.sources.find(source => source.source.oneofKind == 'rep') ?? source).source.oneofKind == 'rep') {\n\t\t\tconst factionNames = item.sources\n\t\t\t\t.filter(source => source.source.oneofKind == 'rep')\n\t\t\t\t.map(source =>\n\t\t\t\t\tsource.source.oneofKind == 'rep' ? REP_FACTION_NAMES[source.source.rep.repFactionId] : REP_FACTION_NAMES[RepFaction.RepFactionUnknown],\n\t\t\t\t);\n\t\t\tconst src = source.source.rep;\n\t\t\treturn makeAnchor(\n\t\t\t\tActionId.makeItemUrl(item.id),\n\t\t\t\t<>\n\t\t\t\t\t{factionNames.map(name => (\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t{name}\n\t\t\t\t\t\t\t{item.factionRestriction == UIItem_FactionRestriction.ALLIANCE_ONLY && (\n\t\t\t\t\t\t\t\t<img src=\"/cata/assets/img/alliance.png\" className=\"ms-1\" width=\"15\" height=\"15\" />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{item.factionRestriction == UIItem_FactionRestriction.HORDE_ONLY && (\n\t\t\t\t\t\t\t\t<img src=\"/cata/assets/img/horde.png\" className=\"ms-1\" width=\"15\" height=\"15\" />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t))}\n\t\t\t\t\t<span>{REP_LEVEL_NAMES[src.repLevel]}</span>\n\t\t\t\t</>,\n\t\t\t);\n\t\t} else if (source.source.oneofKind == 'soldBy') {\n\t\t\tconst src = source.source.soldBy;\n\t\t\treturn makeAnchor(\n\t\t\t\tActionId.makeNpcUrl(src.npcId),\n\t\t\t\t<span>\n\t\t\t\t\tSold by\n\t\t\t\t\t<br />\n\t\t\t\t\t{src.npcName}\n\t\t\t\t</span>,\n\t\t\t);\n\t\t}\n\t\treturn <></>;\n\t}\n}\n","import { Tooltip } from 'bootstrap';\nimport { Component } from '../components/component.js';\nimport { TypedEvent } from '../typed_event.js';\n\nimport { element, fragment } from 'tsx-vanilla';\n\n// Config for displaying a warning to the user whenever a condition is met.\ninterface SimWarning {\n\tupdateOn: TypedEvent<any>,\n\tgetContent: () => string | Array<string>,\n}\n\ninterface WarningLinkArgs {\n\tparent: HTMLElement,\n\thref?: string,\n\ttext?: string,\n\ticon?: string,\n\ttooltip?: string,\n\tclasses?: string,\n\tonclick?: Function\n}\n\nexport class ResultsViewer extends Component {\n\treadonly pendingElem: HTMLElement;\n\treadonly contentElem: HTMLElement;\n\treadonly warningElem: HTMLElement;\n\tprivate warningsLink: HTMLElement;\n\n\tprivate warnings: Array<SimWarning> = [];\n\n\tconstructor(parentElem: HTMLElement) {\n\t\tsuper(parentElem, 'results-viewer');\n\t\tthis.rootElem.appendChild(\n\t\t\t<>\n\t\t\t\t<div className=\"results-pending\">\n\t\t\t\t<div className=\"loader\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"results-content\">\n\t\t\t\t</div>\n\t\t\t\t<div className=\"warning-zone\" style=\"text-align: center\">\n\t\t\t\t</div>\n\t\t\t</>\n\t\t);\n\t\tthis.pendingElem = this.rootElem.getElementsByClassName('results-pending')[0] as HTMLElement;\n\t\tthis.contentElem = this.rootElem.getElementsByClassName('results-content')[0] as HTMLElement;\n\t\tthis.warningElem = this.rootElem.getElementsByClassName('warning-zone')[0] as HTMLElement;\n\n\n\t\tthis.warningsLink = this.addWarningsLink();\n\t\tthis.updateWarnings();\n\n\t\tthis.hideAll();\n\t}\n\n\tprivate addWarningLink(args: WarningLinkArgs): HTMLElement {\n\t\tlet item = (\n\t\t\t<div className=\"sim-toolbar-item\">\n\t\t\t\t<a\n\t\t\t\t\thref={args.href ? args.href : 'javascript:void(0)'}\n\t\t\t\t\ttarget={args.href ? '_blank' : '_self'}\n\t\t\t\t\tclassName={args.classes}\n\t\t\t\t>\n\t\t\t\t\t{args.icon && <i className={args.icon}></i>}\n\t\t\t\t\t{args.text ? args.text : ''}\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t);\n\n\t\tlet link = item.children[0] as HTMLElement;\n\n\t\tif (args.onclick) {\n\t\t\tlink.addEventListener('click', () => {\n\t\t\t\tif (args.onclick)\n\t\t\t\t\targs.onclick();\n\t\t\t});\n\t\t}\n\n\t\tlet cfg = {};\n\t\tif (args.tooltip) {\n\t\t\tcfg = {\n\t\t\t\ttitle: args.tooltip,\n\t\t\t\thtml: true,\n\t\t\t\tplacement: 'bottom',\n\t\t\t};\n\t\t\tlink.setAttribute('data-bs-title', args.tooltip);\n\t\t}\n\t\tnew Tooltip(link, cfg);\n\t\targs.parent.appendChild(item);\n\n\t\treturn item as HTMLElement;\n\t}\n\n\tprivate addWarningsLink(): HTMLElement {\n\t\treturn this.addWarningLink({\n\t\t\tparent: this.warningElem,\n\t\t\ticon: 'fas fa-exclamation-triangle fa-3x',\n\t\t\ttooltip: \"<ul class='text-start ps-3 mb-0'></ul>\",\n\t\t\tclasses: 'warning link-warning'\n\t\t}).children[0] as HTMLElement;\n\t}\n\n\taddWarning(warning: SimWarning) {\n\t\tthis.warnings.push(warning);\n\t\twarning.updateOn.on(() => this.updateWarnings());\n\t\tthis.updateWarnings();\n\t}\n\n\tprivate updateWarnings() {\n\t\tconst activeWarnings = this.warnings.map(warning => warning.getContent()).flat().filter(content => content != '');\n\t\tlet tooltipFragment = document.createElement('fragment');\n\t\ttooltipFragment.innerHTML = this.warningsLink.getAttribute('data-bs-title') as string;\n\t\tlet list = tooltipFragment.children[0] as HTMLElement;\n\t\tlist.innerHTML = '';\n\t\tif (activeWarnings.length == 0) {\n\t\t\tthis.warningsLink.parentElement?.classList?.add('hide');\n\t\t} else {\n\t\t\tthis.warningsLink.parentElement?.classList?.remove('hide');\n\t\t\tactiveWarnings.forEach(warning => {\n\t\t\t\tlet listItem = document.createElement('li');\n\t\t\t\tlistItem.innerHTML = warning;\n\t\t\t\tlist.appendChild(listItem);\n\t\t\t});\n\t\t}\n\t\tthis.warningsLink.setAttribute('data-bs-title', list.outerHTML);\n\t\tnew Tooltip(this.warningsLink, {\n\t\t\ttitle: list.outerHTML,\n\t\t\thtml: true,\n\t\t\tplacement: 'bottom',\n\t\t});\n\t}\n\n\thideAll() {\n\t\tthis.contentElem.style.display = 'none';\n\t\tthis.pendingElem.style.display = 'none';\n\t}\n\n\tsetPending() {\n\t\tthis.contentElem.style.display = 'none';\n\t\tthis.pendingElem.style.display = 'block';\n\t}\n\n\tsetContent(innerHTML: string) {\n\t\tthis.contentElem.innerHTML = innerHTML;\n\t\tthis.contentElem.style.display = 'block';\n\t\tthis.pendingElem.style.display = 'none';\n\t}\n}\n","import { SimUI } from \"../sim_ui\";\nimport { Component } from \"./component\";\n\nexport interface SimTabConfig {\n\tidentifier: string,\n\ttitle: string,\n}\n\nexport abstract class SimTab extends Component {\n\tprotected simUI: SimUI;\n\tprotected config: SimTabConfig;\n\n\treadonly navItem: HTMLElement;\n\treadonly navLink: HTMLElement;\n\treadonly contentContainer: HTMLElement;\n\n\tconstructor(parentElem: HTMLElement, simUI: SimUI, config: SimTabConfig) {\n\t\tsuper(parentElem, 'sim-tab');\n\n\t\tthis.rootElem.classList.add(config.identifier);\n\n\t\tthis.simUI = simUI;\n\t\tthis.config = config;\n\n\t\tthis.rootElem.id = this.config.identifier;\n\t\tthis.rootElem.classList.add('tab-pane', 'fade');\n\n\t\tif (parentElem.childNodes.length == 0)\n\t\t\tthis.rootElem.classList.add('active', 'show');\n\n\t\tthis.navItem = this.buildNavItem();\n\t\tthis.navLink = this.navItem.children[0] as HTMLElement;\n\t\tthis.contentContainer = document.createElement('div');\n\t\tthis.contentContainer.classList.add('tab-pane-content-container');\n\t\tthis.rootElem.appendChild(this.contentContainer);\n\n\t\tthis.simUI.simHeader.addSimTabLink(this);\n\t}\n\n\tprivate buildNavItem(): HTMLElement {\n\t\tconst tabFragment = document.createElement('fragment');\n\t\ttabFragment.innerHTML = `\n\t\t\t<li class=\"${this.config.identifier} nav-item\" role=\"presentation\">\n\t\t\t\t<a\n\t\t\t\t\tclass=\"nav-link\"\n\t\t\t\t\tdata-bs-toggle=\"tab\"\n\t\t\t\t\tdata-bs-target=\"#${this.config.identifier}\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\trole=\"tab\"\n\t\t\t\t\taria-controls=\"${this.config.identifier}\"\n\t\t\t\t>${this.config.title}</a>\n\t\t\t</li>\n\t\t`;\n\n\t\treturn tabFragment.children[0] as HTMLElement;\n\t}\n\n\tprotected abstract buildTabContent(): void;\n\n\tprotected buildColumn(index: number, customCssClass: string): HTMLElement {\n\t\tlet column = document.createElement('div');\n\t\tcolumn.classList.add('tab-panel-col', `${customCssClass}-${index}`)\n\t\treturn column;\n\t}\n}\n","import { IndividualSimUI } from '../../individual_sim_ui';\nimport { BulkComboResult, BulkSettings, ItemSpecWithSlot, ProgressMetrics, TalentLoadout } from '../../proto/api';\nimport { EquipmentSpec, GemColor, ItemSlot, ItemSpec, SimDatabase, SimEnchant, SimGem, SimItem } from '../../proto/common';\nimport { SavedTalents, UIEnchant, UIGem, UIItem, UIItem_FactionRestriction } from '../../proto/ui';\nimport { ActionId } from '../../proto_utils/action_id';\nimport { Database } from '../../proto_utils/database';\nimport { EquippedItem } from '../../proto_utils/equipped_item';\nimport { getEmptyGemSocketIconUrl } from '../../proto_utils/gems';\nimport { canEquipItem, getEligibleItemSlots } from '../../proto_utils/utils';\nimport { TypedEvent } from '../../typed_event';\nimport { EventID } from '../../typed_event.js';\nimport { BaseModal } from '../base_modal';\nimport { BooleanPicker } from '../boolean_picker';\nimport { Component } from '../component';\nimport { ContentBlock } from '../content_block';\nimport { ItemData, ItemList, ItemRenderer, SelectorModal, SelectorModalTabs } from '../gear_picker';\nimport { Importer } from '../importers';\nimport { ResultsViewer } from '../results_viewer';\nimport { SimTab } from '../sim_tab';\n\nexport class BulkGearJsonImporter extends Importer {\n\tprivate readonly simUI: IndividualSimUI<any>;\n\tprivate readonly bulkUI: BulkTab;\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<any>, bulkUI: BulkTab) {\n\t\tsuper(parent, simUI, 'Bag Item Import', true);\n\t\tthis.simUI = simUI;\n\t\tthis.bulkUI = bulkUI;\n\t\tthis.descriptionElem.innerHTML = `\n      <p>Import bag items from a JSON file, which can be created by the WowSimsExporter in-game AddOn.</p>\n      <p>To import, upload the file or paste the text below, then click, 'Import'.</p>\n    `;\n\t}\n\n\tasync onImport(data: string) {\n\t\ttry {\n\t\t\tconst equipment = EquipmentSpec.fromJsonString(data, { ignoreUnknownFields: true });\n\t\t\tif (equipment?.items?.length > 0) {\n\t\t\t\tconst db = await Database.loadLeftoversIfNecessary(equipment);\n\t\t\t\tconst items = equipment.items.filter(spec => spec.id > 0 && db.lookupItemSpec(spec));\n\t\t\t\tif (items.length > 0) {\n\t\t\t\t\tthis.bulkUI.addItems(items);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.close();\n\t\t} catch (e: any) {\n\t\t\tconsole.warn(e);\n\t\t\talert(e.toString());\n\t\t}\n\t}\n}\n\nclass BulkSimResultRenderer {\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<any>, result: BulkComboResult, baseResult: BulkComboResult) {\n\t\tconst dpsDivParent = document.createElement('div');\n\t\tdpsDivParent.classList.add('results-sim');\n\n\t\tconst dpsDiv = document.createElement('div');\n\t\tdpsDiv.classList.add('bulk-result-body-dps', 'bulk-items-text-line', 'results-sim-dps', 'damage-metrics');\n\t\tdpsDivParent.appendChild(dpsDiv);\n\n\t\tconst dpsNumber = document.createElement('span');\n\t\tdpsNumber.textContent = this.formatDps(result.unitMetrics!.dps!.avg);\n\t\tdpsNumber.classList.add('topline-result-avg');\n\t\tdpsDiv.appendChild(dpsNumber);\n\n\t\tconst dpsDelta = result.unitMetrics!.dps!.avg! - baseResult.unitMetrics!.dps!.avg;\n\t\tconst dpsDeltaSpan = document.createElement('span');\n\t\tdpsDeltaSpan.textContent = `${this.formatDpsDelta(dpsDelta)}`;\n\t\tdpsDeltaSpan.classList.add(dpsDelta >= 0 ? 'bulk-result-header-positive' : 'bulk-result-header-negative');\n\t\tdpsDiv.appendChild(dpsDeltaSpan);\n\n\t\tconst itemsContainer = document.createElement('div');\n\t\titemsContainer.classList.add('bulk-gear-combo');\n\t\tparent.appendChild(itemsContainer);\n\t\tparent.appendChild(dpsDivParent);\n\n\t\tconst talentText = document.createElement('p');\n\t\ttalentText.classList.add('talent-loadout-text');\n\t\tif (result.talentLoadout && typeof result.talentLoadout === 'object') {\n\t\t\tif (typeof result.talentLoadout.name === 'string') {\n\t\t\t\ttalentText.textContent = 'Talent loadout used: ' + result.talentLoadout.name;\n\t\t\t}\n\t\t} else {\n\t\t\ttalentText.textContent = 'Current talents';\n\t\t}\n\n\t\tdpsDiv.appendChild(talentText);\n\t\tif (result.itemsAdded && result.itemsAdded.length > 0) {\n\t\t\tconst equipBtn = document.createElement('button');\n\t\t\tequipBtn.textContent = 'Equip';\n\t\t\tequipBtn.classList.add('btn', 'btn-primary', 'bulk-equipit');\n\t\t\tequipBtn.onclick = () => {\n\t\t\t\tresult.itemsAdded.forEach(itemAdded => {\n\t\t\t\t\tconst item = simUI.sim.db.lookupItemSpec(itemAdded.item!);\n\t\t\t\t\tsimUI.player.equipItem(TypedEvent.nextEventID(), itemAdded.slot, item);\n\t\t\t\t\tsimUI.simHeader.activateTab('gear-tab');\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tparent.appendChild(equipBtn);\n\n\t\t\tfor (const is of result.itemsAdded) {\n\t\t\t\tconst item = simUI.sim.db.lookupItemSpec(is.item!);\n\t\t\t\tconst renderer = new ItemRenderer(parent, itemsContainer, simUI.player);\n\t\t\t\trenderer.update(item!);\n\n\t\t\t\tconst p = document.createElement('a');\n\t\t\t\tp.classList.add('bulk-result-item-slot');\n\t\t\t\tp.textContent = this.itemSlotName(is);\n\t\t\t\trenderer.nameElem.appendChild(p);\n\t\t\t}\n\t\t} else if (!result.talentLoadout || typeof result.talentLoadout !== 'object') {\n\t\t\tconst p = document.createElement('p');\n\t\t\tp.textContent = 'No changes - this is your currently equipped gear!';\n\t\t\tparent.appendChild(p);\n\t\t\tdpsDeltaSpan.textContent = '';\n\t\t}\n\t}\n\n\tprivate formatDps(dps: number): string {\n\t\treturn (Math.round(dps * 100) / 100).toFixed(2);\n\t}\n\n\tprivate formatDpsDelta(delta: number): string {\n\t\treturn (delta >= 0 ? '+' : '') + this.formatDps(delta);\n\t}\n\n\tprivate itemSlotName(is: ItemSpecWithSlot): string {\n\t\treturn JSON.parse(ItemSpecWithSlot.toJsonString(is, { emitDefaultValues: true }))['slot'].replace('ItemSlot', '');\n\t}\n}\n\nexport class BulkItemPicker extends Component {\n\tprivate readonly itemElem: ItemRenderer;\n\treadonly simUI: IndividualSimUI<any>;\n\treadonly bulkUI: BulkTab;\n\treadonly index: number;\n\n\tprotected item: EquippedItem;\n\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<any>, bulkUI: BulkTab, item: EquippedItem, index: number) {\n\t\tsuper(parent, 'bulk-item-picker');\n\t\tthis.simUI = simUI;\n\t\tthis.bulkUI = bulkUI;\n\t\tthis.index = index;\n\t\tthis.item = item;\n\t\tthis.itemElem = new ItemRenderer(parent, this.rootElem, simUI.player);\n\n\t\tthis.simUI.sim.waitForInit().then(() => {\n\t\t\tthis.setItem(item);\n\t\t\tconst slot = getEligibleItemSlots(this.item.item)[0];\n\t\t\tconst eligibleEnchants = this.simUI.sim.db.getEnchants(slot);\n\t\t\tconst openEnchantGemSelector = (event: Event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst changeEvent = new TypedEvent<void>();\n\t\t\t\tconst modal = new SelectorModal(this.bulkUI.rootElem, this.simUI, this.simUI.player, {\n\t\t\t\t\tselectedTab: SelectorModalTabs.Enchants,\n\t\t\t\t\tslot: slot,\n\t\t\t\t\tequippedItem: this.item,\n\t\t\t\t\teligibleItems: new Array<UIItem>(),\n\t\t\t\t\teligibleEnchants: eligibleEnchants,\n\t\t\t\t\tgearData: {\n\t\t\t\t\t\tequipItem: (eventID: EventID, equippedItem: EquippedItem | null) => {\n\t\t\t\t\t\t\tif (equippedItem) {\n\t\t\t\t\t\t\t\tconst allItems = this.bulkUI.getItems();\n\t\t\t\t\t\t\t\tallItems[this.index] = equippedItem.asSpec();\n\t\t\t\t\t\t\t\tthis.item = equippedItem;\n\t\t\t\t\t\t\t\tthis.bulkUI.setItems(allItems);\n\t\t\t\t\t\t\t\tchangeEvent.emit(TypedEvent.nextEventID());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tgetEquippedItem: () => this.item,\n\t\t\t\t\t\tchangeEvent: changeEvent,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tif (eligibleEnchants.length > 0) {\n\t\t\t\t\tmodal.openTabName('Enchants');\n\t\t\t\t} else if (this.item._gems.length > 0) {\n\t\t\t\t\tmodal.openTabName('Gem1');\n\t\t\t\t}\n\n\t\t\t\tconst destroyItemButton = document.createElement('button');\n\t\t\t\tdestroyItemButton.textContent = 'Remove from Batch';\n\t\t\t\tdestroyItemButton.classList.add('btn', 'btn-danger');\n\t\t\t\tdestroyItemButton.onclick = () => {\n\t\t\t\t\tbulkUI.setItems(\n\t\t\t\t\t\tbulkUI.getItems().filter((item, idx) => {\n\t\t\t\t\t\t\treturn idx != this.index;\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t\tmodal.close();\n\t\t\t\t};\n\t\t\t\tconst closeX = modal.header?.querySelector('.close-button');\n\t\t\t\tif (closeX != undefined) {\n\t\t\t\t\tmodal.header?.insertBefore(destroyItemButton, closeX);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.itemElem.iconElem.addEventListener('click', openEnchantGemSelector);\n\t\t\tthis.itemElem.nameElem.addEventListener('click', openEnchantGemSelector);\n\t\t\tthis.itemElem.enchantElem.addEventListener('click', openEnchantGemSelector);\n\t\t});\n\t}\n\n\tsetItem(newItem: EquippedItem | null) {\n\t\tthis.itemElem.clear();\n\t\tif (newItem != null) {\n\t\t\tthis.itemElem.update(newItem);\n\t\t\tthis.item = newItem;\n\t\t} else {\n\t\t\tthis.itemElem.rootElem.style.opacity = '30%';\n\t\t\tthis.itemElem.iconElem.style.backgroundImage = `url('/cata/assets/item_slots/empty.jpg')`;\n\t\t\tthis.itemElem.nameElem.textContent = 'Add new item (not implemented)';\n\t\t\tthis.itemElem.rootElem.style.alignItems = 'center';\n\t\t}\n\t}\n}\n\nexport class BulkTab extends SimTab {\n\treadonly simUI: IndividualSimUI<any>;\n\n\treadonly itemsChangedEmitter = new TypedEvent<void>();\n\n\treadonly leftPanel: HTMLElement;\n\treadonly rightPanel: HTMLElement;\n\n\treadonly column1: HTMLElement = this.buildColumn(1, 'raid-settings-col');\n\n\tprotected items: Array<ItemSpec> = new Array<ItemSpec>();\n\n\tprivate pendingResults: ResultsViewer;\n\tprivate pendingDiv: HTMLDivElement;\n\n\t// TODO: Make a real options probably\n\tprivate doCombos: boolean;\n\tprivate fastMode: boolean;\n\tprivate autoGem: boolean;\n\tprivate simTalents: boolean;\n\tprivate autoEnchant: boolean;\n\tprivate defaultGems: SimGem[];\n\tprivate savedTalents: TalentLoadout[];\n\tprivate gemIconElements: HTMLImageElement[];\n\n\tconstructor(parentElem: HTMLElement, simUI: IndividualSimUI<any>) {\n\t\tsuper(parentElem, simUI, { identifier: 'bulk-tab', title: 'Batch' });\n\t\tthis.simUI = simUI;\n\n\t\tthis.leftPanel = document.createElement('div');\n\t\tthis.leftPanel.classList.add('bulk-tab-left', 'tab-panel-left');\n\t\tthis.leftPanel.appendChild(this.column1);\n\n\t\tthis.rightPanel = document.createElement('div');\n\t\tthis.rightPanel.classList.add('bulk-tab-right', 'tab-panel-right');\n\n\t\tthis.pendingDiv = document.createElement('div');\n\t\tthis.pendingDiv.classList.add('results-pending-overlay');\n\t\tthis.pendingResults = new ResultsViewer(this.pendingDiv);\n\t\tthis.pendingResults.hideAll();\n\n\t\tthis.contentContainer.appendChild(this.leftPanel);\n\t\tthis.contentContainer.appendChild(this.rightPanel);\n\t\tthis.contentContainer.appendChild(this.pendingDiv);\n\n\t\tthis.doCombos = true;\n\t\tthis.fastMode = true;\n\t\tthis.autoGem = true;\n\t\tthis.autoEnchant = true;\n\t\tthis.savedTalents = [];\n\t\tthis.simTalents = false;\n\t\tthis.defaultGems = [UIGem.create(), UIGem.create(), UIGem.create(), UIGem.create()];\n\t\tthis.gemIconElements = [];\n\t\tthis.buildTabContent();\n\n\t\tthis.simUI.sim.waitForInit().then(() => {\n\t\t\tthis.loadSettings();\n\t\t});\n\t}\n\n\tprivate getSettingsKey(): string {\n\t\treturn this.simUI.getStorageKey('bulk-settings.v1');\n\t}\n\n\tprivate loadSettings() {\n\t\tconst storedSettings = window.localStorage.getItem(this.getSettingsKey());\n\t\tif (storedSettings != null) {\n\t\t\tconst settings = BulkSettings.fromJsonString(storedSettings, {\n\t\t\t\tignoreUnknownFields: true,\n\t\t\t});\n\n\t\t\tthis.doCombos = settings.combinations;\n\t\t\tthis.fastMode = settings.fastMode;\n\t\t\tthis.autoEnchant = settings.autoEnchant;\n\t\t\tthis.savedTalents = settings.talentsToSim;\n\t\t\tthis.autoGem = settings.autoGem;\n\t\t\tthis.simTalents = settings.simTalents;\n\t\t\tthis.defaultGems = new Array<SimGem>(\n\t\t\t\tSimGem.create({ id: settings.defaultRedGem }),\n\t\t\t\tSimGem.create({ id: settings.defaultYellowGem }),\n\t\t\t\tSimGem.create({ id: settings.defaultBlueGem }),\n\t\t\t\tSimGem.create({ id: settings.defaultMetaGem }),\n\t\t\t);\n\n\t\t\tthis.defaultGems.forEach((gem, idx) => {\n\t\t\t\tActionId.fromItemId(gem.id)\n\t\t\t\t\t.fill()\n\t\t\t\t\t.then(filledId => {\n\t\t\t\t\t\tthis.gemIconElements[idx].src = filledId.iconUrl;\n\t\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate storeSettings() {\n\t\tconst settings = this.createBulkSettings();\n\t\tconst setStr = BulkSettings.toJsonString(settings, { enumAsInteger: true });\n\t\twindow.localStorage.setItem(this.getSettingsKey(), setStr);\n\t}\n\n\tprotected createBulkSettings(): BulkSettings {\n\t\treturn BulkSettings.create({\n\t\t\titems: this.items,\n\t\t\t// TODO(Riotdog-GehennasEU): Make all of these configurable.\n\t\t\t// For now, it's always constant iteration combinations mode for \"sim my bags\".\n\t\t\tcombinations: this.doCombos,\n\t\t\tfastMode: this.fastMode,\n\t\t\tautoEnchant: this.autoEnchant,\n\t\t\tautoGem: this.autoGem,\n\t\t\tsimTalents: this.simTalents,\n\t\t\ttalentsToSim: this.savedTalents,\n\t\t\tdefaultRedGem: this.defaultGems[0].id,\n\t\t\tdefaultYellowGem: this.defaultGems[1].id,\n\t\t\tdefaultBlueGem: this.defaultGems[2].id,\n\t\t\tdefaultMetaGem: this.defaultGems[3].id,\n\t\t\titerationsPerCombo: this.simUI.sim.getIterations(), // TODO(Riotdog-GehennasEU): Define a new UI element for the iteration setting.\n\t\t});\n\t}\n\n\tprotected createBulkItemsDatabase(): SimDatabase {\n\t\tconst itemsDb = SimDatabase.create();\n\t\tfor (const is of this.items) {\n\t\t\tconst item = this.simUI.sim.db.lookupItemSpec(is);\n\t\t\tif (!item) {\n\t\t\t\tthrow new Error(`item with ID ${is.id} not found in database`);\n\t\t\t}\n\t\t\titemsDb.items.push(SimItem.fromJson(UIItem.toJson(item.item), { ignoreUnknownFields: true }));\n\t\t\tif (item.enchant) {\n\t\t\t\titemsDb.enchants.push(\n\t\t\t\t\tSimEnchant.fromJson(UIEnchant.toJson(item.enchant), {\n\t\t\t\t\t\tignoreUnknownFields: true,\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}\n\t\t\tfor (const gem of item.gems) {\n\t\t\t\tif (gem) {\n\t\t\t\t\titemsDb.gems.push(SimGem.fromJson(UIGem.toJson(gem), { ignoreUnknownFields: true }));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (const gem of this.defaultGems) {\n\t\t\tif (gem.id > 0) {\n\t\t\t\titemsDb.gems.push(gem);\n\t\t\t}\n\t\t}\n\t\treturn itemsDb;\n\t}\n\n\taddItems(items: Array<ItemSpec>) {\n\t\tif (this.items.length == 0) {\n\t\t\tthis.items = items;\n\t\t} else {\n\t\t\tthis.items = this.items.concat(items);\n\t\t}\n\t\tthis.itemsChangedEmitter.emit(TypedEvent.nextEventID());\n\t}\n\n\tsetItems(items: Array<ItemSpec>) {\n\t\tthis.items = items;\n\t\tthis.itemsChangedEmitter.emit(TypedEvent.nextEventID());\n\t}\n\n\tclearItems() {\n\t\tthis.items = new Array<ItemSpec>();\n\t\tthis.itemsChangedEmitter.emit(TypedEvent.nextEventID());\n\t}\n\n\tgetItems(): Array<ItemSpec> {\n\t\tconst result = new Array<ItemSpec>();\n\t\tthis.items.forEach(spec => {\n\t\t\tresult.push(ItemSpec.clone(spec));\n\t\t});\n\t\treturn result;\n\t}\n\n\tsetCombinations(doCombos: boolean) {\n\t\tthis.doCombos = doCombos;\n\t\tthis.itemsChangedEmitter.emit(TypedEvent.nextEventID());\n\t}\n\n\tsetFastMode(fastMode: boolean) {\n\t\tthis.fastMode = fastMode;\n\t\tthis.itemsChangedEmitter.emit(TypedEvent.nextEventID());\n\t}\n\n\tprotected async runBulkSim(onProgress: (_?: any) => void) {\n\t\tthis.pendingResults.setPending();\n\n\t\ttry {\n\t\t\tawait this.simUI.sim.runBulkSim(this.createBulkSettings(), this.createBulkItemsDatabase(), onProgress);\n\t\t} catch (e) {\n\t\t\tthis.simUI.handleCrash(e);\n\t\t}\n\t}\n\n\tprotected buildTabContent() {\n\t\tconst itemsBlock = new ContentBlock(this.column1, 'bulk-items', {\n\t\t\theader: { title: 'Items' },\n\t\t});\n\n\t\titemsBlock.bodyElement.classList.add('gear-picker-root');\n\n\t\tconst noticeWorkInProgress = document.createElement('div');\n\t\tnoticeWorkInProgress.classList.add('bulk-items-text-line');\n\t\titemsBlock.bodyElement.appendChild(noticeWorkInProgress);\n\t\tnoticeWorkInProgress.innerHTML =\n\t\t\t'<i>Notice: This is under very early but active development and experimental. You may also need to update your WoW AddOn if you want to import your bags.</i>';\n\n\t\tconst itemTextIntro = document.createElement('div');\n\t\titemTextIntro.classList.add('bulk-items-text-line');\n\t\titemsBlock.bodyElement.appendChild(itemTextIntro);\n\n\t\tconst itemList = document.createElement('div');\n\n\t\titemList.classList.add('tab-panel-col', 'bulk-gear-combo');\n\t\titemsBlock.bodyElement.appendChild(itemList);\n\n\t\tthis.itemsChangedEmitter.on(() => {\n\t\t\titemList.innerHTML = '';\n\t\t\tif (this.items.length > 0) {\n\t\t\t\titemTextIntro.textContent = 'The following items will be simmed together with your equipped gear.';\n\t\t\t\tfor (let i = 0; i < this.items.length; ++i) {\n\t\t\t\t\tconst spec = this.items[i];\n\t\t\t\t\tconst item = this.simUI.sim.db.lookupItemSpec(spec);\n\t\t\t\t\tnew BulkItemPicker(itemList, this.simUI, this, item!, i);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.clearItems();\n\n\t\tconst resultsBlock = new ContentBlock(this.column1, 'bulk-results', {\n\t\t\theader: {\n\t\t\t\ttitle: 'Results',\n\t\t\t\textraCssClasses: ['bulk-results-header'],\n\t\t\t},\n\t\t});\n\n\t\tresultsBlock.rootElem.hidden = true;\n\t\tresultsBlock.bodyElement.classList.add('gear-picker-root', 'tab-panel-col');\n\n\t\tthis.simUI.sim.bulkSimStartEmitter.on(() => {\n\t\t\tresultsBlock.rootElem.hidden = true;\n\t\t});\n\n\t\tthis.simUI.sim.bulkSimResultEmitter.on((_, bulkSimResult) => {\n\t\t\tresultsBlock.rootElem.hidden = bulkSimResult.results.length == 0;\n\t\t\tresultsBlock.bodyElement.innerHTML = '';\n\n\t\t\tfor (const r of bulkSimResult.results) {\n\t\t\t\tconst resultBlock = new ContentBlock(resultsBlock.bodyElement, 'bulk-result', {\n\t\t\t\t\theader: { title: '' },\n\t\t\t\t\tbodyClasses: ['bulk-results-body'],\n\t\t\t\t});\n\t\t\t\tnew BulkSimResultRenderer(resultBlock.bodyElement, this.simUI, r, bulkSimResult.equippedGearResult!);\n\t\t\t}\n\t\t});\n\n\t\tconst settingsBlock = new ContentBlock(this.rightPanel, 'bulk-settings', {\n\t\t\theader: { title: 'Setup' },\n\t\t});\n\n\t\tconst bulkSimButton = document.createElement('button');\n\t\tbulkSimButton.classList.add('btn', 'btn-primary', 'w-100', 'bulk-settings-button');\n\t\tbulkSimButton.textContent = 'Simulate Batch';\n\t\tbulkSimButton.addEventListener('click', () => {\n\t\t\tthis.pendingDiv.style.display = 'flex';\n\t\t\tthis.leftPanel.classList.add('blurred');\n\t\t\tthis.rightPanel.classList.add('blurred');\n\n\t\t\tconst previousContents = bulkSimButton.innerHTML;\n\t\t\tbulkSimButton.disabled = true;\n\t\t\tbulkSimButton.classList.add('.disabled');\n\t\t\tbulkSimButton.innerHTML = `<i class=\"fa fa-spinner fa-spin\"></i>&nbsp;Running`;\n\n\t\t\tlet simStart = new Date().getTime();\n\t\t\tlet lastTotal = 0;\n\t\t\tlet rounds = 0;\n\t\t\tlet currentRound = 0;\n\t\t\tlet combinations = 0;\n\n\t\t\tthis.runBulkSim((progressMetrics: ProgressMetrics) => {\n\t\t\t\tconsole.log(progressMetrics);\n\n\t\t\t\tconst msSinceStart = new Date().getTime() - simStart;\n\t\t\t\tconst iterPerSecond = progressMetrics.completedIterations / (msSinceStart / 1000);\n\n\t\t\t\tif (combinations == 0) {\n\t\t\t\t\tcombinations = progressMetrics.totalSims;\n\t\t\t\t}\n\t\t\t\tif (this.fastMode) {\n\t\t\t\t\tif (rounds == 0 && progressMetrics.totalSims > 0) {\n\t\t\t\t\t\trounds = Math.ceil(Math.log(progressMetrics.totalSims / 20) / Math.log(2)) + 1;\n\t\t\t\t\t\tcurrentRound = 1;\n\t\t\t\t\t}\n\t\t\t\t\tif (progressMetrics.totalSims < lastTotal) {\n\t\t\t\t\t\tcurrentRound += 1;\n\t\t\t\t\t\tsimStart = new Date().getTime();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.setSimProgress(progressMetrics, iterPerSecond, currentRound, rounds, combinations);\n\t\t\t\tlastTotal = progressMetrics.totalSims;\n\n\t\t\t\tif (progressMetrics.finalBulkResult != null) {\n\t\t\t\t\t// reset state\n\t\t\t\t\tthis.pendingDiv.style.display = 'none';\n\t\t\t\t\tthis.leftPanel.classList.remove('blurred');\n\t\t\t\t\tthis.rightPanel.classList.remove('blurred');\n\n\t\t\t\t\tthis.pendingResults.hideAll();\n\t\t\t\t\tbulkSimButton.disabled = false;\n\t\t\t\t\tbulkSimButton.classList.remove('.disabled');\n\t\t\t\t\tbulkSimButton.innerHTML = previousContents;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tsettingsBlock.bodyElement.appendChild(bulkSimButton);\n\n\t\tconst importButton = document.createElement('button');\n\t\timportButton.classList.add('btn', 'btn-secondary', 'w-100', 'bulk-settings-button');\n\t\timportButton.innerHTML = '<i class=\"fa fa-download\"></i> Import From Bags';\n\t\timportButton.addEventListener('click', () => new BulkGearJsonImporter(this.simUI.rootElem, this.simUI, this));\n\t\tsettingsBlock.bodyElement.appendChild(importButton);\n\n\t\tconst importFavsButton = document.createElement('button');\n\t\timportFavsButton.classList.add('btn', 'btn-secondary', 'w-100', 'bulk-settings-button');\n\t\timportFavsButton.innerHTML = '<i class=\"fa fa-download\"></i> Import Favorites';\n\t\timportFavsButton.addEventListener('click', () => {\n\t\t\tconst filters = this.simUI.player.sim.getFilters();\n\t\t\tconst items = filters.favoriteItems.map(itemID => {\n\t\t\t\treturn ItemSpec.create({ id: itemID });\n\t\t\t});\n\t\t\tthis.addItems(items);\n\t\t});\n\t\tsettingsBlock.bodyElement.appendChild(importFavsButton);\n\n\t\tconst searchButton = document.createElement('button');\n\t\tconst searchText = document.createElement('input');\n\t\tsearchText.type = 'text';\n\t\tsearchText.placeholder = 'search...';\n\t\tsearchText.style.display = 'none';\n\n\t\tconst searchResults = document.createElement('ul');\n\t\tsearchResults.classList.add('batch-search-results');\n\n\t\tlet allItems = Array<UIItem>();\n\n\t\tsearchText.addEventListener('keyup', ev => {\n\t\t\tif (ev.key == 'Enter') {\n\t\t\t\tconst toAdd = Array<ItemSpec>();\n\t\t\t\tsearchResults.childNodes.forEach(node => {\n\t\t\t\t\tconst strID = (node as HTMLElement).getAttribute('data-item-id');\n\t\t\t\t\tif (strID != null) {\n\t\t\t\t\t\ttoAdd.push(ItemSpec.create({ id: Number.parseInt(strID) }));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.addItems(toAdd);\n\t\t\t}\n\t\t});\n\n\t\tsearchText.addEventListener('input', _event => {\n\t\t\tconst searchString = searchText.value;\n\t\t\tsearchResults.innerHTML = '';\n\t\t\tif (searchString.length == 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst pieces = searchString.split(' ');\n\n\t\t\tlet displayCount = 0;\n\t\t\tallItems.every(item => {\n\t\t\t\tlet matched = true;\n\t\t\t\tconst lcName = item.name.toLowerCase();\n\t\t\t\tconst lcSetName = item.setName.toLowerCase();\n\n\t\t\t\tpieces.forEach(piece => {\n\t\t\t\t\tconst lcPiece = piece.toLowerCase();\n\t\t\t\t\tif (!lcName.includes(lcPiece) && !lcSetName.includes(lcPiece)) {\n\t\t\t\t\t\tmatched = false;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t});\n\n\t\t\t\tif (matched) {\n\t\t\t\t\tconst itemElement = document.createElement('li');\n\t\t\t\t\titemElement.innerHTML = `<span>${item.name}</span>`;\n\t\t\t\t\titemElement.setAttribute('data-item-id', item.id.toString());\n\t\t\t\t\titemElement.addEventListener('click', _ev => {\n\t\t\t\t\t\tthis.addItems(Array<ItemSpec>(ItemSpec.create({ id: item.id })));\n\t\t\t\t\t});\n\t\t\t\t\tif (item.heroic) {\n\t\t\t\t\t\tconst htxt = document.createElement('span');\n\t\t\t\t\t\thtxt.style.color = 'green';\n\t\t\t\t\t\thtxt.innerText = '[H]';\n\t\t\t\t\t\titemElement.appendChild(htxt);\n\t\t\t\t\t}\n\t\t\t\t\tif (item.factionRestriction == UIItem_FactionRestriction.HORDE_ONLY) {\n\t\t\t\t\t\tconst ftxt = document.createElement('span');\n\t\t\t\t\t\tftxt.style.color = 'red';\n\t\t\t\t\t\tftxt.innerText = '(H)';\n\t\t\t\t\t\titemElement.appendChild(ftxt);\n\t\t\t\t\t}\n\t\t\t\t\tif (item.factionRestriction == UIItem_FactionRestriction.ALLIANCE_ONLY) {\n\t\t\t\t\t\tconst ftxt = document.createElement('span');\n\t\t\t\t\t\tftxt.style.color = 'blue';\n\t\t\t\t\t\tftxt.innerText = '(A)';\n\t\t\t\t\t\titemElement.appendChild(ftxt);\n\t\t\t\t\t}\n\t\t\t\t\tsearchResults.append(itemElement);\n\t\t\t\t\tdisplayCount++;\n\t\t\t\t}\n\n\t\t\t\treturn displayCount < 10;\n\t\t\t});\n\t\t});\n\n\t\tsearchButton.classList.add('btn', 'btn-secondary', 'w-100', 'bulk-settings-button');\n\t\tconst baseSearchHTML = '<i class=\"fa fa-search\"></i> Add Item';\n\t\tsearchButton.innerHTML = baseSearchHTML;\n\t\tsearchButton.addEventListener('click', () => {\n\t\t\tif (searchText.style.display == 'none') {\n\t\t\t\tsearchButton.innerHTML = 'Close Search Results';\n\t\t\t\tallItems = this.simUI.sim.db.getAllItems().filter(item => {\n\t\t\t\t\treturn canEquipItem(item, this.simUI.player.getPlayerSpec(), undefined);\n\t\t\t\t});\n\t\t\t\tsearchText.style.display = 'block';\n\t\t\t\tsearchText.focus();\n\t\t\t} else {\n\t\t\t\tsearchButton.innerHTML = baseSearchHTML;\n\t\t\t\tsearchText.style.display = 'none';\n\t\t\t\tsearchResults.innerHTML = '';\n\t\t\t}\n\t\t});\n\t\tsettingsBlock.bodyElement.appendChild(searchButton);\n\t\tsettingsBlock.bodyElement.appendChild(searchText);\n\t\tsettingsBlock.bodyElement.appendChild(searchResults);\n\n\t\tconst clearButton = document.createElement('button');\n\t\tclearButton.classList.add('btn', 'btn-secondary', 'w-100', 'bulk-settings-button');\n\t\tclearButton.textContent = 'Clear All';\n\t\tclearButton.addEventListener('click', () => {\n\t\t\tthis.clearItems();\n\t\t\tresultsBlock.rootElem.hidden = true;\n\t\t\tresultsBlock.bodyElement.innerHTML = '';\n\t\t});\n\t\tsettingsBlock.bodyElement.appendChild(clearButton);\n\n\t\t// Talents to sim\n\t\tconst talentsToSimDiv = document.createElement('div');\n\t\tif (this.simTalents) {\n\t\t\ttalentsToSimDiv.style.display = 'flex';\n\t\t} else {\n\t\t\ttalentsToSimDiv.style.display = 'none';\n\t\t}\n\t\ttalentsToSimDiv.classList.add('talents-picker-container');\n\t\tconst talentsLabel = document.createElement('label');\n\t\ttalentsLabel.innerText = 'Pick talents to sim (will increase time to sim)';\n\t\ttalentsToSimDiv.appendChild(talentsLabel);\n\t\tconst talentsContainerDiv = document.createElement('div');\n\t\ttalentsContainerDiv.classList.add('talents-container');\n\n\t\tconst dataStr = window.localStorage.getItem(this.simUI.getSavedTalentsStorageKey());\n\n\t\tlet jsonData;\n\t\ttry {\n\t\t\tif (dataStr !== null) {\n\t\t\t\tjsonData = JSON.parse(dataStr);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.warn('Invalid json for local storage value: ' + dataStr);\n\t\t}\n\t\tconst handleToggle = (frag: HTMLElement, load: TalentLoadout) => {\n\t\t\tconst chipDiv = frag.querySelector('.saved-data-set-chip');\n\t\t\tconst exists = this.savedTalents.some(talent => talent.name === load.name); // Replace 'id' with your unique identifier\n\n\t\t\tconsole.log('Exists:', exists);\n\t\t\tconsole.log('Load Object:', load);\n\t\t\tconsole.log('Saved Talents Before Update:', this.savedTalents);\n\n\t\t\tif (exists) {\n\t\t\t\t// If the object exists, find its index and remove it\n\t\t\t\tconst indexToRemove = this.savedTalents.findIndex(talent => talent.name === load.name);\n\t\t\t\tthis.savedTalents.splice(indexToRemove, 1);\n\t\t\t\tchipDiv?.classList.remove('active');\n\t\t\t} else {\n\t\t\t\t// If the object does not exist, add it\n\t\t\t\tthis.savedTalents.push(load);\n\t\t\t\tchipDiv?.classList.add('active');\n\t\t\t}\n\n\t\t\tconsole.log('Updated savedTalents:', this.savedTalents);\n\t\t};\n\t\tfor (const name in jsonData) {\n\t\t\ttry {\n\t\t\t\tconsole.log(name, jsonData[name]);\n\t\t\t\tconst savedTalentLoadout = SavedTalents.fromJson(jsonData[name]);\n\t\t\t\tconst loadout = {\n\t\t\t\t\ttalentsString: savedTalentLoadout.talentsString,\n\t\t\t\t\tglyphs: savedTalentLoadout.glyphs,\n\t\t\t\t\tname: name,\n\t\t\t\t};\n\n\t\t\t\tconst index = this.savedTalents.findIndex(talent => JSON.stringify(talent) === JSON.stringify(loadout));\n\t\t\t\tconst talentFragment = document.createElement('fragment');\n\t\t\t\ttalentFragment.innerHTML = `\n\t\t\t\t\t<div class=\"saved-data-set-chip badge rounded-pill ${index !== -1 ? 'active' : ''}\">\n\t\t\t\t\t\t<a href=\"javascript:void(0)\" class=\"saved-data-set-name\" role=\"button\">${name}</a>\n\t\t\t\t\t</div>`;\n\n\t\t\t\tconsole.log('Adding event for loadout', loadout);\n\t\t\t\t// Wrap the event listener addition in an IIFE\n\t\t\t\t(function (talentFragment, loadout) {\n\t\t\t\t\ttalentFragment.addEventListener('click', () => handleToggle(talentFragment, loadout));\n\t\t\t\t})(talentFragment, loadout);\n\n\t\t\t\ttalentsContainerDiv.appendChild(talentFragment);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t\tconsole.warn('Failed parsing saved data: ' + jsonData[name]);\n\t\t\t}\n\t\t}\n\n\t\ttalentsToSimDiv.append(talentsContainerDiv);\n\t\t//////////////////////\n\t\t////////////////////////////////////\n\n\t\t// Default Gem Options\n\t\tconst defaultGemDiv = document.createElement('div');\n\t\tif (this.autoGem) {\n\t\t\tdefaultGemDiv.style.display = 'flex';\n\t\t} else {\n\t\t\tdefaultGemDiv.style.display = 'none';\n\t\t}\n\n\t\tdefaultGemDiv.classList.add('default-gem-container');\n\t\tconst gemLabel = document.createElement('label');\n\t\tgemLabel.innerText = 'Defaults for Auto Gem';\n\t\tdefaultGemDiv.appendChild(gemLabel);\n\n\t\tconst gemSocketsDiv = document.createElement('div');\n\t\tgemSocketsDiv.classList.add('sockets-container');\n\n\t\tArray<GemColor>(GemColor.GemColorRed, GemColor.GemColorYellow, GemColor.GemColorBlue, GemColor.GemColorMeta).forEach((socketColor, socketIndex) => {\n\t\t\tconst gemFragment = document.createElement('fragment');\n\t\t\tgemFragment.innerHTML = `\n          <div class=\"gem-socket-container\">\n            <img class=\"gem-icon\" />\n            <img class=\"socket-icon\" />\n          </div>\n        `;\n\n\t\t\tconst gemContainer = gemFragment.children[0] as HTMLElement;\n\t\t\tthis.gemIconElements.push(gemContainer.querySelector('.gem-icon') as HTMLImageElement);\n\t\t\tconst socketIconElem = gemContainer.querySelector('.socket-icon') as HTMLImageElement;\n\t\t\tsocketIconElem.src = getEmptyGemSocketIconUrl(socketColor);\n\n\t\t\tlet selector: GemSelectorModal;\n\n\t\t\tconst handleChoose = (itemData: ItemData<UIGem>) => {\n\t\t\t\tthis.defaultGems[socketIndex] = itemData.item;\n\t\t\t\tthis.storeSettings();\n\t\t\t\tActionId.fromItemId(itemData.id)\n\t\t\t\t\t.fill()\n\t\t\t\t\t.then(filledId => {\n\t\t\t\t\t\tthis.gemIconElements[socketIndex].src = filledId.iconUrl;\n\t\t\t\t\t});\n\t\t\t\tselector.close();\n\t\t\t};\n\n\t\t\tconst openGemSelector = (_color: GemColor, _socketIndex: number) => {\n\t\t\t\treturn (_event: Event) => {\n\t\t\t\t\tif (selector == null) {\n\t\t\t\t\t\tselector = new GemSelectorModal(this.simUI.rootElem, this.simUI, socketColor, handleChoose);\n\t\t\t\t\t}\n\t\t\t\t\tselector.show();\n\t\t\t\t};\n\t\t\t};\n\n\t\t\tthis.gemIconElements[socketIndex].addEventListener('click', openGemSelector(socketColor, socketIndex));\n\t\t\tgemContainer.addEventListener('click', openGemSelector(socketColor, socketIndex));\n\t\t\tgemSocketsDiv.appendChild(gemContainer);\n\t\t});\n\t\tdefaultGemDiv.appendChild(gemSocketsDiv);\n\n\t\tnew BooleanPicker<BulkTab>(settingsBlock.bodyElement, this, {\n\t\t\tlabel: 'Fast Mode',\n\t\t\tlabelTooltip: 'Fast mode reduces accuracy but will run faster.',\n\t\t\tchangedEvent: (_obj: BulkTab) => this.itemsChangedEmitter,\n\t\t\tgetValue: _obj => this.fastMode,\n\t\t\tsetValue: (id: EventID, obj: BulkTab, value: boolean) => {\n\t\t\t\tobj.fastMode = value;\n\t\t\t},\n\t\t});\n\t\tnew BooleanPicker<BulkTab>(settingsBlock.bodyElement, this, {\n\t\t\tlabel: 'Combinations',\n\t\t\tlabelTooltip:\n\t\t\t\t'When checked bulk simulator will create all possible combinations of the items. When disabled trinkets and rings will still run all combinations becausee they have two slots to fill each.',\n\t\t\tchangedEvent: (_obj: BulkTab) => this.itemsChangedEmitter,\n\t\t\tgetValue: _obj => this.doCombos,\n\t\t\tsetValue: (id: EventID, obj: BulkTab, value: boolean) => {\n\t\t\t\tobj.doCombos = value;\n\t\t\t},\n\t\t});\n\t\tnew BooleanPicker<BulkTab>(settingsBlock.bodyElement, this, {\n\t\t\tlabel: 'Auto Enchant',\n\t\t\tlabelTooltip: 'When checked bulk simulator apply the current enchant for a slot to each replacement item it can.',\n\t\t\tchangedEvent: (_obj: BulkTab) => this.itemsChangedEmitter,\n\t\t\tgetValue: _obj => this.autoEnchant,\n\t\t\tsetValue: (id: EventID, obj: BulkTab, value: boolean) => {\n\t\t\t\tobj.autoEnchant = value;\n\t\t\t\tif (value) {\n\t\t\t\t\tdefaultGemDiv.style.display = 'flex';\n\t\t\t\t} else {\n\t\t\t\t\tdefaultGemDiv.style.display = 'none';\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tnew BooleanPicker<BulkTab>(settingsBlock.bodyElement, this, {\n\t\t\tlabel: 'Auto Gem',\n\t\t\tlabelTooltip: 'When checked bulk simulator will fill any un-filled gem sockets with default gems.',\n\t\t\tchangedEvent: (_obj: BulkTab) => this.itemsChangedEmitter,\n\t\t\tgetValue: _obj => this.autoGem,\n\t\t\tsetValue: (id: EventID, obj: BulkTab, value: boolean) => {\n\t\t\t\tobj.autoGem = value;\n\t\t\t\tif (value) {\n\t\t\t\t\tdefaultGemDiv.style.display = 'flex';\n\t\t\t\t} else {\n\t\t\t\t\tdefaultGemDiv.style.display = 'none';\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tnew BooleanPicker<BulkTab>(settingsBlock.bodyElement, this, {\n\t\t\tlabel: 'Sim Talents',\n\t\t\tlabelTooltip: 'When checked bulk simulator will sim chosen talent setups. Warning, it might cause the bulk sim to run for a lot longer',\n\t\t\tchangedEvent: (_obj: BulkTab) => this.itemsChangedEmitter,\n\t\t\tgetValue: _obj => this.simTalents,\n\t\t\tsetValue: (id: EventID, obj: BulkTab, value: boolean) => {\n\t\t\t\tobj.simTalents = value;\n\t\t\t\tif (value) {\n\t\t\t\t\ttalentsToSimDiv.style.display = 'flex';\n\t\t\t\t} else {\n\t\t\t\t\ttalentsToSimDiv.style.display = 'none';\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tsettingsBlock.bodyElement.appendChild(defaultGemDiv);\n\t\tsettingsBlock.bodyElement.appendChild(talentsToSimDiv);\n\t}\n\n\tprivate setSimProgress(progress: ProgressMetrics, iterPerSecond: number, currentRound: number, rounds: number, combinations: number) {\n\t\tconst secondsRemain = ((progress.totalIterations - progress.completedIterations) / iterPerSecond).toFixed();\n\n\t\tlet roundsText = '';\n\t\tif (rounds > 0) {\n\t\t\troundsText = `${currentRound} / ${rounds} refining rounds`;\n\t\t}\n\n\t\tthis.pendingResults.setContent(`\n      <div class=\"results-sim\">\n        <div class=\"\">${combinations} total combinations.</div>\n        <div class=\"\">${roundsText}</div>\n        <div class=\"\"> ${progress.completedSims} / ${progress.totalSims}<br>simulations complete</div>\n        <div class=\"\">\n          ${progress.completedIterations} / ${progress.totalIterations}<br>iterations complete\n        </div>\n        <div class=\"\">\n          ${secondsRemain} seconds remaining.\n        </div>\n      </div>\n    `);\n\t}\n}\n\nclass GemSelectorModal extends BaseModal {\n\tprivate readonly simUI: IndividualSimUI<any>;\n\n\tprivate readonly contentElem: HTMLElement;\n\tprivate ilist: ItemList<UIGem> | null;\n\tprivate socketColor: GemColor;\n\tprivate onSelect: (itemData: ItemData<UIGem>) => void;\n\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<any>, socketColor: GemColor, onSelect: (itemData: ItemData<UIGem>) => void) {\n\t\tsuper(parent, 'selector-modal');\n\n\t\tthis.simUI = simUI;\n\t\tthis.onSelect = onSelect;\n\t\tthis.socketColor = socketColor;\n\t\tthis.ilist = null;\n\n\t\twindow.scrollTo({ top: 0 });\n\n\t\tthis.header!.insertAdjacentHTML('afterbegin', `<span>Choose Default Gem</span>`);\n\t\tthis.body.innerHTML = `<div class=\"tab-content selector-modal-tab-content\"></div>`;\n\t\tthis.contentElem = this.rootElem.querySelector('.selector-modal-tab-content') as HTMLElement;\n\t}\n\n\tshow() {\n\t\t// construct item list the first time its opened.\n\t\t// This makes startup faster and also means we are sure to have item database loaded.\n\t\tif (this.ilist == null) {\n\t\t\tthis.ilist = new ItemList<UIGem>(\n\t\t\t\tthis.body,\n\t\t\t\tthis.simUI,\n\t\t\t\t{\n\t\t\t\t\tselectedTab: SelectorModalTabs.Gem1,\n\t\t\t\t\tslot: ItemSlot.ItemSlotHead,\n\t\t\t\t\tequippedItem: null,\n\t\t\t\t\teligibleItems: new Array<UIItem>(),\n\t\t\t\t\teligibleEnchants: new Array<UIEnchant>(),\n\t\t\t\t\tgearData: {\n\t\t\t\t\t\tequipItem: (_eventID: EventID, _equippedItem: EquippedItem | null) => {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tgetEquippedItem: () => null,\n\t\t\t\t\t\tchangeEvent: new TypedEvent(), // FIXME\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tthis.simUI.player,\n\t\t\t\t'Gem1',\n\t\t\t\tthis.simUI.player.getGems(this.socketColor).map((gem: UIGem) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\titem: gem,\n\t\t\t\t\t\tid: gem.id,\n\t\t\t\t\t\tactionId: ActionId.fromItemId(gem.id),\n\t\t\t\t\t\tname: gem.name,\n\t\t\t\t\t\tquality: gem.quality,\n\t\t\t\t\t\tphase: gem.phase,\n\t\t\t\t\t\theroic: false,\n\t\t\t\t\t\tbaseEP: 0,\n\t\t\t\t\t\tignoreEPFilter: true,\n\t\t\t\t\t\tonEquip: (_eventID, _gem: UIGem) => {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\tgem => {\n\t\t\t\t\treturn this.simUI.player.computeGemEP(gem);\n\t\t\t\t},\n\t\t\t\t() => {\n\t\t\t\t\treturn null;\n\t\t\t\t},\n\t\t\t\tthis.socketColor,\n\t\t\t\t() => {\n\t\t\t\t\treturn;\n\t\t\t\t},\n\t\t\t\tthis.onSelect,\n\t\t\t);\n\n\t\t\t// let invokeUpdate = () => {this.ilist?.updateSelected()}\n\t\t\tconst applyFilter = () => {\n\t\t\t\tthis.ilist?.applyFilters();\n\t\t\t};\n\t\t\t// Add event handlers\n\t\t\t// this.itemsChangedEmitter.on(invokeUpdate);\n\n\t\t\tthis.addOnDisposeCallback(() => this.ilist?.dispose());\n\n\t\t\tthis.simUI.sim.phaseChangeEmitter.on(applyFilter);\n\t\t\tthis.simUI.sim.filtersChangeEmitter.on(applyFilter);\n\t\t\t// gearData.changeEvent.on(applyFilter);\n\t\t}\n\n\t\tthis.open();\n\t}\n}\n","import { EventID, TypedEvent } from '../typed_event.js';\nimport { ContentBlock, ContentBlockHeaderConfig } from './content_block';\n\nimport { Component } from '../components/component.js';\nimport { Tooltip } from 'bootstrap';\n\nexport type SavedDataManagerConfig<ModObject, T> = {\n\tlabel: string;\n\theader?: ContentBlockHeaderConfig;\n\tpresetsOnly?: boolean;\n\tstorageKey: string;\n\tchangeEmitters: Array<TypedEvent<any>>,\n\tequals: (a: T, b: T) => boolean;\n\tgetData: (modObject: ModObject) => T;\n\tsetData: (eventID: EventID, modObject: ModObject, data: T) => void;\n\ttoJson: (a: T) => any;\n\tfromJson: (obj: any) => T;\n};\n\nexport type SavedDataConfig<ModObject, T> = {\n\tname: string;\n\tdata: T;\n\ttooltip?: string;\n\tisPreset?: boolean;\n\n\t// If set, will automatically hide the saved data when this evaluates to false.\n\tenableWhen?: (obj: ModObject) => boolean;\n};\n\ntype SavedData<ModObject, T> = {\n\tname: string;\n\tdata: T;\n\telem: HTMLElement;\n\tenableWhen?: (obj: ModObject) => boolean;\n};\n\nexport class SavedDataManager<ModObject, T> extends Component {\n\tprivate readonly modObject: ModObject;\n\tprivate readonly config: SavedDataManagerConfig<ModObject, T>;\n\n\tprivate readonly userData: Array<SavedData<ModObject, T>>;\n\tprivate readonly presets: Array<SavedData<ModObject, T>>;\n\n\tprivate readonly savedDataDiv: HTMLElement\n\tprivate readonly presetDataDiv: HTMLElement;\n\tprivate readonly customDataDiv: HTMLElement;\n\tprivate readonly saveInput?: HTMLInputElement;\n\n\tprivate frozen: boolean;\n\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: SavedDataManagerConfig<ModObject, T>) {\n\t\tsuper(parent, 'saved-data-manager-root');\n\t\tthis.modObject = modObject;\n\t\tthis.config = config;\n\n\t\tthis.userData = [];\n\t\tthis.presets = [];\n\t\tthis.frozen = false;\n\n\t\tlet contentBlock = new ContentBlock(this.rootElem, 'saved-data', { header: config.header });\n\n\t\tcontentBlock.bodyElement.innerHTML = `\n\t\t\t<div class=\"saved-data-container hide\">\n\t\t\t\t<div class=\"saved-data-presets\"></div>\n\t\t\t\t<div class=\"saved-data-custom\"></div>\n\t\t\t</div>\n\t\t`;\n\t\tthis.savedDataDiv = contentBlock.bodyElement.querySelector('.saved-data-container') as HTMLElement;\n\t\tthis.presetDataDiv = contentBlock.bodyElement.querySelector('.saved-data-presets') as HTMLElement;\n\t\tthis.customDataDiv = contentBlock.bodyElement.querySelector('.saved-data-custom') as HTMLElement;\n\n\t\tif (!config.presetsOnly) {\n\t\t\tcontentBlock.bodyElement.appendChild(this.buildCreateContainer());\n\t\t\tthis.saveInput = contentBlock.bodyElement.querySelector('.saved-data-save-input') as HTMLInputElement;\n\t\t}\n\t}\n\n\taddSavedData(config: SavedDataConfig<ModObject, T>) {\n\t\tthis.savedDataDiv.classList.remove('hide');\n\n\t\tconst newData = this.makeSavedData(config);\n\t\tconst dataArr = config.isPreset ? this.presets : this.userData;\n\t\tconst oldIdx = dataArr.findIndex(data => data.name == config.name);\n\n\t\tif (oldIdx == -1) {\n\t\t\tif (config.isPreset) {\n\t\t\t\tthis.presetDataDiv.appendChild(newData.elem);\n\t\t\t} else {\n\t\t\t\tthis.customDataDiv.appendChild(newData.elem);\n\t\t\t}\n\t\t\tdataArr.push(newData);\n\t\t} else {\n\t\t\tdataArr[oldIdx].elem.replaceWith(newData.elem)\n\t\t\tdataArr[oldIdx] = newData;\n\t\t}\n\t}\n\n\tprivate makeSavedData(config: SavedDataConfig<ModObject, T>): SavedData<ModObject, T> {\n\t\tconst dataElemFragment = document.createElement('fragment');\n\t\tdataElemFragment.innerHTML = `\n\t\t\t<div class=\"saved-data-set-chip badge rounded-pill\">\n\t\t\t\t<a href=\"javascript:void(0)\" class=\"saved-data-set-name\" role=\"button\">${config.name}</a>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst dataElem = dataElemFragment.children[0] as HTMLElement;\n\t\tdataElem.addEventListener('click', event => {\n\t\t\tthis.config.setData(TypedEvent.nextEventID(), this.modObject, config.data);\n\n\t\t\tif (this.saveInput)\n\t\t\t\tthis.saveInput.value = config.name;\n\t\t});\n\n\t\tif (!config.isPreset) {\n\t\t\tlet deleteFragment = document.createElement('fragment');\n\t\t\tdeleteFragment.innerHTML = `\n\t\t\t\t<a\n\t\t\t\t\thref=\"javascript:void(0)\"\n\t\t\t\t\tclass=\"saved-data-set-delete\"\n\t\t\t\t\trole=\"button\"\n\t\t\t\t>\n\t\t\t\t\t<i class=\"fa fa-times fa-lg\"></i>\n\t\t\t\t</a>\n\t\t\t`;\n\n\t\t\tconst deleteButton = deleteFragment.children[0] as HTMLElement;\n\t\t\tdataElem.appendChild(deleteButton);\n\n\t\t\tconst tooltip = Tooltip.getOrCreateInstance(deleteButton, {title:`Delete saved ${this.config.label}`});\n\n\t\t\tdeleteButton.addEventListener('click', event => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tconst shouldDelete = confirm(`Delete saved ${this.config.label} '${config.name}'?`);\n\t\t\t\tif (!shouldDelete)\n\t\t\t\t\treturn;\n\n\t\t\t\ttooltip.dispose();\n\n\t\t\t\tconst idx = this.userData.findIndex(data => data.name == config.name);\n\t\t\t\tthis.userData[idx].elem.remove();\n\t\t\t\tthis.userData.splice(idx, 1);\n\t\t\t\tthis.saveUserData();\n\t\t\t});\n\t\t}\n\n\t\tif (config.tooltip) {\n\t\t\tTooltip.getOrCreateInstance(dataElem, {\n\t\t\t\ttitle: config.tooltip,\n\t\t\t\tplacement: 'bottom',\n\t\t\t\thtml: true,\n\t\t\t});\n\t\t}\n\n\t\tconst checkActive = () => {\n\t\t\tif (this.config.equals(config.data, this.config.getData(this.modObject))) {\n\t\t\t\tdataElem.classList.add('active');\n\t\t\t} else {\n\t\t\t\tdataElem.classList.remove('active');\n\t\t\t}\n\n\t\t\tif (config.enableWhen && !config.enableWhen(this.modObject)) {\n\t\t\t\tdataElem.classList.add('disabled');\n\t\t\t} else {\n\t\t\t\tdataElem.classList.remove('disabled');\n\t\t\t}\n\t\t};\n\n\t\tcheckActive();\n\t\tthis.config.changeEmitters.forEach(emitter => emitter.on(checkActive));\n\n\t\treturn {\n\t\t\tname: config.name,\n\t\t\tdata: config.data,\n\t\t\telem: dataElem,\n\t\t\tenableWhen: config.enableWhen,\n\t\t};\n\t}\n\n\t// Save data to window.localStorage.\n\tprivate saveUserData() {\n\t\tconst userData: Record<string, Object> = {};\n\t\tthis.userData.forEach(savedData => {\n\t\t\tuserData[savedData.name] = this.config.toJson(savedData.data);\n\t\t});\n\n\t\tif (this.userData.length == 0 && this.presets.length == 0)\n\t\t\tthis.savedDataDiv.classList.add('hide');\n\n\t\twindow.localStorage.setItem(this.config.storageKey, JSON.stringify(userData));\n\t}\n\n\t// Load data from window.localStorage.\n\tloadUserData() {\n\t\tconst dataStr = window.localStorage.getItem(this.config.storageKey);\n\t\tif (!dataStr)\n\t\t\treturn;\n\n\t\tlet jsonData;\n\t\ttry {\n\t\t\tjsonData = JSON.parse(dataStr);\n\t\t} catch (e) {\n\t\t\tconsole.warn('Invalid json for local storage value: ' + dataStr);\n\t\t}\n\n\t\tfor (let name in jsonData) {\n\t\t\ttry {\n\t\t\t\tthis.addSavedData({\n\t\t\t\t\tname: name,\n\t\t\t\t\tdata: this.config.fromJson(jsonData[name]),\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('Failed parsing saved data: ' + jsonData[name]);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Prevent user input from creating / deleting saved data.\n\tfreeze() {\n\t\tthis.frozen = true;\n\t\tthis.rootElem.classList.add('frozen');\n\t}\n\n\tprivate buildCreateContainer(): HTMLElement {\n\t\tlet savedDataCreateFragment = document.createElement('fragment');\n\t\tsavedDataCreateFragment.innerHTML = `\n\t\t\t<div class=\"saved-data-create-container\">\n\t\t\t\t<label class=\"form-label\">${this.config.label} Name</label>\n\t\t\t\t<input class=\"saved-data-save-input form-control\" type=\"text\" placeholder=\"Name\">\n\t\t\t\t<button class=\"saved-data-save-button btn btn-primary\">Save ${this.config.label}</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst saveButton = savedDataCreateFragment.querySelector('.saved-data-save-button') as HTMLButtonElement;\n\n\t\tsaveButton.addEventListener('click', event => {\n\t\t\tif (this.frozen)\n\t\t\t\treturn;\n\n\t\t\tconst newName = this.saveInput?.value;\n\t\t\tif (!newName) {\n\t\t\t\talert(`Choose a label for your saved ${this.config.label}!`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (newName in this.presets) {\n\t\t\t\talert(`${this.config.label} with name ${newName} already exists.`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.addSavedData({\n\t\t\t\tname: newName,\n\t\t\t\tdata: this.config.getData(this.modObject),\n\t\t\t});\n\t\t\tthis.saveUserData();\n\t\t});\n\n\t\treturn savedDataCreateFragment.children[0] as HTMLElement;\n\t}\n}\n","import { Component } from '../../components/component';\nimport { setItemQualityCssClass } from '../../css_utils';\nimport { Player } from '../../player';\nimport { UIGem as Gem } from '../../proto/ui.js';\nimport { ActionId } from '../../proto_utils/action_id';\nimport { SimUI } from '../../sim_ui';\nimport { ContentBlock } from '../content_block';\n\ninterface GemSummaryData {\n\tgem: Gem;\n\tcount: number;\n}\n\nexport class GemSummary extends Component {\n\tprivate readonly simUI: SimUI;\n\tprivate readonly player: Player<any>;\n\n\tprivate readonly container: ContentBlock;\n\n\tconstructor(parent: HTMLElement, simUI: SimUI, player: Player<any>) {\n\t\tsuper(parent, 'gem-summary-root');\n\t\tthis.simUI = simUI;\n\t\tthis.player = player;\n\n\t\tthis.container = new ContentBlock(this.rootElem, 'gem-summary-container', {\n\t\t\theader: { title: 'Gem Summary' },\n\t\t});\n\t\tplayer.gearChangeEmitter.on(() => this.updateTable());\n\t}\n\n\tprivate updateTable() {\n\t\tthis.container.bodyElement.innerHTML = ``;\n\t\tconst fullGemList = this.player.getGear().getAllGems(this.player.isBlacksmithing());\n\t\tconst gemCounts: Record<string, GemSummaryData> = {};\n\n\t\tfor (const gem of fullGemList) {\n\t\t\tif (gemCounts[gem.name]) {\n\t\t\t\tgemCounts[gem.name].count += 1;\n\t\t\t} else {\n\t\t\t\tgemCounts[gem.name] = {\n\t\t\t\t\tgem: gem,\n\t\t\t\t\tcount: 1,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tfor (const gemName of Object.keys(gemCounts)) {\n\t\t\tconst gemData = gemCounts[gemName];\n\t\t\tconst row = document.createElement('div');\n\t\t\trow.classList.add('d-flex', 'align-items-center', 'justify-content-between');\n\t\t\trow.innerHTML = `\n\t\t\t\t<a class=\"gem-summary-link\" data-whtticon='false' target='_blank'>\n\t\t\t\t\t<img class=\"gem-icon\"/>\n\t\t\t\t\t<div>${gemName}</div>\n\t\t\t\t</a>\n\t\t\t\t<div>${gemData.count.toFixed(0)}</div>\n\t\t\t`;\n\n\t\t\tconst gemLinkElem = row.querySelector('.gem-summary-link') as HTMLAnchorElement;\n\t\t\tconst gemIconElem = row.querySelector('.gem-icon') as HTMLImageElement;\n\n\t\t\tsetItemQualityCssClass(gemLinkElem, gemData.gem.quality);\n\n\t\t\tActionId.fromItemId(gemData.gem.id)\n\t\t\t\t.fill()\n\t\t\t\t.then(filledId => {\n\t\t\t\t\tgemIconElem.src = filledId.iconUrl;\n\t\t\t\t\tfilledId.setWowheadHref(gemLinkElem);\n\t\t\t\t});\n\n\t\t\tthis.container.bodyElement.appendChild(row);\n\t\t}\n\t}\n}\n","import { IndividualSimUI } from '../../individual_sim_ui';\nimport { Player } from '../../player';\nimport { EquipmentSpec, UnitStats } from '../../proto/common';\nimport { SavedGearSet } from '../../proto/ui';\nimport { Stats } from '../../proto_utils/stats';\nimport { EventID, TypedEvent } from '../../typed_event';\nimport { GearPicker } from '../gear_picker';\nimport { SavedDataManager } from '../saved_data_manager';\nimport { SimTab } from '../sim_tab';\nimport { GemSummary } from './gem_summary';\n\nexport class GearTab extends SimTab {\n\tprotected simUI: IndividualSimUI<any>;\n\n\treadonly leftPanel: HTMLElement;\n\treadonly rightPanel: HTMLElement;\n\n\tconstructor(parentElem: HTMLElement, simUI: IndividualSimUI<any>) {\n\t\tsuper(parentElem, simUI, { identifier: 'gear-tab', title: 'Gear' });\n\t\tthis.simUI = simUI;\n\n\t\tthis.leftPanel = document.createElement('div');\n\t\tthis.leftPanel.classList.add('gear-tab-left', 'tab-panel-left');\n\n\t\tthis.rightPanel = document.createElement('div');\n\t\tthis.rightPanel.classList.add('gear-tab-right', 'tab-panel-right');\n\n\t\tthis.contentContainer.appendChild(this.leftPanel);\n\t\tthis.contentContainer.appendChild(this.rightPanel);\n\n\t\tthis.buildTabContent();\n\t}\n\n\tprotected buildTabContent() {\n\t\tthis.buildGearPickers();\n\t\tthis.buildGemSummary();\n\t\tthis.buildSavedGearsetPicker();\n\t}\n\n\tprivate buildGearPickers() {\n\t\tnew GearPicker(this.leftPanel, this.simUI, this.simUI.player);\n\t}\n\n\tprivate buildGemSummary() {\n\t\tnew GemSummary(this.leftPanel, this.simUI, this.simUI.player);\n\t}\n\n\tprivate buildSavedGearsetPicker() {\n\t\tconst savedGearManager = new SavedDataManager<Player<any>, SavedGearSet>(this.rightPanel, this.simUI.player, {\n\t\t\theader: { title: 'Gear Sets' },\n\t\t\tlabel: 'Gear Set',\n\t\t\tstorageKey: this.simUI.getSavedGearStorageKey(),\n\t\t\tgetData: (player: Player<any>) => {\n\t\t\t\treturn SavedGearSet.create({\n\t\t\t\t\tgear: player.getGear().asSpec(),\n\t\t\t\t\tbonusStatsStats: player.getBonusStats().toProto(),\n\t\t\t\t});\n\t\t\t},\n\t\t\tsetData: (eventID: EventID, player: Player<any>, newSavedGear: SavedGearSet) => {\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\t\tplayer.setGear(eventID, this.simUI.sim.db.lookupEquipmentSpec(newSavedGear.gear || EquipmentSpec.create()));\n\t\t\t\t\tplayer.setBonusStats(eventID, Stats.fromProto(newSavedGear.bonusStatsStats || UnitStats.create()));\n\t\t\t\t});\n\t\t\t},\n\t\t\tchangeEmitters: [this.simUI.player.changeEmitter],\n\t\t\tequals: (a: SavedGearSet, b: SavedGearSet) => SavedGearSet.equals(a, b),\n\t\t\ttoJson: (a: SavedGearSet) => SavedGearSet.toJson(a),\n\t\t\tfromJson: (obj: any) => SavedGearSet.fromJson(obj),\n\t\t});\n\n\t\tthis.simUI.sim.waitForInit().then(() => {\n\t\t\tsavedGearManager.loadUserData();\n\t\t\tthis.simUI.individualConfig.presets.gear.forEach(presetGear => {\n\t\t\t\tsavedGearManager.addSavedData({\n\t\t\t\t\tname: presetGear.name,\n\t\t\t\t\ttooltip: presetGear.tooltip,\n\t\t\t\t\tisPreset: true,\n\t\t\t\t\tdata: SavedGearSet.create({\n\t\t\t\t\t\t// Convert to gear and back so order is always the same.\n\t\t\t\t\t\tgear: this.simUI.sim.db.lookupEquipmentSpec(presetGear.gear).asSpec(),\n\t\t\t\t\t\tbonusStatsStats: new Stats().toProto(),\n\t\t\t\t\t}),\n\t\t\t\t\tenableWhen: presetGear.enableWhen,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n}\n","export const BUFFS_SECTION = 'Buffs provided by other party/raid members.';\nexport const DEBUFFS_SECTION = 'Debuffs applied by other raid members.';\nexport const COOLDOWNS_SECTION = 'Specify cooldown timings, in seconds. Cooldowns will be used as soon as possible after their specified timings. When not specified, cooldowns will be used when ready and it is sensible to do so.<br><br>Multiple timings can be provided by separating with commas. Any cooldown usages after the last provided timing will use the default logic.';\nexport const BLESSINGS_SECTION = 'Specify Paladin Blessings for each role, in order of priority. Blessings in the 1st column will be used if there is at least 1 Paladin in the raid, 2nd column if at least 2, etc.';\n\nexport const BASIC_BIS_DISCLAIMER = '<p>Preset gear lists are intended as rough approximations of BIS, and will often not be the absolute highest-DPS setup for you. Your optimal gear setup will depend on many factors; that\\'s why we have a sim!</p><p>Items may also be omitted from the presets if they are highly contested and clearly better utilized on other classes, to encourage equitable gearing for the raid as a whole.</p>';\n\nexport const HEALING_SIM_DISCLAIMER = '*** WARNING - USE AT YOUR OWN RISK ***\\n\\nThe entire concept of a healing sim is EXPERIMENTAL. All results should be taken with an EXTREMELY large grain of salt.\\n\\nThis tool is currently more similar to a spreadsheet than a true sim. Options for specifying incoming damage profiles in order to have proper reactive rotations have not yet been added.';\n","import { Tooltip } from 'bootstrap';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { swap } from '../utils.js';\n\nimport { Input, InputConfig } from './input.js';\n\nimport { element, fragment } from 'tsx-vanilla';\n\nexport type ListItemAction = 'create' | 'delete' | 'move' | 'copy';\n\nexport interface ListPickerActionsConfig {\n\tcreate?: {\n\t\t// Whether or not to use an icon for the create action button\n\t\t// defaults to FALSE\n\t\tuseIcon?: boolean\t\n\t}\n}\n\nexport interface ListPickerConfig<ModObject, ItemType> extends InputConfig<ModObject, Array<ItemType>> {\n\titemLabel: string,\n\tnewItem: () => ItemType,\n\tcopyItem: (oldItem: ItemType) => ItemType,\n\tnewItemPicker: (parent: HTMLElement, listPicker: ListPicker<ModObject, ItemType>, index: number, config: ListItemPickerConfig<ModObject, ItemType>) => Input<ModObject, ItemType>,\n\tactions?: ListPickerActionsConfig\n\ttitle?: string,\n\ttitleTooltip?: string,\n\tinlineMenuBar?: boolean,\n\thideUi?: boolean,\n\thorizontalLayout?: boolean,\n\n\t// If set, only actions included in the list are allowed. Otherwise, all actions are allowed.\n\tallowedActions?: Array<ListItemAction>,\n}\n\nconst DEFAULT_CONFIG = {\n\tactions: {\n\t\tcreate: {\n\t\t\tuseIcon: false,\n\t\t}\n\t}\n}\n\nexport interface ListItemPickerConfig<ModObject, ItemType> extends InputConfig<ModObject, ItemType> {\n}\n\ninterface ItemPickerPair<ItemType> {\n\telem: HTMLElement,\n\tpicker: Input<any, ItemType>,\n\tidx: number,\n}\n\ninterface ListDragData<ModObject, ItemType> {\n\tlistPicker: ListPicker<ModObject, ItemType>;\n\titem: ItemPickerPair<ItemType>;\n}\n\nvar curDragData: ListDragData<any, any>|null = null;\n\nexport class ListPicker<ModObject, ItemType> extends Input<ModObject, Array<ItemType>> {\n\treadonly config: ListPickerConfig<ModObject, ItemType>;\n\tprivate readonly itemsDiv: HTMLElement;\n\n\tprivate itemPickerPairs: Array<ItemPickerPair<ItemType>>;\n\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: ListPickerConfig<ModObject, ItemType>) {\n\t\tsuper(parent, 'list-picker-root', modObject, config);\n\t\tthis.config = {...DEFAULT_CONFIG, ...config};\n\t\tthis.itemPickerPairs = [];\n\n\t\tthis.rootElem.appendChild(\n\t\t\t<>\n\t\t\t\t{config.title &&\n\t\t\t\t\t<label className='list-picker-title form-label'>\n\t\t\t\t\t\t{config.title}\n\t\t\t\t\t</label>\n\t\t\t\t}\n\t\t\t\t<div className=\"list-picker-items\"></div>\n\t\t\t</>\n\t\t)\n\n\t\tif (this.config.hideUi) {\n\t\t\tthis.rootElem.classList.add('d-none');\n\t\t}\n\t\tif (this.config.horizontalLayout) {\n\t\t\tthis.config.inlineMenuBar = true;\n\t\t\tthis.rootElem.classList.add('horizontal');\n\t\t}\n\n\t\tif (this.config.titleTooltip) {\n\t\t\tlet cfg = {\n\t\t\t\ttitle: this.config.titleTooltip\n\t\t\t}\n\t\t\tTooltip.getOrCreateInstance(this.rootElem.querySelector('.list-picker-title') as HTMLElement, cfg);\n\t\t}\n\n\t\tthis.itemsDiv = this.rootElem.getElementsByClassName('list-picker-items')[0] as HTMLElement;\n\n\t\tif (this.actionEnabled('create')) {\n\t\t\tlet newItemButton = null;\n\t\t\tlet newButtonTooltip: Tooltip | null = null;\n\t\t\tif (this.config.actions?.create?.useIcon) {\n\t\t\t\tnewItemButton = ListPicker.makeActionElem('link-success', 'fa-plus')\n\t\t\t\tnewButtonTooltip = Tooltip.getOrCreateInstance(newItemButton, {title: `New ${config.itemLabel}`});\n\t\t\t} else {\n\t\t\t\tnewItemButton = document.createElement('button');\n\t\t\t\tnewItemButton.classList.add('btn', 'btn-primary');\n\t\t\t\tnewItemButton.textContent = `New ${config.itemLabel}`;\n\t\t\t}\n\t\t\tnewItemButton.classList.add('list-picker-new-button');\n\t\t\tnewItemButton.addEventListener('click', event => {\n\t\t\t\tconst newItem = this.config.newItem();\n\t\t\t\tconst newList = this.config.getValue(this.modObject).concat([newItem]);\n\t\t\t\tthis.config.setValue(TypedEvent.nextEventID(), this.modObject, newList);\n\t\t\t\tif (newButtonTooltip) {\n\t\t\t\t\tnewButtonTooltip.hide();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.rootElem.appendChild(newItemButton);\n\t\t}\n\n\t\tthis.init();\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.rootElem;\n\t}\n\n\tgetInputValue(): Array<ItemType> {\n\t\treturn this.itemPickerPairs.map(pair => pair.picker.getInputValue());\n\t}\n\n\tsetInputValue(newValue: Array<ItemType>): void {\n\t\t// Add/remove pickers to make the lengths match.\n\t\tif (newValue.length < this.itemPickerPairs.length) {\n\t\t\tthis.itemPickerPairs.slice(newValue.length).forEach(ipp => ipp.elem.remove());\n\t\t\tthis.itemPickerPairs = this.itemPickerPairs.slice(0, newValue.length);\n\t\t} else if (newValue.length > this.itemPickerPairs.length) {\n\t\t\tconst numToAdd = newValue.length - this.itemPickerPairs.length;\n\t\t\tfor (let i = 0; i < numToAdd; i++) {\n\t\t\t\tthis.addNewPicker();\n\t\t\t}\n\t\t}\n\n\t\t// Set all the values.\n\t\tnewValue.forEach((val, i) => this.itemPickerPairs[i].picker.setInputValue(val))\n\t}\n\n\tprivate actionEnabled(action: ListItemAction): boolean {\n\t\treturn !this.config.allowedActions || this.config.allowedActions.includes(action);\n\t}\n\n\tprivate addNewPicker() {\n\t\tconst index = this.itemPickerPairs.length;\n\t\tconst itemContainer = document.createElement('div');\n\t\titemContainer.classList.add('list-picker-item-container');\n\t\tif (this.config.inlineMenuBar) {\n\t\t\titemContainer.classList.add('inline');\n\t\t}\n\t\tthis.itemsDiv.appendChild(itemContainer);\n\n\t\tconst itemElem = document.createElement('div');\n\t\titemElem.classList.add('list-picker-item');\n\n\t\tconst itemHeader = document.createElement('div');\n\t\titemHeader.classList.add('list-picker-item-header');\n\t\tconst itemHTML = '<div class=\"list-picker-item\"></div>';\n\n\t\tif (this.config.inlineMenuBar) {\n\t\t\titemContainer.appendChild(itemElem);\n\t\t\titemContainer.appendChild(itemHeader);\n\t\t} else {\n\t\t\titemContainer.appendChild(itemHeader);\n\t\t\titemContainer.appendChild(itemElem);\n\t\t\tif (this.config.itemLabel) {\n\t\t\t\tconst itemLabel = document.createElement('h6');\n\t\t\t\titemLabel.classList.add('list-picker-item-title');\n\t\t\t\titemLabel.textContent = `${this.config.itemLabel} ${this.itemPickerPairs.length + 1}`;\n\t\t\t\titemHeader.appendChild(itemLabel);\n\t\t\t}\n\t\t}\n\n\t\tconst itemPicker = this.config.newItemPicker(itemElem, this, index, {\n\t\t\tchangedEvent: this.config.changedEvent,\n\t\t\tgetValue: (modObj: ModObject) => this.getSourceValue()[index],\n\t\t\tsetValue: (eventID: EventID, modObj: ModObject, newValue: ItemType) => {\n\t\t\t\tconst newList = this.getSourceValue();\n\t\t\t\tnewList[index] = newValue;\n\t\t\t\tthis.config.setValue(eventID, modObj, newList);\n\t\t\t},\n\t\t});\n\n\t\tconst item: ItemPickerPair<ItemType> = { elem: itemContainer, picker: itemPicker, idx: index };\n\n\t\tif (this.actionEnabled('move')) {\n\t\t\tconst moveButton = ListPicker.makeActionElem('list-picker-item-move', 'fa-arrows-up-down');\n\t\t\titemHeader.appendChild(moveButton);\n\n\t\t\tconst moveButtonTooltip = Tooltip.getOrCreateInstance(moveButton, {title: 'Move (Drag+Drop)'});\n\t\t\tmoveButton.addEventListener('click', event => {\n\t\t\t\tmoveButtonTooltip.hide();\n\t\t\t});\n\n\t\t\tmoveButton.draggable = true;\n\t\t\tmoveButton.ondragstart = event => {\n\t\t\t\tif (event.target == moveButton) {\n\t\t\t\t\tevent.dataTransfer!.dropEffect = 'move';\n\t\t\t\t\tevent.dataTransfer!.effectAllowed = 'move';\n\t\t\t\t\titemContainer.classList.add('dragfrom');\n\t\t\t\t\tcurDragData = {\n\t\t\t\t\t\tlistPicker: this,\n\t\t\t\t\t\titem: item,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tlet dragEnterCounter = 0;\n\t\t\titemContainer.ondragenter = event => {\n\t\t\t\tif (!curDragData || curDragData.listPicker != this) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tevent.preventDefault();\n\t\t\t\tdragEnterCounter++;\n\t\t\t\titemContainer.classList.add('dragto');\n\t\t\t};\n\t\t\titemContainer.ondragleave = event => {\n\t\t\t\tif (!curDragData || curDragData.listPicker != this) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tevent.preventDefault();\n\t\t\t\tdragEnterCounter--;\n\t\t\t\tif (dragEnterCounter <= 0) {\n\t\t\t\t\titemContainer.classList.remove('dragto');\n\t\t\t\t}\n\t\t\t};\n\t\t\titemContainer.ondragover = event => {\n\t\t\t\tif (!curDragData || curDragData.listPicker != this) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tevent.preventDefault();\n\t\t\t};\n\t\t\titemContainer.ondrop = event => {\n\t\t\t\tif (!curDragData || curDragData.listPicker != this) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tevent.preventDefault();\n\t\t\t\tdragEnterCounter = 0;\n\t\t\t\titemContainer.classList.remove('dragto');\n\t\t\t\tcurDragData.item.elem.classList.remove('dragfrom');\n\n\t\t\t\tconst srcIdx = curDragData.item.idx;\n\t\t\t\tconst dstIdx = index;\n\t\t\t\tconst newList = this.config.getValue(this.modObject);\n\t\t\t\tconst arrElem = newList[srcIdx];\n\t\t\t\tnewList.splice(srcIdx, 1);\n\t\t\t\tnewList.splice(dstIdx, 0, arrElem);\n\t\t\t\tthis.config.setValue(TypedEvent.nextEventID(), this.modObject, newList);\n\n\t\t\t\tcurDragData = null;\n\t\t\t};\n\t\t}\n\n\t\tif (this.actionEnabled('copy')) {\n\t\t\tconst copyButton = ListPicker.makeActionElem('list-picker-item-copy', 'fa-copy');\n\t\t\titemHeader.appendChild(copyButton);\n\t\t\tconst copyButtonTooltip = Tooltip.getOrCreateInstance(copyButton, {title: `Copy to New ${this.config.itemLabel}`});\n\n\t\t\tcopyButton.addEventListener('click', event => {\n\t\t\t\tconst newList = this.config.getValue(this.modObject).slice();\n\t\t\t\tnewList.splice(index, 0, this.config.copyItem(newList[index]));\n\t\t\t\tthis.config.setValue(TypedEvent.nextEventID(), this.modObject, newList);\n\t\t\t\tcopyButtonTooltip.hide();\n\t\t\t});\n\t\t}\n\n\t\tif (this.actionEnabled('delete')) {\n\t\t\tconst deleteButton = ListPicker.makeActionElem('list-picker-item-delete', 'fa-times');\n\t\t\tdeleteButton.classList.add('link-danger');\n\t\t\titemHeader.appendChild(deleteButton);\n\t\t\tconst deleteButtonTooltip = Tooltip.getOrCreateInstance(deleteButton, { title: `Delete ${this.config.itemLabel}`});\n\n\t\t\tdeleteButton.addEventListener('click', event => {\n\t\t\t\tconst newList = this.config.getValue(this.modObject);\n\t\t\t\tnewList.splice(index, 1);\n\t\t\t\tthis.config.setValue(TypedEvent.nextEventID(), this.modObject, newList);\n\t\t\t\tdeleteButtonTooltip.hide();\n\t\t\t});\n\t\t}\n\n\t\tthis.itemPickerPairs.push(item);\n\t}\n\n\tstatic makeActionElem(cssClass: string, iconCssClass: string): HTMLElement {\n\t\tconst actionElem = document.createElement('a');\n\t\tactionElem.classList.add('list-picker-item-action', cssClass);\n\t\tactionElem.href = 'javascript:void(0)';\n\t\tactionElem.setAttribute('role', 'button');\n\n\t\tconst icon = document.createElement('i');\n\t\ticon.classList.add('fa', 'fa-xl', iconCssClass);\n\t\tactionElem.appendChild(icon);\n\n\t\treturn actionElem;\n\t}\n\n\tstatic getItemHeaderElem(itemPicker: Input<any, any>): HTMLElement {\n\t\tconst itemElem = itemPicker.rootElem.parentElement!;\n\t\tconst headerElem = (itemElem.nextElementSibling || itemElem.previousElementSibling);\n\t\tif (!headerElem?.classList.contains('list-picker-item-header')) {\n\t\t\tthrow new Error('Could not find list item header');\n\t\t}\n\t\treturn headerElem as HTMLElement;\n\t}\n}\n","import { EventID, TypedEvent } from '../typed_event.js';\n\nimport { Input, InputConfig } from './input.js';\n\n/**\n * Data for creating a string picker.\n */\nexport interface StringPickerConfig<ModObject> extends InputConfig<ModObject, string> {\n}\n\n// UI element for picking an arbitrary string field.\nexport class StringPicker<ModObject> extends Input<ModObject, string> {\n\tprivate readonly inputElem: HTMLSpanElement;\n\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: StringPickerConfig<ModObject>) {\n\t\tsuper(parent, 'string-picker-root', modObject, config);\n\n\t\tthis.inputElem = document.createElement('span');\n\t\tthis.inputElem.setAttribute('contenteditable', '');\n\t\tthis.inputElem.classList.add('string-picker-input');\n\t\tthis.rootElem.appendChild(this.inputElem);\n\n\t\tthis.init();\n\n\t\tthis.inputElem.addEventListener('input', event => {\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t});\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.inputElem;\n\t}\n\n\tgetInputValue(): string {\n\t\treturn this.inputElem.textContent || '';\n\t}\n\n\tsetInputValue(newValue: string) {\n\t\tthis.inputElem.textContent = newValue;\n\t}\n}\n\n// A string picker which adapts its width to the input.\nexport class AdaptiveStringPicker<ModObject> extends Input<ModObject, string> {\n\tprivate readonly inputElem: HTMLInputElement;\n\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: InputConfig<ModObject, string>) {\n\t\tsuper(parent, 'adaptive-string-picker-root', modObject, config);\n\n\t\tthis.inputElem = document.createElement('input');\n\t\tthis.inputElem.type = 'text';\n\t\tthis.inputElem.classList.add('form-control')\n\t\tthis.rootElem.appendChild(this.inputElem);\n\n\t\tthis.init();\n\n\t\tthis.inputElem.addEventListener('change', event => {\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t});\n\t\tthis.inputElem.addEventListener('input', event => {\n\t\t\tthis.updateSize();\n\t\t});\n\t\tthis.updateSize();\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.inputElem;\n\t}\n\n\tgetInputValue(): string {\n\t\treturn this.inputElem.value;\n\t}\n\n\tsetInputValue(newValue: string) {\n\t\tthis.inputElem.value = newValue;\n\t\tthis.updateSize();\n\t}\n\n\tprivate updateSize() {\n\t\tconst newSize = Math.max(3, this.inputElem.value.length);\n\t\tif (this.inputElem.size != newSize)\n\t\t\tthis.inputElem.size = newSize;\n\t}\n}\n","import { Player, UnitMetadata } from '../../player.js';\nimport { APLValueRuneSlot, APLValueRuneType } from '../../proto/apl.js';\nimport { ActionID, OtherAction, UnitReference, UnitReference_Type as UnitType } from '../../proto/common.js';\nimport { FeralDruid_Rotation_AplType } from '../../proto/druid.js';\nimport { ActionId, defaultTargetIcon, getPetIconFromName } from '../../proto_utils/action_id.js';\nimport { EventID, TypedEvent } from '../../typed_event.js';\nimport { bucket } from '../../utils.js';\nimport { BooleanPicker } from '../boolean_picker.js';\nimport { DropdownPicker, DropdownPickerConfig, DropdownValueConfig, TextDropdownPicker } from '../dropdown_picker.js';\nimport { Input, InputConfig } from '../input.js';\nimport { NumberPicker, NumberPickerConfig } from '../number_picker.js';\nimport { AdaptiveStringPicker } from '../string_picker.js';\nimport { UnitPicker, UnitPickerConfig, UnitValue } from '../unit_picker.js';\n\nexport type ACTION_ID_SET =\n\t| 'auras'\n\t| 'stackable_auras'\n\t| 'icd_auras'\n\t| 'exclusive_effect_auras'\n\t| 'spells'\n\t| 'castable_spells'\n\t| 'channel_spells'\n\t| 'dot_spells'\n\t| 'shield_spells'\n\t| 'non_instant_spells';\n\nconst actionIdSets: Record<\n\tACTION_ID_SET,\n\t{\n\t\tdefaultLabel: string;\n\t\tgetActionIDs: (metadata: UnitMetadata) => Promise<Array<DropdownValueConfig<ActionId>>>;\n\t}\n> = {\n\tauras: {\n\t\tdefaultLabel: 'Aura',\n\t\tgetActionIDs: async metadata => {\n\t\t\treturn metadata.getAuras().map(actionId => {\n\t\t\t\treturn {\n\t\t\t\t\tvalue: actionId.id,\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t},\n\tstackable_auras: {\n\t\tdefaultLabel: 'Aura',\n\t\tgetActionIDs: async metadata => {\n\t\t\treturn metadata\n\t\t\t\t.getAuras()\n\t\t\t\t.filter(aura => aura.data.maxStacks > 0)\n\t\t\t\t.map(actionId => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: actionId.id,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t},\n\t},\n\ticd_auras: {\n\t\tdefaultLabel: 'Aura',\n\t\tgetActionIDs: async metadata => {\n\t\t\treturn metadata\n\t\t\t\t.getAuras()\n\t\t\t\t.filter(aura => aura.data.hasIcd)\n\t\t\t\t.map(actionId => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: actionId.id,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t},\n\t},\n\texclusive_effect_auras: {\n\t\tdefaultLabel: 'Aura',\n\t\tgetActionIDs: async metadata => {\n\t\t\treturn metadata\n\t\t\t\t.getAuras()\n\t\t\t\t.filter(aura => aura.data.hasExclusiveEffect)\n\t\t\t\t.map(actionId => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: actionId.id,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t},\n\t},\n\t// Used for non categorized lists\n\tspells: {\n\t\tdefaultLabel: 'Spell',\n\t\tgetActionIDs: async metadata => {\n\t\t\treturn metadata\n\t\t\t\t.getSpells()\n\t\t\t\t.filter(spell => spell.data.isCastable)\n\t\t\t\t.map(actionId => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: actionId.id,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t},\n\t},\n\tcastable_spells: {\n\t\tdefaultLabel: 'Spell',\n\t\tgetActionIDs: async metadata => {\n\t\t\tconst castableSpells = metadata.getSpells().filter(spell => spell.data.isCastable);\n\n\t\t\t// Split up non-cooldowns and cooldowns into separate sections for easier browsing.\n\t\t\tconst { spells: spells, cooldowns: cooldowns } = bucket(castableSpells, spell => (spell.data.isMajorCooldown ? 'cooldowns' : 'spells'));\n\n\t\t\tconst placeholders: Array<ActionId> = [ActionId.fromOtherId(OtherAction.OtherActionPotion)];\n\n\t\t\treturn [\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: ActionId.fromEmpty(),\n\t\t\t\t\t\theaderText: 'Spells',\n\t\t\t\t\t\tsubmenu: ['Spells'],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\t(spells || []).map(actionId => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: actionId.id,\n\t\t\t\t\t\tsubmenu: ['Spells'],\n\t\t\t\t\t\textraCssClasses: actionId.data.prepullOnly\n\t\t\t\t\t\t\t? ['apl-prepull-actions-only']\n\t\t\t\t\t\t\t: actionId.data.encounterOnly\n\t\t\t\t\t\t\t? ['apl-priority-list-only']\n\t\t\t\t\t\t\t: [],\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: ActionId.fromEmpty(),\n\t\t\t\t\t\theaderText: 'Cooldowns',\n\t\t\t\t\t\tsubmenu: ['Cooldowns'],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\t(cooldowns || []).map(actionId => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: actionId.id,\n\t\t\t\t\t\tsubmenu: ['Cooldowns'],\n\t\t\t\t\t\textraCssClasses: actionId.data.prepullOnly\n\t\t\t\t\t\t\t? ['apl-prepull-actions-only']\n\t\t\t\t\t\t\t: actionId.data.encounterOnly\n\t\t\t\t\t\t\t? ['apl-priority-list-only']\n\t\t\t\t\t\t\t: [],\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: ActionId.fromEmpty(),\n\t\t\t\t\t\theaderText: 'Placeholders',\n\t\t\t\t\t\tsubmenu: ['Placeholders'],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tplaceholders.map(actionId => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: actionId,\n\t\t\t\t\t\tsubmenu: ['Placeholders'],\n\t\t\t\t\t\ttooltip: 'The Prepull Potion if CurrentTime < 0, or the Combat Potion if combat has started.',\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t].flat();\n\t\t},\n\t},\n\tnon_instant_spells: {\n\t\tdefaultLabel: 'Non-instant Spell',\n\t\tgetActionIDs: async metadata => {\n\t\t\treturn metadata\n\t\t\t\t.getSpells()\n\t\t\t\t.filter(spell => spell.data.isCastable && spell.data.hasCastTime)\n\t\t\t\t.map(actionId => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: actionId.id,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t},\n\t},\n\tchannel_spells: {\n\t\tdefaultLabel: 'Channeled Spell',\n\t\tgetActionIDs: async metadata => {\n\t\t\treturn metadata\n\t\t\t\t.getSpells()\n\t\t\t\t.filter(spell => spell.data.isCastable && spell.data.isChanneled)\n\t\t\t\t.map(actionId => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: actionId.id,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t},\n\t},\n\tdot_spells: {\n\t\tdefaultLabel: 'DoT Spell',\n\t\tgetActionIDs: async metadata => {\n\t\t\treturn metadata\n\t\t\t\t.getSpells()\n\t\t\t\t.filter(spell => spell.data.hasDot)\n\t\t\t\t.map(actionId => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: actionId.id,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t},\n\t},\n\tshield_spells: {\n\t\tdefaultLabel: 'Shield Spell',\n\t\tgetActionIDs: async metadata => {\n\t\t\treturn metadata\n\t\t\t\t.getSpells()\n\t\t\t\t.filter(spell => spell.data.hasShield)\n\t\t\t\t.map(actionId => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: actionId.id,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t},\n\t},\n};\n\nexport type DEFAULT_UNIT_REF = 'self' | 'currentTarget';\n\nexport interface APLActionIDPickerConfig<ModObject>\n\textends Omit<DropdownPickerConfig<ModObject, ActionID, ActionId>, 'defaultLabel' | 'equals' | 'setOptionContent' | 'values' | 'getValue' | 'setValue'> {\n\tactionIdSet: ACTION_ID_SET;\n\tgetUnitRef: (player: Player<any>) => UnitReference;\n\tdefaultUnitRef: DEFAULT_UNIT_REF;\n\tgetValue: (obj: ModObject) => ActionID;\n\tsetValue: (eventID: EventID, obj: ModObject, newValue: ActionID) => void;\n}\n\nexport class APLActionIDPicker extends DropdownPicker<Player<any>, ActionID, ActionId> {\n\tconstructor(parent: HTMLElement, player: Player<any>, config: APLActionIDPickerConfig<Player<any>>) {\n\t\tconst actionIdSet = actionIdSets[config.actionIdSet];\n\t\tsuper(parent, player, {\n\t\t\t...config,\n\t\t\tsourceToValue: (src: ActionID) => (src ? ActionId.fromProto(src) : ActionId.fromEmpty()),\n\t\t\tvalueToSource: (val: ActionId) => val.toProto(),\n\t\t\tdefaultLabel: actionIdSet.defaultLabel,\n\t\t\tequals: (a, b) => (a == null) == (b == null) && (!a || a.equals(b!)),\n\t\t\tsetOptionContent: (button, valueConfig) => {\n\t\t\t\tconst actionId = valueConfig.value;\n\n\t\t\t\tconst iconElem = document.createElement('a');\n\t\t\t\ticonElem.classList.add('apl-actionid-item-icon');\n\t\t\t\ticonElem.dataset.whtticon = 'false';\n\t\t\t\ticonElem.classList.add('apl-actionid-item-icon');\n\t\t\t\tactionId.setBackgroundAndHref(iconElem);\n\t\t\t\tbutton.appendChild(iconElem);\n\n\t\t\t\tconst textElem = document.createTextNode(actionId.name);\n\t\t\t\tbutton.appendChild(textElem);\n\t\t\t},\n\t\t\tcreateMissingValue: value => {\n\t\t\t\tif (value.anyId() == 0) {\n\t\t\t\t\treturn new Promise<DropdownValueConfig<ActionId>>(() => {\n\t\t\t\t\t\tvalue: actionIdSet.defaultLabel;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn value.fill().then(filledId => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: filledId,\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t},\n\t\t\tvalues: [],\n\t\t});\n\n\t\tconst getUnitRef = config.getUnitRef;\n\t\tconst defaultRef =\n\t\t\tconfig.defaultUnitRef == 'self' ? UnitReference.create({ type: UnitType.Self }) : UnitReference.create({ type: UnitType.CurrentTarget });\n\t\tconst getActionIDs = actionIdSet.getActionIDs;\n\t\tconst updateValues = async () => {\n\t\t\tconst unitRef = getUnitRef(player);\n\t\t\tconst metadata = player.sim.getUnitMetadata(unitRef, player, defaultRef);\n\t\t\tif (metadata) {\n\t\t\t\tconst values = await getActionIDs(metadata);\n\t\t\t\tthis.setOptions(values);\n\t\t\t}\n\t\t};\n\t\tupdateValues();\n\t\tTypedEvent.onAny([player.sim.unitMetadataEmitter, player.rotationChangeEmitter]).on(updateValues);\n\t}\n}\n\nexport type UNIT_SET = 'aura_sources' | 'aura_sources_targets_first' | 'targets';\n\nconst unitSets: Record<\n\tUNIT_SET,\n\t{\n\t\t// Uses target icon by default instead of person icon. This should be set to true for inputs that default to CurrentTarget.\n\t\ttargetUI?: boolean;\n\t\tgetUnits: (player: Player<any>) => Array<UnitReference | undefined>;\n\t}\n> = {\n\taura_sources: {\n\t\tgetUnits: player => {\n\t\t\treturn [\n\t\t\t\tundefined,\n\t\t\t\tplayer\n\t\t\t\t\t.getPetMetadatas()\n\t\t\t\t\t.asList()\n\t\t\t\t\t.map((petMetadata, i) => UnitReference.create({ type: UnitType.Pet, index: i, owner: UnitReference.create({ type: UnitType.Self }) })),\n\t\t\t\tUnitReference.create({ type: UnitType.CurrentTarget }),\n\t\t\t\tplayer.sim.encounter.targetsMetadata.asList().map((targetMetadata, i) => UnitReference.create({ type: UnitType.Target, index: i })),\n\t\t\t].flat();\n\t\t},\n\t},\n\taura_sources_targets_first: {\n\t\ttargetUI: true,\n\t\tgetUnits: player => {\n\t\t\treturn [\n\t\t\t\tundefined,\n\t\t\t\tplayer.sim.encounter.targetsMetadata.asList().map((targetMetadata, i) => UnitReference.create({ type: UnitType.Target, index: i })),\n\t\t\t\tUnitReference.create({ type: UnitType.Self }),\n\t\t\t\tplayer\n\t\t\t\t\t.getPetMetadatas()\n\t\t\t\t\t.asList()\n\t\t\t\t\t.map((petMetadata, i) => UnitReference.create({ type: UnitType.Pet, index: i, owner: UnitReference.create({ type: UnitType.Self }) })),\n\t\t\t].flat();\n\t\t},\n\t},\n\ttargets: {\n\t\ttargetUI: true,\n\t\tgetUnits: player => {\n\t\t\treturn [\n\t\t\t\tundefined,\n\t\t\t\tplayer.sim.encounter.targetsMetadata.asList().map((targetMetadata, i) => UnitReference.create({ type: UnitType.Target, index: i })),\n\t\t\t].flat();\n\t\t},\n\t},\n};\n\nexport interface APLUnitPickerConfig extends Omit<UnitPickerConfig<Player<any>>, 'values'> {\n\tunitSet: UNIT_SET;\n}\n\nexport class APLUnitPicker extends UnitPicker<Player<any>> {\n\tprivate readonly unitSet: UNIT_SET;\n\n\tconstructor(parent: HTMLElement, player: Player<any>, config: APLUnitPickerConfig) {\n\t\tconst targetUI = !!unitSets[config.unitSet].targetUI;\n\t\tsuper(parent, player, {\n\t\t\t...config,\n\t\t\tsourceToValue: (src: UnitReference | undefined) => APLUnitPicker.refToValue(src, player, targetUI),\n\t\t\tvalueToSource: (val: UnitValue) => val.value,\n\t\t\tvalues: [],\n\t\t\thideLabelWhenDefaultSelected: true,\n\t\t});\n\t\tthis.unitSet = config.unitSet;\n\t\tthis.rootElem.classList.add('apl-unit-picker');\n\n\t\tthis.updateValues();\n\t\tplayer.sim.unitMetadataEmitter.on(() => this.updateValues());\n\t}\n\n\tprivate static refToValue(ref: UnitReference | undefined, thisPlayer: Player<any>, targetUI: boolean | undefined): UnitValue {\n\t\tif (!ref || ref.type == UnitType.Unknown) {\n\t\t\treturn {\n\t\t\t\tvalue: ref,\n\t\t\t\ticonUrl: targetUI ? 'fa-bullseye' : 'fa-user',\n\t\t\t\ttext: targetUI ? 'Current Target' : 'Self',\n\t\t\t};\n\t\t} else if (ref.type == UnitType.Self) {\n\t\t\treturn {\n\t\t\t\tvalue: ref,\n\t\t\t\ticonUrl: 'fa-user',\n\t\t\t\ttext: 'Self',\n\t\t\t};\n\t\t} else if (ref.type == UnitType.CurrentTarget) {\n\t\t\treturn {\n\t\t\t\tvalue: ref,\n\t\t\t\ticonUrl: 'fa-bullseye',\n\t\t\t\ttext: 'Current Target',\n\t\t\t};\n\t\t} else if (ref.type == UnitType.Player) {\n\t\t\tconst player = thisPlayer.sim.raid.getPlayer(ref.index);\n\t\t\tif (player) {\n\t\t\t\treturn {\n\t\t\t\t\tvalue: ref,\n\t\t\t\t\ticonUrl: player.getSpecIcon(),\n\t\t\t\t\ttext: `Player ${ref.index + 1}`,\n\t\t\t\t};\n\t\t\t}\n\t\t} else if (ref.type == UnitType.Target) {\n\t\t\tconst targetMetadata = thisPlayer.sim.encounter.targetsMetadata.asList()[ref.index];\n\t\t\tif (targetMetadata) {\n\t\t\t\treturn {\n\t\t\t\t\tvalue: ref,\n\t\t\t\t\ticonUrl: defaultTargetIcon,\n\t\t\t\t\ttext: `Target ${ref.index + 1}`,\n\t\t\t\t};\n\t\t\t}\n\t\t} else if (ref.type == UnitType.Pet) {\n\t\t\tconst petMetadata = thisPlayer.sim.getUnitMetadata(ref, thisPlayer, UnitReference.create({ type: UnitType.Self }));\n\t\t\tlet name = `Pet ${ref.index + 1}`;\n\t\t\tlet icon: string | ActionId = 'fa-paw';\n\t\t\tif (petMetadata) {\n\t\t\t\tconst petName = petMetadata.getName();\n\t\t\t\tif (petName) {\n\t\t\t\t\tconst rmIdx = petName.indexOf(' - ');\n\t\t\t\t\tname = petName.substring(rmIdx + ' - '.length);\n\t\t\t\t\ticon = getPetIconFromName(name) || icon;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tvalue: ref,\n\t\t\t\ticonUrl: icon,\n\t\t\t\ttext: name,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tvalue: ref,\n\t\t};\n\t}\n\n\tprivate updateValues() {\n\t\tconst unitSet = unitSets[this.unitSet];\n\t\tconst values = unitSet.getUnits(this.modObject);\n\n\t\tthis.setOptions(\n\t\t\tvalues.map(v => {\n\t\t\t\tconst valueConfig: DropdownValueConfig<UnitValue> = {\n\t\t\t\t\tvalue: APLUnitPicker.refToValue(v, this.modObject, unitSet.targetUI),\n\t\t\t\t};\n\t\t\t\tif (v && v.type == UnitType.Pet) {\n\t\t\t\t\tif (unitSet.targetUI) {\n\t\t\t\t\t\tvalueConfig.submenu = [APLUnitPicker.refToValue(v.owner!, this.modObject, unitSet.targetUI)];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalueConfig.submenu = [APLUnitPicker.refToValue(undefined, this.modObject, unitSet.targetUI)];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn valueConfig;\n\t\t\t}),\n\t\t);\n\t}\n}\n\ntype APLPickerBuilderFieldFactory<F> = (\n\tparent: HTMLElement,\n\tplayer: Player<any>,\n\tconfig: InputConfig<Player<any>, F>,\n\tgetParentValue: () => any,\n) => Input<Player<any>, F>;\n\nexport interface APLPickerBuilderFieldConfig<T, F extends keyof T> {\n\tfield: F;\n\tnewValue: () => T[F];\n\tfactory: APLPickerBuilderFieldFactory<T[F]>;\n\n\tlabel?: string;\n\tlabelTooltip?: string;\n}\n\nexport interface APLPickerBuilderConfig<T> extends InputConfig<Player<any>, T> {\n\tnewValue: () => T;\n\tfields: Array<APLPickerBuilderFieldConfig<T, any>>;\n}\n\nexport interface APLPickerBuilderField<T, F extends keyof T> extends APLPickerBuilderFieldConfig<T, F> {\n\tpicker: Input<Player<any>, T[F]>;\n}\n\nexport class APLPickerBuilder<T> extends Input<Player<any>, T> {\n\tprivate readonly config: APLPickerBuilderConfig<T>;\n\tprivate readonly fieldPickers: Array<APLPickerBuilderField<T, any>>;\n\n\tconstructor(parent: HTMLElement, modObject: Player<any>, config: APLPickerBuilderConfig<T>) {\n\t\tsuper(parent, 'apl-picker-builder-root', modObject, config);\n\t\tthis.config = config;\n\n\t\tthis.fieldPickers = config.fields.map(fieldConfig => APLPickerBuilder.makeFieldPicker(this, fieldConfig));\n\n\t\tthis.init();\n\t}\n\n\tprivate static makeFieldPicker<T, F extends keyof T>(\n\t\tbuilder: APLPickerBuilder<T>,\n\t\tfieldConfig: APLPickerBuilderFieldConfig<T, F>,\n\t): APLPickerBuilderField<T, F> {\n\t\tconst field: F = fieldConfig.field;\n\t\tconst picker = fieldConfig.factory(\n\t\t\tbuilder.rootElem,\n\t\t\tbuilder.modObject,\n\t\t\t{\n\t\t\t\tlabel: fieldConfig.label,\n\t\t\t\tlabelTooltip: fieldConfig.labelTooltip,\n\t\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\n\t\t\t\tgetValue: () => {\n\t\t\t\t\tconst source = builder.getSourceValue();\n\t\t\t\t\tif (!source[field]) {\n\t\t\t\t\t\tsource[field] = fieldConfig.newValue();\n\t\t\t\t\t}\n\t\t\t\t\treturn source[field];\n\t\t\t\t},\n\t\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: any) => {\n\t\t\t\t\tbuilder.getSourceValue()[field] = newValue;\n\t\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\n\t\t\t\t},\n\t\t\t},\n\t\t\t() => builder.getSourceValue(),\n\t\t);\n\n\t\tif (field === 'vals' || field === 'actions') {\n\t\t\tpicker.rootElem.classList.add('apl-picker-builder-multi');\n\t\t}\n\n\t\treturn {\n\t\t\t...fieldConfig,\n\t\t\tpicker: picker,\n\t\t};\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.rootElem;\n\t}\n\n\tgetInputValue(): T {\n\t\tconst val = this.config.newValue();\n\t\tthis.fieldPickers.forEach(pickerData => {\n\t\t\tval[pickerData.field as keyof T] = pickerData.picker.getInputValue();\n\t\t});\n\t\treturn val;\n\t}\n\n\tsetInputValue(newValue: T) {\n\t\tthis.fieldPickers.forEach(pickerData => {\n\t\t\tpickerData.picker.setInputValue(newValue[pickerData.field as keyof T]);\n\t\t});\n\t}\n}\n\nexport function actionIdFieldConfig(\n\tfield: string,\n\tactionIdSet: ACTION_ID_SET,\n\tunitRefField?: string,\n\tdefaultUnitRef?: DEFAULT_UNIT_REF,\n\toptions?: Partial<APLPickerBuilderFieldConfig<any, any>>,\n): APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: () => ActionID.create(),\n\t\tfactory: (parent, player, config, getParentValue) =>\n\t\t\tnew APLActionIDPicker(parent, player, {\n\t\t\t\t...config,\n\t\t\t\tactionIdSet: actionIdSet,\n\t\t\t\tgetUnitRef: () => (unitRefField ? getParentValue()[unitRefField] : UnitReference.create()),\n\t\t\t\tdefaultUnitRef: defaultUnitRef || 'self',\n\t\t\t}),\n\t\t...(options || {}),\n\t};\n}\n\nexport function unitFieldConfig(\n\tfield: string,\n\tunitSet: UNIT_SET,\n\toptions?: Partial<APLPickerBuilderFieldConfig<any, any>>,\n): APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: () => undefined,\n\t\tfactory: (parent, player, config) =>\n\t\t\tnew APLUnitPicker(parent, player, {\n\t\t\t\t...config,\n\t\t\t\tunitSet: unitSet,\n\t\t\t}),\n\t\t...(options || {}),\n\t};\n}\n\nexport function booleanFieldConfig(\n\tfield: string,\n\tlabel?: string,\n\toptions?: Partial<APLPickerBuilderFieldConfig<any, any>>,\n): APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: () => false,\n\t\tfactory: (parent, player, config) => {\n\t\t\tconfig.extraCssClasses = ['input-inline'].concat(config.extraCssClasses || []);\n\t\t\treturn new BooleanPicker(parent, player, config);\n\t\t},\n\t\t...(options || {}),\n\t\tlabel: label,\n\t};\n}\n\nexport function numberFieldConfig(\n\tfield: string,\n\tfloat: boolean,\n\toptions?: Partial<APLPickerBuilderFieldConfig<any, any>>,\n): APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: () => 0,\n\t\tfactory: (parent, player, config) => {\n\t\t\tconst numberPickerConfig = config as NumberPickerConfig<Player<any>>;\n\t\t\tnumberPickerConfig.float = float;\n\t\t\tnumberPickerConfig.extraCssClasses = ['input-inline'].concat(config.extraCssClasses || []);\n\t\t\treturn new NumberPicker(parent, player, numberPickerConfig);\n\t\t},\n\t\t...(options || {}),\n\t};\n}\n\nexport function stringFieldConfig(field: string, options?: Partial<APLPickerBuilderFieldConfig<any, any>>): APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: () => '',\n\t\tfactory: (parent, player, config) => {\n\t\t\tconfig.extraCssClasses = ['input-inline'].concat(config.extraCssClasses || []);\n\t\t\treturn new AdaptiveStringPicker(parent, player, config);\n\t\t},\n\t\t...(options || {}),\n\t};\n}\n\nexport function runeTypeFieldConfig(field: string, includeDeath: boolean): APLPickerBuilderFieldConfig<any, any> {\n\tconst values = [\n\t\t{ value: APLValueRuneType.RuneBlood, label: 'Blood' },\n\t\t{ value: APLValueRuneType.RuneFrost, label: 'Frost' },\n\t\t{ value: APLValueRuneType.RuneUnholy, label: 'Unholy' },\n\t];\n\n\tif (includeDeath) {\n\t\tvalues.push({ value: APLValueRuneType.RuneDeath, label: 'Death' });\n\t}\n\n\treturn {\n\t\tfield: field,\n\t\tnewValue: () => APLValueRuneType.RuneBlood,\n\t\tfactory: (parent, player, config) =>\n\t\t\tnew TextDropdownPicker(parent, player, {\n\t\t\t\t...config,\n\t\t\t\tdefaultLabel: 'None',\n\t\t\t\tequals: (a, b) => a == b,\n\t\t\t\tvalues: values,\n\t\t\t}),\n\t};\n}\n\nexport function runeSlotFieldConfig(field: string): APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: () => APLValueRuneSlot.SlotLeftBlood,\n\t\tfactory: (parent, player, config) =>\n\t\t\tnew TextDropdownPicker(parent, player, {\n\t\t\t\t...config,\n\t\t\t\tdefaultLabel: 'None',\n\t\t\t\tequals: (a, b) => a == b,\n\t\t\t\tvalues: [\n\t\t\t\t\t{ value: APLValueRuneSlot.SlotLeftBlood, label: 'Blood Left' },\n\t\t\t\t\t{ value: APLValueRuneSlot.SlotRightBlood, label: 'Blood Right' },\n\t\t\t\t\t{ value: APLValueRuneSlot.SlotLeftFrost, label: 'Frost Left' },\n\t\t\t\t\t{ value: APLValueRuneSlot.SlotRightFrost, label: 'Frost Right' },\n\t\t\t\t\t{ value: APLValueRuneSlot.SlotLeftUnholy, label: 'Unholy Left' },\n\t\t\t\t\t{ value: APLValueRuneSlot.SlotRightUnholy, label: 'Unholy Right' },\n\t\t\t\t],\n\t\t\t}),\n\t};\n}\n\nexport function rotationTypeFieldConfig(field: string): APLPickerBuilderFieldConfig<any, any> {\n\tconst values = [\n\t\t{ value: FeralDruid_Rotation_AplType.SingleTarget, label: 'Single Target' },\n\t\t{ value: FeralDruid_Rotation_AplType.Aoe, label: 'AOE' },\n\t];\n\n\treturn {\n\t\tfield: field,\n\t\tlabel: 'Type',\n\t\tnewValue: () => FeralDruid_Rotation_AplType.SingleTarget,\n\t\tfactory: (parent, player, config) =>\n\t\t\tnew TextDropdownPicker(parent, player, {\n\t\t\t\t...config,\n\t\t\t\tdefaultLabel: 'Single Target',\n\t\t\t\tequals: (a, b) => a == b,\n\t\t\t\tvalues: values,\n\t\t\t}),\n\t};\n}\n\nexport function aplInputBuilder<T>(\n\tnewValue: () => T,\n\tfields: Array<APLPickerBuilderFieldConfig<T, keyof T>>,\n): (parent: HTMLElement, player: Player<any>, config: InputConfig<Player<any>, T>) => Input<Player<any>, T> {\n\treturn (parent, player, config) => {\n\t\treturn new APLPickerBuilder(parent, player, {\n\t\t\t...config,\n\t\t\tnewValue: newValue,\n\t\t\tfields: fields,\n\t\t});\n\t};\n}\n","import { Player } from '../../player.js';\nimport {\n\tAPLValue,\n\tAPLValueAnd,\n\tAPLValueAuraICDIsReadyWithReactionTime,\n\tAPLValueAuraInternalCooldown,\n\tAPLValueAuraIsActive,\n\tAPLValueAuraIsActiveWithReactionTime,\n\tAPLValueAuraNumStacks,\n\tAPLValueAuraRemainingTime,\n\tAPLValueAuraShouldRefresh,\n\tAPLValueAutoTimeToNext,\n\tAPLValueBossSpellIsCasting,\n\tAPLValueBossSpellTimeToReady,\n\tAPLValueCatExcessEnergy,\n\tAPLValueCatNewSavageRoarDuration,\n\tAPLValueChannelClipDelay,\n\tAPLValueCompare,\n\tAPLValueCompare_ComparisonOperator as ComparisonOperator,\n\tAPLValueConst,\n\tAPLValueCurrentComboPoints,\n\tAPLValueCurrentEnergy,\n\tAPLValueCurrentFocus,\n\tAPLValueCurrentHealth,\n\tAPLValueCurrentHealthPercent,\n\tAPLValueCurrentMana,\n\tAPLValueCurrentManaPercent,\n\tAPLValueCurrentNonDeathRuneCount,\n\tAPLValueCurrentRage,\n\tAPLValueCurrentRuneActive,\n\tAPLValueCurrentRuneCount,\n\tAPLValueCurrentRuneDeath,\n\tAPLValueCurrentRunicPower,\n\tAPLValueCurrentTime,\n\tAPLValueCurrentTimePercent,\n\tAPLValueDotIsActive,\n\tAPLValueDotRemainingTime,\n\tAPLValueDotTickFrequency,\n\tAPLValueFrontOfTarget,\n\tAPLValueGCDIsReady,\n\tAPLValueGCDTimeToReady,\n\tAPLValueIsExecutePhase,\n\tAPLValueIsExecutePhase_ExecutePhaseThreshold as ExecutePhaseThreshold,\n\tAPLValueMath,\n\tAPLValueMath_MathOperator as MathOperator,\n\tAPLValueMax,\n\tAPLValueMin,\n\tAPLValueNextRuneCooldown,\n\tAPLValueNot,\n\tAPLValueNumberTargets,\n\tAPLValueOr,\n\tAPLValueRemainingTime,\n\tAPLValueRemainingTimePercent,\n\tAPLValueRuneCooldown,\n\tAPLValueRuneSlotCooldown,\n\tAPLValueSequenceIsComplete,\n\tAPLValueSequenceIsReady,\n\tAPLValueSequenceTimeToReady,\n\tAPLValueSpellCanCast,\n\tAPLValueSpellCastTime,\n\tAPLValueSpellChanneledTicks,\n\tAPLValueSpellCPM,\n\tAPLValueSpellCurrentCost,\n\tAPLValueSpellIsChanneling,\n\tAPLValueSpellIsReady,\n\tAPLValueSpellTimeToReady,\n\tAPLValueSpellTravelTime,\n\tAPLValueTotemRemainingTime,\n\tAPLValueWarlockShouldRecastDrainSoul,\n\tAPLValueWarlockShouldRefreshCorruption,\n} from '../../proto/apl.js';\nimport { Class, Spec } from '../../proto/common.js';\nimport { ShamanTotems_TotemType as TotemType } from '../../proto/shaman.js';\nimport { EventID } from '../../typed_event.js';\nimport { TextDropdownPicker, TextDropdownValueConfig } from '../dropdown_picker.js';\nimport { Input, InputConfig } from '../input.js';\nimport { ListItemPickerConfig, ListPicker } from '../list_picker.js';\nimport * as AplHelpers from './apl_helpers.js';\n\nexport interface APLValuePickerConfig extends InputConfig<Player<any>, APLValue | undefined> {}\n\nexport type APLValueKind = APLValue['value']['oneofKind'];\nexport type APLValueImplStruct<F extends APLValueKind> = Extract<APLValue['value'], { oneofKind: F }>;\ntype APLValueImplTypesUnion = {\n\t[f in NonNullable<APLValueKind>]: f extends keyof APLValueImplStruct<f> ? APLValueImplStruct<f>[f] : never;\n};\nexport type APLValueImplType = APLValueImplTypesUnion[NonNullable<APLValueKind>] | undefined;\n\nexport class APLValuePicker extends Input<Player<any>, APLValue | undefined> {\n\tprivate kindPicker: TextDropdownPicker<Player<any>, APLValueKind>;\n\n\tprivate currentKind: APLValueKind;\n\tprivate valuePicker: Input<Player<any>, any> | null;\n\n\tconstructor(parent: HTMLElement, player: Player<any>, config: APLValuePickerConfig) {\n\t\tsuper(parent, 'apl-value-picker-root', player, config);\n\n\t\tconst isPrepull = this.rootElem.closest('.apl-prepull-action-picker') != null;\n\n\t\tconst allValueKinds = (Object.keys(valueKindFactories) as Array<NonNullable<APLValueKind>>).filter(\n\t\t\tvalueKind => valueKindFactories[valueKind].includeIf?.(player, isPrepull) ?? true,\n\t\t);\n\n\t\tthis.kindPicker = new TextDropdownPicker(this.rootElem, player, {\n\t\t\tdefaultLabel: 'No Condition',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tvalue: undefined,\n\t\t\t\t\tlabel: '<None>',\n\t\t\t\t} as TextDropdownValueConfig<APLValueKind>,\n\t\t\t].concat(\n\t\t\t\tallValueKinds.map(kind => {\n\t\t\t\t\tconst factory = valueKindFactories[kind];\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: kind,\n\t\t\t\t\t\tlabel: factory.label,\n\t\t\t\t\t\tsubmenu: factory.submenu,\n\t\t\t\t\t\ttooltip: factory.fullDescription ? `<p>${factory.shortDescription}</p> ${factory.fullDescription}` : factory.shortDescription,\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t),\n\t\t\tequals: (a, b) => a == b,\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\n\t\t\tgetValue: (_player: Player<any>) => this.getSourceValue()?.value.oneofKind,\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newKind: APLValueKind) => {\n\t\t\t\tconst sourceValue = this.getSourceValue();\n\t\t\t\tconst oldKind = sourceValue?.value.oneofKind;\n\t\t\t\tif (oldKind == newKind) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (newKind) {\n\t\t\t\t\tconst factory = valueKindFactories[newKind];\n\t\t\t\t\tlet newSourceValue = this.makeAPLValue(newKind, factory.newValue());\n\t\t\t\t\tif (sourceValue) {\n\t\t\t\t\t\t// Some pre-fill logic when swapping kinds.\n\t\t\t\t\t\tif (oldKind && this.valuePicker) {\n\t\t\t\t\t\t\tif (newKind == 'not') {\n\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'not'>).not.val = this.makeAPLValue(oldKind, this.valuePicker.getInputValue());\n\t\t\t\t\t\t\t} else if (sourceValue.value.oneofKind == 'not' && sourceValue.value.not.val?.value.oneofKind == newKind) {\n\t\t\t\t\t\t\t\tnewSourceValue = sourceValue.value.not.val;\n\t\t\t\t\t\t\t} else if (newKind == 'and') {\n\t\t\t\t\t\t\t\tif (sourceValue.value.oneofKind == 'or') {\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'and'>).and.vals = sourceValue.value.or.vals;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'and'>).and.vals = [\n\t\t\t\t\t\t\t\t\t\tthis.makeAPLValue(oldKind, this.valuePicker.getInputValue()),\n\t\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (newKind == 'or') {\n\t\t\t\t\t\t\t\tif (sourceValue.value.oneofKind == 'and') {\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'or'>).or.vals = sourceValue.value.and.vals;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'or'>).or.vals = [this.makeAPLValue(oldKind, this.valuePicker.getInputValue())];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (newKind == 'min') {\n\t\t\t\t\t\t\t\tif (sourceValue.value.oneofKind == 'max') {\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'min'>).min.vals = sourceValue.value.max.vals;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'min'>).min.vals = [\n\t\t\t\t\t\t\t\t\t\tthis.makeAPLValue(oldKind, this.valuePicker.getInputValue()),\n\t\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (newKind == 'max') {\n\t\t\t\t\t\t\t\tif (sourceValue.value.oneofKind == 'min') {\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'max'>).max.vals = sourceValue.value.min.vals;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'max'>).max.vals = [\n\t\t\t\t\t\t\t\t\t\tthis.makeAPLValue(oldKind, this.valuePicker.getInputValue()),\n\t\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (sourceValue.value.oneofKind == 'and' && sourceValue.value.and.vals?.[0]?.value.oneofKind == newKind) {\n\t\t\t\t\t\t\t\tnewSourceValue = sourceValue.value.and.vals[0];\n\t\t\t\t\t\t\t} else if (sourceValue.value.oneofKind == 'or' && sourceValue.value.or.vals?.[0]?.value.oneofKind == newKind) {\n\t\t\t\t\t\t\t\tnewSourceValue = sourceValue.value.or.vals[0];\n\t\t\t\t\t\t\t} else if (sourceValue.value.oneofKind == 'min' && sourceValue.value.min.vals?.[0]?.value.oneofKind == newKind) {\n\t\t\t\t\t\t\t\tnewSourceValue = sourceValue.value.min.vals[0];\n\t\t\t\t\t\t\t} else if (sourceValue.value.oneofKind == 'max' && sourceValue.value.max.vals?.[0]?.value.oneofKind == newKind) {\n\t\t\t\t\t\t\t\tnewSourceValue = sourceValue.value.max.vals[0];\n\t\t\t\t\t\t\t} else if (newKind == 'cmp') {\n\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'cmp'>).cmp.lhs = this.makeAPLValue(oldKind, this.valuePicker.getInputValue());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (sourceValue) {\n\t\t\t\t\t\tsourceValue.value = newSourceValue.value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.setSourceValue(eventID, newSourceValue);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.setSourceValue(eventID, undefined);\n\t\t\t\t}\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\n\t\tthis.currentKind = undefined;\n\t\tthis.valuePicker = null;\n\n\t\tthis.init();\n\t}\n\n\tgetInputElem(): HTMLElement | null {\n\t\treturn this.rootElem;\n\t}\n\n\tgetInputValue(): APLValue | undefined {\n\t\tconst kind = this.kindPicker.getInputValue();\n\t\tif (!kind) {\n\t\t\treturn undefined;\n\t\t} else {\n\t\t\treturn APLValue.create({\n\t\t\t\tvalue: {\n\t\t\t\t\toneofKind: kind,\n\t\t\t\t\t...(() => {\n\t\t\t\t\t\tconst val: any = {};\n\t\t\t\t\t\tif (kind && this.valuePicker) {\n\t\t\t\t\t\t\tval[kind] = this.valuePicker.getInputValue();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn val;\n\t\t\t\t\t})(),\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tsetInputValue(newValue: APLValue | undefined) {\n\t\tconst newKind = newValue?.value.oneofKind;\n\t\tthis.updateValuePicker(newKind);\n\n\t\tif (newKind && newValue) {\n\t\t\tthis.valuePicker!.setInputValue((newValue.value as any)[newKind]);\n\t\t}\n\t}\n\n\tprivate makeAPLValue<K extends NonNullable<APLValueKind>>(kind: K, implVal: APLValueImplTypesUnion[K]): APLValue {\n\t\tif (!kind) {\n\t\t\treturn APLValue.create();\n\t\t}\n\t\tconst obj: any = { oneofKind: kind };\n\t\tobj[kind] = implVal;\n\t\treturn APLValue.create({ value: obj });\n\t}\n\n\tprivate updateValuePicker(newKind: APLValueKind) {\n\t\tconst oldKind = this.currentKind;\n\t\tif (newKind == oldKind) {\n\t\t\treturn;\n\t\t}\n\t\tthis.currentKind = newKind;\n\n\t\tif (this.valuePicker) {\n\t\t\tthis.valuePicker.rootElem.remove();\n\t\t\tthis.valuePicker = null;\n\t\t}\n\n\t\tif (!newKind) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.kindPicker.setInputValue(newKind);\n\n\t\tconst factory = valueKindFactories[newKind];\n\t\tthis.valuePicker = factory.factory(this.rootElem, this.modObject, {\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\n\t\t\tgetValue: () => {\n\t\t\t\tconst sourceVal = this.getSourceValue();\n\t\t\t\treturn sourceVal ? (sourceVal.value as any)[newKind] || factory.newValue() : factory.newValue();\n\t\t\t},\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: any) => {\n\t\t\t\tconst sourceVal = this.getSourceValue();\n\t\t\t\tif (sourceVal) {\n\t\t\t\t\t(sourceVal.value as any)[newKind] = newValue;\n\t\t\t\t}\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\t}\n}\n\ntype ValueKindConfig<T> = {\n\tlabel: string;\n\tsubmenu?: Array<string>;\n\tshortDescription: string;\n\tfullDescription?: string;\n\tnewValue: () => T;\n\tincludeIf?: (player: Player<any>, isPrepull: boolean) => boolean;\n\tfactory: (parent: HTMLElement, player: Player<any>, config: InputConfig<Player<any>, T>) => Input<Player<any>, T>;\n};\n\nfunction comparisonOperatorFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: () => ComparisonOperator.OpEq,\n\t\tfactory: (parent, player, config) =>\n\t\t\tnew TextDropdownPicker(parent, player, {\n\t\t\t\t...config,\n\t\t\t\tdefaultLabel: 'None',\n\t\t\t\tequals: (a, b) => a == b,\n\t\t\t\tvalues: [\n\t\t\t\t\t{ value: ComparisonOperator.OpEq, label: '==' },\n\t\t\t\t\t{ value: ComparisonOperator.OpNe, label: '!=' },\n\t\t\t\t\t{ value: ComparisonOperator.OpGe, label: '>=' },\n\t\t\t\t\t{ value: ComparisonOperator.OpGt, label: '>' },\n\t\t\t\t\t{ value: ComparisonOperator.OpLe, label: '<=' },\n\t\t\t\t\t{ value: ComparisonOperator.OpLt, label: '<' },\n\t\t\t\t],\n\t\t\t}),\n\t};\n}\n\nfunction mathOperatorFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: () => MathOperator.OpAdd,\n\t\tfactory: (parent, player, config) =>\n\t\t\tnew TextDropdownPicker(parent, player, {\n\t\t\t\t...config,\n\t\t\t\tdefaultLabel: 'None',\n\t\t\t\tequals: (a, b) => a == b,\n\t\t\t\tvalues: [\n\t\t\t\t\t{ value: MathOperator.OpAdd, label: '+' },\n\t\t\t\t\t{ value: MathOperator.OpSub, label: '-' },\n\t\t\t\t\t{ value: MathOperator.OpMul, label: '*' },\n\t\t\t\t\t{ value: MathOperator.OpDiv, label: '/' },\n\t\t\t\t],\n\t\t\t}),\n\t};\n}\n\nfunction executePhaseThresholdFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: () => ExecutePhaseThreshold.E20,\n\t\tfactory: (parent, player, config) =>\n\t\t\tnew TextDropdownPicker(parent, player, {\n\t\t\t\t...config,\n\t\t\t\tdefaultLabel: 'None',\n\t\t\t\tequals: (a, b) => a == b,\n\t\t\t\tvalues: [\n\t\t\t\t\t{ value: ExecutePhaseThreshold.E20, label: '20%' },\n\t\t\t\t\t{ value: ExecutePhaseThreshold.E25, label: '25%' },\n\t\t\t\t\t{ value: ExecutePhaseThreshold.E35, label: '35%' },\n\t\t\t\t\t{ value: ExecutePhaseThreshold.E90, label: '90%' },\n\t\t\t\t],\n\t\t\t}),\n\t};\n}\n\nfunction totemTypeFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: () => TotemType.Water,\n\t\tfactory: (parent, player, config) =>\n\t\t\tnew TextDropdownPicker(parent, player, {\n\t\t\t\t...config,\n\t\t\t\tdefaultLabel: 'None',\n\t\t\t\tequals: (a, b) => a == b,\n\t\t\t\tvalues: [\n\t\t\t\t\t{ value: TotemType.Earth, label: 'Earth' },\n\t\t\t\t\t{ value: TotemType.Air, label: 'Air' },\n\t\t\t\t\t{ value: TotemType.Fire, label: 'Fire' },\n\t\t\t\t\t{ value: TotemType.Water, label: 'Water' },\n\t\t\t\t],\n\t\t\t}),\n\t};\n}\n\nexport function valueFieldConfig(\n\tfield: string,\n\toptions?: Partial<AplHelpers.APLPickerBuilderFieldConfig<any, any>>,\n): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: APLValue.create,\n\t\tfactory: (parent, player, config) => new APLValuePicker(parent, player, config),\n\t\t...(options || {}),\n\t};\n}\n\nexport function valueListFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: () => [],\n\t\tfactory: (parent, player, config) =>\n\t\t\tnew ListPicker<Player<any>, APLValue | undefined>(parent, player, {\n\t\t\t\t...config,\n\t\t\t\t// Override setValue to replace undefined elements with default messages.\n\t\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: Array<APLValue | undefined>) => {\n\t\t\t\t\tconfig.setValue(\n\t\t\t\t\t\teventID,\n\t\t\t\t\t\tplayer,\n\t\t\t\t\t\tnewValue.map(val => val || APLValue.create()),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\titemLabel: 'Value',\n\t\t\t\tnewItem: APLValue.create,\n\t\t\t\tcopyItem: (oldValue: APLValue | undefined) => (oldValue ? APLValue.clone(oldValue) : oldValue),\n\t\t\t\tnewItemPicker: (\n\t\t\t\t\tparent: HTMLElement,\n\t\t\t\t\tlistPicker: ListPicker<Player<any>, APLValue | undefined>,\n\t\t\t\t\tindex: number,\n\t\t\t\t\tconfig: ListItemPickerConfig<Player<any>, APLValue | undefined>,\n\t\t\t\t) => new APLValuePicker(parent, player, config),\n\t\t\t\tallowedActions: ['create', 'delete'],\n\t\t\t\tactions: {\n\t\t\t\t\tcreate: {\n\t\t\t\t\t\tuseIcon: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t};\n}\n\nfunction inputBuilder<T extends APLValueImplType>(config: {\n\tlabel: string;\n\tsubmenu?: Array<string>;\n\tshortDescription: string;\n\tfullDescription?: string;\n\tnewValue: () => T;\n\tincludeIf?: (player: Player<any>, isPrepull: boolean) => boolean;\n\tfields: Array<AplHelpers.APLPickerBuilderFieldConfig<T, keyof T>>;\n}): ValueKindConfig<T> {\n\treturn {\n\t\tlabel: config.label,\n\t\tsubmenu: config.submenu,\n\t\tshortDescription: config.shortDescription,\n\t\tfullDescription: config.fullDescription,\n\t\tnewValue: config.newValue,\n\t\tincludeIf: config.includeIf,\n\t\tfactory: AplHelpers.aplInputBuilder(config.newValue, config.fields),\n\t};\n}\n\nconst valueKindFactories: { [f in NonNullable<APLValueKind>]: ValueKindConfig<APLValueImplTypesUnion[f]> } = {\n\t// Operators\n\tconst: inputBuilder({\n\t\tlabel: 'Const',\n\t\tshortDescription: 'A fixed value.',\n\t\tfullDescription: `\n\t\t<p>\n\t\t\tExamples:\n\t\t\t<ul>\n\t\t\t\t<li><b>Number:</b> '123', '0.5', '-10'</li>\n\t\t\t\t<li><b>Time:</b> '100ms', '5s', '3m'</li>\n\t\t\t\t<li><b>Percentage:</b> '30%'</li>\n\t\t\t</ul>\n\t\t</p>\n\t\t`,\n\t\tnewValue: APLValueConst.create,\n\t\tfields: [AplHelpers.stringFieldConfig('val')],\n\t}),\n\tcmp: inputBuilder({\n\t\tlabel: 'Compare',\n\t\tsubmenu: ['Logic'],\n\t\tshortDescription: 'Compares two values.',\n\t\tnewValue: APLValueCompare.create,\n\t\tfields: [valueFieldConfig('lhs'), comparisonOperatorFieldConfig('op'), valueFieldConfig('rhs')],\n\t}),\n\tmath: inputBuilder({\n\t\tlabel: 'Math',\n\t\tsubmenu: ['Logic'],\n\t\tshortDescription: 'Do basic math on two values.',\n\t\tnewValue: APLValueMath.create,\n\t\tfields: [valueFieldConfig('lhs'), mathOperatorFieldConfig('op'), valueFieldConfig('rhs')],\n\t}),\n\tmax: inputBuilder({\n\t\tlabel: 'Max',\n\t\tsubmenu: ['Logic'],\n\t\tshortDescription: 'Returns the largest value among the subvalues.',\n\t\tnewValue: APLValueMax.create,\n\t\tfields: [valueListFieldConfig('vals')],\n\t}),\n\tmin: inputBuilder({\n\t\tlabel: 'Min',\n\t\tsubmenu: ['Logic'],\n\t\tshortDescription: 'Returns the smallest value among the subvalues.',\n\t\tnewValue: APLValueMin.create,\n\t\tfields: [valueListFieldConfig('vals')],\n\t}),\n\tand: inputBuilder({\n\t\tlabel: 'All of',\n\t\tsubmenu: ['Logic'],\n\t\tshortDescription: 'Returns <b>True</b> if all of the sub-values are <b>True</b>, otherwise <b>False</b>',\n\t\tnewValue: APLValueAnd.create,\n\t\tfields: [valueListFieldConfig('vals')],\n\t}),\n\tor: inputBuilder({\n\t\tlabel: 'Any of',\n\t\tsubmenu: ['Logic'],\n\t\tshortDescription: 'Returns <b>True</b> if any of the sub-values are <b>True</b>, otherwise <b>False</b>',\n\t\tnewValue: APLValueOr.create,\n\t\tfields: [valueListFieldConfig('vals')],\n\t}),\n\tnot: inputBuilder({\n\t\tlabel: 'Not',\n\t\tsubmenu: ['Logic'],\n\t\tshortDescription: 'Returns the opposite of the inner value, i.e. <b>True</b> if the value is <b>False</b> and vice-versa.',\n\t\tnewValue: APLValueNot.create,\n\t\tfields: [valueFieldConfig('val')],\n\t}),\n\n\t// Encounter\n\tcurrentTime: inputBuilder({\n\t\tlabel: 'Current Time',\n\t\tsubmenu: ['Encounter'],\n\t\tshortDescription: 'Elapsed time of the current sim iteration.',\n\t\tnewValue: APLValueCurrentTime.create,\n\t\tfields: [],\n\t}),\n\tcurrentTimePercent: inputBuilder({\n\t\tlabel: 'Current Time (%)',\n\t\tsubmenu: ['Encounter'],\n\t\tshortDescription: 'Elapsed time of the current sim iteration, as a percentage.',\n\t\tnewValue: APLValueCurrentTimePercent.create,\n\t\tfields: [],\n\t}),\n\tremainingTime: inputBuilder({\n\t\tlabel: 'Remaining Time',\n\t\tsubmenu: ['Encounter'],\n\t\tshortDescription: 'Elapsed time of the remaining sim iteration.',\n\t\tnewValue: APLValueRemainingTime.create,\n\t\tfields: [],\n\t}),\n\tremainingTimePercent: inputBuilder({\n\t\tlabel: 'Remaining Time (%)',\n\t\tsubmenu: ['Encounter'],\n\t\tshortDescription: 'Elapsed time of the remaining sim iteration, as a percentage.',\n\t\tnewValue: APLValueRemainingTimePercent.create,\n\t\tfields: [],\n\t}),\n\tisExecutePhase: inputBuilder({\n\t\tlabel: 'Is Execute Phase',\n\t\tsubmenu: ['Encounter'],\n\t\tshortDescription:\n\t\t\t\"<b>True</b> if the encounter is in Execute Phase, meaning the target's health is less than the given threshold, otherwise <b>False</b>.\",\n\t\tnewValue: APLValueIsExecutePhase.create,\n\t\tfields: [executePhaseThresholdFieldConfig('threshold')],\n\t}),\n\tnumberTargets: inputBuilder({\n\t\tlabel: 'Number of Targets',\n\t\tsubmenu: ['Encounter'],\n\t\tshortDescription: 'Count of targets in the current encounter',\n\t\tnewValue: APLValueNumberTargets.create,\n\t\tfields: [],\n\t}),\n\tfrontOfTarget: inputBuilder({\n\t\tlabel: 'Front of Target',\n\t\tsubmenu: ['Encounter'],\n\t\tshortDescription: '<b>True</b> if facing from of target',\n\t\tnewValue: APLValueFrontOfTarget.create,\n\t\tfields: [],\n\t}),\n\n\t// Boss\n\tbossSpellIsCasting: inputBuilder({\n\t\tlabel: 'Spell is Casting',\n\t\tsubmenu: ['Boss'],\n\t\tshortDescription: '',\n\t\tnewValue: APLValueBossSpellIsCasting.create,\n\t\tfields: [\n\t\t\tAplHelpers.unitFieldConfig('targetUnit', 'targets'),\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'non_instant_spells', 'targetUnit', 'currentTarget'),\n\t\t],\n\t}),\n\tbossSpellTimeToReady: inputBuilder({\n\t\tlabel: 'Spell Time to Ready',\n\t\tsubmenu: ['Boss'],\n\t\tshortDescription: '',\n\t\tnewValue: APLValueBossSpellTimeToReady.create,\n\t\tfields: [AplHelpers.unitFieldConfig('targetUnit', 'targets'), AplHelpers.actionIdFieldConfig('spellId', 'spells', 'targetUnit', 'currentTarget')],\n\t}),\n\n\t// Resources\n\tcurrentHealth: inputBuilder({\n\t\tlabel: 'Health',\n\t\tsubmenu: ['Resources'],\n\t\tshortDescription: 'Amount of currently available Health.',\n\t\tnewValue: APLValueCurrentHealth.create,\n\t\tfields: [AplHelpers.unitFieldConfig('sourceUnit', 'aura_sources')],\n\t}),\n\tcurrentHealthPercent: inputBuilder({\n\t\tlabel: 'Health (%)',\n\t\tsubmenu: ['Resources'],\n\t\tshortDescription: 'Amount of currently available Health, as a percentage.',\n\t\tnewValue: APLValueCurrentHealthPercent.create,\n\t\tfields: [AplHelpers.unitFieldConfig('sourceUnit', 'aura_sources')],\n\t}),\n\tcurrentMana: inputBuilder({\n\t\tlabel: 'Mana',\n\t\tsubmenu: ['Resources'],\n\t\tshortDescription: 'Amount of currently available Mana.',\n\t\tnewValue: APLValueCurrentMana.create,\n\t\tfields: [],\n\t}),\n\tcurrentManaPercent: inputBuilder({\n\t\tlabel: 'Mana (%)',\n\t\tsubmenu: ['Resources'],\n\t\tshortDescription: 'Amount of currently available Mana, as a percentage.',\n\t\tnewValue: APLValueCurrentManaPercent.create,\n\t\tfields: [],\n\t}),\n\tcurrentRage: inputBuilder({\n\t\tlabel: 'Rage',\n\t\tsubmenu: ['Resources'],\n\t\tshortDescription: 'Amount of currently available Rage.',\n\t\tnewValue: APLValueCurrentRage.create,\n\t\tfields: [],\n\t}),\n\tcurrentFocus: inputBuilder({\n\t\tlabel: 'Focus',\n\t\tsubmenu: ['Resources'],\n\t\tshortDescription: 'Amount of currently available Focus.',\n\t\tnewValue: APLValueCurrentFocus.create,\n\t\tfields: [],\n\t}),\n\tcurrentEnergy: inputBuilder({\n\t\tlabel: 'Energy',\n\t\tsubmenu: ['Resources'],\n\t\tshortDescription: 'Amount of currently available Energy.',\n\t\tnewValue: APLValueCurrentEnergy.create,\n\t\tfields: [],\n\t}),\n\tcurrentComboPoints: inputBuilder({\n\t\tlabel: 'Combo Points',\n\t\tsubmenu: ['Resources'],\n\t\tshortDescription: 'Amount of currently available Combo Points.',\n\t\tnewValue: APLValueCurrentComboPoints.create,\n\t\tfields: [],\n\t}),\n\tcurrentRunicPower: inputBuilder({\n\t\tlabel: 'Runic Power',\n\t\tsubmenu: ['Resources'],\n\t\tshortDescription: 'Amount of currently available Runic Power.',\n\t\tnewValue: APLValueCurrentRunicPower.create,\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => player.getClass() == Class.ClassDeathKnight,\n\t\tfields: [],\n\t}),\n\n\t// Resources Rune\n\tcurrentRuneCount: inputBuilder({\n\t\tlabel: 'Num Runes',\n\t\tsubmenu: ['Resources', 'Runes'],\n\t\tshortDescription: 'Amount of currently available Runes of certain type including Death.',\n\t\tnewValue: APLValueCurrentRuneCount.create,\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => player.getClass() == Class.ClassDeathKnight,\n\t\tfields: [AplHelpers.runeTypeFieldConfig('runeType', true)],\n\t}),\n\tcurrentNonDeathRuneCount: inputBuilder({\n\t\tlabel: 'Num Non Death Runes',\n\t\tsubmenu: ['Resources', 'Runes'],\n\t\tshortDescription: 'Amount of currently available Runes of certain type ignoring Death',\n\t\tnewValue: APLValueCurrentNonDeathRuneCount.create,\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => player.getClass() == Class.ClassDeathKnight,\n\t\tfields: [AplHelpers.runeTypeFieldConfig('runeType', false)],\n\t}),\n\tcurrentRuneActive: inputBuilder({\n\t\tlabel: 'Rune Is Ready',\n\t\tsubmenu: ['Resources', 'Runes'],\n\t\tshortDescription: 'Is the rune of a certain slot currently available.',\n\t\tnewValue: APLValueCurrentRuneActive.create,\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => player.getClass() == Class.ClassDeathKnight,\n\t\tfields: [AplHelpers.runeSlotFieldConfig('runeSlot')],\n\t}),\n\tcurrentRuneDeath: inputBuilder({\n\t\tlabel: 'Rune Is Death',\n\t\tsubmenu: ['Resources', 'Runes'],\n\t\tshortDescription: 'Is the rune of a certain slot currently converted to Death.',\n\t\tnewValue: APLValueCurrentRuneDeath.create,\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => player.getClass() == Class.ClassDeathKnight,\n\t\tfields: [AplHelpers.runeSlotFieldConfig('runeSlot')],\n\t}),\n\truneCooldown: inputBuilder({\n\t\tlabel: 'Rune Cooldown',\n\t\tsubmenu: ['Resources', 'Runes'],\n\t\tshortDescription: 'Amount of time until a rune of certain type is ready to use.<br><b>NOTE:</b> Returns 0 if there is a rune available',\n\t\tnewValue: APLValueRuneCooldown.create,\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => player.getClass() == Class.ClassDeathKnight,\n\t\tfields: [AplHelpers.runeTypeFieldConfig('runeType', false)],\n\t}),\n\tnextRuneCooldown: inputBuilder({\n\t\tlabel: 'Next Rune Cooldown',\n\t\tsubmenu: ['Resources', 'Runes'],\n\t\tshortDescription: 'Amount of time until a 2nd rune of certain type is ready to use.<br><b>NOTE:</b> Returns 0 if there are 2 runes available',\n\t\tnewValue: APLValueNextRuneCooldown.create,\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => player.getClass() == Class.ClassDeathKnight,\n\t\tfields: [AplHelpers.runeTypeFieldConfig('runeType', false)],\n\t}),\n\truneSlotCooldown: inputBuilder({\n\t\tlabel: 'Rune Slot Cooldown',\n\t\tsubmenu: ['Resources', 'Runes'],\n\t\tshortDescription: 'Amount of time until a rune of certain slot is ready to use.<br><b>NOTE:</b> Returns 0 if rune is ready',\n\t\tnewValue: APLValueRuneSlotCooldown.create,\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => player.getClass() == Class.ClassDeathKnight,\n\t\tfields: [AplHelpers.runeSlotFieldConfig('runeSlot')],\n\t}),\n\n\t// GCD\n\tgcdIsReady: inputBuilder({\n\t\tlabel: 'GCD Is Ready',\n\t\tsubmenu: ['GCD'],\n\t\tshortDescription: '<b>True</b> if the GCD is not on cooldown, otherwise <b>False</b>.',\n\t\tnewValue: APLValueGCDIsReady.create,\n\t\tfields: [],\n\t}),\n\tgcdTimeToReady: inputBuilder({\n\t\tlabel: 'GCD Time To Ready',\n\t\tsubmenu: ['GCD'],\n\t\tshortDescription: 'Amount of time remaining before the GCD comes off cooldown, or <b>0</b> if it is not on cooldown.',\n\t\tnewValue: APLValueGCDTimeToReady.create,\n\t\tfields: [],\n\t}),\n\n\t// Auto attacks\n\tautoTimeToNext: inputBuilder({\n\t\tlabel: 'Time To Next Auto',\n\t\tsubmenu: ['Auto'],\n\t\tshortDescription: 'Amount of time remaining before the next Main-hand or Off-hand melee attack, or <b>0</b> if autoattacks are not engaged.',\n\t\tnewValue: APLValueAutoTimeToNext.create,\n\t\tfields: [],\n\t}),\n\n\t// Spells\n\tspellCurrentCost: inputBuilder({\n\t\tlabel: 'Current Cost',\n\t\tsubmenu: ['Spell'],\n\t\tshortDescription: 'Returns current resource cost of spell',\n\t\tnewValue: APLValueSpellCurrentCost.create,\n\t\tfields: [AplHelpers.actionIdFieldConfig('spellId', 'castable_spells', '')],\n\t}),\n\tspellCanCast: inputBuilder({\n\t\tlabel: 'Can Cast',\n\t\tsubmenu: ['Spell'],\n\t\tshortDescription: '<b>True</b> if all requirements for casting the spell are currently met, otherwise <b>False</b>.',\n\t\tfullDescription: `\n\t\t\t<p>The <b>Cast Spell</b> action does not need to be conditioned on this, because it applies this check automatically.</p>\n\t\t`,\n\t\tnewValue: APLValueSpellCanCast.create,\n\t\tfields: [AplHelpers.actionIdFieldConfig('spellId', 'castable_spells', '')],\n\t}),\n\tspellIsReady: inputBuilder({\n\t\tlabel: 'Is Ready',\n\t\tsubmenu: ['Spell'],\n\t\tshortDescription: '<b>True</b> if the spell is not on cooldown, otherwise <b>False</b>.',\n\t\tnewValue: APLValueSpellIsReady.create,\n\t\tfields: [AplHelpers.actionIdFieldConfig('spellId', 'castable_spells', '')],\n\t}),\n\tspellTimeToReady: inputBuilder({\n\t\tlabel: 'Time To Ready',\n\t\tsubmenu: ['Spell'],\n\t\tshortDescription: 'Amount of time remaining before the spell comes off cooldown, or <b>0</b> if it is not on cooldown.',\n\t\tnewValue: APLValueSpellTimeToReady.create,\n\t\tfields: [AplHelpers.actionIdFieldConfig('spellId', 'castable_spells', '')],\n\t}),\n\tspellCastTime: inputBuilder({\n\t\tlabel: 'Cast Time',\n\t\tsubmenu: ['Spell'],\n\t\tshortDescription: 'Amount of time to cast the spell including any haste and spell cast time adjustments.',\n\t\tnewValue: APLValueSpellCastTime.create,\n\t\tfields: [AplHelpers.actionIdFieldConfig('spellId', 'castable_spells', '')],\n\t}),\n\tspellTravelTime: inputBuilder({\n\t\tlabel: 'Travel Time',\n\t\tsubmenu: ['Spell'],\n\t\tshortDescription: 'Amount of time for the spell to travel to the target.',\n\t\tnewValue: APLValueSpellTravelTime.create,\n\t\tfields: [AplHelpers.actionIdFieldConfig('spellId', 'castable_spells', '')],\n\t}),\n\tspellCpm: inputBuilder({\n\t\tlabel: 'CPM',\n\t\tsubmenu: ['Spell'],\n\t\tshortDescription: 'Casts Per Minute for the spell so far in the current iteration.',\n\t\tnewValue: APLValueSpellCPM.create,\n\t\tfields: [AplHelpers.actionIdFieldConfig('spellId', 'castable_spells', '')],\n\t}),\n\tspellIsChanneling: inputBuilder({\n\t\tlabel: 'Is Channeling',\n\t\tsubmenu: ['Spell'],\n\t\tshortDescription: '<b>True</b> if this spell is currently being channeled, otherwise <b>False</b>.',\n\t\tnewValue: APLValueSpellIsChanneling.create,\n\t\tfields: [AplHelpers.actionIdFieldConfig('spellId', 'channel_spells', '')],\n\t}),\n\tspellChanneledTicks: inputBuilder({\n\t\tlabel: 'Channeled Ticks',\n\t\tsubmenu: ['Spell'],\n\t\tshortDescription: 'The number of completed ticks in the current channel of this spell, or <b>0</b> if the spell is not being channeled.',\n\t\tnewValue: APLValueSpellChanneledTicks.create,\n\t\tfields: [AplHelpers.actionIdFieldConfig('spellId', 'channel_spells', '')],\n\t}),\n\tchannelClipDelay: inputBuilder({\n\t\tlabel: 'Channel Clip Delay',\n\t\tsubmenu: ['Spell'],\n\t\tshortDescription: 'The amount of time specified by the <b>Channel Clip Delay</b> setting.',\n\t\tnewValue: APLValueChannelClipDelay.create,\n\t\tfields: [],\n\t}),\n\n\t// Auras\n\tauraIsActive: inputBuilder({\n\t\tlabel: 'Aura Active',\n\t\tsubmenu: ['Aura'],\n\t\tshortDescription: '<b>True</b> if the aura is currently active, otherwise <b>False</b>.',\n\t\tnewValue: APLValueAuraIsActive.create,\n\t\tfields: [AplHelpers.unitFieldConfig('sourceUnit', 'aura_sources'), AplHelpers.actionIdFieldConfig('auraId', 'auras', 'sourceUnit')],\n\t}),\n\tauraIsActiveWithReactionTime: inputBuilder({\n\t\tlabel: 'Aura Active (with Reaction Time)',\n\t\tsubmenu: ['Aura'],\n\t\tshortDescription:\n\t\t\t'<b>True</b> if the aura is currently active AND it has been active for at least as long as the player reaction time (configured in Settings), otherwise <b>False</b>.',\n\t\tnewValue: APLValueAuraIsActiveWithReactionTime.create,\n\t\tfields: [AplHelpers.unitFieldConfig('sourceUnit', 'aura_sources'), AplHelpers.actionIdFieldConfig('auraId', 'auras', 'sourceUnit')],\n\t}),\n\tauraRemainingTime: inputBuilder({\n\t\tlabel: 'Aura Remaining Time',\n\t\tsubmenu: ['Aura'],\n\t\tshortDescription: 'Time remaining before this aura will expire, or 0 if the aura is not currently active.',\n\t\tnewValue: APLValueAuraRemainingTime.create,\n\t\tfields: [AplHelpers.unitFieldConfig('sourceUnit', 'aura_sources'), AplHelpers.actionIdFieldConfig('auraId', 'auras', 'sourceUnit')],\n\t}),\n\tauraNumStacks: inputBuilder({\n\t\tlabel: 'Aura Num Stacks',\n\t\tsubmenu: ['Aura'],\n\t\tshortDescription: 'Number of stacks of the aura.',\n\t\tnewValue: APLValueAuraNumStacks.create,\n\t\tfields: [AplHelpers.unitFieldConfig('sourceUnit', 'aura_sources'), AplHelpers.actionIdFieldConfig('auraId', 'stackable_auras', 'sourceUnit')],\n\t}),\n\tauraInternalCooldown: inputBuilder({\n\t\tlabel: 'Aura Remaining ICD',\n\t\tsubmenu: ['Aura'],\n\t\tshortDescription: \"Time remaining before this aura's internal cooldown will be ready, or <b>0</b> if the ICD is ready now.\",\n\t\tnewValue: APLValueAuraInternalCooldown.create,\n\t\tfields: [AplHelpers.unitFieldConfig('sourceUnit', 'aura_sources'), AplHelpers.actionIdFieldConfig('auraId', 'icd_auras', 'sourceUnit')],\n\t}),\n\tauraIcdIsReadyWithReactionTime: inputBuilder({\n\t\tlabel: 'Aura ICD Is Ready (with Reaction Time)',\n\t\tsubmenu: ['Aura'],\n\t\tshortDescription:\n\t\t\t\"<b>True</b> if the aura's ICD is currently ready OR it was put on CD recently, within the player's reaction time (configured in Settings), otherwise <b>False</b>.\",\n\t\tnewValue: APLValueAuraICDIsReadyWithReactionTime.create,\n\t\tfields: [AplHelpers.unitFieldConfig('sourceUnit', 'aura_sources'), AplHelpers.actionIdFieldConfig('auraId', 'icd_auras', 'sourceUnit')],\n\t}),\n\tauraShouldRefresh: inputBuilder({\n\t\tlabel: 'Should Refresh Aura',\n\t\tsubmenu: ['Aura'],\n\t\tshortDescription: 'Whether this aura should be refreshed, e.g. for the purpose of maintaining a debuff.',\n\t\tfullDescription: `\n\t\t<p>This condition checks not only the specified aura but also any other auras on the same unit, including auras applied by other raid members, which apply the same debuff category.</p>\n\t\t<p>For example, 'Should Refresh Debuff(Sunder Armor)' will return <b>False</b> if the unit has an active Expose Armor aura.</p>\n\t\t`,\n\t\tnewValue: () =>\n\t\t\tAPLValueAuraShouldRefresh.create({\n\t\t\t\tmaxOverlap: {\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\toneofKind: 'const',\n\t\t\t\t\t\tconst: {\n\t\t\t\t\t\t\tval: '0ms',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\tfields: [\n\t\t\tAplHelpers.unitFieldConfig('sourceUnit', 'aura_sources_targets_first'),\n\t\t\tAplHelpers.actionIdFieldConfig('auraId', 'exclusive_effect_auras', 'sourceUnit', 'currentTarget'),\n\t\t\tvalueFieldConfig('maxOverlap', {\n\t\t\t\tlabel: 'Overlap',\n\t\t\t\tlabelTooltip: 'Maximum amount of time before the aura expires when it may be refreshed.',\n\t\t\t}),\n\t\t],\n\t}),\n\n\t// DoT\n\tdotIsActive: inputBuilder({\n\t\tlabel: 'Dot Is Active',\n\t\tsubmenu: ['DoT'],\n\t\tshortDescription: '<b>True</b> if the specified dot is currently ticking, otherwise <b>False</b>.',\n\t\tnewValue: APLValueDotIsActive.create,\n\t\tfields: [AplHelpers.unitFieldConfig('targetUnit', 'targets'), AplHelpers.actionIdFieldConfig('spellId', 'dot_spells', '')],\n\t}),\n\tdotRemainingTime: inputBuilder({\n\t\tlabel: 'Dot Remaining Time',\n\t\tsubmenu: ['DoT'],\n\t\tshortDescription: 'Time remaining before the last tick of this DoT will occur, or 0 if the DoT is not currently ticking.',\n\t\tnewValue: APLValueDotRemainingTime.create,\n\t\tfields: [AplHelpers.unitFieldConfig('targetUnit', 'targets'), AplHelpers.actionIdFieldConfig('spellId', 'dot_spells', '')],\n\t}),\n\tdotTickFrequency: inputBuilder({\n\t\tlabel: 'Dot Tick Frequency',\n\t\tsubmenu: ['DoT'],\n\t\tshortDescription: 'The time between each tick.',\n\t\tnewValue: APLValueDotTickFrequency.create,\n\t\tfields: [AplHelpers.unitFieldConfig('targetUnit', 'targets'), AplHelpers.actionIdFieldConfig('spellId', 'dot_spells', '')],\n\t}),\n\tsequenceIsComplete: inputBuilder({\n\t\tlabel: 'Sequence Is Complete',\n\t\tsubmenu: ['Sequence'],\n\t\tshortDescription: '<b>True</b> if there are no more subactions left to execute in the sequence, otherwise <b>False</b>.',\n\t\tnewValue: APLValueSequenceIsComplete.create,\n\t\tfields: [AplHelpers.stringFieldConfig('sequenceName')],\n\t}),\n\tsequenceIsReady: inputBuilder({\n\t\tlabel: 'Sequence Is Ready',\n\t\tsubmenu: ['Sequence'],\n\t\tshortDescription: '<b>True</b> if the next subaction in the sequence is ready to be executed, otherwise <b>False</b>.',\n\t\tnewValue: APLValueSequenceIsReady.create,\n\t\tfields: [AplHelpers.stringFieldConfig('sequenceName')],\n\t}),\n\tsequenceTimeToReady: inputBuilder({\n\t\tlabel: 'Sequence Time To Ready',\n\t\tsubmenu: ['Sequence'],\n\t\tshortDescription: 'Returns the amount of time remaining until the next subaction in the sequence will be ready.',\n\t\tnewValue: APLValueSequenceTimeToReady.create,\n\t\tfields: [AplHelpers.stringFieldConfig('sequenceName')],\n\t}),\n\n\t// Class/spec specific values\n\ttotemRemainingTime: inputBuilder({\n\t\tlabel: 'Totem Remaining Time',\n\t\tsubmenu: ['Shaman'],\n\t\tshortDescription: 'Returns the amount of time remaining until the totem will expire.',\n\t\tnewValue: APLValueTotemRemainingTime.create,\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => player.getClass() == Class.ClassShaman,\n\t\tfields: [totemTypeFieldConfig('totemType')],\n\t}),\n\tcatExcessEnergy: inputBuilder({\n\t\tlabel: 'Excess Energy',\n\t\tsubmenu: ['Feral Druid'],\n\t\tshortDescription: 'Returns the amount of excess energy available, after subtracting energy that will be needed to maintain DoTs.',\n\t\tnewValue: APLValueCatExcessEnergy.create,\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => player.getSpec() == Spec.SpecFeralDruid,\n\t\tfields: [],\n\t}),\n\tcatNewSavageRoarDuration: inputBuilder({\n\t\tlabel: 'New Savage Roar Duration',\n\t\tsubmenu: ['Feral Druid'],\n\t\tshortDescription: 'Returns duration of savage roar based on current combo points',\n\t\tnewValue: APLValueCatNewSavageRoarDuration.create,\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => player.getSpec() == Spec.SpecFeralDruid,\n\t\tfields: [],\n\t}),\n\twarlockShouldRecastDrainSoul: inputBuilder({\n\t\tlabel: 'Should Recast Drain Soul',\n\t\tsubmenu: ['Warlock'],\n\t\tshortDescription: 'Returns <b>True</b> if the current Drain Soul channel should be immediately recast, to get a better snapshot.',\n\t\tnewValue: APLValueWarlockShouldRecastDrainSoul.create,\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => player.getClass() == Class.ClassWarlock,\n\t\tfields: [],\n\t}),\n\twarlockShouldRefreshCorruption: inputBuilder({\n\t\tlabel: 'Should Refresh Corruption',\n\t\tsubmenu: ['Warlock'],\n\t\tshortDescription: 'Returns <b>True</b> if the current Corruption has expired, or should be refreshed to get a better snapshot.',\n\t\tnewValue: APLValueWarlockShouldRefreshCorruption.create,\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => player.getClass() == Class.ClassWarlock,\n\t\tfields: [AplHelpers.unitFieldConfig('targetUnit', 'targets')],\n\t}),\n};\n","import { itemSwapEnabledSpecs } from '../../individual_sim_ui.js';\nimport { Player } from '../../player.js';\nimport {\n\tAPLAction,\n\tAPLActionActivateAura,\n\tAPLActionAutocastOtherCooldowns,\n\tAPLActionCancelAura,\n\tAPLActionCastSpell,\n\tAPLActionCatOptimalRotationAction,\n\tAPLActionChangeTarget,\n\tAPLActionChannelSpell,\n\tAPLActionCustomRotation,\n\tAPLActionItemSwap,\n\tAPLActionItemSwap_SwapSet as ItemSwapSet,\n\tAPLActionMultidot,\n\tAPLActionMultishield,\n\tAPLActionResetSequence,\n\tAPLActionSchedule,\n\tAPLActionSequence,\n\tAPLActionStrictSequence,\n\tAPLActionTriggerICD,\n\tAPLActionWait,\n\tAPLActionWaitUntil,\n\tAPLValue,\n} from '../../proto/apl.js';\nimport { Spec } from '../../proto/common.js';\nimport { FeralDruid_Rotation_AplType } from '../../proto/druid.js';\nimport { EventID } from '../../typed_event.js';\nimport { TextDropdownPicker } from '../dropdown_picker.js';\nimport { Input, InputConfig } from '../input.js';\nimport { ListItemPickerConfig, ListPicker } from '../list_picker.js';\nimport * as AplHelpers from './apl_helpers.js';\nimport * as AplValues from './apl_values.js';\n\nexport interface APLActionPickerConfig extends InputConfig<Player<any>, APLAction> {}\n\nexport type APLActionKind = APLAction['action']['oneofKind'];\ntype APLActionImplStruct<F extends APLActionKind> = Extract<APLAction['action'], { oneofKind: F }>;\ntype APLActionImplTypesUnion = {\n\t[f in NonNullable<APLActionKind>]: f extends keyof APLActionImplStruct<f> ? APLActionImplStruct<f>[f] : never;\n};\nexport type APLActionImplType = APLActionImplTypesUnion[NonNullable<APLActionKind>] | undefined;\n\nexport class APLActionPicker extends Input<Player<any>, APLAction> {\n\tprivate kindPicker: TextDropdownPicker<Player<any>, APLActionKind>;\n\n\tprivate readonly actionDiv: HTMLElement;\n\tprivate currentKind: APLActionKind;\n\tprivate actionPicker: Input<Player<any>, any> | null;\n\n\tprivate readonly conditionPicker: AplValues.APLValuePicker;\n\n\tconstructor(parent: HTMLElement, player: Player<any>, config: APLActionPickerConfig) {\n\t\tsuper(parent, 'apl-action-picker-root', player, config);\n\n\t\tthis.conditionPicker = new AplValues.APLValuePicker(this.rootElem, this.modObject, {\n\t\t\tlabel: 'If:',\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\n\t\t\tgetValue: (_player: Player<any>) => this.getSourceValue()?.condition,\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: APLValue | undefined) => {\n\t\t\t\tconst srcVal = this.getSourceValue();\n\t\t\t\tif (srcVal) {\n\t\t\t\t\tsrcVal.condition = newValue;\n\t\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\n\t\t\t\t} else {\n\t\t\t\t\tthis.setSourceValue(\n\t\t\t\t\t\teventID,\n\t\t\t\t\t\tAPLAction.create({\n\t\t\t\t\t\t\tcondition: newValue,\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tthis.conditionPicker.rootElem.classList.add('apl-action-condition', 'apl-priority-list-only');\n\n\t\tthis.actionDiv = document.createElement('div');\n\t\tthis.actionDiv.classList.add('apl-action-picker-action');\n\t\tthis.rootElem.appendChild(this.actionDiv);\n\n\t\tconst isPrepull = this.rootElem.closest('.apl-prepull-action-picker') != null;\n\n\t\tconst allActionKinds = (Object.keys(actionKindFactories) as Array<NonNullable<APLActionKind>>).filter(\n\t\t\tactionKind => actionKindFactories[actionKind].includeIf?.(player, isPrepull) ?? true,\n\t\t);\n\n\t\tthis.kindPicker = new TextDropdownPicker(this.actionDiv, player, {\n\t\t\tdefaultLabel: 'Action',\n\t\t\tvalues: allActionKinds.map(actionKind => {\n\t\t\t\tconst factory = actionKindFactories[actionKind];\n\t\t\t\treturn {\n\t\t\t\t\tvalue: actionKind,\n\t\t\t\t\tlabel: factory.label,\n\t\t\t\t\tsubmenu: factory.submenu,\n\t\t\t\t\ttooltip: factory.fullDescription ? `<p>${factory.shortDescription}</p> ${factory.fullDescription}` : factory.shortDescription,\n\t\t\t\t};\n\t\t\t}),\n\t\t\tequals: (a, b) => a == b,\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\n\t\t\tgetValue: (_player: Player<any>) => this.getSourceValue()?.action.oneofKind,\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newKind: APLActionKind) => {\n\t\t\t\tconst sourceValue = this.getSourceValue();\n\t\t\t\tconst oldKind = sourceValue?.action.oneofKind;\n\t\t\t\tif (oldKind == newKind) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (newKind) {\n\t\t\t\t\tconst factory = actionKindFactories[newKind];\n\t\t\t\t\tlet newSourceValue = this.makeAPLAction(newKind, factory.newValue());\n\t\t\t\t\tif (sourceValue) {\n\t\t\t\t\t\t// Some pre-fill logic when swapping kinds.\n\t\t\t\t\t\tif (oldKind && this.actionPicker) {\n\t\t\t\t\t\t\tif (newKind == 'sequence') {\n\t\t\t\t\t\t\t\tif (sourceValue.action.oneofKind == 'strictSequence') {\n\t\t\t\t\t\t\t\t\t(newSourceValue.action as APLActionImplStruct<'sequence'>).sequence.actions = sourceValue.action.strictSequence.actions;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t(newSourceValue.action as APLActionImplStruct<'sequence'>).sequence.actions = [\n\t\t\t\t\t\t\t\t\t\tthis.makeAPLAction(oldKind, this.actionPicker.getInputValue()),\n\t\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (newKind == 'strictSequence') {\n\t\t\t\t\t\t\t\tif (sourceValue.action.oneofKind == 'sequence') {\n\t\t\t\t\t\t\t\t\t(newSourceValue.action as APLActionImplStruct<'strictSequence'>).strictSequence.actions =\n\t\t\t\t\t\t\t\t\t\tsourceValue.action.sequence.actions;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t(newSourceValue.action as APLActionImplStruct<'strictSequence'>).strictSequence.actions = [\n\t\t\t\t\t\t\t\t\t\tthis.makeAPLAction(oldKind, this.actionPicker.getInputValue()),\n\t\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (sourceValue.action.oneofKind == 'sequence' && sourceValue.action.sequence.actions?.[0]?.action.oneofKind == newKind) {\n\t\t\t\t\t\t\t\tnewSourceValue = sourceValue.action.sequence.actions[0];\n\t\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t\tsourceValue.action.oneofKind == 'strictSequence' &&\n\t\t\t\t\t\t\t\tsourceValue.action.strictSequence.actions?.[0]?.action.oneofKind == newKind\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tnewSourceValue = sourceValue.action.strictSequence.actions[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (sourceValue) {\n\t\t\t\t\t\tsourceValue.action = newSourceValue.action;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.setSourceValue(eventID, newSourceValue);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tsourceValue.action = {\n\t\t\t\t\t\toneofKind: newKind,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\n\t\tthis.currentKind = undefined;\n\t\tthis.actionPicker = null;\n\n\t\tthis.init();\n\t}\n\n\tgetInputElem(): HTMLElement | null {\n\t\treturn this.rootElem;\n\t}\n\n\tgetInputValue(): APLAction {\n\t\tconst actionKind = this.kindPicker.getInputValue();\n\t\treturn APLAction.create({\n\t\t\tcondition: this.conditionPicker.getInputValue(),\n\t\t\taction: {\n\t\t\t\toneofKind: actionKind,\n\t\t\t\t...(() => {\n\t\t\t\t\tconst val: any = {};\n\t\t\t\t\tif (actionKind && this.actionPicker) {\n\t\t\t\t\t\tval[actionKind] = this.actionPicker.getInputValue();\n\t\t\t\t\t}\n\t\t\t\t\treturn val;\n\t\t\t\t})(),\n\t\t\t},\n\t\t});\n\t}\n\n\tsetInputValue(newValue: APLAction) {\n\t\tif (!newValue) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.conditionPicker.setInputValue(newValue.condition || APLValue.create());\n\n\t\tconst newActionKind = newValue.action.oneofKind;\n\t\tthis.updateActionPicker(newActionKind);\n\n\t\tif (newActionKind) {\n\t\t\tthis.actionPicker!.setInputValue((newValue.action as any)[newActionKind]);\n\t\t}\n\t}\n\n\tprivate makeAPLAction<K extends NonNullable<APLActionKind>>(kind: K, implVal: APLActionImplTypesUnion[K]): APLAction {\n\t\tif (!kind) {\n\t\t\treturn APLAction.create();\n\t\t}\n\t\tconst obj: any = { oneofKind: kind };\n\t\tobj[kind] = implVal;\n\t\treturn APLAction.create({ action: obj });\n\t}\n\n\tprivate updateActionPicker(newActionKind: APLActionKind) {\n\t\tconst actionKind = this.currentKind;\n\t\tif (newActionKind == actionKind) {\n\t\t\treturn;\n\t\t}\n\t\tthis.currentKind = newActionKind;\n\n\t\tif (this.actionPicker) {\n\t\t\tthis.actionPicker.rootElem.remove();\n\t\t\tthis.actionPicker = null;\n\t\t}\n\n\t\tif (!newActionKind) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.kindPicker.setInputValue(newActionKind);\n\n\t\tconst factory = actionKindFactories[newActionKind];\n\t\tthis.actionPicker = factory.factory(this.actionDiv, this.modObject, {\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\n\t\t\tgetValue: () => (this.getSourceValue()?.action as any)?.[newActionKind] || factory.newValue(),\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: any) => {\n\t\t\t\tconst sourceValue = this.getSourceValue();\n\t\t\t\tif (sourceValue) {\n\t\t\t\t\t(sourceValue?.action as any)[newActionKind] = newValue;\n\t\t\t\t}\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\t\tthis.actionPicker.rootElem.classList.add('apl-action-' + newActionKind);\n\t}\n}\n\ntype ActionKindConfig<T> = {\n\tlabel: string;\n\tsubmenu?: Array<string>;\n\tshortDescription: string;\n\tfullDescription?: string;\n\tincludeIf?: (player: Player<any>, isPrepull: boolean) => boolean;\n\tnewValue: () => T;\n\tfactory: (parent: HTMLElement, player: Player<any>, config: InputConfig<Player<any>, T>) => Input<Player<any>, T>;\n};\n\nfunction itemSwapSetFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: () => ItemSwapSet.Swap1,\n\t\tfactory: (parent, player, config) =>\n\t\t\tnew TextDropdownPicker(parent, player, {\n\t\t\t\t...config,\n\t\t\t\tdefaultLabel: 'None',\n\t\t\t\tequals: (a, b) => a == b,\n\t\t\t\tvalues: [\n\t\t\t\t\t{ value: ItemSwapSet.Main, label: 'Main' },\n\t\t\t\t\t{ value: ItemSwapSet.Swap1, label: 'Swapped' },\n\t\t\t\t],\n\t\t\t}),\n\t};\n}\n\nfunction actionFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: APLValue.create,\n\t\tfactory: (parent, player, config) => new APLActionPicker(parent, player, config),\n\t};\n}\n\nfunction actionListFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\n\treturn {\n\t\tfield: field,\n\t\tnewValue: () => [],\n\t\tfactory: (parent, player, config) =>\n\t\t\tnew ListPicker<Player<any>, APLAction>(parent, player, {\n\t\t\t\t...config,\n\t\t\t\t// Override setValue to replace undefined elements with default messages.\n\t\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: Array<APLAction>) => {\n\t\t\t\t\tconfig.setValue(\n\t\t\t\t\t\teventID,\n\t\t\t\t\t\tplayer,\n\t\t\t\t\t\tnewValue.map(val => val || APLAction.create()),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\titemLabel: 'Action',\n\t\t\t\tnewItem: APLAction.create,\n\t\t\t\tcopyItem: (oldValue: APLAction) => (oldValue ? APLAction.clone(oldValue) : oldValue),\n\t\t\t\tnewItemPicker: (\n\t\t\t\t\tparent: HTMLElement,\n\t\t\t\t\tlistPicker: ListPicker<Player<any>, APLAction>,\n\t\t\t\t\tindex: number,\n\t\t\t\t\tconfig: ListItemPickerConfig<Player<any>, APLAction>,\n\t\t\t\t) => new APLActionPicker(parent, player, config),\n\t\t\t\tallowedActions: ['create', 'delete', 'move'],\n\t\t\t\tactions: {\n\t\t\t\t\tcreate: {\n\t\t\t\t\t\tuseIcon: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t};\n}\n\nfunction inputBuilder<T>(config: {\n\tlabel: string;\n\tsubmenu?: Array<string>;\n\tshortDescription: string;\n\tfullDescription?: string;\n\tincludeIf?: (player: Player<any>, isPrepull: boolean) => boolean;\n\tnewValue: () => T;\n\tfields: Array<AplHelpers.APLPickerBuilderFieldConfig<T, any>>;\n}): ActionKindConfig<T> {\n\treturn {\n\t\tlabel: config.label,\n\t\tsubmenu: config.submenu,\n\t\tshortDescription: config.shortDescription,\n\t\tfullDescription: config.fullDescription,\n\t\tincludeIf: config.includeIf,\n\t\tnewValue: config.newValue,\n\t\tfactory: AplHelpers.aplInputBuilder(config.newValue, config.fields),\n\t};\n}\n\nconst actionKindFactories: { [f in NonNullable<APLActionKind>]: ActionKindConfig<APLActionImplTypesUnion[f]> } = {\n\t['castSpell']: inputBuilder({\n\t\tlabel: 'Cast',\n\t\tshortDescription: 'Casts the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.',\n\t\tnewValue: APLActionCastSpell.create,\n\t\tfields: [AplHelpers.actionIdFieldConfig('spellId', 'castable_spells', ''), AplHelpers.unitFieldConfig('target', 'targets')],\n\t}),\n\t['multidot']: inputBuilder({\n\t\tlabel: 'Multi Dot',\n\t\tsubmenu: ['Casting'],\n\t\tshortDescription: 'Keeps a DoT active on multiple targets by casting the specified spell.',\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\n\t\tnewValue: () =>\n\t\t\tAPLActionMultidot.create({\n\t\t\t\tmaxDots: 3,\n\t\t\t\tmaxOverlap: {\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\toneofKind: 'const',\n\t\t\t\t\t\tconst: {\n\t\t\t\t\t\t\tval: '0ms',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\tfields: [\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'dot_spells', ''),\n\t\t\tAplHelpers.numberFieldConfig('maxDots', false, {\n\t\t\t\tlabel: 'Max Dots',\n\t\t\t\tlabelTooltip: 'Maximum number of DoTs to simultaneously apply.',\n\t\t\t}),\n\t\t\tAplValues.valueFieldConfig('maxOverlap', {\n\t\t\t\tlabel: 'Overlap',\n\t\t\t\tlabelTooltip: 'Maximum amount of time before a DoT expires when it may be refreshed.',\n\t\t\t}),\n\t\t],\n\t}),\n\t['multishield']: inputBuilder({\n\t\tlabel: 'Multi Shield',\n\t\tsubmenu: ['Casting'],\n\t\tshortDescription: 'Keeps a Shield active on multiple targets by casting the specified spell.',\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull && player.getSpec().isHealingSpec,\n\t\tnewValue: () =>\n\t\t\tAPLActionMultishield.create({\n\t\t\t\tmaxShields: 3,\n\t\t\t\tmaxOverlap: {\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\toneofKind: 'const',\n\t\t\t\t\t\tconst: {\n\t\t\t\t\t\t\tval: '0ms',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\tfields: [\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'shield_spells', ''),\n\t\t\tAplHelpers.numberFieldConfig('maxShields', false, {\n\t\t\t\tlabel: 'Max Shields',\n\t\t\t\tlabelTooltip: 'Maximum number of Shields to simultaneously apply.',\n\t\t\t}),\n\t\t\tAplValues.valueFieldConfig('maxOverlap', {\n\t\t\t\tlabel: 'Overlap',\n\t\t\t\tlabelTooltip: 'Maximum amount of time before a Shield expires when it may be refreshed.',\n\t\t\t}),\n\t\t],\n\t}),\n\t['channelSpell']: inputBuilder({\n\t\tlabel: 'Channel',\n\t\tsubmenu: ['Casting'],\n\t\tshortDescription: 'Channels the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.',\n\t\tfullDescription: `\n\t\t\t<p>The difference between channeling a spell vs casting the spell is that channels can be interrupted. If the <b>Interrupt If</b> parameter is empty, this action is equivalent to <b>Cast</b>.</p>\n\t\t\t<p>The channel will be interrupted only if all of the following are true:</p>\n\t\t\t<ul>\n\t\t\t\t<li>Immediately following a tick of the channel</li>\n\t\t\t\t<li>The <b>Interrupt If</b> condition evaluates to <b>True</b></li>\n\t\t\t\t<li>Another action in the APL list is available</li>\n\t\t\t</ul>\n\t\t\t<p>Note that if you simply want to allow other actions to interrupt the channel, set <b>Interrupt If</b> to <b>True</b>.</p>\n\t\t`,\n\t\tnewValue: () =>\n\t\t\tAPLActionChannelSpell.create({\n\t\t\t\tinterruptIf: {\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\toneofKind: 'gcdIsReady',\n\t\t\t\t\t\tgcdIsReady: {},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\tfields: [\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'channel_spells', ''),\n\t\t\tAplHelpers.unitFieldConfig('target', 'targets'),\n\t\t\tAplValues.valueFieldConfig('interruptIf', {\n\t\t\t\tlabel: 'Interrupt If',\n\t\t\t\tlabelTooltip: 'Condition which must be true to allow the channel to be interrupted.',\n\t\t\t}),\n\t\t\tAplHelpers.booleanFieldConfig('allowRecast', 'Recast', {\n\t\t\t\tlabelTooltip: 'If checked, interrupts of this channel will recast the spell.',\n\t\t\t}),\n\t\t],\n\t}),\n\t['autocastOtherCooldowns']: inputBuilder({\n\t\tlabel: 'Autocast Other Cooldowns',\n\t\tsubmenu: ['Casting'],\n\t\tshortDescription: 'Auto-casts cooldowns as soon as they are ready.',\n\t\tfullDescription: `\n\t\t\t<ul>\n\t\t\t\t<li>Does not auto-cast cooldowns which are already controlled by other actions in the priority list.</li>\n\t\t\t\t<li>Cooldowns are usually cast immediately upon becoming ready, but there are some basic smart checks in place, e.g. don't use Mana CDs when near full mana.</li>\n\t\t\t</ul>\n\t\t`,\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\n\t\tnewValue: APLActionAutocastOtherCooldowns.create,\n\t\tfields: [],\n\t}),\n\t['wait']: inputBuilder({\n\t\tlabel: 'Wait',\n\t\tsubmenu: ['Timing'],\n\t\tshortDescription: 'Pauses all APL actions for a specified amount of time.',\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\n\t\tnewValue: () =>\n\t\t\tAPLActionWait.create({\n\t\t\t\tduration: {\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\toneofKind: 'const',\n\t\t\t\t\t\tconst: {\n\t\t\t\t\t\t\tval: '1000ms',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\tfields: [AplValues.valueFieldConfig('duration')],\n\t}),\n\t['waitUntil']: inputBuilder({\n\t\tlabel: 'Wait Until',\n\t\tsubmenu: ['Timing'],\n\t\tshortDescription: 'Pauses all APL actions until the specified condition is <b>True</b>.',\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\n\t\tnewValue: () => APLActionWaitUntil.create(),\n\t\tfields: [AplValues.valueFieldConfig('condition')],\n\t}),\n\t['schedule']: inputBuilder({\n\t\tlabel: 'Scheduled Action',\n\t\tsubmenu: ['Timing'],\n\t\tshortDescription: 'Executes the inner action once at each specified timing.',\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\n\t\tnewValue: () =>\n\t\t\tAPLActionSchedule.create({\n\t\t\t\tschedule: '0s, 60s',\n\t\t\t\tinnerAction: {\n\t\t\t\t\taction: { oneofKind: 'castSpell', castSpell: {} },\n\t\t\t\t},\n\t\t\t}),\n\t\tfields: [\n\t\t\tAplHelpers.stringFieldConfig('schedule', {\n\t\t\t\tlabel: 'Do At',\n\t\t\t\tlabelTooltip: 'Comma-separated list of timings. The inner action will be performed once at each timing.',\n\t\t\t}),\n\t\t\tactionFieldConfig('innerAction'),\n\t\t],\n\t}),\n\t['sequence']: inputBuilder({\n\t\tlabel: 'Sequence',\n\t\tsubmenu: ['Sequences'],\n\t\tshortDescription: 'A list of sub-actions to execute in the specified order.',\n\t\tfullDescription: `\n\t\t\t<p>Once one of the sub-actions has been performed, the next sub-action will not necessarily be immediately executed next. The system will restart at the beginning of the whole actions list (not the sequence). If the sequence is executed again, it will perform the next sub-action.</p>\n\t\t\t<p>When all actions have been performed, the sequence does NOT automatically reset; instead, it will be skipped from now on. Use the <b>Reset Sequence</b> action to reset it, if desired.</p>\n\t\t`,\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\n\t\tnewValue: APLActionSequence.create,\n\t\tfields: [AplHelpers.stringFieldConfig('name'), actionListFieldConfig('actions')],\n\t}),\n\t['resetSequence']: inputBuilder({\n\t\tlabel: 'Reset Sequence',\n\t\tsubmenu: ['Sequences'],\n\t\tshortDescription: 'Restarts a sequence, so that the next time it executes it will perform its first sub-action.',\n\t\tfullDescription: `\n\t\t\t<p>Use the <b>name</b> field to refer to the sequence to be reset. The desired sequence must have the same (non-empty) value for its <b>name</b>.</p>\n\t\t`,\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\n\t\tnewValue: APLActionResetSequence.create,\n\t\tfields: [AplHelpers.stringFieldConfig('sequenceName')],\n\t}),\n\t['strictSequence']: inputBuilder({\n\t\tlabel: 'Strict Sequence',\n\t\tsubmenu: ['Sequences'],\n\t\tshortDescription:\n\t\t\t'Like a regular <b>Sequence</b>, except all sub-actions are executed immediately after each other and the sequence resets automatically upon completion.',\n\t\tfullDescription: `\n\t\t\t<p>Strict Sequences do not begin unless ALL sub-actions are ready.</p>\n\t\t`,\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\n\t\tnewValue: APLActionStrictSequence.create,\n\t\tfields: [actionListFieldConfig('actions')],\n\t}),\n\t['changeTarget']: inputBuilder({\n\t\tlabel: 'Change Target',\n\t\tsubmenu: ['Misc'],\n\t\tshortDescription: 'Sets the current target, which is the target of auto attacks and most casts by default.',\n\t\tnewValue: () => APLActionChangeTarget.create(),\n\t\tfields: [AplHelpers.unitFieldConfig('newTarget', 'targets')],\n\t}),\n\t['activateAura']: inputBuilder({\n\t\tlabel: 'Activate Aura',\n\t\tsubmenu: ['Misc'],\n\t\tshortDescription: 'Activates an aura',\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => isPrepull,\n\t\tnewValue: () => APLActionActivateAura.create(),\n\t\tfields: [AplHelpers.actionIdFieldConfig('auraId', 'auras')],\n\t}),\n\t['cancelAura']: inputBuilder({\n\t\tlabel: 'Cancel Aura',\n\t\tsubmenu: ['Misc'],\n\t\tshortDescription: 'Deactivates an aura, equivalent to /cancelaura.',\n\t\tnewValue: () => APLActionCancelAura.create(),\n\t\tfields: [AplHelpers.actionIdFieldConfig('auraId', 'auras')],\n\t}),\n\t['triggerIcd']: inputBuilder({\n\t\tlabel: 'Trigger ICD',\n\t\tsubmenu: ['Misc'],\n\t\tshortDescription: \"Triggers an aura's ICD, putting it on cooldown. Example usage would be to desync an ICD cooldown before combat starts.\",\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => isPrepull,\n\t\tnewValue: () => APLActionTriggerICD.create(),\n\t\tfields: [AplHelpers.actionIdFieldConfig('auraId', 'icd_auras')],\n\t}),\n\t['itemSwap']: inputBuilder({\n\t\tlabel: 'Item Swap',\n\t\tsubmenu: ['Misc'],\n\t\tshortDescription: 'Swaps items, using the swap set specified in Settings.',\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => itemSwapEnabledSpecs.includes(player.getSpec()),\n\t\tnewValue: () => APLActionItemSwap.create(),\n\t\tfields: [itemSwapSetFieldConfig('swapSet')],\n\t}),\n\n\t['customRotation']: inputBuilder({\n\t\tlabel: 'Custom Rotation',\n\t\t//submenu: ['Misc'],\n\t\tshortDescription: 'INTERNAL ONLY',\n\t\tincludeIf: (_player: Player<any>, _isPrepull: boolean) => false, // Never show this, because its internal only.\n\t\tnewValue: () => APLActionCustomRotation.create(),\n\t\tfields: [],\n\t}),\n\n\t// Class/spec specific actions\n\t['catOptimalRotationAction']: inputBuilder({\n\t\tlabel: 'Optimal Rotation Action',\n\t\tsubmenu: ['Feral Druid'],\n\t\tshortDescription: 'Executes optimized Feral DPS rotation using hardcoded algorithm.',\n\t\tincludeIf: (player: Player<any>, _isPrepull: boolean) => player.getSpec() == Spec.SpecFeralDruid,\n\t\tnewValue: () =>\n\t\t\tAPLActionCatOptimalRotationAction.create({\n\t\t\t\trotationType: FeralDruid_Rotation_AplType.SingleTarget,\n\t\t\t\tmaintainFaerieFire: true,\n\t\t\t\tmanualParams: true,\n\t\t\t\tminRoarOffset: 25.0,\n\t\t\t\tripLeeway: 4,\n\t\t\t\tuseRake: true,\n\t\t\t\tuseBite: true,\n\t\t\t\tbiteTime: 4.0,\n\t\t\t}),\n\t\tfields: [\n\t\t\tAplHelpers.rotationTypeFieldConfig('rotationType'),\n\t\t\tAplHelpers.booleanFieldConfig('maintainFaerieFire', 'Maintain Faerie Fire', {\n\t\t\t\tlabelTooltip: 'Maintain Faerie Fire debuff. Overwrites any external Sunder effects specified in settings.',\n\t\t\t}),\n\t\t\tAplHelpers.booleanFieldConfig('manualParams', 'Manual Advanced Parameters', {\n\t\t\t\tlabelTooltip: 'Manually specify advanced parameters, otherwise will use preset defaults.',\n\t\t\t}),\n\t\t\tAplHelpers.numberFieldConfig('minRoarOffset', true, {\n\t\t\t\tlabel: 'Roar Offset',\n\t\t\t\tlabelTooltip: 'Targeted offset in Rip/Roar timings. Ignored for AOE rotation or if not using manual advanced parameters.',\n\t\t\t}),\n\t\t\tAplHelpers.numberFieldConfig('ripLeeway', false, {\n\t\t\t\tlabel: 'Rip Leeway',\n\t\t\t\tlabelTooltip: 'Rip leeway when optimizing Roar clips. Ignored for AOE rotation or if not using manual advanced parameters.',\n\t\t\t}),\n\t\t\tAplHelpers.booleanFieldConfig('useRake', 'Use Rake', {\n\t\t\t\tlabelTooltip: 'Use Rake during rotation. Ignored for AOE rotation or if not using manual advanced parameters.',\n\t\t\t}),\n\t\t\tAplHelpers.booleanFieldConfig('useBite', 'Bite during rotation', {\n\t\t\t\tlabelTooltip:\n\t\t\t\t\t'Use Bite during rotation rather than exclusively at end of fight. Ignored for AOE rotation or if not using manual advanced parameters.',\n\t\t\t}),\n\t\t\tAplHelpers.numberFieldConfig('biteTime', true, {\n\t\t\t\tlabel: 'Bite Time',\n\t\t\t\tlabelTooltip: 'Min seconds remaining on Rip/Roar to allow a Bite. Ignored if not Biting during rotation.',\n\t\t\t}),\n\t\t],\n\t}),\n};\n","import { Tooltip } from 'bootstrap';\n\nimport { EventID, TypedEvent } from '../../typed_event.js';\nimport { Player } from '../../player.js';\nimport { ListItemPickerConfig, ListPicker } from '../list_picker.js';\nimport { AdaptiveStringPicker } from '../string_picker.js';\nimport {\n\tAPLRotation,\n\tAPLListItem,\n\tAPLAction,\n\tAPLPrepullAction,\n\tAPLValue,\n\tAPLValueConst,\n} from '../../proto/apl.js';\n\nimport { Component } from '../component.js';\nimport { Input, InputConfig } from '../input.js';\nimport { ActionId } from '../../proto_utils/action_id.js';\nimport { SimUI } from '../../sim_ui.js';\n\nimport { APLActionPicker } from './apl_actions.js';\nimport { APLValuePicker, APLValueImplStruct } from './apl_values.js';\n\nexport class APLRotationPicker extends Component {\n\tconstructor(parent: HTMLElement, simUI: SimUI, modPlayer: Player<any>) {\n\t\tsuper(parent, 'apl-rotation-picker-root');\n\n\t\tnew ListPicker<Player<any>, APLPrepullAction>(this.rootElem, modPlayer, {\n\t\t\textraCssClasses: ['apl-prepull-action-picker'],\n\t\t\ttitle: 'Prepull Actions',\n\t\t\ttitleTooltip: 'Actions to perform before the pull.',\n\t\t\titemLabel: 'Prepull Action',\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\n\t\t\tgetValue: (player: Player<any>) => player.aplRotation.prepullActions,\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: Array<APLPrepullAction>) => {\n\t\t\t\tplayer.aplRotation.prepullActions = newValue;\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t\tnewItem: () => APLPrepullAction.create({\n\t\t\t\taction: {},\n\t\t\t\tdoAtValue: {\n\t\t\t\t\tvalue: {oneofKind: 'const', const: { val: '-1s' }}\n\t\t\t\t},\n\t\t\t}),\n\t\t\tcopyItem: (oldItem: APLPrepullAction) => APLPrepullAction.clone(oldItem),\n\t\t\tnewItemPicker: (parent: HTMLElement, listPicker: ListPicker<Player<any>, APLPrepullAction>, index: number, config: ListItemPickerConfig<Player<any>, APLPrepullAction>) => new APLPrepullActionPicker(parent, modPlayer, config, index),\n\t\t\tinlineMenuBar: true,\n\t\t});\n\n\t\tnew ListPicker<Player<any>, APLListItem>(this.rootElem, modPlayer, {\n\t\t\textraCssClasses: ['apl-list-item-picker'],\n\t\t\ttitle: 'Priority List',\n\t\t\ttitleTooltip: 'At each decision point, the simulation will perform the first valid action from this list.',\n\t\t\titemLabel: 'Action',\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\n\t\t\tgetValue: (player: Player<any>) => player.aplRotation.priorityList,\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: Array<APLListItem>) => {\n\t\t\t\tplayer.aplRotation.priorityList = newValue;\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t\tnewItem: () => APLListItem.create({\n\t\t\t\taction: {},\n\t\t\t}),\n\t\t\tcopyItem: (oldItem: APLListItem) => APLListItem.clone(oldItem),\n\t\t\tnewItemPicker: (parent: HTMLElement, listPicker: ListPicker<Player<any>, APLListItem>, index: number, config: ListItemPickerConfig<Player<any>, APLListItem>) => new APLListItemPicker(parent, modPlayer, config, index),\n\t\t\tinlineMenuBar: true,\n\t\t});\n\n\t\t//modPlayer.rotationChangeEmitter.on(() => console.log('APL: ' + APLRotation.toJsonString(modPlayer.aplRotation)))\n\t}\n}\n\nclass APLPrepullActionPicker extends Input<Player<any>, APLPrepullAction> {\n\tprivate readonly player: Player<any>;\n\n\tprivate readonly hidePicker: Input<Player<any>, boolean>;\n\tprivate readonly doAtPicker: Input<Player<any>, string>;\n\tprivate readonly actionPicker: APLActionPicker;\n\n\tprivate getItem(): APLPrepullAction {\n\t\treturn this.getSourceValue() || APLPrepullAction.create({\n\t\t\taction: {},\n\t\t});\n\t}\n\n\tconstructor(parent: HTMLElement, player: Player<any>, config: ListItemPickerConfig<Player<any>, APLPrepullAction>, index: number) {\n\t\tconfig.enableWhen = () => !this.getItem().hide;\n\t\tsuper(parent, 'apl-list-item-picker-root', player, config);\n\t\tthis.player = player;\n\n\t\tconst itemHeaderElem = ListPicker.getItemHeaderElem(this);\n\t\tmakeListItemWarnings(itemHeaderElem, player, player => player.getCurrentStats().rotationStats?.prepullActions[index]?.warnings || []);\n\n\t\tthis.hidePicker = new HidePicker(itemHeaderElem, player, {\n\t\t\tchangedEvent: () => this.player.rotationChangeEmitter,\n\t\t\tgetValue: () => this.getItem().hide,\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: boolean) => {\n\t\t\t\tthis.getItem().hide = newValue;\n\t\t\t\tthis.player.rotationChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\n\t\tthis.doAtPicker = new AdaptiveStringPicker(this.rootElem, this.player, {\n\t\t\tlabel: 'Do At',\n\t\t\tlabelTooltip: 'Time before pull to do the action. Should be negative, and formatted like, \\'-1s\\' or \\'-2500ms\\'.',\n\t\t\textraCssClasses: ['apl-prepull-actions-doat'],\n\t\t\tchangedEvent: () => this.player.rotationChangeEmitter,\n\t\t\tgetValue: () => (this.getItem().doAtValue?.value as APLValueImplStruct<'const'>|undefined)?.const.val || '',\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: string) => {\n\t\t\t\tif (newValue) {\n\t\t\t\t\tthis.getItem().doAtValue = APLValue.create({\n\t\t\t\t\t\tvalue: {oneofKind: 'const', const: { val: newValue }}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.getItem().doAtValue = undefined;\n\t\t\t\t}\n\t\t\t\tthis.player.rotationChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t\tinline: true,\n\t\t});\n\t\t//this.doAtPicker = new APLValuePicker(this.rootElem, this.player, {\n\t\t//\tlabel: 'Do At',\n\t\t//\tlabelTooltip: 'Time before pull to do the action. Should be negative, and formatted like, \\'-1s\\' or \\'-2500ms\\'.',\n\t\t//\textraCssClasses: ['apl-prepull-actions-doat'],\n\t\t//\tchangedEvent: () => this.player.rotationChangeEmitter,\n\t\t//\tgetValue: () => this.getItem().doAtValue,\n\t\t//\tsetValue: (eventID: EventID, player: Player<any>, newValue: APLValue | undefined) => {\n\t\t//\t\tthis.getItem().doAtValue = newValue;\n\t\t//\t\tthis.player.rotationChangeEmitter.emit(eventID);\n\t\t//\t},\n\t\t//\tinline: true,\n\t\t//});\n\n\t\tthis.actionPicker = new APLActionPicker(this.rootElem, this.player, {\n\t\t\tchangedEvent: () => this.player.rotationChangeEmitter,\n\t\t\tgetValue: () => this.getItem().action!,\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: APLAction) => {\n\t\t\t\tthis.getItem().action = newValue;\n\t\t\t\tthis.player.rotationChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\t\tthis.init();\n\t}\n\n\tgetInputElem(): HTMLElement | null {\n\t\treturn this.rootElem;\n\t}\n\n\tgetInputValue(): APLPrepullAction {\n\t\tconst item = APLPrepullAction.create({\n\t\t\thide: this.hidePicker.getInputValue(),\n\t\t\tdoAtValue: {\n\t\t\t\tvalue: {oneofKind: 'const', const: { val: this.doAtPicker.getInputValue() }},\n\t\t\t},\n\t\t\taction: this.actionPicker.getInputValue(),\n\t\t});\n\t\treturn item;\n\t}\n\n\tsetInputValue(newValue: APLPrepullAction) {\n\t\tif (!newValue) {\n\t\t\treturn;\n\t\t}\n\t\tthis.hidePicker.setInputValue(newValue.hide);\n\t\tthis.doAtPicker.setInputValue((newValue.doAtValue?.value as APLValueImplStruct<'const'>|undefined)?.const.val || '');\n\t\tthis.actionPicker.setInputValue(newValue.action || APLAction.create());\n\t}\n}\n\nclass APLListItemPicker extends Input<Player<any>, APLListItem> {\n\tprivate readonly player: Player<any>;\n\n\tprivate readonly hidePicker: Input<Player<any>, boolean>;\n\tprivate readonly actionPicker: APLActionPicker;\n\n\tprivate getItem(): APLListItem {\n\t\treturn this.getSourceValue() || APLListItem.create({\n\t\t\taction: {},\n\t\t});\n\t}\n\n\tconstructor(parent: HTMLElement, player: Player<any>, config: ListItemPickerConfig<Player<any>, APLListItem>, index: number) {\n\t\tconfig.enableWhen = () => !this.getItem().hide;\n\t\tsuper(parent, 'apl-list-item-picker-root', player, config);\n\t\tthis.player = player;\n\n\t\tconst itemHeaderElem = ListPicker.getItemHeaderElem(this);\n\t\tmakeListItemWarnings(itemHeaderElem, player, player => player.getCurrentStats().rotationStats?.priorityList[index]?.warnings || []);\n\n\t\tthis.hidePicker = new HidePicker(itemHeaderElem, player, {\n\t\t\tchangedEvent: () => this.player.rotationChangeEmitter,\n\t\t\tgetValue: () => this.getItem().hide,\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: boolean) => {\n\t\t\t\tthis.getItem().hide = newValue;\n\t\t\t\tthis.player.rotationChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\n\t\tthis.actionPicker = new APLActionPicker(this.rootElem, this.player, {\n\t\t\tchangedEvent: () => this.player.rotationChangeEmitter,\n\t\t\tgetValue: () => this.getItem().action!,\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: APLAction) => {\n\t\t\t\tthis.getItem().action = newValue;\n\t\t\t\tthis.player.rotationChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\t\tthis.init();\n\t}\n\n\tgetInputElem(): HTMLElement | null {\n\t\treturn this.rootElem;\n\t}\n\n\tgetInputValue(): APLListItem {\n\t\tconst item = APLListItem.create({\n\t\t\thide: this.hidePicker.getInputValue(),\n\t\t\taction: this.actionPicker.getInputValue(),\n\t\t});\n\t\treturn item;\n\t}\n\n\tsetInputValue(newValue: APLListItem) {\n\t\tif (!newValue) {\n\t\t\treturn;\n\t\t}\n\t\tthis.hidePicker.setInputValue(newValue.hide);\n\t\tthis.actionPicker.setInputValue(newValue.action || APLAction.create());\n\t}\n}\n\nfunction makeListItemWarnings(itemHeaderElem: HTMLElement, player: Player<any>, getWarnings: (player: Player<any>) => Array<string>) {\n\tconst warningsElem = ListPicker.makeActionElem('apl-warnings', 'fa-exclamation-triangle');\n\twarningsElem.classList.add('warning', 'link-warning');\n\twarningsElem.setAttribute('data-bs-html', 'true');\n\tconst warningsTooltip = Tooltip.getOrCreateInstance(warningsElem, {\n\t\tcustomClass: 'dropdown-tooltip',\n\t\ttitle: 'Warnings',\n\t\thtml: true,\n\t});\n\titemHeaderElem.appendChild(warningsElem);\n\n\tconst updateWarnings = async () => {\n\t\twarningsTooltip.setContent({ '.tooltip-inner': '' });\n\t\tconst warnings = getWarnings(player);\n\t\tif (warnings.length == 0) {\n\t\t\twarningsElem.style.visibility = 'hidden';\n\t\t} else {\n\t\t\twarningsElem.style.visibility = 'visible';\n\t\t\tconst formattedWarnings = await Promise.all(warnings.map(w => ActionId.replaceAllInString(w)));\n\t\t\twarningsTooltip.setContent({\n\t\t\t\t'.tooltip-inner': `\n\t\t\t\t<p>This action has warnings, and might not behave as expected.</p>\n\t\t\t\t<ul>\n\t\t\t\t\t${formattedWarnings.map(w => `<li>${w}</li>`).join('')}\n\t\t\t\t</ul>\n\t\t\t`});\n\t\t}\n\t};\n\tupdateWarnings();\n\tplayer.currentStatsEmitter.on(updateWarnings);\n}\n\nclass HidePicker extends Input<Player<any>, boolean> {\n\tprivate readonly inputElem: HTMLElement;\n\tprivate readonly iconElem: HTMLElement;\n\tprivate tooltip: Tooltip;\n\n\tconstructor(parent: HTMLElement, modObject: Player<any>, config: InputConfig<Player<any>, boolean>) {\n\t\tsuper(parent, 'hide-picker-root', modObject, config);\n\n\t\tthis.inputElem = ListPicker.makeActionElem('hide-picker-button', 'fa-eye');\n\t\tthis.iconElem = this.inputElem.childNodes[0] as HTMLElement;\n\t\tthis.rootElem.appendChild(this.inputElem);\n\t\tthis.tooltip = Tooltip.getOrCreateInstance(this.inputElem, { title: 'Enable/Disable' });\n\n\t\tthis.init();\n\n\t\tthis.inputElem.addEventListener('click', () => {\n\t\t\tthis.setInputValue(!this.getInputValue());\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t});\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.inputElem;\n\t}\n\n\tgetInputValue(): boolean {\n\t\treturn this.iconElem.classList.contains('fa-eye-slash');\n\t}\n\n\tsetInputValue(newValue: boolean) {\n\t\tif (newValue) {\n\t\t\tthis.iconElem.classList.add('fa-eye-slash');\n\t\t\tthis.iconElem.classList.remove('fa-eye');\n\t\t\tthis.tooltip.setContent({ '.tooltip-inner': 'Enable Action' });\n\t\t} else {\n\t\t\tthis.iconElem.classList.add('fa-eye');\n\t\t\tthis.iconElem.classList.remove('fa-eye-slash');\n\t\t\tthis.tooltip.setContent({ '.tooltip-inner': 'Disable Action' });\n\t\t}\n\t}\n}","import { EventID, TypedEvent } from '../typed_event.js';\nimport { arrayEquals } from '../utils.js';\n\nimport { Input, InputConfig } from './input.js';\n\n/**\n * Data for creating a number list picker.\n */\nexport interface NumberListPickerConfig<ModObject> extends InputConfig<ModObject, Array<number>> {\n\tplaceholder?: string,\n}\n\n// UI element for picking an arbitrary number list field.\nexport class NumberListPicker<ModObject> extends Input<ModObject, Array<number>> {\n\tprivate readonly inputElem: HTMLInputElement;\n\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: NumberListPickerConfig<ModObject>) {\n\t\tsuper(parent, 'number-list-picker-root', modObject, config);\n\n\t\tthis.inputElem = document.createElement('input');\n\t\tthis.inputElem.type = 'text';\n\t\tthis.inputElem.placeholder = config.placeholder || '';\n\t\tthis.inputElem.classList.add('number-list-picker-input', 'form-control');\n\t\tthis.rootElem.appendChild(this.inputElem);\n\n\t\tthis.init();\n\n\t\tthis.inputElem.addEventListener('change', event => {\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t});\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.inputElem;\n\t}\n\n\tgetInputValue(): Array<number> {\n\t\tconst str = this.inputElem.value;\n\t\tif (!str) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn str.split(',').map(parseFloat).filter(val => !isNaN(val));\n\t}\n\n\tsetInputValue(newValue: Array<number>) {\n\t\tif (arrayEquals(this.getInputValue(), newValue)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.inputElem.value = newValue.map(v => String(v)).join(',');\n\t}\n}\n","import { Component } from '../component.js';\nimport { IconEnumPicker, IconEnumValueConfig } from '../icon_enum_picker.js';\nimport { NumberListPicker } from '../number_list_picker.js';\nimport { Player } from '../../player.js';\nimport { EventID, TypedEvent } from '../../typed_event.js';\nimport { ActionID as ActionIdProto } from '../../proto/common.js';\nimport { Cooldown } from '../../proto/common.js';\nimport { ActionId } from '../../proto_utils/action_id.js';\nimport { Tooltip } from 'bootstrap';\n\nexport class CooldownsPicker extends Component {\n\treadonly player: Player<any>;\n\n\tprivate cooldownPickers: Array<HTMLElement>;\n\n\tconstructor(parentElem: HTMLElement, player: Player<any>) {\n\t\tsuper(parentElem, 'cooldowns-picker-root');\n\t\tthis.player = player;\n\t\tthis.cooldownPickers = [];\n\n\t\tTypedEvent.onAny([this.player.rotationChangeEmitter, this.player.sim.unitMetadataEmitter]).on(eventID => {\n\t\t\tthis.update();\n\t\t});\n\t\tthis.update();\n\t}\n\n\tprivate update() {\n\t\tthis.rootElem.innerHTML = '';\n\t\tconst cooldowns = this.player.getSimpleCooldowns().cooldowns;\n\n\t\tthis.cooldownPickers = [];\n\t\tfor (let i = 0; i < cooldowns.length + 1; i++) {\n\t\t\tconst cooldown = cooldowns[i];\n\n\t\t\tconst row = document.createElement('div');\n\t\t\trow.classList.add('cooldown-picker');\n\t\t\tif (i == cooldowns.length) {\n\t\t\t\trow.classList.add('add-cooldown-picker');\n\t\t\t}\n\t\t\tthis.rootElem.appendChild(row);\n\n\t\t\tconst actionPicker = this.makeActionPicker(row, i);\n\n\t\t\tconst label = document.createElement('label');\n\t\t\tlabel.classList.add('cooldown-picker-label', 'form-label');\n\t\t\tif (cooldown && cooldown.id) {\n\t\t\t\tActionId.fromProto(cooldown.id).fill(this.player.getRaidIndex()).then(filledId => label.textContent = filledId.name);\n\t\t\t}\n\t\t\trow.appendChild(label);\n\n\t\t\tconst timingsPicker = this.makeTimingsPicker(row, i);\n\n\t\t\tlet deleteButtonFragment = document.createElement('fragment');\n\t\t\tdeleteButtonFragment.innerHTML = `\n\t\t\t\t<a\n\t\t\t\t\thref=\"javascript:void(0)\"\n\t\t\t\t\tclass=\"delete-cooldown link-danger\"\n\t\t\t\t\trole=\"button\"\n\t\t\t\t>\n\t\t\t\t\t<i class=\"fa fa-times fa-xl\"></i>\n\t\t\t\t</a>\n\t\t\t`\n\t\t\tconst deleteButton = deleteButtonFragment.children[0] as HTMLElement;\n\t\t\tconst deleteButtonTooltip = Tooltip.getOrCreateInstance(deleteButton, {title: 'Delete Cooldown'});\n\t\t\tdeleteButton.addEventListener('click', event => {\n\t\t\t\tconst newCooldowns = this.player.getSimpleCooldowns();\n\t\t\t\tnewCooldowns.cooldowns.splice(i, 1);\n\t\t\t\tthis.player.setSimpleCooldowns(TypedEvent.nextEventID(), newCooldowns);\n\t\t\t\tdeleteButtonTooltip.hide();\n\t\t\t});\n\t\t\trow.appendChild(deleteButton);\n\n\t\t\tthis.cooldownPickers.push(row);\n\t\t}\n\t}\n\n\tprivate makeActionPicker(parentElem: HTMLElement, cooldownIndex: number): IconEnumPicker<Player<any>, ActionIdProto> {\n\t\tconst availableCooldowns = this.player.getMetadata().getSpells().filter(spell => spell.data.isMajorCooldown).map(spell => spell.id);\n\n\t\tconst actionPicker = new IconEnumPicker<Player<any>, ActionIdProto>(parentElem, this.player, {\n\t\t\textraCssClasses: [\n\t\t\t\t'cooldown-action-picker',\n\t\t\t],\n\t\t\tnumColumns: 3,\n\t\t\tvalues: ([\n\t\t\t\t{ color: '#grey', value: ActionIdProto.create() },\n\t\t\t] as Array<IconEnumValueConfig<Player<any>, ActionIdProto>>).concat(availableCooldowns.map(cooldownAction => {\n\t\t\t\treturn { actionId: cooldownAction, value: cooldownAction.toProto() };\n\t\t\t})),\n\t\t\tequals: (a: ActionIdProto, b: ActionIdProto) => ActionIdProto.equals(a, b),\n\t\t\tzeroValue: ActionIdProto.create(),\n\t\t\tbackupIconUrl: (value: ActionIdProto) => ActionId.fromProto(value),\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\n\t\t\tgetValue: (player: Player<any>) => player.getSimpleCooldowns().cooldowns[cooldownIndex]?.id || ActionIdProto.create(),\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: ActionIdProto) => {\n\t\t\t\tconst newCooldowns = player.getSimpleCooldowns();\n\n\t\t\t\twhile (newCooldowns.cooldowns.length < cooldownIndex) {\n\t\t\t\t\tnewCooldowns.cooldowns.push(Cooldown.create());\n\t\t\t\t}\n\t\t\t\tnewCooldowns.cooldowns[cooldownIndex] = Cooldown.create({\n\t\t\t\t\tid: newValue,\n\t\t\t\t\ttimings: [],\n\t\t\t\t});\n\n\t\t\t\tplayer.setSimpleCooldowns(eventID, newCooldowns);\n\t\t\t},\n\t\t});\n\t\treturn actionPicker;\n\t}\n\n\tprivate makeTimingsPicker(parentElem: HTMLElement, cooldownIndex: number): NumberListPicker<Player<any>> {\n\t\tconst actionPicker = new NumberListPicker(parentElem, this.player, {\n\t\t\textraCssClasses: [\n\t\t\t\t'cooldown-timings-picker',\n\t\t\t],\n\t\t\tplaceholder: '20, 40, ...',\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\n\t\t\tgetValue: (player: Player<any>) => {\n\t\t\t\treturn player.getSimpleCooldowns().cooldowns[cooldownIndex]?.timings || [];\n\t\t\t},\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: Array<number>) => {\n\t\t\t\tconst newCooldowns = player.getSimpleCooldowns();\n\t\t\t\tnewCooldowns.cooldowns[cooldownIndex].timings = newValue;\n\t\t\t\tplayer.setSimpleCooldowns(eventID, newCooldowns);\n\t\t\t},\n\t\t\tenableWhen: (player: Player<any>) => {\n\t\t\t\tconst curCooldown = player.getSimpleCooldowns().cooldowns[cooldownIndex];\n\t\t\t\treturn curCooldown && !ActionIdProto.equals(curCooldown.id, ActionIdProto.create());\n\t\t\t},\n\t\t});\n\t\treturn actionPicker;\n\t}\n}\n","import * as Tooltips from '../../constants/tooltips.js';\nimport { IndividualSimUI, InputSection } from '../../individual_sim_ui';\nimport { Player } from '../../player';\nimport { APLRotation, APLRotation_Type as APLRotationType } from '../../proto/apl';\nimport { SavedRotation } from '../../proto/ui';\nimport { EventID, TypedEvent } from '../../typed_event';\nimport { BooleanPicker } from '../boolean_picker';\nimport { ContentBlock } from '../content_block';\nimport { EnumPicker } from '../enum_picker';\nimport * as IconInputs from '../icon_inputs.js';\nimport { Input } from '../input';\nimport { NumberPicker } from '../number_picker';\nimport { SavedDataManager } from '../saved_data_manager';\nimport { SimTab } from '../sim_tab';\nimport { APLRotationPicker } from './apl_rotation_picker';\nimport { CooldownsPicker } from './cooldowns_picker';\n\nexport class RotationTab extends SimTab {\n\tprotected simUI: IndividualSimUI<any>;\n\n\treadonly leftPanel: HTMLElement;\n\treadonly rightPanel: HTMLElement;\n\n\tconstructor(parentElem: HTMLElement, simUI: IndividualSimUI<any>) {\n\t\tsuper(parentElem, simUI, { identifier: 'rotation-tab', title: 'Rotation' });\n\t\tthis.simUI = simUI;\n\n\t\tthis.leftPanel = document.createElement('div');\n\t\tthis.leftPanel.classList.add('rotation-tab-left', 'tab-panel-left');\n\n\t\tthis.rightPanel = document.createElement('div');\n\t\tthis.rightPanel.classList.add('rotation-tab-right', 'tab-panel-right');\n\n\t\tthis.contentContainer.appendChild(this.leftPanel);\n\t\tthis.contentContainer.appendChild(this.rightPanel);\n\n\t\tthis.buildTabContent();\n\n\t\tthis.updateSections();\n\t\tthis.simUI.player.rotationChangeEmitter.on(() => this.updateSections());\n\t}\n\n\tprotected buildTabContent() {\n\t\tthis.buildHeader();\n\n\t\tthis.buildAutoContent();\n\t\tthis.buildAplContent();\n\t\tthis.buildSimpleContent();\n\n\t\tthis.buildSavedDataPickers();\n\t}\n\n\tprivate updateSections() {\n\t\tthis.rootElem.classList.remove('rotation-type-auto');\n\t\tthis.rootElem.classList.remove('rotation-type-simple');\n\t\tthis.rootElem.classList.remove('rotation-type-apl');\n\t\tthis.rootElem.classList.remove('rotation-type-legacy');\n\n\t\tconst rotType = this.simUI.player.getRotationType();\n\t\tif (rotType == APLRotationType.TypeAuto) {\n\t\t\tthis.rootElem.classList.add('rotation-type-auto');\n\t\t} else if (rotType == APLRotationType.TypeSimple) {\n\t\t\tthis.rootElem.classList.add('rotation-type-simple');\n\t\t} else if (rotType == APLRotationType.TypeAPL) {\n\t\t\tthis.rootElem.classList.add('rotation-type-apl');\n\t\t}\n\t}\n\n\tprivate buildHeader() {\n\t\tconst header = document.createElement('div');\n\t\theader.classList.add('rotation-tab-header');\n\t\tthis.leftPanel.appendChild(header);\n\n\t\tnew EnumPicker(header, this.simUI.player, {\n\t\t\tlabel: 'Rotation Type',\n\t\t\tlabelTooltip: 'Which set of options to use for specifying the rotation.',\n\t\t\tinline: true,\n\t\t\tvalues: this.simUI.player.hasSimpleRotationGenerator()\n\t\t\t\t? [\n\t\t\t\t\t\t{ value: APLRotationType.TypeAuto, name: 'Auto' },\n\t\t\t\t\t\t{ value: APLRotationType.TypeSimple, name: 'Simple' },\n\t\t\t\t\t\t{ value: APLRotationType.TypeAPL, name: 'APL' },\n\t\t\t\t  ]\n\t\t\t\t: [\n\t\t\t\t\t\t{ value: APLRotationType.TypeAuto, name: 'Auto' },\n\t\t\t\t\t\t{ value: APLRotationType.TypeAPL, name: 'APL' },\n\t\t\t\t  ],\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\n\t\t\tgetValue: (player: Player<any>) => player.getRotationType(),\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\t\t\tplayer.aplRotation.type = newValue;\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate buildAutoContent() {\n\t\tconst content = document.createElement('div');\n\t\tcontent.classList.add('rotation-tab-auto');\n\t\tthis.leftPanel.appendChild(content);\n\t}\n\n\tprivate buildAplContent() {\n\t\tconst content = document.createElement('div');\n\t\tcontent.classList.add('rotation-tab-apl');\n\t\tthis.leftPanel.appendChild(content);\n\n\t\tnew APLRotationPicker(content, this.simUI, this.simUI.player);\n\t}\n\n\tprivate buildSimpleContent() {\n\t\tif (!this.simUI.player.hasSimpleRotationGenerator() || !this.simUI.individualConfig.rotationInputs) {\n\t\t\treturn;\n\t\t}\n\t\tconst cssClass = 'rotation-tab-simple';\n\n\t\tconst contentBlock = new ContentBlock(this.leftPanel, 'rotation-settings', {\n\t\t\theader: { title: 'Rotation' },\n\t\t});\n\t\tcontentBlock.rootElem.classList.add(cssClass);\n\n\t\tconst rotationIconGroup = Input.newGroupContainer();\n\t\trotationIconGroup.classList.add('rotation-icon-group', 'icon-group');\n\t\tcontentBlock.bodyElement.appendChild(rotationIconGroup);\n\n\t\tif (this.simUI.individualConfig.rotationIconInputs?.length) {\n\t\t\tthis.configureIconSection(\n\t\t\t\trotationIconGroup,\n\t\t\t\tthis.simUI.individualConfig.rotationIconInputs.map(iconInput => IconInputs.buildIconInput(rotationIconGroup, this.simUI.player, iconInput)),\n\t\t\t\ttrue,\n\t\t\t);\n\t\t}\n\n\t\tthis.configureInputSection(contentBlock.bodyElement, this.simUI.individualConfig.rotationInputs);\n\n\t\tcontentBlock.bodyElement.querySelectorAll('.input-root').forEach(elem => {\n\t\t\telem.classList.add('input-inline');\n\t\t});\n\n\t\tconst cooldownsContentBlock = new ContentBlock(this.leftPanel, 'cooldown-settings', {\n\t\t\theader: { title: 'Cooldowns', tooltip: Tooltips.COOLDOWNS_SECTION },\n\t\t});\n\t\tcooldownsContentBlock.rootElem.classList.add(cssClass);\n\n\t\tnew CooldownsPicker(cooldownsContentBlock.bodyElement, this.simUI.player);\n\t}\n\n\tprivate configureInputSection(sectionElem: HTMLElement, sectionConfig: InputSection) {\n\t\tsectionConfig.inputs.forEach(inputConfig => {\n\t\t\tif (inputConfig.type == 'number') {\n\t\t\t\tnew NumberPicker(sectionElem, this.simUI.player, inputConfig);\n\t\t\t} else if (inputConfig.type == 'boolean') {\n\t\t\t\tnew BooleanPicker(sectionElem, this.simUI.player, { ...inputConfig });\n\t\t\t} else if (inputConfig.type == 'enum') {\n\t\t\t\tnew EnumPicker(sectionElem, this.simUI.player, inputConfig);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate configureIconSection(sectionElem: HTMLElement, iconPickers: Array<any>, adjustColumns?: boolean) {\n\t\tif (iconPickers.length == 0) {\n\t\t\tsectionElem.classList.add('hide');\n\t\t} else if (adjustColumns) {\n\t\t\tif (iconPickers.length <= 4) {\n\t\t\t\tsectionElem.style.gridTemplateColumns = `repeat(${iconPickers.length}, 1fr)`;\n\t\t\t} else if (iconPickers.length > 4 && iconPickers.length < 8) {\n\t\t\t\tsectionElem.style.gridTemplateColumns = `repeat(${Math.ceil(iconPickers.length / 2)}, 1fr)`;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate buildSavedDataPickers() {\n\t\tconst savedRotationsManager = new SavedDataManager<Player<any>, SavedRotation>(this.rightPanel, this.simUI.player, {\n\t\t\tlabel: 'Rotation',\n\t\t\theader: { title: 'Saved Rotations' },\n\t\t\tstorageKey: this.simUI.getSavedRotationStorageKey(),\n\t\t\tgetData: (player: Player<any>) =>\n\t\t\t\tSavedRotation.create({\n\t\t\t\t\trotation: APLRotation.clone(player.aplRotation),\n\t\t\t\t}),\n\t\t\tsetData: (eventID: EventID, player: Player<any>, newRotation: SavedRotation) => {\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\t\tplayer.setAplRotation(eventID, newRotation.rotation || APLRotation.create());\n\t\t\t\t});\n\t\t\t},\n\t\t\tchangeEmitters: [this.simUI.player.rotationChangeEmitter, this.simUI.player.talentsChangeEmitter],\n\t\t\tequals: (a: SavedRotation, b: SavedRotation) => {\n\t\t\t\t// Uncomment this to debug equivalence checks with preset rotations (e.g. the chip doesn't highlight)\n\t\t\t\t//console.log(`Rot A: ${SavedRotation.toJsonString(a, {prettySpaces: 2})}\\n\\nRot B: ${SavedRotation.toJsonString(b, {prettySpaces: 2})}`);\n\t\t\t\treturn SavedRotation.equals(a, b);\n\t\t\t},\n\t\t\ttoJson: (a: SavedRotation) => SavedRotation.toJson(a),\n\t\t\tfromJson: (obj: any) => SavedRotation.fromJson(obj),\n\t\t});\n\n\t\tthis.simUI.sim.waitForInit().then(() => {\n\t\t\tsavedRotationsManager.loadUserData();\n\t\t\t(this.simUI.individualConfig.presets.rotations || []).forEach(presetRotation => {\n\t\t\t\tconst rotData = presetRotation.rotation;\n\t\t\t\t// Fill default values so the equality checks always work.\n\t\t\t\tif (!rotData.rotation) rotData.rotation = APLRotation.create();\n\n\t\t\t\tsavedRotationsManager.addSavedData({\n\t\t\t\t\tname: presetRotation.name,\n\t\t\t\t\ttooltip: presetRotation.tooltip,\n\t\t\t\t\tisPreset: true,\n\t\t\t\t\tdata: rotData,\n\t\t\t\t\tenableWhen: presetRotation.enableWhen,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n}\n","import { BooleanPicker } from '../components/boolean_picker.js';\nimport { EnumPicker } from '../components/enum_picker.js';\nimport { ListItemPickerConfig, ListPicker } from '../components/list_picker.js';\nimport { NumberPicker } from '../components/number_picker.js';\nimport { Encounter } from '../encounter.js';\nimport { IndividualSimUI } from '../individual_sim_ui.js';\nimport { InputType, MobType, SpellSchool, Stat, Target, Target as TargetProto, TargetInput } from '../proto/common.js';\nimport { statNames } from '../proto_utils/names.js';\nimport { Stats } from '../proto_utils/stats.js';\nimport { Raid } from '../raid.js';\nimport { SimUI } from '../sim_ui.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { BaseModal } from './base_modal.js';\nimport { Component } from './component.js';\nimport { Input } from './input.js';\n\nexport interface EncounterPickerConfig {\n\tshowExecuteProportion: boolean;\n}\n\nexport class EncounterPicker extends Component {\n\tconstructor(parent: HTMLElement, modEncounter: Encounter, config: EncounterPickerConfig, simUI: SimUI) {\n\t\tsuper(parent, 'encounter-picker-root');\n\n\t\taddEncounterFieldPickers(this.rootElem, modEncounter, config.showExecuteProportion);\n\n\t\t// Need to wait so that the encounter and target presets will be loaded.\n\t\tmodEncounter.sim.waitForInit().then(() => {\n\t\t\tconst presetTargets = modEncounter.sim.db.getAllPresetTargets();\n\n\t\t\tnew EnumPicker<Encounter>(this.rootElem, modEncounter, {\n\t\t\t\textraCssClasses: ['damage-metrics', 'npc-picker'],\n\t\t\t\tlabel: 'NPC',\n\t\t\t\tlabelTooltip: 'Selects a preset NPC configuration.',\n\t\t\t\tvalues: [{ name: 'Custom', value: -1 }].concat(\n\t\t\t\t\tpresetTargets.map((pe, i) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tname: pe.path,\n\t\t\t\t\t\t\tvalue: i,\n\t\t\t\t\t\t};\n\t\t\t\t\t}),\n\t\t\t\t),\n\t\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\t\tgetValue: (encounter: Encounter) => presetTargets.findIndex(pe => equalTargetsIgnoreInputs(encounter.primaryTarget, pe.target)),\n\t\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t\t\tif (newValue != -1) {\n\t\t\t\t\t\tencounter.applyPresetTarget(eventID, presetTargets[newValue], 0);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\n\t\t\t//new EnumPicker<Encounter>(this.rootElem, modEncounter, {\n\t\t\t//\tlabel: 'Target Level',\n\t\t\t//\tvalues: [\n\t\t\t//\t\t{ name: '83', value: 83 },\n\t\t\t//\t\t{ name: '82', value: 82 },\n\t\t\t//\t\t{ name: '81', value: 81 },\n\t\t\t//\t\t{ name: '80', value: 80 },\n\t\t\t//\t],\n\t\t\t//\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\t//\tgetValue: (encounter: Encounter) => encounter.primaryTarget.getLevel(),\n\t\t\t//\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t//\t\tencounter.primaryTarget.setLevel(eventID, newValue);\n\t\t\t//\t},\n\t\t\t//});\n\n\t\t\t//new EnumPicker(this.rootElem, modEncounter, {\n\t\t\t//\tlabel: 'Mob Type',\n\t\t\t//\tvalues: mobTypeEnumValues,\n\t\t\t//\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\t//\tgetValue: (encounter: Encounter) => encounter.primaryTarget.getMobType(),\n\t\t\t//\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t//\t\tencounter.primaryTarget.setMobType(eventID, newValue);\n\t\t\t//\t},\n\t\t\t//});\n\n\t\t\t// Leaving this commented in case we want it later. But it takes up a lot of\n\t\t\t// screen space and none of these fields get changed much.\n\t\t\t//if (config.simpleTargetStats) {\n\t\t\t//\tconfig.simpleTargetStats.forEach(stat => {\n\t\t\t//\t\tnew NumberPicker(this.rootElem, modEncounter, {\n\t\t\t//\t\t\tlabel: statNames[stat],\n\t\t\t//\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\t//\t\t\tgetValue: (encounter: Encounter) => encounter.primaryTarget.getStats().getStat(stat),\n\t\t\t//\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t//\t\t\t\tencounter.primaryTarget.setStats(eventID, encounter.primaryTarget.getStats().withStat(stat, newValue));\n\t\t\t//\t\t\t},\n\t\t\t//\t\t});\n\t\t\t//\t});\n\t\t\t//}\n\n\t\t\tif (simUI.isIndividualSim() && (simUI as IndividualSimUI<any>).player.getSpec().isHealingSpec) {\n\t\t\t\tnew NumberPicker(this.rootElem, simUI.sim.raid, {\n\t\t\t\t\tlabel: 'Num Allies',\n\t\t\t\t\tlabelTooltip: 'Number of allied players in the raid.',\n\t\t\t\t\tchangedEvent: (raid: Raid) => raid.targetDummiesChangeEmitter,\n\t\t\t\t\tgetValue: (raid: Raid) => raid.getTargetDummies(),\n\t\t\t\t\tsetValue: (eventID: EventID, raid: Raid, newValue: number) => {\n\t\t\t\t\t\traid.setTargetDummies(eventID, newValue);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (simUI.isIndividualSim() && (simUI as IndividualSimUI<any>).player.getSpec().isTankSpec) {\n\t\t\t\tnew NumberPicker(this.rootElem, modEncounter, {\n\t\t\t\t\tlabel: 'Min Base Damage',\n\t\t\t\t\tlabelTooltip: 'Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.',\n\t\t\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\t\t\tgetValue: (encounter: Encounter) => encounter.primaryTarget.minBaseDamage,\n\t\t\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t\t\t\tencounter.primaryTarget.minBaseDamage = newValue;\n\t\t\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Transfer Target Inputs from target Id if they dont match (possible when custom AI is selected)\n\t\t\tconst targetIndex = presetTargets.findIndex(pe => modEncounter.primaryTarget.id == pe.target?.id);\n\t\t\tconst targetInputs = presetTargets[targetIndex]?.target?.targetInputs || [];\n\n\t\t\tif (\n\t\t\t\ttargetInputs.length != modEncounter.primaryTarget.targetInputs.length ||\n\t\t\t\tmodEncounter.primaryTarget.targetInputs.some((ti, i) => ti.label != targetInputs[i].label)\n\t\t\t) {\n\t\t\t\tmodEncounter.primaryTarget.targetInputs = targetInputs;\n\t\t\t\tmodEncounter.targetsChangeEmitter.emit(TypedEvent.nextEventID());\n\t\t\t}\n\n\t\t\tmakeTargetInputsPicker(this.rootElem, modEncounter, 0);\n\n\t\t\tconst advancedButton = document.createElement('button');\n\t\t\tadvancedButton.classList.add('advanced-button', 'btn', 'btn-primary');\n\t\t\tadvancedButton.textContent = 'Advanced';\n\t\t\tadvancedButton.addEventListener('click', () => new AdvancedEncounterModal(simUI.rootElem, simUI, modEncounter));\n\t\t\tthis.rootElem.appendChild(advancedButton);\n\t\t});\n\t}\n}\n\nclass AdvancedEncounterModal extends BaseModal {\n\tprivate readonly encounter: Encounter;\n\n\tconstructor(parent: HTMLElement, simUI: SimUI, encounter: Encounter) {\n\t\tsuper(parent, 'advanced-encounter-picker-modal');\n\n\t\tthis.encounter = encounter;\n\n\t\tthis.addHeader();\n\t\tthis.body.innerHTML = `\n\t\t\t<div class=\"encounter-header\"></div>\n\t\t\t<div class=\"encounter-targets\"></div>\n\t\t`;\n\n\t\tconst header = this.rootElem.getElementsByClassName('encounter-header')[0] as HTMLElement;\n\t\tconst targetsElem = this.rootElem.getElementsByClassName('encounter-targets')[0] as HTMLElement;\n\n\t\taddEncounterFieldPickers(header, this.encounter, true);\n\t\tif (!simUI.isIndividualSim()) {\n\t\t\tnew BooleanPicker<Encounter>(header, encounter, {\n\t\t\t\tlabel: 'Use Health',\n\t\t\t\tlabelTooltip: 'Uses a damage limit in place of a duration limit. Damage limit is equal to sum of all targets health.',\n\t\t\t\tinline: true,\n\t\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\t\tgetValue: (encounter: Encounter) => encounter.getUseHealth(),\n\t\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: boolean) => {\n\t\t\t\t\tencounter.setUseHealth(eventID, newValue);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tnew ListPicker<Encounter, TargetProto>(targetsElem, this.encounter, {\n\t\t\textraCssClasses: ['targets-picker', 'mb-0'],\n\t\t\titemLabel: 'Target',\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.targetsChangeEmitter,\n\t\t\tgetValue: (encounter: Encounter) => encounter.targets,\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: Array<TargetProto>) => {\n\t\t\t\tencounter.targets = newValue;\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t\tnewItem: () => Encounter.defaultTargetProto(),\n\t\t\tcopyItem: (oldItem: TargetProto) => TargetProto.clone(oldItem),\n\t\t\tnewItemPicker: (\n\t\t\t\tparent: HTMLElement,\n\t\t\t\tlistPicker: ListPicker<Encounter, TargetProto>,\n\t\t\t\tindex: number,\n\t\t\t\tconfig: ListItemPickerConfig<Encounter, TargetProto>,\n\t\t\t) => new TargetPicker(parent, encounter, index, config),\n\t\t});\n\t}\n\n\tprivate addHeader() {\n\t\tconst presetEncounters = this.encounter.sim.db.getAllPresetEncounters();\n\n\t\tnew EnumPicker<Encounter>(this.header as HTMLElement, this.encounter, {\n\t\t\tlabel: 'Encounter',\n\t\t\textraCssClasses: ['encounter-picker', 'mb-0', 'pe-2', 'order-first'],\n\t\t\tvalues: [{ name: 'Custom', value: -1 }].concat(\n\t\t\t\tpresetEncounters.map((pe, i) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: pe.path,\n\t\t\t\t\t\tvalue: i,\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t),\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\tgetValue: (encounter: Encounter) => presetEncounters.findIndex(pe => encounter.matchesPreset(pe)),\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t\tif (newValue != -1) {\n\t\t\t\t\tencounter.applyPreset(eventID, presetEncounters[newValue]);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n}\n\nclass TargetPicker extends Input<Encounter, TargetProto> {\n\tprivate readonly encounter: Encounter;\n\tprivate readonly targetIndex: number;\n\n\tprivate readonly aiPicker: Input<null, number>;\n\tprivate readonly levelPicker: Input<null, number>;\n\tprivate readonly mobTypePicker: Input<null, number>;\n\tprivate readonly tankIndexPicker: Input<null, number>;\n\tprivate readonly statPickers: Array<Input<null, number>>;\n\tprivate readonly swingSpeedPicker: Input<null, number>;\n\tprivate readonly minBaseDamagePicker: Input<null, number>;\n\tprivate readonly dualWieldPicker: Input<null, boolean>;\n\tprivate readonly dwMissPenaltyPicker: Input<null, boolean>;\n\tprivate readonly parryHastePicker: Input<null, boolean>;\n\tprivate readonly spellSchoolPicker: Input<null, number>;\n\tprivate readonly damageSpreadPicker: Input<null, number>;\n\tprivate readonly targetInputPickers: ListPicker<Encounter, TargetInput>;\n\n\tprivate getTarget(): TargetProto {\n\t\treturn this.encounter.targets[this.targetIndex] || Target.create();\n\t}\n\n\tconstructor(parent: HTMLElement, encounter: Encounter, targetIndex: number, config: ListItemPickerConfig<Encounter, TargetProto>) {\n\t\tsuper(parent, 'target-picker-root', encounter, config);\n\t\tthis.encounter = encounter;\n\t\tthis.targetIndex = targetIndex;\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"target-picker-section target-picker-section1\"></div>\n\t\t\t<div class=\"target-picker-section target-picker-section2\"></div>\n\t\t\t<div class=\"target-picker-section target-picker-section3 threat-metrics\"></div>\n\t\t`;\n\n\t\tconst section1 = this.rootElem.getElementsByClassName('target-picker-section1')[0] as HTMLElement;\n\t\tconst section2 = this.rootElem.getElementsByClassName('target-picker-section2')[0] as HTMLElement;\n\t\tconst section3 = this.rootElem.getElementsByClassName('target-picker-section3')[0] as HTMLElement;\n\n\t\tconst presetTargets = encounter.sim.db.getAllPresetTargets();\n\t\tnew EnumPicker<null>(section1, null, {\n\t\t\textraCssClasses: ['npc-picker'],\n\t\t\tlabel: 'NPC',\n\t\t\tlabelTooltip: 'Selects a preset NPC configuration.',\n\t\t\tvalues: [{ name: 'Custom', value: -1 }].concat(\n\t\t\t\tpresetTargets.map((pe, i) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: pe.path,\n\t\t\t\t\t\tvalue: i,\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t),\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\n\t\t\tgetValue: () => presetTargets.findIndex(pe => equalTargetsIgnoreInputs(this.getTarget(), pe.target)),\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\n\t\t\t\tif (newValue != -1) {\n\t\t\t\t\tencounter.applyPresetTarget(eventID, presetTargets[newValue], this.targetIndex);\n\t\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.aiPicker = new EnumPicker<null>(section1, null, {\n\t\t\textraCssClasses: ['ai-picker'],\n\t\t\tlabel: 'AI',\n\t\t\tlabelTooltip: `\n\t\t\t\t<p>Determines the target\\'s ability rotation.</p>\n\t\t\t\t<p>Note that most rotations are not yet implemented.</p>\n\t\t\t`,\n\t\t\tvalues: [{ name: 'None', value: 0 }].concat(\n\t\t\t\tpresetTargets.map(pe => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tname: pe.path,\n\t\t\t\t\t\tvalue: pe.target!.id,\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t),\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\n\t\t\tgetValue: () => this.getTarget().id,\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\n\t\t\t\tconst target = this.getTarget();\n\t\t\t\ttarget.id = newValue;\n\n\t\t\t\t// Transfer Target Inputs from the AI of the selected target\n\t\t\t\ttarget.targetInputs = (presetTargets.find(pe => target.id == pe.target?.id)?.target?.targetInputs || []).map(ti => TargetInput.clone(ti));\n\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\n\t\tthis.levelPicker = new EnumPicker<null>(section1, null, {\n\t\t\tlabel: 'Level',\n\t\t\tvalues: [\n\t\t\t\t{ name: '88', value: 88 },\n\t\t\t\t{ name: '87', value: 87 },\n\t\t\t\t{ name: '86', value: 86 },\n\t\t\t\t{ name: '85', value: 85 },\n\t\t\t\t{ name: '83', value: 83 },\n\t\t\t],\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\n\t\t\tgetValue: () => this.getTarget().level,\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\n\t\t\t\tthis.getTarget().level = newValue;\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\t\tthis.mobTypePicker = new EnumPicker(section1, null, {\n\t\t\tlabel: 'Mob Type',\n\t\t\tvalues: mobTypeEnumValues,\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\n\t\t\tgetValue: () => this.getTarget().mobType,\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\n\t\t\t\tthis.getTarget().mobType = newValue;\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\t\tthis.tankIndexPicker = new EnumPicker<null>(section1, null, {\n\t\t\textraCssClasses: ['threat-metrics'],\n\t\t\tlabel: 'Tanked By',\n\t\t\tlabelTooltip:\n\t\t\t\t'Determines which player in the raid this enemy will attack. If no player is assigned to the specified tank slot, this enemy will not attack.',\n\t\t\tvalues: [\n\t\t\t\t{ name: 'None', value: -1 },\n\t\t\t\t{ name: 'Main Tank', value: 0 },\n\t\t\t\t{ name: 'Tank 2', value: 1 },\n\t\t\t\t{ name: 'Tank 3', value: 2 },\n\t\t\t\t{ name: 'Tank 4', value: 3 },\n\t\t\t],\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\n\t\t\tgetValue: () => this.getTarget().tankIndex,\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\n\t\t\t\tthis.getTarget().tankIndex = newValue;\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\n\t\tthis.targetInputPickers = makeTargetInputsPicker(section1, encounter, this.targetIndex);\n\n\t\tthis.statPickers = ALL_TARGET_STATS.map(statData => {\n\t\t\tconst stat = statData.stat;\n\t\t\treturn new NumberPicker(section2, null, {\n\t\t\t\tinline: true,\n\t\t\t\textraCssClasses: statData.extraCssClasses,\n\t\t\t\tlabel: statNames.get(stat),\n\t\t\t\tlabelTooltip: statData.tooltip,\n\t\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\n\t\t\t\tgetValue: () => this.getTarget().stats[stat],\n\t\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\n\t\t\t\t\tthis.getTarget().stats[stat] = newValue;\n\t\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tthis.swingSpeedPicker = new NumberPicker(section3, null, {\n\t\t\tlabel: 'Swing Speed',\n\t\t\tlabelTooltip: 'Time in seconds between auto attacks. Set to 0 to disable auto attacks.',\n\t\t\tfloat: true,\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\n\t\t\tgetValue: () => this.getTarget().swingSpeed,\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\n\t\t\t\tthis.getTarget().swingSpeed = newValue;\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\t\tthis.minBaseDamagePicker = new NumberPicker(section3, null, {\n\t\t\tlabel: 'Min Base Damage',\n\t\t\tlabelTooltip: 'Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.',\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\n\t\t\tgetValue: () => this.getTarget().minBaseDamage,\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\n\t\t\t\tthis.getTarget().minBaseDamage = newValue;\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\t\tthis.damageSpreadPicker = new NumberPicker(section3, null, {\n\t\t\tlabel: 'Damage Spread',\n\t\t\tlabelTooltip: 'Fractional spread between the minimum and maximum auto-attack damage from this enemy at 0 Attack Power.',\n\t\t\tfloat: true,\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\n\t\t\tgetValue: () => this.getTarget().damageSpread,\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\n\t\t\t\tthis.getTarget().damageSpread = newValue;\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\t\tthis.dualWieldPicker = new BooleanPicker(section3, null, {\n\t\t\tlabel: 'Dual Wield',\n\t\t\tlabelTooltip: 'Uses 2 separate weapons to attack.',\n\t\t\tinline: true,\n\t\t\treverse: true,\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\n\t\t\tgetValue: () => this.getTarget().dualWield,\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: boolean) => {\n\t\t\t\tthis.getTarget().dualWield = newValue;\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\t\tthis.dwMissPenaltyPicker = new BooleanPicker(section3, null, {\n\t\t\tlabel: 'DW Miss Penalty',\n\t\t\tlabelTooltip:\n\t\t\t\t'Enables the Dual Wield Miss Penalty (+19% chance to miss) if dual wielding. Bosses in Hyjal/BT/SWP usually have this disabled to stop tanks from avoidance stacking.',\n\t\t\tinline: true,\n\t\t\treverse: true,\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\n\t\t\tgetValue: () => this.getTarget().dualWieldPenalty,\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: boolean) => {\n\t\t\t\tthis.getTarget().dualWieldPenalty = newValue;\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t\tenableWhen: () => this.getTarget().dualWield,\n\t\t});\n\t\tthis.parryHastePicker = new BooleanPicker(section3, null, {\n\t\t\tlabel: 'Parry Haste',\n\t\t\tlabelTooltip: 'Whether this enemy will gain parry haste when parrying attacks.',\n\t\t\tinline: true,\n\t\t\treverse: true,\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\n\t\t\tgetValue: () => this.getTarget().parryHaste,\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: boolean) => {\n\t\t\t\tthis.getTarget().parryHaste = newValue;\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\t\tthis.spellSchoolPicker = new EnumPicker<null>(section3, null, {\n\t\t\tlabel: 'Spell School',\n\t\t\tlabelTooltip: 'Type of damage caused by auto attacks. This is usually Physical, but some enemies have elemental attacks.',\n\t\t\tvalues: [\n\t\t\t\t{ name: 'Physical', value: SpellSchool.SpellSchoolPhysical },\n\t\t\t\t{ name: 'Arcane', value: SpellSchool.SpellSchoolArcane },\n\t\t\t\t{ name: 'Fire', value: SpellSchool.SpellSchoolFire },\n\t\t\t\t{ name: 'Frost', value: SpellSchool.SpellSchoolFrost },\n\t\t\t\t{ name: 'Holy', value: SpellSchool.SpellSchoolHoly },\n\t\t\t\t{ name: 'Nature', value: SpellSchool.SpellSchoolNature },\n\t\t\t\t{ name: 'Shadow', value: SpellSchool.SpellSchoolShadow },\n\t\t\t],\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\n\t\t\tgetValue: () => this.getTarget().spellSchool,\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\n\t\t\t\tthis.getTarget().spellSchool = newValue;\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t\t},\n\t\t});\n\n\t\tthis.init();\n\t}\n\n\tgetInputElem(): HTMLElement | null {\n\t\treturn null;\n\t}\n\tgetInputValue(): TargetProto {\n\t\treturn TargetProto.create({\n\t\t\tid: this.aiPicker.getInputValue(),\n\t\t\tlevel: this.levelPicker.getInputValue(),\n\t\t\tmobType: this.mobTypePicker.getInputValue(),\n\t\t\ttankIndex: this.tankIndexPicker.getInputValue(),\n\t\t\tswingSpeed: this.swingSpeedPicker.getInputValue(),\n\t\t\tminBaseDamage: this.minBaseDamagePicker.getInputValue(),\n\t\t\tdualWield: this.dualWieldPicker.getInputValue(),\n\t\t\tdualWieldPenalty: this.dwMissPenaltyPicker.getInputValue(),\n\t\t\tparryHaste: this.parryHastePicker.getInputValue(),\n\t\t\tspellSchool: this.spellSchoolPicker.getInputValue(),\n\t\t\tdamageSpread: this.damageSpreadPicker.getInputValue(),\n\t\t\tstats: this.statPickers\n\t\t\t\t.map(picker => picker.getInputValue())\n\t\t\t\t.map((statValue, i) => new Stats().withStat(ALL_TARGET_STATS[i].stat, statValue))\n\t\t\t\t.reduce((totalStats, curStats) => totalStats.add(curStats))\n\t\t\t\t.asArray(),\n\t\t\ttargetInputs: this.targetInputPickers.getInputValue(),\n\t\t});\n\t}\n\tsetInputValue(newValue: TargetProto) {\n\t\tif (!newValue) {\n\t\t\treturn;\n\t\t}\n\t\tthis.aiPicker.setInputValue(newValue.id);\n\t\tthis.levelPicker.setInputValue(newValue.level);\n\t\tthis.mobTypePicker.setInputValue(newValue.mobType);\n\t\tthis.tankIndexPicker.setInputValue(newValue.tankIndex);\n\t\tthis.swingSpeedPicker.setInputValue(newValue.swingSpeed);\n\t\tthis.minBaseDamagePicker.setInputValue(newValue.minBaseDamage);\n\t\tthis.dualWieldPicker.setInputValue(newValue.dualWield);\n\t\tthis.dwMissPenaltyPicker.setInputValue(newValue.dualWieldPenalty);\n\t\tthis.parryHastePicker.setInputValue(newValue.parryHaste);\n\t\tthis.spellSchoolPicker.setInputValue(newValue.spellSchool);\n\t\tthis.damageSpreadPicker.setInputValue(newValue.damageSpread);\n\t\tALL_TARGET_STATS.forEach((statData, i) => this.statPickers[i].setInputValue(newValue.stats[statData.stat]));\n\t\tthis.targetInputPickers.setInputValue(newValue.targetInputs);\n\t}\n}\n\nclass TargetInputPicker extends Input<Encounter, TargetInput> {\n\tprivate readonly encounter: Encounter;\n\tprivate readonly targetIndex: number;\n\tprivate readonly targetInputIndex: number;\n\n\tprivate boolPicker: Input<null, boolean> | null;\n\tprivate numberPicker: Input<null, number> | null;\n\n\tprivate getTargetInput(): TargetInput {\n\t\treturn this.encounter.targets[this.targetIndex].targetInputs[this.targetInputIndex] || TargetInput.create();\n\t}\n\n\tconstructor(\n\t\tparent: HTMLElement,\n\t\tencounter: Encounter,\n\t\ttargetIndex: number,\n\t\ttargetInputIndex: number,\n\t\tconfig: ListItemPickerConfig<Encounter, TargetInput>,\n\t) {\n\t\tsuper(parent, 'target-input-picker-root', encounter, config);\n\t\tthis.encounter = encounter;\n\t\tthis.targetIndex = targetIndex;\n\t\tthis.targetInputIndex = targetInputIndex;\n\n\t\tthis.boolPicker = null;\n\t\tthis.numberPicker = null;\n\t\tthis.init();\n\t}\n\n\tgetInputElem(): HTMLElement | null {\n\t\treturn this.rootElem;\n\t}\n\tgetInputValue(): TargetInput {\n\t\treturn TargetInput.create({\n\t\t\tboolValue: this.boolPicker ? this.boolPicker.getInputValue() : undefined,\n\t\t\tnumberValue: this.numberPicker ? this.numberPicker.getInputValue() : undefined,\n\t\t});\n\t}\n\tsetInputValue(newValue: TargetInput) {\n\t\tif (!newValue) {\n\t\t\treturn;\n\t\t}\n\t\tif (newValue.inputType == InputType.Number && !this.numberPicker) {\n\t\t\tif (this.boolPicker) {\n\t\t\t\tthis.boolPicker.rootElem.remove();\n\t\t\t\tthis.boolPicker = null;\n\t\t\t}\n\t\t\tthis.numberPicker = new NumberPicker(this.rootElem, null, {\n\t\t\t\tlabel: newValue.label,\n\t\t\t\tlabelTooltip: newValue.tooltip,\n\t\t\t\tchangedEvent: () => this.encounter.targetsChangeEmitter,\n\t\t\t\tgetValue: () => this.getTargetInput().numberValue,\n\t\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\n\t\t\t\t\tthis.getTargetInput().numberValue = newValue;\n\t\t\t\t\tthis.encounter.targetsChangeEmitter.emit(eventID);\n\t\t\t\t},\n\t\t\t});\n\t\t} else if (newValue.inputType == InputType.Bool && !this.boolPicker) {\n\t\t\tif (this.numberPicker) {\n\t\t\t\tthis.numberPicker.rootElem.remove();\n\t\t\t\tthis.numberPicker = null;\n\t\t\t}\n\t\t\tthis.boolPicker = new BooleanPicker(this.rootElem, null, {\n\t\t\t\tlabel: newValue.label,\n\t\t\t\tlabelTooltip: newValue.tooltip,\n\t\t\t\tchangedEvent: () => this.encounter.targetsChangeEmitter,\n\t\t\t\tgetValue: () => this.getTargetInput().boolValue,\n\t\t\t\tsetValue: (eventID: EventID, _: null, newValue: boolean) => {\n\t\t\t\t\tthis.getTargetInput().boolValue = newValue;\n\t\t\t\t\tthis.encounter.targetsChangeEmitter.emit(eventID);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n}\n\nfunction addEncounterFieldPickers(rootElem: HTMLElement, encounter: Encounter, showExecuteProportion: boolean) {\n\tconst durationGroup = Input.newGroupContainer();\n\trootElem.appendChild(durationGroup);\n\n\tnew NumberPicker(durationGroup, encounter, {\n\t\tlabel: 'Duration',\n\t\tlabelTooltip: 'The fight length for each sim iteration, in seconds.',\n\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\tgetValue: (encounter: Encounter) => encounter.getDuration(),\n\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\tencounter.setDuration(eventID, newValue);\n\t\t},\n\t\tenableWhen: _obj => {\n\t\t\treturn !encounter.getUseHealth();\n\t\t},\n\t});\n\tnew NumberPicker(durationGroup, encounter, {\n\t\tlabel: 'Duration +/-',\n\t\tlabelTooltip:\n\t\t\t'Adds a random amount of time, in seconds, between [value, -1 * value] to each sim iteration. For example, setting Duration to 180 and Duration +/- to 10 will result in random durations between 170s and 190s.',\n\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\tgetValue: (encounter: Encounter) => encounter.getDurationVariation(),\n\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\tencounter.setDurationVariation(eventID, newValue);\n\t\t},\n\t\tenableWhen: _obj => {\n\t\t\treturn !encounter.getUseHealth();\n\t\t},\n\t});\n\n\tif (showExecuteProportion) {\n\t\tconst executeGroup = Input.newGroupContainer();\n\t\texecuteGroup.classList.add('execute-group');\n\t\trootElem.appendChild(executeGroup);\n\n\t\tnew NumberPicker(executeGroup, encounter, {\n\t\t\tlabel: 'Execute Duration 20 (%)',\n\t\t\tlabelTooltip:\n\t\t\t\t'Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 20% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.',\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\tgetValue: (encounter: Encounter) => encounter.getExecuteProportion20() * 100,\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t\tencounter.setExecuteProportion20(eventID, newValue / 100);\n\t\t\t},\n\t\t\tenableWhen: _obj => {\n\t\t\t\treturn !encounter.getUseHealth();\n\t\t\t},\n\t\t});\n\t\tnew NumberPicker(executeGroup, encounter, {\n\t\t\tlabel: 'Execute Duration 25 (%)',\n\t\t\tlabelTooltip:\n\t\t\t\t\"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 25% HP) for the purpose of effects like Warlock's Drain Soul.\",\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\tgetValue: (encounter: Encounter) => encounter.getExecuteProportion25() * 100,\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t\tencounter.setExecuteProportion25(eventID, newValue / 100);\n\t\t\t},\n\t\t\tenableWhen: _obj => {\n\t\t\t\treturn !encounter.getUseHealth();\n\t\t\t},\n\t\t});\n\t\tnew NumberPicker(executeGroup, encounter, {\n\t\t\tlabel: 'Execute Duration 35 (%)',\n\t\t\tlabelTooltip:\n\t\t\t\t'Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 35% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.',\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\tgetValue: (encounter: Encounter) => encounter.getExecuteProportion35() * 100,\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t\tencounter.setExecuteProportion35(eventID, newValue / 100);\n\t\t\t},\n\t\t\tenableWhen: _obj => {\n\t\t\t\treturn !encounter.getUseHealth();\n\t\t\t},\n\t\t});\n\t\tnew NumberPicker(executeGroup, encounter, {\n\t\t\tlabel: 'Execute Duration 90 (%)',\n\t\t\tlabelTooltip:\n\t\t\t\t'Percentage of the total encounter duration, for which the targets will be considered to be in range (>= 90% HP) for the purpose of effects like Hunter Careful Aim',\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\n\t\t\tgetValue: (encounter: Encounter) => encounter.getExecuteProportion90() * 100,\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\n\t\t\t\tencounter.setExecuteProportion90(eventID, newValue / 100);\n\t\t\t},\n\t\t\tenableWhen: _obj => {\n\t\t\t\treturn !encounter.getUseHealth();\n\t\t\t},\n\t\t});\n\t}\n}\n\nfunction makeTargetInputsPicker(parent: HTMLElement, encounter: Encounter, targetIndex: number): ListPicker<Encounter, TargetInput> {\n\treturn new ListPicker<Encounter, TargetInput>(parent, encounter, {\n\t\titemLabel: 'Target Input',\n\t\tchangedEvent: (encounter: Encounter) => encounter.targetsChangeEmitter,\n\t\tgetValue: (encounter: Encounter) => encounter.targets[targetIndex].targetInputs,\n\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: Array<TargetInput>) => {\n\t\t\tencounter.targets[targetIndex].targetInputs = newValue;\n\t\t\tencounter.targetsChangeEmitter.emit(eventID);\n\t\t},\n\t\tnewItem: () => TargetInput.create(),\n\t\tcopyItem: (oldItem: TargetInput) => TargetInput.clone(oldItem),\n\t\tnewItemPicker: (\n\t\t\tparent: HTMLElement,\n\t\t\tlistPicker: ListPicker<Encounter, TargetInput>,\n\t\t\tindex: number,\n\t\t\tconfig: ListItemPickerConfig<Encounter, TargetInput>,\n\t\t) => new TargetInputPicker(parent, encounter, targetIndex, index, config),\n\t\thideUi: true,\n\t});\n}\n\nfunction equalTargetsIgnoreInputs(target1: TargetProto | undefined, target2: TargetProto | undefined): boolean {\n\tif ((target1 == null) != (target2 == null)) {\n\t\treturn false;\n\t}\n\tif (target1 == null) {\n\t\treturn true;\n\t}\n\tconst modTarget2 = TargetProto.clone(target2!);\n\tmodTarget2.targetInputs = target1.targetInputs;\n\treturn TargetProto.equals(target1, modTarget2);\n}\n\nconst ALL_TARGET_STATS: Array<{ stat: Stat; tooltip: string; extraCssClasses: Array<string> }> = [\n\t{ stat: Stat.StatHealth, tooltip: '', extraCssClasses: [] },\n\t{ stat: Stat.StatArmor, tooltip: '', extraCssClasses: [] },\n\t{ stat: Stat.StatArcaneResistance, tooltip: '', extraCssClasses: [] },\n\t{ stat: Stat.StatFireResistance, tooltip: '', extraCssClasses: [] },\n\t{ stat: Stat.StatFrostResistance, tooltip: '', extraCssClasses: [] },\n\t{ stat: Stat.StatNatureResistance, tooltip: '', extraCssClasses: [] },\n\t{ stat: Stat.StatShadowResistance, tooltip: '', extraCssClasses: [] },\n\t{ stat: Stat.StatAttackPower, tooltip: '', extraCssClasses: ['threat-metrics'] },\n\t{ stat: Stat.StatBlockValue, tooltip: '', extraCssClasses: ['threat-metrics'] },\n];\n\nconst mobTypeEnumValues = [\n\t{ name: 'None', value: MobType.MobTypeUnknown },\n\t{ name: 'Beast', value: MobType.MobTypeBeast },\n\t{ name: 'Demon', value: MobType.MobTypeDemon },\n\t{ name: 'Dragonkin', value: MobType.MobTypeDragonkin },\n\t{ name: 'Elemental', value: MobType.MobTypeElemental },\n\t{ name: 'Giant', value: MobType.MobTypeGiant },\n\t{ name: 'Humanoid', value: MobType.MobTypeHumanoid },\n\t{ name: 'Mechanical', value: MobType.MobTypeMechanical },\n\t{ name: 'Undead', value: MobType.MobTypeUndead },\n];\n","import { IndividualSimUI } from '../../individual_sim_ui';\nimport { Player } from '../../player';\nimport { Faction, Stat } from '../../proto/common';\nimport { ActionId } from '../../proto_utils/action_id';\nimport { IconEnumPicker, IconEnumPickerConfig } from '../icon_enum_picker';\nimport { IconPicker, IconPickerConfig } from '../icon_picker';\nimport { MultiIconPicker, MultiIconPickerConfig } from '../multi_icon_picker';\n\nexport interface ActionInputConfig<T> {\n\tactionId: ActionId;\n\tvalue: T;\n\tfaction?: Faction;\n\tshowWhen?: (player: Player<any>) => boolean;\n}\n\nexport interface StatOption {\n\tstats: Array<Stat>;\n}\n\nexport interface ItemStatOption<T> extends StatOption {\n\tconfig: ActionInputConfig<T>;\n}\n\nexport interface PickerStatOption<PickerType, ConfigType> extends StatOption {\n\tconfig: ConfigType;\n\tpicker: PickerType;\n}\n\nexport interface IconPickerStatOption extends PickerStatOption<typeof IconPicker<Player<any>, any>, IconPickerConfig<Player<any>, any>> {}\n\nexport interface MultiIconPickerStatOption extends PickerStatOption<typeof MultiIconPicker<Player<any>>, MultiIconPickerConfig<Player<any>>> {}\n\nexport interface IconEnumPickerStatOption extends PickerStatOption<typeof IconEnumPicker<Player<any>, any>, IconEnumPickerConfig<Player<any>, any>> {}\n\nexport type ItemStatOptions<T> = ItemStatOption<T>;\nexport type PickerStatOptions = IconPickerStatOption | MultiIconPickerStatOption | IconEnumPickerStatOption;\nexport type StatOptions<T, Options extends ItemStatOptions<T> | PickerStatOptions> = Array<Options>;\n\nexport function relevantStatOptions<T, OptionsType extends ItemStatOptions<T> | PickerStatOptions>(\n\toptions: StatOptions<T, OptionsType>,\n\tsimUI: IndividualSimUI<any>,\n): StatOptions<T, OptionsType> {\n\treturn options\n\t\t.filter(\n\t\t\toption =>\n\t\t\t\toption.stats.length == 0 ||\n\t\t\t\toption.stats.some(stat => simUI.individualConfig.epStats.includes(stat)) ||\n\t\t\t\tsimUI.individualConfig.includeBuffDebuffInputs.includes(option.config),\n\t\t)\n\t\t.filter(option => !simUI.individualConfig.excludeBuffDebuffInputs.includes(option.config));\n}\n","import { Tooltip } from 'bootstrap';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { element, fragment } from 'tsx-vanilla';\n\nimport { Player } from '../player.js';\nimport { ItemSlot, Spec } from '../proto/common.js';\nimport { SimUI } from '../sim_ui.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { BooleanPicker } from './boolean_picker.js';\nimport { Component } from './component.js';\nimport { IconItemSwapPicker } from './gear_picker.jsx';\nimport { Input } from './input.jsx';\n\nexport interface ItemSwapConfig {\n\titemSlots: Array<ItemSlot>;\n\tnote?: string;\n}\n\nexport class ItemSwapPicker<SpecType extends Spec> extends Component {\n\tprivate readonly itemSlots: Array<ItemSlot>;\n\tprivate readonly enableItemSwapPicker: BooleanPicker<Player<SpecType>>;\n\n\tconstructor(parentElem: HTMLElement, simUI: SimUI, player: Player<SpecType>, config: ItemSwapConfig) {\n\t\tsuper(parentElem, 'item-swap-picker-root');\n\t\tthis.itemSlots = config.itemSlots;\n\n\t\tthis.enableItemSwapPicker = new BooleanPicker(this.rootElem, player, {\n\t\t\treverse: true,\n\t\t\tlabel: 'Enable Item Swapping',\n\t\t\tlabelTooltip: 'Allows configuring an Item Swap Set which is used with the <b>Item Swap</b> APL action.',\n\t\t\textraCssClasses: ['input-inline'],\n\t\t\tgetValue: (player: Player<SpecType>) => player.getEnableItemSwap(),\n\t\t\tsetValue(eventID: EventID, player: Player<SpecType>, newValue: boolean) {\n\t\t\t\tplayer.setEnableItemSwap(eventID, newValue);\n\t\t\t},\n\t\t\tchangedEvent: (player: Player<SpecType>) => player.itemSwapChangeEmitter,\n\t\t});\n\n\t\tconst swapPickerContainer = document.createElement('div');\n\t\tswapPickerContainer.classList.add('input-root', 'input-inline');\n\t\tthis.rootElem.appendChild(swapPickerContainer);\n\n\t\tlet noteElem: Element;\n\t\tif (config.note) {\n\t\t\tnoteElem = this.rootElem.appendChild(<p className=\"form-text\">{config.note}</p>);\n\t\t}\n\n\t\tconst toggleEnabled = () => {\n\t\t\tif (!player.getEnableItemSwap()) {\n\t\t\t\tswapPickerContainer.classList.add('hide');\n\t\t\t\tnoteElem?.classList.add('hide');\n\t\t\t} else {\n\t\t\t\tswapPickerContainer.classList.remove('hide');\n\t\t\t\tnoteElem?.classList.remove('hide');\n\t\t\t}\n\t\t};\n\t\tplayer.itemSwapChangeEmitter.on(toggleEnabled);\n\t\ttoggleEnabled();\n\n\t\tconst label = document.createElement('label');\n\t\tlabel.classList.add('form-label');\n\t\tlabel.textContent = 'Item Swap';\n\t\tswapPickerContainer.appendChild(label);\n\n\t\tconst itemSwapContainer = Input.newGroupContainer();\n\t\titemSwapContainer.classList.add('icon-group');\n\t\tswapPickerContainer.appendChild(itemSwapContainer);\n\n\t\tconst swapButtonFragment = document.createElement('fragment');\n\t\tswapButtonFragment.innerHTML = `\n\t\t\t<a\n\t\t\t\thref=\"javascript:void(0)\"\n\t\t\t\tclass=\"gear-swap-icon\"\n\t\t\t\trole=\"button\"\n\t\t\t\tdata-bs-title=\"Swap with equipped items\"\n\t\t\t>\n\t\t\t\t<i class=\"fas fa-arrows-rotate me-1\"></i>\n\t\t\t</a>\n\t\t`;\n\n\t\tconst swapButton = swapButtonFragment.children[0] as HTMLElement;\n\t\titemSwapContainer.appendChild(swapButton);\n\n\t\tswapButton.addEventListener('click', _event => this.swapWithGear(TypedEvent.nextEventID(), player));\n\t\tTooltip.getOrCreateInstance(swapButton);\n\n\t\tthis.itemSlots.forEach(itemSlot => {\n\t\t\tnew IconItemSwapPicker(itemSwapContainer, simUI, player, itemSlot);\n\t\t});\n\t}\n\n\tswapWithGear(eventID: EventID, player: Player<SpecType>) {\n\t\tlet newGear = player.getGear();\n\t\tlet newIsg = player.getItemSwapGear();\n\n\t\tthis.itemSlots.forEach(slot => {\n\t\t\tconst gearItem = player.getGear().getEquippedItem(slot);\n\t\t\tconst swapItem = player.getItemSwapGear().getEquippedItem(slot);\n\n\t\t\tnewGear = newGear.withEquippedItem(slot, swapItem, player.canDualWield2H());\n\t\t\tnewIsg = newIsg.withEquippedItem(slot, gearItem, player.canDualWield2H());\n\t\t});\n\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tplayer.setGear(eventID, newGear);\n\t\t\tplayer.setItemSwapGear(eventID, newIsg);\n\t\t});\n\t}\n}\n","import { Player } from '../../player';\nimport { BattleElixir, Class, Conjured, Consumes, Explosive, Flask, Food, GuardianElixir, PetFood, Potions, Profession, Spec, Stat, TinkerHands } from '../../proto/common';\nimport { ActionId } from '../../proto_utils/action_id';\nimport { EventID, TypedEvent } from '../../typed_event';\nimport { IconEnumValueConfig } from '../icon_enum_picker';\nimport { makeBooleanConsumeInput } from '../icon_inputs';\nimport * as InputHelpers from '../input_helpers';\nimport { ActionInputConfig, ItemStatOption } from './stat_options';\n\nexport interface ConsumableInputConfig<T> extends ActionInputConfig<T> {\n\tvalue: T;\n}\n\nexport interface ConsumableStatOption<T> extends ItemStatOption<T> {\n\tconfig: ConsumableInputConfig<T>;\n}\n\nexport interface ConsumeInputFactoryArgs<T extends number> {\n\tconsumesFieldName: keyof Consumes;\n\t// Additional callback if logic besides syncing consumes is required\n\tonSet?: (eventactionId: EventID, player: Player<any>, newValue: T) => void;\n\tshowWhen?: (player: Player<any>) => boolean;\n}\n\nfunction makeConsumeInputFactory<T extends number, SpecType extends Spec>(\n\targs: ConsumeInputFactoryArgs<T>,\n): (options: ConsumableStatOption<T>[], tooltip?: string) => InputHelpers.TypedIconEnumPickerConfig<Player<SpecType>, T> {\n\treturn (options: ConsumableStatOption<T>[], tooltip?: string) => {\n\t\treturn {\n\t\t\ttype: 'iconEnum',\n\t\t\ttooltip: tooltip,\n\t\t\tnumColumns: options.length > 5 ? 2 : 1,\n\t\t\tvalues: [{ value: 0 } as unknown as IconEnumValueConfig<Player<SpecType>, T>].concat(\n\t\t\t\toptions.map(option => {\n\t\t\t\t\tconst rtn = {\n\t\t\t\t\t\tactionId: option.config.actionId,\n\t\t\t\t\t\tvalue: option.config.value,\n\t\t\t\t\t\tshowWhen: (player: Player<SpecType>) =>\n\t\t\t\t\t\t\t(!option.config.showWhen || option.config.showWhen(player)) &&\n\t\t\t\t\t\t\t(option.config.faction || player.getFaction()) == player.getFaction(),\n\t\t\t\t\t} as IconEnumValueConfig<Player<SpecType>, T>;\n\n\t\t\t\t\treturn rtn;\n\t\t\t\t}),\n\t\t\t),\n\t\t\tequals: (a: T, b: T) => a == b,\n\t\t\tzeroValue: 0 as T,\n\t\t\tchangedEvent: (player: Player<any>) => TypedEvent.onAny([player.consumesChangeEmitter, player.gearChangeEmitter, player.professionChangeEmitter]),\n\t\t\tshowWhen: (player: Player<any>) => !args.showWhen || args.showWhen(player),\n\t\t\tgetValue: (player: Player<any>) => player.getConsumes()[args.consumesFieldName] as T,\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\t\t\tconst newConsumes = player.getConsumes();\n\n\t\t\t\tif (newConsumes[args.consumesFieldName] === newValue) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t(newConsumes[args.consumesFieldName] as number) = newValue;\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\t\tplayer.setConsumes(eventID, newConsumes);\n\t\t\t\t\tif (args.onSet) {\n\t\t\t\t\t\targs.onSet(eventID, player, newValue as T);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t};\n\t};\n}\n\n///////////////////////////////////////////////////////////////////////////\n//                                 CONJURED\n///////////////////////////////////////////////////////////////////////////\n\nexport const ConjuredDarkRune = {\n\tactionId: ActionId.fromItemId(12662),\n\tvalue: Conjured.ConjuredDarkRune,\n};\nexport const ConjuredFlameCap = {\n\tactionId: ActionId.fromItemId(22788),\n\tvalue: Conjured.ConjuredFlameCap,\n};\nexport const ConjuredHealthstone = {\n\tactionId: ActionId.fromItemId(22105),\n\tvalue: Conjured.ConjuredHealthstone,\n};\nexport const ConjuredRogueThistleTea = {\n\tactionId: ActionId.fromItemId(7676),\n\tvalue: Conjured.ConjuredRogueThistleTea,\n\tshowWhen: <SpecType extends Spec>(player: Player<SpecType>) => player.getClass() == Class.ClassRogue,\n};\n\nexport const CONJURED_CONFIG = [\n\t{ config: ConjuredRogueThistleTea, stats: [] },\n\t{ config: ConjuredHealthstone, stats: [Stat.StatStamina] },\n\t{ config: ConjuredDarkRune, stats: [Stat.StatIntellect] },\n\t{ config: ConjuredFlameCap, stats: [] },\n] as ConsumableStatOption<Conjured>[];\n\nexport const makeConjuredInput = makeConsumeInputFactory({ consumesFieldName: 'defaultConjured' });\n\n///////////////////////////////////////////////////////////////////////////\n//                                 EXPLOSIVES\n///////////////////////////////////////////////////////////////////////////\n\nexport const ExplosiveSaroniteBomb = {\n\tactionId: ActionId.fromItemId(41119),\n\tvalue: Explosive.ExplosiveSaroniteBomb,\n};\nexport const ExplosiveCobaltFragBomb = {\n\tactionId: ActionId.fromItemId(40771),\n\tvalue: Explosive.ExplosiveCobaltFragBomb,\n};\n\nexport const EXPLOSIVES_CONFIG = [\n\t{ config: ExplosiveSaroniteBomb, stats: [] },\n\t{ config: ExplosiveCobaltFragBomb, stats: [] },\n] as ConsumableStatOption<Explosive>[];\n\nexport const makeExplosivesInput = makeConsumeInputFactory({\n\tconsumesFieldName: 'fillerExplosive',\n\tshowWhen: (player: Player<any>) => player.hasProfession(Profession.Engineering),\n});\n\nexport const ThermalSapper = makeBooleanConsumeInput({\n\tactionId: ActionId.fromItemId(42641),\n\tfieldName: 'thermalSapper',\n\tshowWhen: (player: Player<any>) => player.hasProfession(Profession.Engineering),\n});\nexport const ExplosiveDecoy = makeBooleanConsumeInput({\n\tactionId: ActionId.fromItemId(40536),\n\tfieldName: 'explosiveDecoy',\n\tshowWhen: (player: Player<any>) => player.hasProfession(Profession.Engineering),\n});\n\n///////////////////////////////////////////////////////////////////////////\n//                                 Tinkers\n///////////////////////////////////////////////////////////////////////////\n\nexport const TinkerHandsSynapseSprings = {\n\tactionId: ActionId.fromSpellId(82174),\n\tvalue: TinkerHands.TinkerHandsSynapseSprings,\n};\nexport const TinkerHandsQuickflipDeflectionPlates = {\n\tactionId: ActionId.fromSpellId(82176),\n\tvalue: TinkerHands.TinkerHandsQuickflipDeflectionPlates,\n};\nexport const TinkerHandsTazikShocker = {\n\tactionId: ActionId.fromSpellId(82179),\n\tvalue: TinkerHands.TinkerHandsTazikShocker,\n};\nexport const TinkerHandsSpinalHealingInjector = {\n\tactionId: ActionId.fromSpellId(82184),\n\tvalue: TinkerHands.TinkerHandsSpinalHealingInjector,\n};\nexport const TinkerHandsZ50ManaGulper = {\n\tactionId: ActionId.fromSpellId(82186),\n\tvalue: TinkerHands.TinkerHandsZ50ManaGulper,\n};\n\nexport const TINKERS_HANDS_CONFIG = [\n\t{ config: TinkerHandsSynapseSprings, stats: [] },\n\t{ config: TinkerHandsQuickflipDeflectionPlates, stats: [] },\n\t{ config: TinkerHandsTazikShocker, stats: [] },\n\t{ config: TinkerHandsSpinalHealingInjector, stats: [] },\n\t{ config: TinkerHandsZ50ManaGulper, stats: [] },\n] as ConsumableStatOption<TinkerHands>[];\n\nexport const makeTinkerHandsInput = makeConsumeInputFactory({\n\tconsumesFieldName: 'tinkerHands',\n\tshowWhen: (player: Player<any>) => player.hasProfession(Profession.Engineering),\n});\n\n///////////////////////////////////////////////////////////////////////////\n//                                 FLASKS + ELIXIRS\n///////////////////////////////////////////////////////////////////////////\n\n// Flasks\nexport const FlaskOfTitanicStrength = {\n\tactionId: ActionId.fromItemId(58088), // Use the correct item ID\n\tvalue: Flask.FlaskOfTitanicStrength,\n};\n\nexport const FlaskOfTheWinds = {\n\tactionId: ActionId.fromItemId(58087), // Use the correct item ID\n\tvalue: Flask.FlaskOfTheWinds,\n};\n\nexport const FlaskOfSteelskin = {\n\tactionId: ActionId.fromItemId(58085), // Use the correct item ID\n\tvalue: Flask.FlaskOfSteelskin,\n};\n\nexport const FlaskOfFlowingWater = {\n\tactionId: ActionId.fromItemId(67438), // Use the correct item ID\n\tvalue: Flask.FlaskOfFlowingWater,\n};\n\nexport const FlaskOfTheDraconicMind = {\n\tactionId: ActionId.fromItemId(58086), // Use the correct item ID\n\tvalue: Flask.FlaskOfTheDraconicMind,\n};\n\nexport const FlaskOfTheFrostWyrm = {\n\tactionId: ActionId.fromItemId(46376),\n\tvalue: Flask.FlaskOfTheFrostWyrm,\n};\nexport const FlaskOfEndlessRage = {\n\tactionId: ActionId.fromItemId(46377),\n\tvalue: Flask.FlaskOfEndlessRage,\n};\nexport const FlaskOfPureMojo = {\n\tactionId: ActionId.fromItemId(46378),\n\tvalue: Flask.FlaskOfPureMojo,\n};\nexport const FlaskOfStoneblood = {\n\tactionId: ActionId.fromItemId(46379),\n\tvalue: Flask.FlaskOfStoneblood,\n};\nexport const LesserFlaskOfToughness = {\n\tactionId: ActionId.fromItemId(40079),\n\tvalue: Flask.LesserFlaskOfToughness,\n};\nexport const LesserFlaskOfResistance = {\n\tactionId: ActionId.fromItemId(44939),\n\tvalue: Flask.LesserFlaskOfResistance,\n};\n\nexport const FLASKS_CONFIG = [\n\t{ config: FlaskOfTheDraconicMind, stats: [Stat.StatSpellPower] },\n\t{ config: FlaskOfTitanicStrength, stats: [Stat.StatStrength] },\n\t{ config: FlaskOfTheWinds, stats: [Stat.StatAgility] },\n\t{ config: FlaskOfSteelskin, stats: [Stat.StatStamina] },\n\t{ config: FlaskOfFlowingWater, stats: [Stat.StatSpirit] },\n\t{ config: FlaskOfTheFrostWyrm, stats: [Stat.StatSpellPower] },\n\t{ config: FlaskOfEndlessRage, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\n\t{ config: FlaskOfPureMojo, stats: [Stat.StatMP5] },\n\t{ config: FlaskOfStoneblood, stats: [Stat.StatStamina] },\n\t{ config: LesserFlaskOfToughness, stats: [Stat.StatResilience] },\n\t{\n\t\tconfig: LesserFlaskOfResistance,\n\t\tstats: [Stat.StatArcaneResistance, Stat.StatFireResistance, Stat.StatFrostResistance, Stat.StatNatureResistance, Stat.StatShadowResistance],\n\t},\n] as ConsumableStatOption<Flask>[];\n\nexport const makeFlasksInput = makeConsumeInputFactory({\n\tconsumesFieldName: 'flask',\n\tonSet: (eventID: EventID, player: Player<any>, newValue: Flask) => {\n\t\tif (newValue) {\n\t\t\tconst newConsumes = player.getConsumes();\n\t\t\tnewConsumes.battleElixir = BattleElixir.BattleElixirUnknown;\n\t\t\tnewConsumes.guardianElixir = GuardianElixir.GuardianElixirUnknown;\n\t\t\tplayer.setConsumes(eventID, newConsumes);\n\t\t}\n\t},\n});\n\n// Battle Elixirs\nexport const ElixirOfTheMaster = {\n\tactionId: ActionId.fromItemId(58148),\n\tvalue: BattleElixir.ElixirOfTheMaster,\n};\n\nexport const ElixirOfMightySpeed = {\n\tactionId: ActionId.fromItemId(58144),\n\tvalue: BattleElixir.ElixirOfMightySpeed,\n};\n\nexport const ElixirOfImpossibleAccuracy = {\n\tactionId: ActionId.fromItemId(58094),\n\tvalue: BattleElixir.ElixirOfImpossibleAccuracy,\n};\n\nexport const ElixirOfTheCobra = {\n\tactionId: ActionId.fromItemId(58092),\n\tvalue: BattleElixir.ElixirOfTheCobra,\n};\n\nexport const ElixirOfTheNaga = {\n\tactionId: ActionId.fromItemId(58089),\n\tvalue: BattleElixir.ElixirOfTheNaga,\n};\n\nexport const GhostElixir = {\n\tactionId: ActionId.fromItemId(58084),\n\tvalue: BattleElixir.GhostElixir,\n};\nexport const ElixirOfAccuracy = {\n\tactionId: ActionId.fromItemId(44325),\n\tvalue: BattleElixir.ElixirOfAccuracy,\n};\nexport const ElixirOfArmorPiercing = {\n\tactionId: ActionId.fromItemId(44330),\n\tvalue: BattleElixir.ElixirOfArmorPiercing,\n};\nexport const ElixirOfDeadlyStrikes = {\n\tactionId: ActionId.fromItemId(44327),\n\tvalue: BattleElixir.ElixirOfDeadlyStrikes,\n};\nexport const ElixirOfExpertise = {\n\tactionId: ActionId.fromItemId(44329),\n\tvalue: BattleElixir.ElixirOfExpertise,\n};\nexport const ElixirOfLightningSpeed = {\n\tactionId: ActionId.fromItemId(44331),\n\tvalue: BattleElixir.ElixirOfLightningSpeed,\n};\nexport const ElixirOfMightyAgility = {\n\tactionId: ActionId.fromItemId(39666),\n\tvalue: BattleElixir.ElixirOfMightyAgility,\n};\nexport const ElixirOfMightyStrength = {\n\tactionId: ActionId.fromItemId(40073),\n\tvalue: BattleElixir.ElixirOfMightyStrength,\n};\nexport const GurusElixir = {\n\tactionId: ActionId.fromItemId(40076),\n\tvalue: BattleElixir.GurusElixir,\n};\nexport const SpellpowerElixir = {\n\tactionId: ActionId.fromItemId(40070),\n\tvalue: BattleElixir.SpellpowerElixir,\n};\nexport const WrathElixir = {\n\tactionId: ActionId.fromItemId(40068),\n\tvalue: BattleElixir.WrathElixir,\n};\nexport const ElixirOfDemonslaying = {\n\tactionId: ActionId.fromItemId(9224),\n\tvalue: BattleElixir.ElixirOfDemonslaying,\n};\n\nexport const BATTLE_ELIXIRS_CONFIG = [\n\t{ config: ElixirOfTheMaster, stats: [Stat.StatMastery] },\n\t{ config: ElixirOfMightySpeed, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\n\t{ config: ElixirOfImpossibleAccuracy, stats: [Stat.StatMeleeHit, Stat.StatSpellHit] },\n\t{ config: ElixirOfTheCobra, stats: [Stat.StatMeleeCrit, Stat.StatSpellCrit] },\n\t{ config: ElixirOfTheNaga, stats: [Stat.StatExpertise] },\n\t{ config: GhostElixir, stats: [Stat.StatSpirit] },\n\t{ config: ElixirOfAccuracy, stats: [Stat.StatMeleeHit, Stat.StatSpellHit] },\n\t{ config: ElixirOfDeadlyStrikes, stats: [Stat.StatMeleeCrit, Stat.StatSpellCrit] },\n\t{ config: ElixirOfExpertise, stats: [Stat.StatExpertise] },\n\t{ config: ElixirOfLightningSpeed, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\n\t{ config: ElixirOfMightyAgility, stats: [Stat.StatAgility] },\n\t{ config: ElixirOfMightyStrength, stats: [Stat.StatStrength] },\n\t{\n\t\tconfig: GurusElixir,\n\t\tstats: [Stat.StatStamina, Stat.StatAgility, Stat.StatStrength, Stat.StatSpirit, Stat.StatIntellect],\n\t},\n\t{ config: SpellpowerElixir, stats: [Stat.StatSpellPower] },\n\t{ config: WrathElixir, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\n] as ConsumableStatOption<BattleElixir>[];\n\nexport const makeBattleElixirsInput = makeConsumeInputFactory({\n\tconsumesFieldName: 'battleElixir',\n\tonSet: (eventID: EventID, player: Player<any>, newValue: BattleElixir) => {\n\t\tif (newValue) {\n\t\t\tconst newConsumes = player.getConsumes();\n\t\t\tnewConsumes.flask = Flask.FlaskUnknown;\n\t\t\tplayer.setConsumes(eventID, newConsumes);\n\t\t}\n\t},\n});\n\n// Guardian Elixirs\nexport const ElixirOfDeepEarth = {\n\tactionId: ActionId.fromItemId(58093),\n\tvalue: GuardianElixir.ElixirOfDeepEarth,\n};\nexport const PrismaticElixir = {\n\tactionId: ActionId.fromItemId(80492),\n\tvalue: GuardianElixir.PrismaticElixir,\n};\nexport const ElixirOfMightyDefense = {\n\tactionId: ActionId.fromItemId(44328),\n\tvalue: GuardianElixir.ElixirOfMightyDefense,\n};\nexport const ElixirOfMightyFortitude = {\n\tactionId: ActionId.fromItemId(40078),\n\tvalue: GuardianElixir.ElixirOfMightyFortitude,\n};\nexport const ElixirOfMightyMageblood = {\n\tactionId: ActionId.fromItemId(40109),\n\tvalue: GuardianElixir.ElixirOfMightyMageblood,\n};\nexport const ElixirOfMightyThoughts = {\n\tactionId: ActionId.fromItemId(44332),\n\tvalue: GuardianElixir.ElixirOfMightyThoughts,\n};\nexport const ElixirOfProtection = {\n\tactionId: ActionId.fromItemId(40097),\n\tvalue: GuardianElixir.ElixirOfProtection,\n};\nexport const ElixirOfSpirit = {\n\tactionId: ActionId.fromItemId(40072),\n\tvalue: GuardianElixir.ElixirOfSpirit,\n};\n\nexport const GUARDIAN_ELIXIRS_CONFIG = [\n\t{ config: ElixirOfDeepEarth, stats: [Stat.StatArmor] },\n\t{\n\t\tconfig: PrismaticElixir,\n\t\tstats: [Stat.StatArcaneResistance, Stat.StatFireResistance, Stat.StatFrostResistance, Stat.StatNatureResistance, Stat.StatShadowResistance],\n\t},\n\t{ config: ElixirOfMightyDefense, stats: [Stat.StatDefense] },\n\t{ config: ElixirOfMightyFortitude, stats: [Stat.StatStamina] },\n\t{ config: ElixirOfMightyMageblood, stats: [Stat.StatMP5] },\n\t{ config: ElixirOfMightyThoughts, stats: [Stat.StatIntellect] },\n\t{ config: ElixirOfProtection, stats: [Stat.StatArmor] },\n\t{ config: ElixirOfSpirit, stats: [Stat.StatSpirit] },\n] as ConsumableStatOption<GuardianElixir>[];\n\nexport const makeGuardianElixirsInput = makeConsumeInputFactory({\n\tconsumesFieldName: 'guardianElixir',\n\tonSet: (eventID: EventID, player: Player<any>, newValue: GuardianElixir) => {\n\t\tif (newValue) {\n\t\t\tconst newConsumes = player.getConsumes();\n\t\t\tnewConsumes.flask = Flask.FlaskUnknown;\n\t\t\tplayer.setConsumes(eventID, newConsumes);\n\t\t}\n\t},\n});\n\n///////////////////////////////////////////////////////////////////////////\n//                                 FOOD\n///////////////////////////////////////////////////////////////////////////\n\nexport const FoodFishFeast = { actionId: ActionId.fromItemId(43015), value: Food.FoodFishFeast };\nexport const FoodGreatFeast = { actionId: ActionId.fromItemId(34753), value: Food.FoodGreatFeast };\nexport const FoodBlackenedDragonfin = {\n\tactionId: ActionId.fromItemId(42999),\n\tvalue: Food.FoodBlackenedDragonfin,\n};\nexport const FoodHeartyRhino = {\n\tactionId: ActionId.fromItemId(42995),\n\tvalue: Food.FoodHeartyRhino,\n};\nexport const FoodMegaMammothMeal = {\n\tactionId: ActionId.fromItemId(34754),\n\tvalue: Food.FoodMegaMammothMeal,\n};\nexport const FoodSpicedWormBurger = {\n\tactionId: ActionId.fromItemId(34756),\n\tvalue: Food.FoodSpicedWormBurger,\n};\nexport const FoodRhinoliciousWormsteak = {\n\tactionId: ActionId.fromItemId(42994),\n\tvalue: Food.FoodRhinoliciousWormsteak,\n};\nexport const FoodImperialMantaSteak = {\n\tactionId: ActionId.fromItemId(34769),\n\tvalue: Food.FoodImperialMantaSteak,\n};\nexport const FoodSnapperExtreme = {\n\tactionId: ActionId.fromItemId(42996),\n\tvalue: Food.FoodSnapperExtreme,\n};\nexport const FoodMightyRhinoDogs = {\n\tactionId: ActionId.fromItemId(34758),\n\tvalue: Food.FoodMightyRhinoDogs,\n};\nexport const FoodFirecrackerSalmon = {\n\tactionId: ActionId.fromItemId(34767),\n\tvalue: Food.FoodFirecrackerSalmon,\n};\nexport const FoodCuttlesteak = {\n\tactionId: ActionId.fromItemId(42998),\n\tvalue: Food.FoodCuttlesteak,\n};\nexport const FoodDragonfinFilet = {\n\tactionId: ActionId.fromItemId(43000),\n\tvalue: Food.FoodDragonfinFilet,\n};\n\nexport const FoodBlackenedBasilisk = {\n\tactionId: ActionId.fromItemId(27657),\n\tvalue: Food.FoodBlackenedBasilisk,\n};\nexport const FoodGrilledMudfish = {\n\tactionId: ActionId.fromItemId(27664),\n\tvalue: Food.FoodGrilledMudfish,\n};\nexport const FoodRavagerDog = { actionId: ActionId.fromItemId(27655), value: Food.FoodRavagerDog };\nexport const FoodRoastedClefthoof = {\n\tactionId: ActionId.fromItemId(27658),\n\tvalue: Food.FoodRoastedClefthoof,\n};\nexport const FoodSpicyHotTalbuk = {\n\tactionId: ActionId.fromItemId(33872),\n\tvalue: Food.FoodSpicyHotTalbuk,\n};\nexport const FoodSkullfishSoup = {\n\tactionId: ActionId.fromItemId(33825),\n\tvalue: Food.FoodSkullfishSoup,\n};\nexport const FoodFishermansFeast = {\n\tactionId: ActionId.fromItemId(33052),\n\tvalue: Food.FoodFishermansFeast,\n};\nexport const FoodSeafoodMagnifiqueFeast = {\n\tactionId: ActionId.fromItemId(62290),\n\tvalue: Food.FoodSeafoodFeast,\n};\nexport const FoodFortuneCookie = {\n\tactionId: ActionId.fromItemId(62649),\n\tvalue: Food.FoodFortuneCookie,\n};\nexport const FoodSeveredSagefishHead = {\n\tactionId: ActionId.fromItemId(62671),\n\tvalue: Food.FoodSeveredSagefish,\n};\nexport const FoodBeerBastedCrocolisk = {\n\tactionId: ActionId.fromItemId(62670),\n\tvalue: Food.FoodBeerBasedCrocolisk,\n};\nexport const FoodBakedRockfish = {\n\tactionId: ActionId.fromItemId(62661),\n\tvalue: Food.FoodBakedRockfish,\n};\nexport const FoodBasiliskLiverdog = {\n\tactionId: ActionId.fromItemId(62665),\n\tvalue: Food.FoodBasiliskLiverdog,\n};\nexport const FoodBlackbellySushi = {\n\tactionId: ActionId.fromItemId(62668),\n\tvalue: Food.FoodBlackbellySushi,\n};\nexport const FoodSkeweredEll = {\n\tactionId: ActionId.fromItemId(62669),\n\tvalue: Food.FoodSkeweredEel,\n};\nexport const FoodCrocoliskAuGratin = {\n\tactionId: ActionId.fromItemId(62664),\n\tvalue: Food.FoodCrocoliskAuGratin,\n};\nexport const FoodDeliciousSagefishTail = {\n\tactionId: ActionId.fromItemId(62666),\n\tvalue: Food.FoodDeliciousSagefishTail,\n};\nexport const FoodMushroomSauceMudfish = {\n\tactionId: ActionId.fromItemId(62667),\n\tvalue: Food.FoodMushroomSauceMudfish,\n};\nexport const FoodGrilledDragon = {\n\tactionId: ActionId.fromItemId(62662),\n\tvalue: Food.FoodGrilledDragon,\n};\nexport const FoodLavascaleMinestrone = {\n\tactionId: ActionId.fromItemId(62663),\n\tvalue: Food.FoodLavascaleMinestrone,\n};\n\nexport const FOOD_CONFIG = [\n\t{\n\t\tconfig: FoodSeafoodMagnifiqueFeast,\n\t\tstats: [Stat.StatStamina, Stat.StatStrength, Stat.StatIntellect, Stat.StatAgility],\n\t},\n\t{ config: FoodFortuneCookie, stats: [Stat.StatAgility, Stat.StatStamina, Stat.StatStrength, Stat.StatAgility] },\n\t{ config: FoodSeveredSagefishHead, stats: [Stat.StatIntellect] },\n\t{ config: FoodBeerBastedCrocolisk, stats: [Stat.StatStrength] },\n\t{ config: FoodSkeweredEll, stats: [Stat.StatAgility] },\n\t{ config: FoodDeliciousSagefishTail, stats: [Stat.StatSpirit] },\n\t{ config: FoodBakedRockfish, stats: [Stat.StatMeleeCrit, Stat.StatSpellCrit] },\n\t{ config: FoodBasiliskLiverdog, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\n\t{ config: FoodLavascaleMinestrone, stats: [Stat.StatMastery] },\n\t{ config: FoodGrilledDragon, stats: [Stat.StatMeleeHit, Stat.StatSpellHit] },\n\t{ config: FoodCrocoliskAuGratin, stats: [Stat.StatExpertise] },\n\t{ config: FoodMushroomSauceMudfish, stats: [Stat.StatDodge] },\n\t{ config: FoodBlackbellySushi, stats: [Stat.StatParry] },\n\t{\n\t\tconfig: FoodFishFeast,\n\t\tstats: [Stat.StatStamina, Stat.StatAttackPower, Stat.StatRangedAttackPower, Stat.StatSpellPower],\n\t},\n\t{\n\t\tconfig: FoodGreatFeast,\n\t\tstats: [Stat.StatStamina, Stat.StatAttackPower, Stat.StatRangedAttackPower, Stat.StatSpellPower],\n\t},\n\t{ config: FoodBlackenedDragonfin, stats: [Stat.StatAgility] },\n\t{ config: FoodDragonfinFilet, stats: [Stat.StatStrength] },\n\t{ config: FoodCuttlesteak, stats: [Stat.StatSpirit] },\n\t{ config: FoodMegaMammothMeal, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\n\t{ config: FoodHeartyRhino, stats: [Stat.StatArmorPenetration] },\n\t{ config: FoodRhinoliciousWormsteak, stats: [Stat.StatExpertise] },\n\t{ config: FoodFirecrackerSalmon, stats: [Stat.StatSpellPower] },\n\t{ config: FoodSnapperExtreme, stats: [Stat.StatMeleeHit, Stat.StatSpellHit] },\n\t{ config: FoodSpicedWormBurger, stats: [Stat.StatMeleeCrit, Stat.StatSpellCrit] },\n\t{ config: FoodImperialMantaSteak, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\n\t{ config: FoodMightyRhinoDogs, stats: [Stat.StatMP5] },\n] as ConsumableStatOption<Food>[];\n\nexport const makeFoodInput = makeConsumeInputFactory({ consumesFieldName: 'food' });\n\n///////////////////////////////////////////////////////////////////////////\n//                                 PET\n///////////////////////////////////////////////////////////////////////////\n\nexport const SpicedMammothTreats = makeBooleanConsumeInput({\n\tactionId: ActionId.fromItemId(43005),\n\tfieldName: 'petFood',\n\tvalue: PetFood.PetFoodSpicedMammothTreats,\n});\nexport const PetScrollOfAgilityV = makeBooleanConsumeInput({\n\tactionId: ActionId.fromItemId(27498),\n\tfieldName: 'petScrollOfAgility',\n\tvalue: 5,\n});\nexport const PetScrollOfStrengthV = makeBooleanConsumeInput({\n\tactionId: ActionId.fromItemId(27503),\n\tfieldName: 'petScrollOfStrength',\n\tvalue: 5,\n});\n\n///////////////////////////////////////////////////////////////////////////\n//                                 POTIONS\n///////////////////////////////////////////////////////////////////////////\nexport const GolembloodPotion = {\n\tactionId: ActionId.fromItemId(58146),\n\tvalue: Potions.GolembloodPotion,\n};\n\nexport const PotionOfTheTolvir = {\n\tactionId: ActionId.fromItemId(58145),\n\tvalue: Potions.PotionOfTheTolvir,\n};\n\nexport const PotionOfConcentration = {\n\tactionId: ActionId.fromItemId(57194),\n\tvalue: Potions.PotionOfConcentration,\n};\n\nexport const VolcanicPotion = {\n\tactionId: ActionId.fromItemId(58091),\n\tvalue: Potions.VolcanicPotion,\n};\n\nexport const EarthenPotion = {\n\tactionId: ActionId.fromItemId(58090),\n\tvalue: Potions.EarthenPotion,\n};\n\nexport const MightyRejuvenationPotion = {\n\tactionId: ActionId.fromItemId(57193),\n\tvalue: Potions.MightyRejuvenationPotion,\n};\n\nexport const MythicalHealingPotion = {\n\tactionId: ActionId.fromItemId(57191),\n\tvalue: Potions.MythicalHealingPotion,\n};\n\nexport const MythicalManaPotion = {\n\tactionId: ActionId.fromItemId(57192),\n\tvalue: Potions.MythicalManaPotion,\n};\nexport const PotionOfSpeed = { actionId: ActionId.fromItemId(40211), value: Potions.PotionOfSpeed };\nexport const HastePotion = { actionId: ActionId.fromItemId(22838), value: Potions.HastePotion };\nexport const MightyRagePotion = {\n\tactionId: ActionId.fromItemId(13442),\n\tvalue: Potions.MightyRagePotion,\n};\n\nexport const POTIONS_CONFIG = [\n\t{ config: GolembloodPotion, stats: [Stat.StatStrength] },\n\t{ config: PotionOfTheTolvir, stats: [Stat.StatAgility] },\n\t{ config: PotionOfConcentration, stats: [Stat.StatMana] },\n\t{ config: VolcanicPotion, stats: [Stat.StatIntellect] },\n\t{ config: EarthenPotion, stats: [Stat.StatArmor] },\n\t{ config: MightyRejuvenationPotion, stats: [Stat.StatIntellect, Stat.StatHealth] },\n\t{ config: MythicalHealingPotion, stats: [Stat.StatHealth] },\n\t{ config: MythicalManaPotion, stats: [Stat.StatIntellect] },\n\t{ config: PotionOfSpeed, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\n] as ConsumableStatOption<Potions>[];\n\nexport const PRE_POTIONS_CONFIG = [\n\t{ config: GolembloodPotion, stats: [Stat.StatStrength] },\n\t{ config: PotionOfTheTolvir, stats: [Stat.StatAgility] },\n\t{ config: VolcanicPotion, stats: [Stat.StatIntellect] },\n\t{ config: EarthenPotion, stats: [Stat.StatArmor] },\n\t{ config: PotionOfSpeed, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\n] as ConsumableStatOption<Potions>[];\n\nexport const makePotionsInput = makeConsumeInputFactory({ consumesFieldName: 'defaultPotion' });\nexport const makePrepopPotionsInput = makeConsumeInputFactory({\n\tconsumesFieldName: 'prepopPotion',\n});\n","import { IndividualSimUI } from '../../individual_sim_ui';\nimport { Player } from '../../player';\nimport { TypedEvent } from '../../typed_event';\nimport { Component } from '../component';\nimport { IconEnumPicker } from '../icon_enum_picker';\nimport { buildIconInput } from '../icon_inputs.js';\nimport { IconPicker } from '../icon_picker';\nimport * as ConsumablesInputs from '../inputs/consumables';\nimport { relevantStatOptions } from '../inputs/stat_options';\nimport { SettingsTab } from './settings_tab';\n\nexport class ConsumesPicker extends Component {\n\tprotected settingsTab: SettingsTab;\n\tprotected simUI: IndividualSimUI<any>;\n\n\tconstructor(parentElem: HTMLElement, settingsTab: SettingsTab, simUI: IndividualSimUI<any>) {\n\t\tsuper(parentElem, 'consumes-picker-root');\n\t\tthis.settingsTab = settingsTab;\n\t\tthis.simUI = simUI;\n\n\t\tthis.buildPotionsPicker();\n\t\tthis.buildElixirsPicker();\n\t\tthis.buildFoodPicker();\n\t\tthis.buildEngPicker();\n\t\tthis.buildPetPicker();\n\t}\n\n\tprivate buildPotionsPicker() {\n\t\tconst fragment = document.createElement('fragment');\n\t\tfragment.innerHTML = `\n\t\t\t<div class=\"consumes-row input-root input-inline\">\n\t\t\t\t<label class=\"form-label\">Potions</label>\n\t\t\t\t<div class=\"consumes-row-inputs consumes-potions\"></div>\n\t\t\t</div>\n    \t`;\n\n\t\tconst row = this.rootElem.appendChild(fragment.children[0] as HTMLElement);\n\t\tconst potionsElem = this.rootElem.querySelector('.consumes-potions') as HTMLElement;\n\n\t\t//makePrepopPotionsInput;\n\t\tconst prePotOptions = ConsumablesInputs.makePrepopPotionsInput(relevantStatOptions(ConsumablesInputs.PRE_POTIONS_CONFIG, this.simUI), 'Prepop Potion');\n\t\tconst prePotPicker = buildIconInput(potionsElem, this.simUI.player, prePotOptions);\n\n\t\tconst potionsOptions = ConsumablesInputs.makePotionsInput(relevantStatOptions(ConsumablesInputs.POTIONS_CONFIG, this.simUI), 'Combat Potion');\n\t\tconst potionsPicker = buildIconInput(potionsElem, this.simUI.player, potionsOptions);\n\n\t\tconst conjuredOptions = ConsumablesInputs.makeConjuredInput(relevantStatOptions(ConsumablesInputs.CONJURED_CONFIG, this.simUI));\n\t\tconst conjuredPicker = buildIconInput(potionsElem, this.simUI.player, conjuredOptions);\n\n\t\tTypedEvent.onAny([this.simUI.player.professionChangeEmitter]).on(() => {\n\t\t\tthis.updateRow(row, [potionsPicker, conjuredPicker, prePotPicker]);\n\t\t});\n\t}\n\n\tprivate buildElixirsPicker() {\n\t\tconst fragment = document.createElement('fragment');\n\t\tfragment.innerHTML = `\n      \t\t<div class=\"consumes-row input-root input-inline\">\n\t\t\t\t<label class=\"form-label\">Elixirs</label>\n\t\t\t\t<div class=\"consumes-row-inputs\">\n\t\t\t\t\t<div class=\"consumes-flasks\"></div>\n\t\t\t\t\t<span class=\"elixir-space\">or</span>\n\t\t\t\t\t<div class=\"consumes-battle-elixirs\"></div>\n\t\t\t\t\t<div class=\"consumes-guardian-elixirs\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n    \t`;\n\n\t\tconst rowElem = this.rootElem.appendChild(fragment.children[0] as HTMLElement);\n\t\tconst flasksElem = this.rootElem.querySelector('.consumes-flasks') as HTMLElement;\n\t\tconst battleElixirsElem = this.rootElem.querySelector('.consumes-battle-elixirs') as HTMLElement;\n\t\tconst guardianElixirsElem = this.rootElem.querySelector('.consumes-guardian-elixirs') as HTMLElement;\n\t\tconst flasksOptions = ConsumablesInputs.makeFlasksInput(relevantStatOptions(ConsumablesInputs.FLASKS_CONFIG, this.simUI));\n\t\tbuildIconInput(flasksElem, this.simUI.player, flasksOptions);\n\t\tconst battleElixirOptions = ConsumablesInputs.makeBattleElixirsInput(relevantStatOptions(ConsumablesInputs.BATTLE_ELIXIRS_CONFIG, this.simUI));\n\t\tbuildIconInput(battleElixirsElem, this.simUI.player, battleElixirOptions);\n\t\tconst guardianElixirOptions = ConsumablesInputs.makeGuardianElixirsInput(relevantStatOptions(ConsumablesInputs.GUARDIAN_ELIXIRS_CONFIG, this.simUI));\n\t\tbuildIconInput(guardianElixirsElem, this.simUI.player, guardianElixirOptions);\n\t}\n\n\tprivate buildFoodPicker() {\n\t\tconst fragment = document.createElement('fragment');\n\t\tfragment.innerHTML = `\n\t\t\t<div class=\"consumes-row input-root input-inline\">\n\t\t\t\t<label class=\"form-label\">Food</label>\n\t\t\t\t<div class=\"consumes-row-inputs consumes-food\"></div>\n\t\t\t</div>\n    \t`;\n\n\t\tconst row = this.rootElem.appendChild(fragment.children[0] as HTMLElement);\n\t\tconst foodsElem = this.rootElem.querySelector('.consumes-food') as HTMLElement;\n\n\t\tconst foodOptions = ConsumablesInputs.makeFoodInput(relevantStatOptions(ConsumablesInputs.FOOD_CONFIG, this.simUI));\n\t\tbuildIconInput(foodsElem, this.simUI.player, foodOptions);\n\t}\n\n\tprivate buildEngPicker() {\n\t\tconst fragment = document.createElement('fragment');\n\t\tfragment.innerHTML = `\n\t\t\t<div class=\"consumes-row input-root input-inline\">\n\t\t\t\t<label class=\"form-label\">Engineering</label>\n\t\t\t\t<div class=\"consumes-row-inputs consumes-engi\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst row = this.rootElem.appendChild(fragment.children[0] as HTMLElement);\n\t\tconst engiConsumesElem = this.rootElem.querySelector('.consumes-engi') as HTMLElement;\n\n\t\tconst tinkerOptions = ConsumablesInputs.makeTinkerHandsInput(relevantStatOptions(ConsumablesInputs.TINKERS_HANDS_CONFIG, this.simUI), 'Gloves Tinkers');\n\t\tconst tinkerPicker = buildIconInput(engiConsumesElem, this.simUI.player, tinkerOptions);\n\n\t\tconst decoyPicker = buildIconInput(engiConsumesElem, this.simUI.player, ConsumablesInputs.ExplosiveDecoy);\n\t\tconst sapperPicker = buildIconInput(engiConsumesElem, this.simUI.player, ConsumablesInputs.ThermalSapper);\n\n\t\tconst explosiveOptions = ConsumablesInputs.makeExplosivesInput(relevantStatOptions(ConsumablesInputs.EXPLOSIVES_CONFIG, this.simUI), 'Explosives');\n\t\tconst explosivePicker = buildIconInput(engiConsumesElem, this.simUI.player, explosiveOptions);\n\n\t\tTypedEvent.onAny([this.simUI.player.professionChangeEmitter]).on(() => this.updateRow(row, [decoyPicker, sapperPicker, explosivePicker, tinkerPicker]));\n\t\tthis.updateRow(row, [decoyPicker, sapperPicker, explosivePicker, tinkerPicker]);\n\t}\n\n\tprivate buildPetPicker() {\n\t\tif (this.simUI.individualConfig.petConsumeInputs?.length) {\n\t\t\tconst fragment = document.createElement('fragment');\n\t\t\tfragment.innerHTML = `\n\t\t\t\t<div class=\"consumes-row input-root input-inline\">\n\t\t\t\t\t<label class=\"form-label\">Pet</label>\n\t\t\t\t\t<div class=\"consumes-row-inputs consumes-pet\"></div>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tthis.rootElem.appendChild(fragment.children[0] as HTMLElement);\n\t\t\tconst petConsumesElem = this.rootElem.querySelector('.consumes-pet') as HTMLElement;\n\n\t\t\tthis.simUI.individualConfig.petConsumeInputs.map(iconInput => buildIconInput(petConsumesElem, this.simUI.player, iconInput));\n\t\t}\n\t}\n\n\tprivate updateRow(rowElem: HTMLElement, pickers: (IconPicker<Player<any>, any> | IconEnumPicker<Player<any>, any>)[]) {\n\t\tif (!!pickers.find(p => p?.showWhen())) {\n\t\t\trowElem.classList.remove('hide');\n\t\t} else {\n\t\t\trowElem.classList.add('hide');\n\t\t}\n\t}\n}\n","import * as Tooltips from '../../constants/tooltips.js';\nimport { Encounter } from '../../encounter';\nimport { IndividualSimUI, InputSection } from '../../individual_sim_ui';\nimport { Consumes, Debuffs, HealingModel, IndividualBuffs, ItemSwap, PartyBuffs, Profession, RaidBuffs } from '../../proto/common';\nimport { SavedEncounter, SavedSettings } from '../../proto/ui';\nimport { professionNames, raceNames } from '../../proto_utils/names';\nimport { EventID, TypedEvent } from '../../typed_event';\nimport { getEnumValues } from '../../utils';\nimport { BooleanPicker } from '../boolean_picker';\nimport { ContentBlock } from '../content_block';\nimport { EncounterPicker } from '../encounter_picker.js';\nimport { EnumPicker } from '../enum_picker';\nimport * as IconInputs from '../icon_inputs.js';\nimport { Input } from '../input';\nimport * as BuffDebuffInputs from '../inputs/buffs_debuffs';\nimport { relevantStatOptions } from '../inputs/stat_options';\nimport { ItemSwapPicker } from '../item_swap_picker';\nimport { MultiIconPicker } from '../multi_icon_picker';\nimport { NumberPicker } from '../number_picker';\nimport { SavedDataManager } from '../saved_data_manager';\nimport { SimTab } from '../sim_tab';\nimport { ConsumesPicker } from './consumes_picker';\n\nexport class SettingsTab extends SimTab {\n\tprotected simUI: IndividualSimUI<any>;\n\n\treadonly leftPanel: HTMLElement;\n\treadonly rightPanel: HTMLElement;\n\n\treadonly column1: HTMLElement = this.buildColumn(1, 'settings-left-col');\n\treadonly column2: HTMLElement = this.buildColumn(2, 'settings-left-col');\n\treadonly column3: HTMLElement = this.buildColumn(3, 'settings-left-col');\n\treadonly column4?: HTMLElement;\n\n\tconstructor(parentElem: HTMLElement, simUI: IndividualSimUI<any>) {\n\t\tsuper(parentElem, simUI, { identifier: 'settings-tab', title: 'Settings' });\n\t\tthis.simUI = simUI;\n\n\t\tthis.leftPanel = document.createElement('div');\n\t\tthis.leftPanel.classList.add('settings-tab-left', 'tab-panel-left');\n\n\t\tthis.leftPanel.appendChild(this.column1);\n\t\tthis.leftPanel.appendChild(this.column2);\n\t\tthis.leftPanel.appendChild(this.column3);\n\n\t\t// The 4th column is only used in the raid sim player editor to spread out player settings\n\t\tif (this.simUI.isWithinRaidSim) {\n\t\t\tthis.column4 = this.buildColumn(4, 'settings-left-col');\n\t\t\tthis.leftPanel.appendChild(this.column4);\n\t\t}\n\n\t\tthis.rightPanel = document.createElement('div');\n\t\tthis.rightPanel.classList.add('settings-tab-right', 'tab-panel-right', 'within-raid-sim-hide');\n\n\t\tthis.contentContainer.appendChild(this.leftPanel);\n\t\tthis.contentContainer.appendChild(this.rightPanel);\n\n\t\tthis.buildTabContent();\n\t}\n\n\tprotected buildTabContent() {\n\t\tif (!this.simUI.isWithinRaidSim) {\n\t\t\tthis.buildEncounterSettings();\n\t\t}\n\n\t\tthis.buildPlayerSettings();\n\t\tthis.buildCustomSettingsSections();\n\t\tthis.buildConsumesSection();\n\t\tthis.buildOtherSettings();\n\n\t\tif (!this.simUI.isWithinRaidSim) {\n\t\t\tthis.buildBuffsSettings();\n\t\t\tthis.buildDebuffsSettings();\n\t\t}\n\n\t\tif (!this.simUI.isWithinRaidSim) {\n\t\t\tthis.buildSavedDataPickers();\n\t\t}\n\t}\n\n\tprivate buildEncounterSettings() {\n\t\tconst contentBlock = new ContentBlock(this.column1, 'encounter-settings', {\n\t\t\theader: { title: 'Encounter' },\n\t\t});\n\n\t\tnew EncounterPicker(contentBlock.bodyElement, this.simUI.sim.encounter, this.simUI.individualConfig.encounterPicker, this.simUI);\n\t}\n\n\tprivate buildPlayerSettings() {\n\t\tconst column = this.column1;\n\t\tconst contentBlock = new ContentBlock(column, 'player-settings', {\n\t\t\theader: { title: 'Player' },\n\t\t});\n\n\t\tconst playerIconGroup = Input.newGroupContainer();\n\t\tplayerIconGroup.classList.add('player-icon-group', 'icon-group');\n\t\tcontentBlock.bodyElement.appendChild(playerIconGroup);\n\n\t\tthis.configureIconSection(\n\t\t\tplayerIconGroup,\n\t\t\tthis.simUI.individualConfig.playerIconInputs.map(iconInput => IconInputs.buildIconInput(playerIconGroup, this.simUI.player, iconInput)),\n\t\t\ttrue,\n\t\t);\n\n\t\tconst races = this.simUI.player.getPlayerClass().races;\n\t\tconst _racePicker = new EnumPicker(contentBlock.bodyElement, this.simUI.player, {\n\t\t\tlabel: 'Race',\n\t\t\tvalues: races.map(race => {\n\t\t\t\treturn {\n\t\t\t\t\tname: raceNames.get(race)!,\n\t\t\t\t\tvalue: race,\n\t\t\t\t};\n\t\t\t}),\n\t\t\tchangedEvent: sim => sim.raceChangeEmitter,\n\t\t\tgetValue: sim => sim.getRace(),\n\t\t\tsetValue: (eventID, sim, newValue) => sim.setRace(eventID, newValue),\n\t\t});\n\n\t\tif (this.simUI.individualConfig.playerInputs?.inputs.length) {\n\t\t\tthis.configureInputSection(contentBlock.bodyElement, this.simUI.individualConfig.playerInputs);\n\t\t}\n\n\t\tconst professionGroup = Input.newGroupContainer();\n\t\tcontentBlock.bodyElement.appendChild(professionGroup);\n\n\t\tconst professions = getEnumValues(Profession) as Array<Profession>;\n\t\tconst _profession1Picker = new EnumPicker(professionGroup, this.simUI.player, {\n\t\t\tlabel: 'Profession 1',\n\t\t\tvalues: professions.map(p => {\n\t\t\t\treturn {\n\t\t\t\t\tname: professionNames.get(p)!,\n\t\t\t\t\tvalue: p,\n\t\t\t\t};\n\t\t\t}),\n\t\t\tchangedEvent: sim => sim.professionChangeEmitter,\n\t\t\tgetValue: sim => sim.getProfession1(),\n\t\t\tsetValue: (eventID, sim, newValue) => sim.setProfession1(eventID, newValue),\n\t\t});\n\n\t\tconst _profession2Picker = new EnumPicker(professionGroup, this.simUI.player, {\n\t\t\tlabel: 'Profession 2',\n\t\t\tvalues: professions.map(p => {\n\t\t\t\treturn {\n\t\t\t\t\tname: professionNames.get(p)!,\n\t\t\t\t\tvalue: p,\n\t\t\t\t};\n\t\t\t}),\n\t\t\tchangedEvent: sim => sim.professionChangeEmitter,\n\t\t\tgetValue: sim => sim.getProfession2(),\n\t\t\tsetValue: (eventID, sim, newValue) => sim.setProfession2(eventID, newValue),\n\t\t});\n\t}\n\n\tprivate buildCustomSettingsSections() {\n\t\t(this.simUI.individualConfig.customSections || []).forEach(customSection => {\n\t\t\tconst section = customSection(this.column2, this.simUI);\n\t\t\tsection.rootElem.classList.add('custom-section');\n\t\t});\n\t}\n\n\tprivate buildConsumesSection() {\n\t\tconst column = this.simUI.isWithinRaidSim ? this.column3 : this.column2;\n\t\tconst contentBlock = new ContentBlock(column, 'consumes-settings', {\n\t\t\theader: { title: 'Consumables' },\n\t\t});\n\n\t\tnew ConsumesPicker(contentBlock.bodyElement, this, this.simUI);\n\t}\n\n\tprivate buildOtherSettings() {\n\t\tconst settings = this.simUI.individualConfig.otherInputs?.inputs.filter(inputs => !inputs.extraCssClasses?.includes('within-raid-sim-hide') || true);\n\n\t\tconst swapSlots = this.simUI.individualConfig.itemSwapSlots || [];\n\t\tif (settings.length > 0 || swapSlots.length > 0) {\n\t\t\tconst contentBlock = new ContentBlock(this.column2, 'other-settings', {\n\t\t\t\theader: { title: 'Other' },\n\t\t\t});\n\n\t\t\tif (settings.length > 0) {\n\t\t\t\tthis.configureInputSection(contentBlock.bodyElement, this.simUI.individualConfig.otherInputs);\n\t\t\t\tcontentBlock.bodyElement.querySelectorAll('.input-root').forEach(elem => {\n\t\t\t\t\telem.classList.add('input-inline');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (swapSlots.length > 0) {\n\t\t\t\tconst _itemSwapPicker = new ItemSwapPicker(contentBlock.bodyElement, this.simUI, this.simUI.player, {\n\t\t\t\t\titemSlots: swapSlots,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate buildBuffsSettings() {\n\t\tconst contentBlock = new ContentBlock(this.column3, 'buffs-settings', {\n\t\t\theader: { title: 'Raid Buffs', tooltip: Tooltips.BUFFS_SECTION },\n\t\t});\n\n\t\tconst buffOptions = relevantStatOptions(BuffDebuffInputs.RAID_BUFFS_CONFIG, this.simUI);\n\t\tthis.configureIconSection(\n\t\t\tcontentBlock.bodyElement,\n\t\t\tbuffOptions.map(options => options.picker && new options.picker(contentBlock.bodyElement, this.simUI.player, options.config as any, this.simUI)),\n\t\t);\n\n\t\tconst miscBuffOptions = relevantStatOptions(BuffDebuffInputs.RAID_BUFFS_MISC_CONFIG, this.simUI);\n\t\tif (miscBuffOptions.length > 0) {\n\t\t\tnew MultiIconPicker(\n\t\t\t\tcontentBlock.bodyElement,\n\t\t\t\tthis.simUI.player,\n\t\t\t\t{\n\t\t\t\t\tinputs: miscBuffOptions.map(option => option.config),\n\t\t\t\t\tlabel: 'Misc',\n\t\t\t\t},\n\t\t\t\tthis.simUI,\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate buildDebuffsSettings() {\n\t\tconst contentBlock = new ContentBlock(this.column3, 'debuffs-settings', {\n\t\t\theader: { title: 'Debuffs', tooltip: Tooltips.DEBUFFS_SECTION },\n\t\t});\n\n\t\tconst debuffOptions = relevantStatOptions(BuffDebuffInputs.DEBUFFS_CONFIG, this.simUI);\n\t\tthis.configureIconSection(\n\t\t\tcontentBlock.bodyElement,\n\t\t\tdebuffOptions.map(options => options.picker && new options.picker(contentBlock.bodyElement, this.simUI.player, options.config as any, this.simUI)),\n\t\t);\n\n\t\tconst miscDebuffOptions = relevantStatOptions(BuffDebuffInputs.DEBUFFS_MISC_CONFIG, this.simUI);\n\t\tif (miscDebuffOptions.length) {\n\t\t\tnew MultiIconPicker(\n\t\t\t\tcontentBlock.bodyElement,\n\t\t\t\tthis.simUI.player,\n\t\t\t\t{\n\t\t\t\t\tinputs: miscDebuffOptions.map(options => options.config),\n\t\t\t\t\tlabel: 'Misc',\n\t\t\t\t},\n\t\t\t\tthis.simUI,\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate buildSavedDataPickers() {\n\t\tconst savedEncounterManager = new SavedDataManager<Encounter, SavedEncounter>(this.rightPanel, this.simUI.sim.encounter, {\n\t\t\tlabel: 'Encounter',\n\t\t\theader: { title: 'Saved Encounters' },\n\t\t\tstorageKey: this.simUI.getSavedEncounterStorageKey(),\n\t\t\tgetData: (encounter: Encounter) => SavedEncounter.create({ encounter: encounter.toProto() }),\n\t\t\tsetData: (eventID: EventID, encounter: Encounter, newEncounter: SavedEncounter) => encounter.fromProto(eventID, newEncounter.encounter!),\n\t\t\tchangeEmitters: [this.simUI.sim.encounter.changeEmitter],\n\t\t\tequals: (a: SavedEncounter, b: SavedEncounter) => SavedEncounter.equals(a, b),\n\t\t\ttoJson: (a: SavedEncounter) => SavedEncounter.toJson(a),\n\t\t\tfromJson: (obj: any) => SavedEncounter.fromJson(obj),\n\t\t});\n\n\t\tconst savedSettingsManager = new SavedDataManager<IndividualSimUI<any>, SavedSettings>(this.rightPanel, this.simUI, {\n\t\t\tlabel: 'Settings',\n\t\t\theader: { title: 'Saved Settings' },\n\t\t\tstorageKey: this.simUI.getSavedSettingsStorageKey(),\n\t\t\tgetData: (simUI: IndividualSimUI<any>) => {\n\t\t\t\tconst player = simUI.player;\n\t\t\t\treturn SavedSettings.create({\n\t\t\t\t\traidBuffs: simUI.sim.raid.getBuffs(),\n\t\t\t\t\tpartyBuffs: player.getParty()?.getBuffs() || PartyBuffs.create(),\n\t\t\t\t\tplayerBuffs: player.getBuffs(),\n\t\t\t\t\tdebuffs: simUI.sim.raid.getDebuffs(),\n\t\t\t\t\tconsumes: player.getConsumes(),\n\t\t\t\t\trace: player.getRace(),\n\t\t\t\t\tprofessions: player.getProfessions(),\n\t\t\t\t\tenableItemSwap: player.getEnableItemSwap(),\n\t\t\t\t\titemSwap: player.getItemSwapGear().toProto(),\n\t\t\t\t\treactionTimeMs: player.getReactionTime(),\n\t\t\t\t\tchannelClipDelayMs: player.getChannelClipDelay(),\n\t\t\t\t\tinFrontOfTarget: player.getInFrontOfTarget(),\n\t\t\t\t\tdistanceFromTarget: player.getDistanceFromTarget(),\n\t\t\t\t\thealingModel: player.getHealingModel(),\n\t\t\t\t\tdarkIntentUptime: player.getDarkIntentUptime(),\n\t\t\t\t});\n\t\t\t},\n\t\t\tsetData: (eventID: EventID, simUI: IndividualSimUI<any>, newSettings: SavedSettings) => {\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\t\tsimUI.sim.raid.setBuffs(eventID, newSettings.raidBuffs || RaidBuffs.create());\n\t\t\t\t\tsimUI.sim.raid.setDebuffs(eventID, newSettings.debuffs || Debuffs.create());\n\t\t\t\t\tconst party = simUI.player.getParty();\n\t\t\t\t\tif (party) {\n\t\t\t\t\t\tparty.setBuffs(eventID, newSettings.partyBuffs || PartyBuffs.create());\n\t\t\t\t\t}\n\t\t\t\t\tsimUI.player.setBuffs(eventID, newSettings.playerBuffs || IndividualBuffs.create());\n\t\t\t\t\tsimUI.player.setConsumes(eventID, newSettings.consumes || Consumes.create());\n\t\t\t\t\tsimUI.player.setRace(eventID, newSettings.race);\n\t\t\t\t\tsimUI.player.setProfessions(eventID, newSettings.professions);\n\t\t\t\t\tsimUI.player.setEnableItemSwap(eventID, newSettings.enableItemSwap);\n\t\t\t\t\tsimUI.player.setItemSwapGear(eventID, simUI.sim.db.lookupItemSwap(newSettings.itemSwap || ItemSwap.create()));\n\t\t\t\t\tsimUI.player.setReactionTime(eventID, newSettings.reactionTimeMs);\n\t\t\t\t\tsimUI.player.setChannelClipDelay(eventID, newSettings.channelClipDelayMs);\n\t\t\t\t\tsimUI.player.setInFrontOfTarget(eventID, newSettings.inFrontOfTarget);\n\t\t\t\t\tsimUI.player.setDistanceFromTarget(eventID, newSettings.distanceFromTarget);\n\t\t\t\t\tsimUI.player.setHealingModel(eventID, newSettings.healingModel || HealingModel.create());\n\t\t\t\t\tsimUI.player.setDarkIntentUptime(eventID, newSettings.darkIntentUptime);\n\t\t\t\t});\n\t\t\t},\n\t\t\tchangeEmitters: [\n\t\t\t\tthis.simUI.sim.raid.buffsChangeEmitter,\n\t\t\t\tthis.simUI.sim.raid.debuffsChangeEmitter,\n\t\t\t\tthis.simUI.player.getParty()!.buffsChangeEmitter,\n\t\t\t\tthis.simUI.player.buffsChangeEmitter,\n\t\t\t\tthis.simUI.player.consumesChangeEmitter,\n\t\t\t\tthis.simUI.player.raceChangeEmitter,\n\t\t\t\tthis.simUI.player.professionChangeEmitter,\n\t\t\t\tthis.simUI.player.itemSwapChangeEmitter,\n\t\t\t\tthis.simUI.player.miscOptionsChangeEmitter,\n\t\t\t\tthis.simUI.player.inFrontOfTargetChangeEmitter,\n\t\t\t\tthis.simUI.player.distanceFromTargetChangeEmitter,\n\t\t\t\tthis.simUI.player.healingModelChangeEmitter,\n\t\t\t],\n\t\t\tequals: (a: SavedSettings, b: SavedSettings) => SavedSettings.equals(a, b),\n\t\t\ttoJson: (a: SavedSettings) => SavedSettings.toJson(a),\n\t\t\tfromJson: (obj: any) => SavedSettings.fromJson(obj),\n\t\t});\n\n\t\tthis.simUI.sim.waitForInit().then(() => {\n\t\t\tsavedEncounterManager.loadUserData();\n\t\t\tsavedSettingsManager.loadUserData();\n\t\t});\n\t}\n\n\tprivate configureInputSection(sectionElem: HTMLElement, sectionConfig: InputSection) {\n\t\tsectionConfig.inputs.forEach(inputConfig => {\n\t\t\tif (inputConfig.type == 'number') {\n\t\t\t\tnew NumberPicker(sectionElem, this.simUI.player, inputConfig);\n\t\t\t} else if (inputConfig.type == 'boolean') {\n\t\t\t\tnew BooleanPicker(sectionElem, this.simUI.player, { ...inputConfig, reverse: true });\n\t\t\t} else if (inputConfig.type == 'enum') {\n\t\t\t\tnew EnumPicker(sectionElem, this.simUI.player, inputConfig);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate configureIconSection(sectionElem: HTMLElement, iconPickers: Array<any>, adjustColumns?: boolean) {\n\t\tif (iconPickers.length == 0) {\n\t\t\tsectionElem.classList.add('hide');\n\t\t} else if (adjustColumns) {\n\t\t\tif (iconPickers.length <= 4) {\n\t\t\t\tsectionElem.style.gridTemplateColumns = `repeat(${iconPickers.length}, 1fr)`;\n\t\t\t} else if (iconPickers.length > 4 && iconPickers.length < 8) {\n\t\t\t\tsectionElem.style.gridTemplateColumns = `repeat(${Math.ceil(iconPickers.length / 2)}, 1fr)`;\n\t\t\t}\n\t\t}\n\t}\n}\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { element } from 'tsx-vanilla';\n\nimport { Component } from '../components/component.js';\nimport { IconEnumPicker } from '../components/icon_enum_picker';\nimport * as InputHelpers from '../components/input_helpers.js';\nimport { SavedDataManager } from '../components/saved_data_manager.js';\nimport { Player } from '../player.js';\nimport { Spec } from '../proto/common';\nimport { HunterOptions_PetType as PetType, HunterPetTalents } from '../proto/hunter.js';\nimport { ActionId } from '../proto_utils/action_id.js';\nimport { getTalentTree, getTalentTreePoints, HunterSpecs } from '../proto_utils/utils.js';\nimport { SimUI } from '../sim_ui.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { protoToTalentString, talentStringToProto } from './factory.js';\nimport { newTalentsConfig, TalentsConfig, TalentsPicker } from './talents_picker.jsx';\nimport HunterPetCunningJson from './trees/hunter_cunning.json';\nimport HunterPetFerocityJson from './trees/hunter_ferocity.json';\nimport HunterPetTenacityJson from './trees/hunter_tenacity.json';\n\nexport function makePetTypeInputConfig<SpecType extends HunterSpecs>(): InputHelpers.TypedIconEnumPickerConfig<Player<SpecType>, PetType> {\n\treturn InputHelpers.makeClassOptionsEnumIconInput<SpecType, PetType>({\n\t\textraCssClasses: ['pet-type-picker'],\n\t\tfieldName: 'petType',\n\t\tnumColumns: 5,\n\t\tvalues: [\n\t\t\t{ value: PetType.PetNone, tooltip: 'No Pet' },\n\t\t\t{ actionId: ActionId.fromPetName('Bat'), tooltip: 'Bat', value: PetType.Bat },\n\t\t\t{ actionId: ActionId.fromPetName('Bear'), tooltip: 'Bear', value: PetType.Bear },\n\t\t\t{ actionId: ActionId.fromPetName('Bird of Prey'), tooltip: 'Bird of Prey', value: PetType.BirdOfPrey },\n\t\t\t{ actionId: ActionId.fromPetName('Boar'), tooltip: 'Boar', value: PetType.Boar },\n\t\t\t{ actionId: ActionId.fromPetName('Carrion Bird'), tooltip: 'Carrion Bird', value: PetType.CarrionBird },\n\t\t\t{ actionId: ActionId.fromPetName('Cat'), tooltip: 'Cat', value: PetType.Cat },\n\t\t\t{ actionId: ActionId.fromPetName('Chimaera'), tooltip: 'Chimaera (Exotic)', value: PetType.Chimaera },\n\t\t\t{ actionId: ActionId.fromPetName('Core Hound'), tooltip: 'Core Hound (Exotic)', value: PetType.CoreHound },\n\t\t\t{ actionId: ActionId.fromPetName('Crab'), tooltip: 'Crab', value: PetType.Crab },\n\t\t\t{ actionId: ActionId.fromPetName('Crocolisk'), tooltip: 'Crocolisk', value: PetType.Crocolisk },\n\t\t\t{ actionId: ActionId.fromPetName('Devilsaur'), tooltip: 'Devilsaur (Exotic)', value: PetType.Devilsaur },\n\t\t\t{ actionId: ActionId.fromPetName('Dragonhawk'), tooltip: 'Dragonhawk', value: PetType.Dragonhawk },\n\t\t\t{ actionId: ActionId.fromPetName('Gorilla'), tooltip: 'Gorilla', value: PetType.Gorilla },\n\t\t\t{ actionId: ActionId.fromPetName('Hyena'), tooltip: 'Hyena', value: PetType.Hyena },\n\t\t\t{ actionId: ActionId.fromPetName('Moth'), tooltip: 'Moth', value: PetType.Moth },\n\t\t\t{ actionId: ActionId.fromPetName('Nether Ray'), tooltip: 'Nether Ray', value: PetType.NetherRay },\n\t\t\t{ actionId: ActionId.fromPetName('Raptor'), tooltip: 'Raptor', value: PetType.Raptor },\n\t\t\t{ actionId: ActionId.fromPetName('Ravager'), tooltip: 'Ravager', value: PetType.Ravager },\n\t\t\t{ actionId: ActionId.fromPetName('Rhino'), tooltip: 'Rhino', value: PetType.Rhino },\n\t\t\t{ actionId: ActionId.fromPetName('Scorpid'), tooltip: 'Scorpid', value: PetType.Scorpid },\n\t\t\t{ actionId: ActionId.fromPetName('Serpent'), tooltip: 'Serpent', value: PetType.Serpent },\n\t\t\t{ actionId: ActionId.fromPetName('Silithid'), tooltip: 'Silithid (Exotic)', value: PetType.Silithid },\n\t\t\t{ actionId: ActionId.fromPetName('Spider'), tooltip: 'Spider', value: PetType.Spider },\n\t\t\t{ actionId: ActionId.fromPetName('Spirit Beast'), tooltip: 'Spirit Beast (Exotic)', value: PetType.SpiritBeast },\n\t\t\t{ actionId: ActionId.fromPetName('Spore Bat'), tooltip: 'Spore Bat', value: PetType.SporeBat },\n\t\t\t{ actionId: ActionId.fromPetName('Tallstrider'), tooltip: 'Tallstrider', value: PetType.Tallstrider },\n\t\t\t{ actionId: ActionId.fromPetName('Turtle'), tooltip: 'Turtle', value: PetType.Turtle },\n\t\t\t{ actionId: ActionId.fromPetName('Warp Stalker'), tooltip: 'Warp Stalker', value: PetType.WarpStalker },\n\t\t\t{ actionId: ActionId.fromPetName('Wasp'), tooltip: 'Wasp', value: PetType.Wasp },\n\t\t\t{ actionId: ActionId.fromPetName('Wind Serpent'), tooltip: 'Wind Serpent', value: PetType.WindSerpent },\n\t\t\t{ actionId: ActionId.fromPetName('Wolf'), tooltip: 'Wolf', value: PetType.Wolf },\n\t\t\t{ actionId: ActionId.fromPetName('Worm'), tooltip: 'Worm (Exotic)', value: PetType.Worm },\n\t\t],\n\t});\n}\n\nenum PetCategory {\n\tCunning,\n\tFerocity,\n\tTenacity,\n}\n\nconst petCategories: Record<PetType, PetCategory> = {\n\t[PetType.PetNone]: PetCategory.Ferocity,\n\t[PetType.Bat]: PetCategory.Cunning,\n\t[PetType.Bear]: PetCategory.Tenacity,\n\t[PetType.BirdOfPrey]: PetCategory.Cunning,\n\t[PetType.Boar]: PetCategory.Tenacity,\n\t[PetType.CarrionBird]: PetCategory.Ferocity,\n\t[PetType.Cat]: PetCategory.Ferocity,\n\t[PetType.Chimaera]: PetCategory.Cunning,\n\t[PetType.CoreHound]: PetCategory.Ferocity,\n\t[PetType.Crab]: PetCategory.Tenacity,\n\t[PetType.Crocolisk]: PetCategory.Tenacity,\n\t[PetType.Devilsaur]: PetCategory.Ferocity,\n\t[PetType.Dragonhawk]: PetCategory.Cunning,\n\t[PetType.Gorilla]: PetCategory.Tenacity,\n\t[PetType.Hyena]: PetCategory.Ferocity,\n\t[PetType.Moth]: PetCategory.Ferocity,\n\t[PetType.NetherRay]: PetCategory.Cunning,\n\t[PetType.Raptor]: PetCategory.Ferocity,\n\t[PetType.Ravager]: PetCategory.Cunning,\n\t[PetType.Rhino]: PetCategory.Tenacity,\n\t[PetType.Scorpid]: PetCategory.Tenacity,\n\t[PetType.Serpent]: PetCategory.Cunning,\n\t[PetType.Silithid]: PetCategory.Cunning,\n\t[PetType.Spider]: PetCategory.Cunning,\n\t[PetType.SpiritBeast]: PetCategory.Ferocity,\n\t[PetType.SporeBat]: PetCategory.Cunning,\n\t[PetType.Tallstrider]: PetCategory.Ferocity,\n\t[PetType.Turtle]: PetCategory.Tenacity,\n\t[PetType.WarpStalker]: PetCategory.Tenacity,\n\t[PetType.Wasp]: PetCategory.Ferocity,\n\t[PetType.WindSerpent]: PetCategory.Cunning,\n\t[PetType.Wolf]: PetCategory.Ferocity,\n\t[PetType.Worm]: PetCategory.Tenacity,\n};\n\nconst categoryOrder = [PetCategory.Cunning, PetCategory.Ferocity, PetCategory.Tenacity];\nconst categoryClasses = ['cunning', 'ferocity', 'tenacity'];\n\nexport function getPetTalentsConfig(petType: PetType): TalentsConfig<HunterPetTalents> {\n\tconst petCategory = petCategories[petType];\n\tconst categoryIdx = categoryOrder.indexOf(petCategory);\n\treturn petTalentsConfig[categoryIdx];\n}\n\nexport const cunningDefault: HunterPetTalents = HunterPetTalents.create({\n\tserpentSwiftness: 2,\n\tdive: true,\n\towlsFocus: 2,\n\tspikedCollar: 3,\n\tcullingTheHerd: 3,\n\tfeedingFrenzy: 2,\n\troarOfRecovery: true,\n\twolverineBite: true,\n\twildHunt: 2,\n});\nexport const ferocityDefault: HunterPetTalents = HunterPetTalents.create({\n\tserpentSwiftness: 2,\n\tdive: true,\n\tspikedCollar: 3,\n\tbloodthirsty: 1,\n\tcullingTheHerd: 3,\n\tspidersBite: 3,\n\trabid: true,\n\tcallOfTheWild: true,\n\tsharkAttack: 2,\n});\nexport const tenacityDefault: HunterPetTalents = HunterPetTalents.create({\n\tserpentSwiftness: 2,\n\tcharge: true,\n\tspikedCollar: 3,\n\tboarsSpeed: true,\n\tcullingTheHerd: 3,\n\tthunderstomp: true,\n\tgraceOfTheMantis: 2,\n\troarOfSacrifice: true,\n\tintervene: true,\n\twildHunt: 2,\n});\nconst defaultTalents = [cunningDefault, ferocityDefault, tenacityDefault];\n\nexport const cunningBMDefault: HunterPetTalents = HunterPetTalents.create({\n\tserpentSwiftness: 2,\n\tdive: true,\n\towlsFocus: 2,\n\tspikedCollar: 3,\n\tcullingTheHerd: 3,\n\tfeedingFrenzy: 2,\n\troarOfRecovery: true,\n\twolverineBite: true,\n\twildHunt: 2,\n});\nexport const ferocityBMDefault: HunterPetTalents = HunterPetTalents.create({\n\tserpentSwiftness: 2,\n\tdive: true,\n\tspikedCollar: 3,\n\tbloodthirsty: 1,\n\tcullingTheHerd: 3,\n\tspidersBite: 3,\n\trabid: true,\n\tcallOfTheWild: true,\n\tsharkAttack: 2,\n});\nexport const tenacityBMDefault: HunterPetTalents = HunterPetTalents.create({\n\tserpentSwiftness: 2,\n\tcharge: true,\n\tspikedCollar: 3,\n\tboarsSpeed: true,\n\tcullingTheHerd: 3,\n\tthunderstomp: true,\n\tgraceOfTheMantis: 2,\n\troarOfSacrifice: true,\n\tintervene: true,\n\twildHunt: 2,\n});\nconst defaultBMTalents = [cunningBMDefault, ferocityBMDefault, tenacityBMDefault];\n\nexport const cunningPetTalentsConfig: TalentsConfig<HunterPetTalents> = newTalentsConfig(HunterPetCunningJson);\nexport const ferocityPetTalentsConfig: TalentsConfig<HunterPetTalents> = newTalentsConfig(HunterPetFerocityJson);\nexport const tenacityPetTalentsConfig: TalentsConfig<HunterPetTalents> = newTalentsConfig(HunterPetTenacityJson);\n\nexport const petTalentsConfig = [cunningPetTalentsConfig, ferocityPetTalentsConfig, tenacityPetTalentsConfig];\n\nexport class HunterPet<SpecType extends HunterSpecs> {\n\treadonly player: Player<SpecType>;\n\n\tprivate talents: HunterPetTalents;\n\tprivate talentsConfig: TalentsConfig<HunterPetTalents>;\n\tprivate talentsString: string;\n\n\treadonly talentsChangeEmitter: TypedEvent<void>;\n\n\tconstructor(player: Player<SpecType>) {\n\t\tthis.player = player;\n\t\tthis.talents = player.getClassOptions().petTalents ?? HunterPetTalents.create();\n\t\tthis.talentsConfig = getPetTalentsConfig(player.getClassOptions().petType);\n\t\tthis.talentsString = protoToTalentString(this.talents, this.talentsConfig);\n\t\tthis.talentsChangeEmitter = this.player.specOptionsChangeEmitter;\n\t}\n\n\tgetTalents(): HunterPetTalents {\n\t\treturn this.talents;\n\t}\n\n\tgetTalentsString(): string {\n\t\treturn protoToTalentString(this.talents, this.talentsConfig);\n\t}\n\n\tsetTalentsString(eventID: EventID, newTalentsString: string) {\n\t\tif (newTalentsString == this.talentsString) return;\n\n\t\tconst options = this.player.getClassOptions();\n\t\toptions.petTalents = talentStringToProto(HunterPetTalents.create(), newTalentsString, this.talentsConfig);\n\n\t\tthis.talents = options.petTalents;\n\t\tthis.talentsString = newTalentsString;\n\t\tthis.player.setClassOptions(eventID, options);\n\t}\n\n\tgetTalentTree(): number {\n\t\treturn getTalentTree(this.getTalentsString());\n\t}\n\n\tgetTalentTreePoints(): Array<number> {\n\t\treturn getTalentTreePoints(this.getTalentsString());\n\t}\n}\n\nexport class HunterPetTalentsPicker<SpecType extends HunterSpecs> extends Component {\n\tprivate readonly simUI: SimUI;\n\tprivate readonly player: Player<SpecType>;\n\tprivate curCategory: PetCategory | null;\n\tprivate curTalents: HunterPetTalents;\n\n\t// Not saved to storage, just holds last-used values for this session.\n\tprivate savedSets: Array<HunterPetTalents>;\n\n\tconstructor(parent: HTMLElement, simUI: SimUI, player: Player<SpecType>) {\n\t\tsuper(parent, 'hunter-pet-talents-picker');\n\t\tthis.simUI = simUI;\n\t\tthis.player = player;\n\n\t\tthis.curCategory = this.getCategoryFromPlayer();\n\t\tthis.curTalents = this.getPetTalentsFromPlayer();\n\t\tthis.savedSets = defaultTalents.slice();\n\t\tthis.savedSets[this.curCategory] = this.curTalents;\n\n\t\tthis.rootElem.classList.add(categoryClasses[this.curCategory]);\n\n\t\tconst talentsContainer = <div className=\"pet-talents-container\" />;\n\t\tthis.rootElem.appendChild(talentsContainer);\n\n\t\tsimUI.sim.waitForInit().then(() => {\n\t\t\tconst pet = new HunterPet(player);\n\t\t\tcategoryOrder.map((_category, i) => {\n\t\t\t\tconst pickerContainer = document.createElement('div');\n\t\t\t\tpickerContainer.classList.add('hunter-pet-talents-' + categoryClasses[i]);\n\t\t\t\ttalentsContainer.appendChild(pickerContainer);\n\n\t\t\t\tconst talentsConfig = petTalentsConfig[i];\n\t\t\t\tconst picker = new TalentsPicker(pickerContainer, pet, {\n\t\t\t\t\tklass: player.getClass(),\n\t\t\t\t\ttrees: talentsConfig,\n\t\t\t\t\tchangedEvent: (pet: HunterPet<SpecType>) => pet.player.specOptionsChangeEmitter,\n\t\t\t\t\tgetValue: (pet: HunterPet<SpecType>) => pet.getTalentsString(),\n\t\t\t\t\tsetValue: (eventID: EventID, pet: HunterPet<SpecType>, newValue: string) => {\n\t\t\t\t\t\tpet.setTalentsString(eventID, newValue);\n\t\t\t\t\t\tthis.savedSets[i] = pet.getTalents();\n\t\t\t\t\t\tthis.curTalents = pet.getTalents();\n\t\t\t\t\t},\n\t\t\t\t\tpointsPerRow: 3,\n\t\t\t\t});\n\n\t\t\t\treturn picker;\n\t\t\t});\n\t\t});\n\n\t\tnew IconEnumPicker(this.rootElem, this.player, makePetTypeInputConfig());\n\n\t\tplayer.specOptionsChangeEmitter.on(() => {\n\t\t\tconst petCategory = this.getCategoryFromPlayer();\n\t\t\tconst categoryIdx = categoryOrder.indexOf(petCategory);\n\t\t\tconsole.log('should change pet talents', petCategory);\n\n\t\t\tif (petCategory != this.curCategory) {\n\t\t\t\tthis.curCategory = petCategory;\n\t\t\t\tthis.rootElem.classList.remove(...categoryClasses);\n\t\t\t\tthis.rootElem.classList.add(categoryClasses[categoryIdx]);\n\n\t\t\t\tconst curTalents = this.getPetTalentsFromPlayer();\n\t\t\t\tconsole.log(curTalents);\n\t\t\t\tif (!HunterPetTalents.equals(curTalents, this.curTalents)) {\n\t\t\t\t\t// If the current talents have also changed, this was probably a load so we shouldn't switch sets.\n\t\t\t\t\tthis.curTalents = curTalents;\n\t\t\t\t\tthis.savedSets[this.curCategory] = this.curTalents;\n\t\t\t\t} else {\n\t\t\t\t\t// Revert to the talents from last time the user was editing this category.\n\t\t\t\t\tconst options = this.player.getClassOptions();\n\t\t\t\t\toptions.petTalents = this.savedSets[this.curCategory];\n\t\t\t\t\tthis.player.setClassOptions(TypedEvent.nextEventID(), options);\n\t\t\t\t\tthis.curTalents = options.petTalents;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tgetPetTalentsFromPlayer(): HunterPetTalents {\n\t\treturn this.player.getClassOptions().petTalents || HunterPetTalents.create();\n\t}\n\n\tgetCategoryFromPlayer(): PetCategory {\n\t\tconst petType = this.player.getClassOptions().petType;\n\t\treturn petCategories[petType];\n\t}\n}\n","import { IndividualSimUI } from '../../individual_sim_ui';\nimport { Player } from '../../player';\nimport { Class, Glyphs, Spec } from '../../proto/common';\nimport { SavedTalents } from '../../proto/ui';\nimport { classTalentsConfig } from '../../talents/factory';\nimport { HunterPetTalentsPicker } from '../../talents/hunter_pet';\nimport { TalentsPicker } from '../../talents/talents_picker';\nimport { EventID, TypedEvent } from '../../typed_event';\nimport { SavedDataManager } from '../saved_data_manager';\nimport { SimTab } from '../sim_tab';\n\nexport class TalentsTab<SpecType extends Spec> extends SimTab {\n\tprotected simUI: IndividualSimUI<SpecType>;\n\n\treadonly leftPanel: HTMLElement;\n\treadonly rightPanel: HTMLElement;\n\n\tconstructor(parentElem: HTMLElement, simUI: IndividualSimUI<SpecType>) {\n\t\tsuper(parentElem, simUI, { identifier: 'talents-tab', title: 'Talents' });\n\t\tthis.simUI = simUI;\n\n\t\tthis.leftPanel = document.createElement('div');\n\t\tthis.leftPanel.classList.add('talents-tab-left', 'tab-panel-left');\n\t\tthis.rightPanel = document.createElement('div');\n\t\tthis.rightPanel.classList.add('talents-tab-right', 'tab-panel-right', 'within-raid-sim-hide');\n\n\t\tthis.contentContainer.appendChild(this.leftPanel);\n\t\tthis.contentContainer.appendChild(this.rightPanel);\n\n\t\tthis.buildTabContent();\n\t}\n\n\tprotected buildTabContent() {\n\t\tif (this.simUI.player.getClass() == Class.ClassHunter) {\n\t\t\tthis.buildHunterPickers();\n\t\t} else {\n\t\t\tthis.buildTalentsPicker(this.leftPanel);\n\t\t}\n\n\t\tthis.buildSavedTalentsPicker();\n\t}\n\n\tprivate buildTalentsPicker(parentElem: HTMLElement) {\n\t\tnew TalentsPicker(parentElem, this.simUI.player, {\n\t\t\tklass: this.simUI.player.getClass(),\n\t\t\ttrees: classTalentsConfig[this.simUI.player.getClass()],\n\t\t\tchangedEvent: (player: Player<any>) => player.talentsChangeEmitter,\n\t\t\tgetValue: (player: Player<any>) => player.getTalentsString(),\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: string) => {\n\t\t\t\tplayer.setTalentsString(eventID, newValue);\n\t\t\t},\n\t\t\tpointsPerRow: 5,\n\t\t});\n\t}\n\n\tprivate buildHunterPickers() {\n\t\tthis.leftPanel.innerHTML = `\n      <div class=\"hunter-talents-pickers-container tab-content\">\n        <ul class=\"nav nav-tabs\" role=\"tablist\">\n          <li class=\"nav-item\" role=\"presentation\">\n            <a\n              class=\"nav-link active\"\n              type=\"button\"\n              role=\"tab\"\n              data-bs-toggle=\"tab\"\n              data-bs-target=\"#player-talents-tab\"\n              aria-controls=\"#player-talents-tab\"\n              aria-selected=\"true\"\n            >\n              Player\n            </a>\n          </li>\n          <li class=\"nav-item\" role=\"presentation\">\n            <a\n              class=\"nav-link\"\n              type=\"button\"\n              role=\"tab\"\n              data-bs-toggle=\"tab\"\n              data-bs-target=\"#pet-talents-tab\"\n              aria-controls=\"#pet-talents-tab\"\n              aria-selected=\"false\"\n            >\n              Pet</a\n            >\n          </li>\n        </ul>\n        <div id=\"player-talents-tab\" class=\"tab-pane fade active show\" role=\"tabpanel\">\n        </div>\n        <div id=\"pet-talents-tab\" class=\"tab-pane fade\" role=\"tabpanel\">\n        </div>\n      </div>\n    `;\n\n\t\tconst playerTab = this.leftPanel.querySelector('#player-talents-tab') as HTMLElement;\n\t\tconst petTab = this.leftPanel.querySelector('#pet-talents-tab') as HTMLElement;\n\n\t\tthis.buildTalentsPicker(playerTab);\n\t\tthis.buildHunterPetPicker(petTab);\n\t}\n\n\tprivate buildHunterPetPicker(parentElem: HTMLElement) {\n\t\tif (this.simUI.player.isClass(Class.ClassHunter)) {\n\t\t\tnew HunterPetTalentsPicker(parentElem, this.simUI, this.simUI.player);\n\t\t}\n\t}\n\n\tprivate buildSavedTalentsPicker() {\n\t\tconst savedTalentsManager = new SavedDataManager<Player<any>, SavedTalents>(this.rightPanel, this.simUI.player, {\n\t\t\tlabel: 'Talents',\n\t\t\theader: { title: 'Saved Talents' },\n\t\t\tstorageKey: this.simUI.getSavedTalentsStorageKey(),\n\t\t\tgetData: (player: Player<any>) =>\n\t\t\t\tSavedTalents.create({\n\t\t\t\t\ttalentsString: player.getTalentsString(),\n\t\t\t\t\tglyphs: player.getGlyphs(),\n\t\t\t\t}),\n\t\t\tsetData: (eventID: EventID, player: Player<any>, newTalents: SavedTalents) => {\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\t\tplayer.setTalentsString(eventID, newTalents.talentsString);\n\t\t\t\t\tplayer.setGlyphs(eventID, newTalents.glyphs || Glyphs.create());\n\t\t\t\t});\n\t\t\t},\n\t\t\tchangeEmitters: [this.simUI.player.talentsChangeEmitter, this.simUI.player.glyphsChangeEmitter],\n\t\t\tequals: (a: SavedTalents, b: SavedTalents) => SavedTalents.equals(a, b),\n\t\t\ttoJson: (a: SavedTalents) => SavedTalents.toJson(a),\n\t\t\tfromJson: (obj: any) => SavedTalents.fromJson(obj),\n\t\t});\n\n\t\tthis.simUI.sim.waitForInit().then(() => {\n\t\t\tsavedTalentsManager.loadUserData();\n\t\t\tthis.simUI.individualConfig.presets.talents.forEach(config => {\n\t\t\t\tconfig.isPreset = true;\n\t\t\t\tsavedTalentsManager.addSavedData({\n\t\t\t\t\tname: config.name,\n\t\t\t\t\tisPreset: true,\n\t\t\t\t\tdata: config.data,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n}\n","import { Tooltip } from 'bootstrap';\n\nimport { BooleanPicker } from '../components/boolean_picker.js';\nimport { NumberPicker } from '../components/number_picker.js';\nimport { IndividualSimUI } from '../individual_sim_ui.js';\nimport { Player } from '../player.js';\nimport { ProgressMetrics, StatWeightsResult, StatWeightValues } from '../proto/api.js';\nimport { GemColor, ItemSlot, Profession, PseudoStat, Stat, UnitStats } from '../proto/common.js';\nimport { UIGem as Gem } from '../proto/ui.js';\nimport { Gear } from '../proto_utils/gear.js';\nimport * as Gems from '../proto_utils/gems.js';\nimport { getClassStatName } from '../proto_utils/names.js';\nimport { Stats, UnitStat } from '../proto_utils/stats.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { combinationsWithDups, permutations, stDevToConf90, sum } from '../utils.js';\nimport { BaseModal } from './base_modal.js';\nimport { ResultsViewer } from './results_viewer.js';\n\nexport function addStatWeightsAction(simUI: IndividualSimUI<any>, epStats: Array<Stat>, epPseudoStats: Array<PseudoStat> | undefined, epReferenceStat: Stat) {\n\tsimUI.addAction('Stat Weights', 'ep-weights-action', () => {\n\t\tnew EpWeightsMenu(simUI, epStats, epPseudoStats || [], epReferenceStat);\n\t});\n}\n\n// Create the config for modal in separate function, as constructor cannot\n// contain any logic before `super' call. Use modal-xl to accommodate the extra\n// TMI & p(death) EP in the UI.\nfunction getModalConfig(simUI: IndividualSimUI<any>) {\n\tconst baseConfig = { footer: true, scrollContents: true };\n\tif (simUI.sim.getShowThreatMetrics() && simUI.sim.getShowExperimental()) {\n\t\treturn { size: 'xl' as const, ...baseConfig };\n\t}\n\treturn baseConfig;\n}\n\nfunction scaledEpValue(stat: UnitStat, epRatios: number[], result: StatWeightsResult | null): number {\n\tif (!result) return 0;\n\n\treturn (\n\t\tepRatios[0] * stat.getProtoValue(result.dps?.epValues!) +\n\t\tepRatios[1] * stat.getProtoValue(result.hps?.epValues!) +\n\t\tepRatios[2] * stat.getProtoValue(result.tps?.epValues!) +\n\t\tepRatios[3] * stat.getProtoValue(result.dtps?.epValues!) +\n\t\tepRatios[4] * stat.getProtoValue(result.tmi?.epValues!) +\n\t\tepRatios[5] * stat.getProtoValue(result.pDeath?.epValues!)\n\t);\n}\n\nclass EpWeightsMenu extends BaseModal {\n\tprivate readonly simUI: IndividualSimUI<any>;\n\tprivate readonly container: HTMLElement;\n\tprivate readonly table: HTMLElement;\n\tprivate readonly tableBody: HTMLElement;\n\tprivate readonly resultsViewer: ResultsViewer;\n\n\tprivate statsType: string;\n\tprivate epStats: Array<Stat>;\n\tprivate epPseudoStats: Array<PseudoStat>;\n\tprivate epReferenceStat: Stat;\n\tprivate showAllStats = false;\n\n\tconstructor(simUI: IndividualSimUI<any>, epStats: Array<Stat>, epPseudoStats: Array<PseudoStat>, epReferenceStat: Stat) {\n\t\tsuper(simUI.rootElem, 'ep-weights-menu', getModalConfig(simUI));\n\t\tthis.simUI = simUI;\n\t\tthis.statsType = 'ep';\n\t\tthis.epStats = epStats;\n\t\tthis.epPseudoStats = epPseudoStats;\n\t\tthis.epReferenceStat = epReferenceStat;\n\n\t\tthis.header?.insertAdjacentHTML('afterbegin', '<h5 class=\"modal-title\">Calculate Stat Weights</h5>');\n\t\tthis.body.innerHTML = `\n\t\t\t<div class=\"ep-weights-options row\">\n\t\t\t\t<div class=\"col col-sm-3\">\n\t\t\t\t\t<select class=\"ep-type-select form-select\">\n\t\t\t\t\t\t<option value=\"ep\">EP</option>\n\t\t\t\t\t\t<option value=\"weight\">Weights</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"show-all-stats-container col col-sm-3\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"ep-reference-options row experimental\">\n\t\t\t\t<div class=\"col col-sm-4 damage-metrics\">\n\t\t\t\t\t<span>DPS/TPS reference:</span>\n\t\t\t\t\t<select class=\"ref-stat-select form-select damage-metrics\">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"col col-sm-4 healing-metrics\">\n\t\t\t\t\t<span>Healing reference:</span>\n\t\t\t\t\t<select class=\"ref-stat-select form-select healing-metrics\">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"col col-sm-4 threat-metrics\">\n\t\t\t\t\t<span>Mitigation reference:</span>\n\t\t\t\t\t<select class=\"ref-stat-select form-select threat-metrics\">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<p>The above stat selectors control which reference stat is used for EP normalisation for the different EP columns.</p>\n\t\t\t</div>\n\t\t\t<p>The 'Current EP' column displays the values currently used by the item pickers to sort items.</br>\n\t\t\tUse the <a href='javascript:void(0)' class=\"fa fa-copy\"></a> icon above the EPs to use newly calculated EPs.</p>\n\t\t\t<div class=\"results-ep-table-container modal-scroll-table\">\n\t\t\t\t<div class=\"results-pending-overlay\"></div>\n\t\t\t\t<table class=\"results-ep-table\">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>Stat</th>\n\t\t\t\t\t\t\t<th class=\"damage-metrics type-weight\">\n\t\t\t\t\t\t\t\t<span>DPS Weight</span>\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class=\"damage-metrics type-ep\">\n\t\t\t\t\t\t\t\t<span>DPS EP</span>\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class=\"healing-metrics type-weight\">\n\t\t\t\t\t\t\t\t<span>HPS Weight</span>\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class=\"healing-metrics type-ep\">\n\t\t\t\t\t\t\t\t<span>HPS EP</span>\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-weight\">\n\t\t\t\t\t\t\t\t<span>TPS Weight</span>\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-ep\">\n\t\t\t\t\t\t\t\t<span>TPS EP</span>\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-weight\">\n\t\t\t\t\t\t\t\t<span>DTPS Weight</span>\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-ep\">\n\t\t\t\t\t\t\t\t<span>DTPS EP</span>\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-weight experimental\">\n\t\t\t\t\t\t\t\t<span>TMI Weight</span>\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-ep experimental\">\n\t\t\t\t\t\t\t\t<span>TMI EP</span>\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-weight experimental\">\n\t\t\t\t\t\t\t\t<span>Death Weight</span>\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-ep experimental\">\n\t\t\t\t\t\t\t\t<span>Death EP</span>\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th style=\"text-align: center\">\n\t\t\t\t\t\t\t\t<span>Current EP</span>\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\n\t\t\t\t\t\t\t\t\t<i class=\"fas fa-arrows-rotate\"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr class=\"ep-ratios\">\n\t\t\t\t\t\t\t<td>EP Ratio</td>\n\t\t\t\t\t\t\t<td class=\"damage-metrics type-ratio type-weight\">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"damage-metrics type-ratio type-ep\">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"healing-metrics type-ratio type-weight\">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"healing-metrics type-ratio type-ep\">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-weight\">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-ep\">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-weight\">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-ep\">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-weight experimental\">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-ep experimental\">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-weight experimental\">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-ep experimental\">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style=\"text-align: center; vertical-align: middle;\">\n\t\t\t\t\t\t\t\t<button class=\"btn btn-primary compute-ep\">\n\t\t\t\t\t\t\t\t\t<i class=\"fas fa-calculator\"></i>\n\t\t\t\t\t\t\t\t\t<span class=\"not-tiny\">Update </span>EP\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t`;\n\t\tthis.footer!.innerHTML = `\n\t\t\t<button class=\"btn btn-primary optimize-gems experimental me-2\">\n\t\t\t\tOptimize Gems\n\t\t\t</button>\n\t\t\t<button class=\"btn btn-primary calc-weights\">\n\t\t\t\t<i class=\"fas fa-calculator\"></i>\n\t\t\t\tCalculate\n\t\t\t</button>\n\t\t`;\n\n\t\tthis.container = this.rootElem.querySelector('.results-ep-table-container') as HTMLElement;\n\t\tthis.table = this.rootElem.querySelector('.results-ep-table') as HTMLElement;\n\t\tthis.tableBody = this.rootElem.querySelector('.results-ep-table tbody') as HTMLElement;\n\n\t\tconst resultsElem = this.rootElem.querySelector('.results-pending-overlay') as HTMLElement;\n\t\tthis.resultsViewer = new ResultsViewer(resultsElem);\n\n\t\tconst updateType = () => {\n\t\t\tif (this.statsType == 'ep') {\n\t\t\t\tthis.table.classList.remove('stats-type-weight');\n\t\t\t\tthis.table.classList.add('stats-type-ep');\n\t\t\t} else {\n\t\t\t\tthis.table.classList.add('stats-type-weight');\n\t\t\t\tthis.table.classList.remove('stats-type-ep');\n\t\t\t}\n\t\t};\n\n\t\tconst selectElem = this.rootElem.getElementsByClassName('ep-type-select')[0] as HTMLSelectElement;\n\t\tselectElem.addEventListener('input', event => {\n\t\t\tthis.statsType = selectElem.value;\n\t\t\tupdateType();\n\t\t});\n\t\tselectElem.value = this.statsType;\n\t\tupdateType();\n\n\t\tconst getNameFromStat = (stat: Stat | undefined) => {\n\t\t\treturn stat !== undefined ? getClassStatName(stat, this.simUI.player.getClass()) : '??';\n\t\t};\n\n\t\tconst getStatFromName = (value: string) => {\n\t\t\tfor (const stat of this.epStats) {\n\t\t\t\tif (getNameFromStat(stat) == value) {\n\t\t\t\t\treturn stat;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t};\n\n\t\tconst updateEpRefStat = () => {\n\t\t\tthis.simUI.player.epRefStatChangeEmitter.emit(TypedEvent.nextEventID());\n\t\t\tthis.simUI.prevEpSimResult = this.calculateEp(this.getPrevSimResult());\n\t\t\tthis.updateTable();\n\t\t};\n\n\t\tconst epRefSelects = this.rootElem.querySelectorAll('.ref-stat-select') as NodeListOf<HTMLSelectElement>;\n\t\tepRefSelects.forEach((epSelect: HTMLSelectElement, idx: number) => {\n\t\t\tthis.epStats.forEach(stat => {\n\t\t\t\tepSelect.options[epSelect.options.length] = new Option(getNameFromStat(stat));\n\t\t\t});\n\t\t\tif (epSelect.classList.contains('damage-metrics')) {\n\t\t\t\tepSelect.addEventListener('input', event => {\n\t\t\t\t\tthis.simUI.dpsRefStat = getStatFromName(epSelect.value);\n\t\t\t\t\tupdateEpRefStat();\n\t\t\t\t});\n\t\t\t\tepSelect.value = getNameFromStat(this.getDpsEpRefStat());\n\t\t\t} else if (epSelect.classList.contains('healing-metrics')) {\n\t\t\t\tepSelect.addEventListener('input', event => {\n\t\t\t\t\tthis.simUI.healRefStat = getStatFromName(epSelect.value);\n\t\t\t\t\tupdateEpRefStat();\n\t\t\t\t});\n\t\t\t\tepSelect.value = getNameFromStat(this.getHealEpRefStat());\n\t\t\t} else if (epSelect.classList.contains('threat-metrics')) {\n\t\t\t\tepSelect.addEventListener('input', event => {\n\t\t\t\t\tthis.simUI.tankRefStat = getStatFromName(epSelect.value);\n\t\t\t\t\tupdateEpRefStat();\n\t\t\t\t});\n\t\t\t\tepSelect.value = getNameFromStat(this.getTankEpRefStat());\n\t\t\t}\n\t\t});\n\n\t\tconst optimizeGemsButton = this.rootElem.getElementsByClassName('optimize-gems')[0] as HTMLElement;\n\t\tTooltip.getOrCreateInstance(optimizeGemsButton, {\n\t\t\thtml: true,\n\t\t\ttitle: `<p><span class='warning link-warning'><i class='fa fa-exclamation-triangle'></i> WARNING</span> This feature is experimental, and will not always produce the most optimal gems especially when interacting with soft/hard stat caps.</p>\n\t\t\t<p>Optimizes equipped gems to maximize EP, based on the values in <b>Current EP</b>.</p>\n\t\t\t<p class='mb-0'>Does not change the meta gem, but ensures that its condition is met. Uses JC gems if Jewelcrafting is a selected profession.</p>`,\n\t\t});\n\t\toptimizeGemsButton.addEventListener('click', async event => {\n\t\t\tconst previousContents = optimizeGemsButton.innerHTML;\n\t\t\toptimizeGemsButton.classList.add('disabled');\n\t\t\toptimizeGemsButton.style.width = `${optimizeGemsButton.getBoundingClientRect().width.toFixed(3)}px`;\n\t\t\toptimizeGemsButton.innerHTML = `<i class=\"fa fa-spinner fa-spin\"></i>&nbsp;Running`;\n\t\t\tawait this.optimizeGems(TypedEvent.nextEventID());\n\t\t\toptimizeGemsButton.innerHTML = previousContents;\n\t\t\toptimizeGemsButton.classList.remove('disabled');\n\t\t});\n\n\t\tconst calcButton = this.rootElem.getElementsByClassName('calc-weights')[0] as HTMLElement;\n\t\tcalcButton.addEventListener('click', async event => {\n\t\t\tconst previousContents = calcButton.innerHTML;\n\t\t\tcalcButton.classList.add('disabled');\n\t\t\tcalcButton.style.width = `${calcButton.getBoundingClientRect().width.toFixed(3)}px`;\n\t\t\tcalcButton.innerHTML = `<i class=\"fa fa-spinner fa-spin\"></i>&nbsp;Running`;\n\t\t\tthis.container.scrollTo({ top: 0 });\n\t\t\tthis.container.classList.add('pending');\n\t\t\tthis.resultsViewer.setPending();\n\t\t\tconst iterations = this.simUI.sim.getIterations();\n\t\t\tconst result = await this.simUI.player.computeStatWeights(\n\t\t\t\tTypedEvent.nextEventID(),\n\t\t\t\tthis.epStats,\n\t\t\t\tthis.epPseudoStats,\n\t\t\t\tthis.epReferenceStat,\n\t\t\t\t(progress: ProgressMetrics) => {\n\t\t\t\t\tthis.setSimProgress(progress);\n\t\t\t\t},\n\t\t\t);\n\t\t\tthis.container.classList.remove('pending');\n\t\t\tthis.resultsViewer.hideAll();\n\t\t\tcalcButton.innerHTML = previousContents;\n\t\t\tcalcButton.classList.remove('disabled');\n\t\t\tthis.simUI.prevEpIterations = iterations;\n\t\t\tthis.simUI.prevEpSimResult = this.calculateEp(result);\n\t\t\tthis.updateTable();\n\t\t});\n\n\t\tconst colActionButtons = Array.from(this.rootElem.getElementsByClassName('col-action')) as Array<HTMLSelectElement>;\n\t\tconst makeUpdateWeights = (\n\t\t\tbutton: HTMLElement,\n\t\t\tlabelTooltip: string,\n\t\t\ttooltip: string,\n\t\t\tweightsFunc: () => UnitStats | undefined,\n\t\t\tepRefStat?: () => Stat,\n\t\t) => {\n\t\t\tconst label = button.previousElementSibling as HTMLElement;\n\t\t\tconst title = () => {\n\t\t\t\tif (!epRefStat) return labelTooltip;\n\n\t\t\t\tconst refStatName = getNameFromStat(epRefStat());\n\t\t\t\treturn labelTooltip + ` Normalized by ${refStatName}.`;\n\t\t\t};\n\t\t\tconst labelTooltipConfig = {\n\t\t\t\ttoggle: 'tooltip',\n\t\t\t\thtml: true,\n\t\t\t\ttitle: title,\n\t\t\t};\n\n\t\t\tnew Tooltip(label, labelTooltipConfig);\n\t\t\tTooltip.getOrCreateInstance(button, {\n\t\t\t\ttitle: tooltip,\n\t\t\t\thtml: true,\n\t\t\t});\n\n\t\t\tbutton.addEventListener('click', event => {\n\t\t\t\tthis.simUI.player.setEpWeights(TypedEvent.nextEventID(), Stats.fromProto(weightsFunc()));\n\t\t\t\tthis.updateTable();\n\t\t\t});\n\t\t};\n\n\t\tmakeUpdateWeights(\n\t\t\tcolActionButtons[0],\n\t\t\t'Per-point increase in DPS (Damage Per Second) for each stat.',\n\t\t\t'Copy to Current EP',\n\t\t\t() => this.getPrevSimResult().dps!.weights,\n\t\t);\n\t\tmakeUpdateWeights(\n\t\t\tcolActionButtons[1],\n\t\t\t'EP (Equivalency Points) for DPS (Damage Per Second) for each stat.',\n\t\t\t'Copy to Current EP',\n\t\t\t() => this.getPrevSimResult().dps!.epValues,\n\t\t\t() => this.getDpsEpRefStat(),\n\t\t);\n\t\tmakeUpdateWeights(\n\t\t\tcolActionButtons[2],\n\t\t\t'Per-point increase in HPS (Healing Per Second) for each stat.',\n\t\t\t'Copy to Current EP',\n\t\t\t() => this.getPrevSimResult().hps!.weights,\n\t\t);\n\t\tmakeUpdateWeights(\n\t\t\tcolActionButtons[3],\n\t\t\t'EP (Equivalency Points) for HPS (Healing Per Second) for each stat.',\n\t\t\t'Copy to Current EP',\n\t\t\t() => this.getPrevSimResult().hps!.epValues,\n\t\t\t() => this.getHealEpRefStat(),\n\t\t);\n\t\tmakeUpdateWeights(\n\t\t\tcolActionButtons[4],\n\t\t\t'Per-point increase in TPS (Threat Per Second) for each stat.',\n\t\t\t'Copy to Current EP',\n\t\t\t() => this.getPrevSimResult().tps!.weights,\n\t\t);\n\t\tmakeUpdateWeights(\n\t\t\tcolActionButtons[5],\n\t\t\t'EP (Equivalency Points) for TPS (Threat Per Second) for each stat.',\n\t\t\t'Copy to Current EP',\n\t\t\t() => this.getPrevSimResult().tps!.epValues,\n\t\t\t() => this.getDpsEpRefStat(),\n\t\t);\n\t\tmakeUpdateWeights(\n\t\t\tcolActionButtons[6],\n\t\t\t'Per-point increase in DTPS (Damage Taken Per Second) for each stat.',\n\t\t\t'Copy to Current EP',\n\t\t\t() => this.getPrevSimResult().dtps!.weights,\n\t\t);\n\t\tmakeUpdateWeights(\n\t\t\tcolActionButtons[7],\n\t\t\t'EP (Equivalency Points) for DTPS (Damage Taken Per Second) for each stat.',\n\t\t\t'Copy to Current EP',\n\t\t\t() => this.getPrevSimResult().dtps!.epValues,\n\t\t\t() => this.getTankEpRefStat(),\n\t\t);\n\t\tmakeUpdateWeights(\n\t\t\tcolActionButtons[8],\n\t\t\t'Per-point decrease in TMI (Theck-Meloree Index) for each stat.',\n\t\t\t'Copy to Current EP',\n\t\t\t() => this.getPrevSimResult().tmi!.weights,\n\t\t);\n\t\tmakeUpdateWeights(\n\t\t\tcolActionButtons[9],\n\t\t\t'EP (Equivalency Points) for TMI (Theck-Meloree Index) for each stat.',\n\t\t\t'Copy to Current EP',\n\t\t\t() => this.getPrevSimResult().tmi!.epValues,\n\t\t\t() => this.getTankEpRefStat(),\n\t\t);\n\t\tmakeUpdateWeights(\n\t\t\tcolActionButtons[10],\n\t\t\t'Per-point decrease in p(death) for each stat.',\n\t\t\t'Copy to Current EP',\n\t\t\t() => this.getPrevSimResult().pDeath!.weights,\n\t\t);\n\t\tmakeUpdateWeights(\n\t\t\tcolActionButtons[11],\n\t\t\t'EP (Equivalency Points) for p(death) for each stat.',\n\t\t\t'Copy to Current EP',\n\t\t\t() => this.getPrevSimResult().pDeath!.epValues,\n\t\t\t() => this.getTankEpRefStat(),\n\t\t);\n\t\tmakeUpdateWeights(colActionButtons[12], 'Current EP Weights. Used to sort the gear selector menus.', 'Restore Default EP', () =>\n\t\t\tthis.simUI.individualConfig.defaults.epWeights.toProto(),\n\t\t);\n\n\t\tconst showAllStatsContainer = this.rootElem.getElementsByClassName('show-all-stats-container')[0] as HTMLElement;\n\t\tnew BooleanPicker(showAllStatsContainer, this, {\n\t\t\tlabel: 'Show All Stats',\n\t\t\tinline: true,\n\t\t\tchangedEvent: () => new TypedEvent(),\n\t\t\tgetValue: () => this.showAllStats,\n\t\t\tsetValue: (eventID: EventID, menu: EpWeightsMenu, newValue: boolean) => {\n\t\t\t\tthis.showAllStats = newValue;\n\t\t\t\tthis.updateTable();\n\t\t\t},\n\t\t});\n\n\t\tthis.updateTable();\n\n\t\tconst makeEpRatioCell = (cell: HTMLElement, idx: number) => {\n\t\t\tnew NumberPicker(cell, this.simUI.player, {\n\t\t\t\tfloat: true,\n\t\t\t\tchangedEvent: (player: Player<any>) => player.epRatiosChangeEmitter,\n\t\t\t\tgetValue: (player: Player<any>) => this.simUI.player.getEpRatios()[idx],\n\t\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\t\t\t\tconst epRatios = player.getEpRatios();\n\t\t\t\t\tepRatios[idx] = newValue;\n\t\t\t\t\tplayer.setEpRatios(eventID, epRatios);\n\t\t\t\t},\n\t\t\t});\n\t\t};\n\t\tconst epRatioCells = this.body.querySelectorAll('.type-ratio.type-ep') as NodeListOf<HTMLElement>;\n\t\tepRatioCells.forEach(makeEpRatioCell);\n\t\tthis.simUI.player.epRatiosChangeEmitter.on(_eventID => this.updateTable());\n\n\t\tconst weightRatioCells = this.body.querySelectorAll('.type-ratio.type-weight') as NodeListOf<HTMLElement>;\n\t\tweightRatioCells.forEach(makeEpRatioCell);\n\n\t\tconst updateButton = this.rootElem.getElementsByClassName('compute-ep')[0] as HTMLElement;\n\t\tTooltip.getOrCreateInstance(updateButton, {\n\t\t\ttitle: 'Compute Weighted EP',\n\t\t});\n\n\t\tupdateButton.addEventListener('click', event => {\n\t\t\tconst results = this.getPrevSimResult();\n\t\t\tconst epRatios = this.simUI.player.getEpRatios();\n\t\t\tif (this.statsType == 'ep') {\n\t\t\t\tconst scaledDpsEp = Stats.fromProto(results.dps!.epValues).scale(epRatios[0]);\n\t\t\t\tconst scaledHpsEp = Stats.fromProto(results.hps!.epValues).scale(epRatios[1]);\n\t\t\t\tconst scaledTpsEp = Stats.fromProto(results.tps!.epValues).scale(epRatios[2]);\n\t\t\t\tconst scaledDtpsEp = Stats.fromProto(results.dtps!.epValues).scale(epRatios[3]);\n\t\t\t\tconst scaledTmiEp = Stats.fromProto(results.tmi!.epValues).scale(epRatios[4]);\n\t\t\t\tconst scaledPDeathEp = Stats.fromProto(results.pDeath!.epValues).scale(epRatios[5]);\n\t\t\t\tconst newEp = scaledDpsEp.add(scaledHpsEp).add(scaledTpsEp).add(scaledDtpsEp).add(scaledTmiEp).add(scaledPDeathEp);\n\t\t\t\tthis.simUI.player.setEpWeights(TypedEvent.nextEventID(), newEp);\n\t\t\t} else {\n\t\t\t\tconst scaledDpsWeights = Stats.fromProto(results.dps!.weights).scale(epRatios[0]);\n\t\t\t\tconst scaledHpsWeights = Stats.fromProto(results.hps!.weights).scale(epRatios[1]);\n\t\t\t\tconst scaledTpsWeights = Stats.fromProto(results.tps!.weights).scale(epRatios[2]);\n\t\t\t\tconst scaledDtpsWeights = Stats.fromProto(results.dtps!.weights).scale(epRatios[3]);\n\t\t\t\tconst scaledTmiWeights = Stats.fromProto(results.tmi!.weights).scale(epRatios[4]);\n\t\t\t\tconst scaledPDeathWeights = Stats.fromProto(results.pDeath!.weights).scale(epRatios[5]);\n\t\t\t\tconst newWeights = scaledDpsWeights\n\t\t\t\t\t.add(scaledHpsWeights)\n\t\t\t\t\t.add(scaledTpsWeights)\n\t\t\t\t\t.add(scaledDtpsWeights)\n\t\t\t\t\t.add(scaledTmiWeights)\n\t\t\t\t\t.add(scaledPDeathWeights);\n\t\t\t\tthis.simUI.player.setEpWeights(TypedEvent.nextEventID(), newWeights);\n\t\t\t}\n\t\t\tthis.updateTable();\n\t\t});\n\t}\n\n\tprivate setSimProgress(progress: ProgressMetrics) {\n\t\tthis.resultsViewer.setContent(`\n\t\t\t<div class=\"results-sim\">\n\t\t\t\t<div class=\"\"> ${progress.completedSims} / ${progress.totalSims}<br>simulations complete</div>\n\t\t\t\t<div class=\"\">\n\t\t\t\t\t${progress.completedIterations} / ${progress.totalIterations}<br>iterations complete\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\t}\n\n\tprivate updateTable() {\n\t\tthis.tableBody.innerHTML = ``;\n\n\t\tEpWeightsMenu.epUnitStats.forEach(stat => {\n\t\t\t// Don't show extra stats when 'Show all stats' is not selected\n\t\t\tif (\n\t\t\t\t(!this.showAllStats && stat.isStat() && !this.epStats.includes(stat.getStat())) ||\n\t\t\t\t(stat.isPseudoStat() && !this.epPseudoStats.includes(stat.getPseudoStat()))\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst row = this.makeTableRow(stat);\n\t\t\tthis.tableBody.appendChild(row);\n\t\t});\n\t}\n\n\tprivate makeTableRow(stat: UnitStat): HTMLElement {\n\t\tconst row = document.createElement('tr');\n\t\tconst result = this.simUI.prevEpSimResult;\n\t\tconst epRatios = this.simUI.player.getEpRatios();\n\t\tconst rowTotalEp = scaledEpValue(stat, epRatios, result);\n\t\trow.innerHTML = `\n\t\t\t<td>${stat.getName(this.simUI.player.getClass())}</td>\n\t\t\t${this.makeTableRowCells(stat, result?.dps, 'damage-metrics', rowTotalEp, epRatios[0])}\n\t\t\t${this.makeTableRowCells(stat, result?.hps, 'healing-metrics', rowTotalEp, epRatios[1])}\n\t\t\t${this.makeTableRowCells(stat, result?.tps, 'threat-metrics', rowTotalEp, epRatios[2])}\n\t\t\t${this.makeTableRowCells(stat, result?.dtps, 'threat-metrics', rowTotalEp, epRatios[3])}\n\t\t\t${this.makeTableRowCells(stat, result?.tmi, 'threat-metrics experimental', rowTotalEp, epRatios[4])}\n\t\t\t${this.makeTableRowCells(stat, result?.pDeath, 'threat-metrics experimental', rowTotalEp, epRatios[5])}\n\t\t\t<td class=\"current-ep\"></td>\n\t\t`;\n\n\t\tconst currentEpCell = row.querySelector('.current-ep') as HTMLElement;\n\t\tnew NumberPicker(currentEpCell, this.simUI.player, {\n\t\t\tfloat: true,\n\t\t\tchangedEvent: (player: Player<any>) => player.epWeightsChangeEmitter,\n\t\t\tgetValue: (player: Player<any>) => this.simUI.player.getEpWeights().getUnitStat(stat),\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\n\t\t\t\tconst epWeights = player.getEpWeights().withUnitStat(stat, newValue);\n\t\t\t\tplayer.setEpWeights(eventID, epWeights);\n\t\t\t},\n\t\t});\n\n\t\treturn row;\n\t}\n\n\tprivate makeTableRowCells(stat: UnitStat, statWeights: StatWeightValues | undefined, className: string, epTotal: number, epRatio: number): string {\n\t\tlet weightCell, epCell;\n\t\tif (statWeights) {\n\t\t\tconst weightAvg = stat.getProtoValue(statWeights.weights!);\n\t\t\tconst weightStdev = stat.getProtoValue(statWeights.weightsStdev!);\n\t\t\tweightCell = this.makeTableCellContents(weightAvg, weightStdev);\n\n\t\t\tconst epAvg = stat.getProtoValue(statWeights.epValues!);\n\t\t\tconst epStdev = stat.getProtoValue(statWeights.epValuesStdev!);\n\t\t\tepCell = this.makeTableCellContents(epAvg, epStdev);\n\t\t} else {\n\t\t\tweightCell = `<span class=\"results-avg notapplicable\">N/A</span>`;\n\t\t\tepCell = weightCell;\n\t\t}\n\n\t\tconst template = document.createElement('template');\n\t\ttemplate.innerHTML = `\n\t\t\t<td class=\"stdev-cell ${className} type-weight\">\n\t\t\t\t${weightCell}\n\t\t\t</td>\n\t\t\t<td class=\"stdev-cell ${className} type-ep\">\n\t\t\t\t${epCell}\n\t\t\t</td>\n\t\t`;\n\n\t\tif (!statWeights) return template.innerHTML;\n\n\t\tif (epRatio == 0) {\n\t\t\tconst cells = template.content.querySelectorAll('.stdev-cell');\n\t\t\tcells.forEach(cell => cell.classList.add('unused-ep'));\n\t\t\treturn template.innerHTML;\n\t\t}\n\n\t\tconst epCurrent = this.simUI.player.getEpWeights().getUnitStat(stat);\n\t\tconst epDelta = epTotal - epCurrent;\n\n\t\tconst epAvgElem = template.content.querySelector('.type-ep .results-avg') as HTMLElement;\n\t\tif (epDelta.toFixed(2) == '0.00') epAvgElem; // no-op\n\t\telse if (epDelta > 0) epAvgElem.classList.add('positive');\n\t\telse if (epDelta < 0) epAvgElem.classList.add('negative');\n\n\t\treturn template.innerHTML;\n\t}\n\n\tprivate makeTableCellContents(value: number, stdev: number): string {\n\t\tconst iterations = this.simUI.prevEpIterations || 1;\n\t\treturn `\n\t\t\t<span class=\"results-avg\">${value.toFixed(2)}</span>\n\t\t\t<span class=\"results-stdev\">\n\t\t\t\t(<i class=\"fas fa-plus-minus fa-xs\"></i>${stDevToConf90(stdev, iterations).toFixed(2)})\n\t\t\t</span>\n\t\t`;\n\t}\n\n\tprivate calculateEp(weights: StatWeightsResult) {\n\t\tconst result = StatWeightsResult.clone(weights);\n\t\tconst normaliseValue = (refStat: Stat, values: StatWeightValues) => {\n\t\t\tconst refUnitStat = UnitStat.fromStat(refStat);\n\t\t\tconst refWeight = refUnitStat.getProtoValue(values.weights!);\n\t\t\tconst refStdev = refUnitStat.getProtoValue(values.weightsStdev!);\n\t\t\tEpWeightsMenu.epUnitStats.forEach(stat => {\n\t\t\t\tconst value = stat.getProtoValue(values.weights!);\n\t\t\t\tstat.setProtoValue(values.epValues!, refWeight == 0 ? 0 : value / refWeight);\n\n\t\t\t\tconst valueStdev = stat.getProtoValue(values.weightsStdev!);\n\t\t\t\tstat.setProtoValue(values.epValuesStdev!, refStdev == 0 ? 0 : valueStdev / refStdev);\n\t\t\t});\n\t\t};\n\n\t\tif (this.simUI.dpsRefStat !== undefined) {\n\t\t\tnormaliseValue(this.simUI.dpsRefStat, result.dps!);\n\t\t\tnormaliseValue(this.simUI.dpsRefStat, result.tps!);\n\t\t}\n\t\tif (this.simUI.healRefStat !== undefined) normaliseValue(this.simUI.healRefStat, result.hps!);\n\t\tif (this.simUI.tankRefStat !== undefined) {\n\t\t\tnormaliseValue(this.simUI.tankRefStat, result.dtps!);\n\t\t\tnormaliseValue(this.simUI.tankRefStat, result.tmi!);\n\t\t\tnormaliseValue(this.simUI.tankRefStat, result.pDeath!);\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate getDpsEpRefStat(): Stat {\n\t\treturn this.simUI.dpsRefStat !== undefined ? this.simUI.dpsRefStat : this.epReferenceStat;\n\t}\n\n\tprivate getHealEpRefStat(): Stat {\n\t\treturn this.simUI.healRefStat !== undefined ? this.simUI.healRefStat : this.epReferenceStat;\n\t}\n\n\tprivate getTankEpRefStat(): Stat {\n\t\treturn this.simUI.tankRefStat !== undefined ? this.simUI.tankRefStat : Stat.StatArmor;\n\t}\n\n\tprivate getPrevSimResult(): StatWeightsResult {\n\t\treturn (\n\t\t\tthis.simUI.prevEpSimResult ||\n\t\t\tStatWeightsResult.create({\n\t\t\t\tdps: {\n\t\t\t\t\tweights: new Stats().toProto(),\n\t\t\t\t\tweightsStdev: new Stats().toProto(),\n\t\t\t\t\tepValues: new Stats().toProto(),\n\t\t\t\t\tepValuesStdev: new Stats().toProto(),\n\t\t\t\t},\n\t\t\t\thps: {\n\t\t\t\t\tweights: new Stats().toProto(),\n\t\t\t\t\tweightsStdev: new Stats().toProto(),\n\t\t\t\t\tepValues: new Stats().toProto(),\n\t\t\t\t\tepValuesStdev: new Stats().toProto(),\n\t\t\t\t},\n\t\t\t\ttps: {\n\t\t\t\t\tweights: new Stats().toProto(),\n\t\t\t\t\tweightsStdev: new Stats().toProto(),\n\t\t\t\t\tepValues: new Stats().toProto(),\n\t\t\t\t\tepValuesStdev: new Stats().toProto(),\n\t\t\t\t},\n\t\t\t\tdtps: {\n\t\t\t\t\tweights: new Stats().toProto(),\n\t\t\t\t\tweightsStdev: new Stats().toProto(),\n\t\t\t\t\tepValues: new Stats().toProto(),\n\t\t\t\t\tepValuesStdev: new Stats().toProto(),\n\t\t\t\t},\n\t\t\t\ttmi: {\n\t\t\t\t\tweights: new Stats().toProto(),\n\t\t\t\t\tweightsStdev: new Stats().toProto(),\n\t\t\t\t\tepValues: new Stats().toProto(),\n\t\t\t\t\tepValuesStdev: new Stats().toProto(),\n\t\t\t\t},\n\t\t\t\tpDeath: {\n\t\t\t\t\tweights: new Stats().toProto(),\n\t\t\t\t\tweightsStdev: new Stats().toProto(),\n\t\t\t\t\tepValues: new Stats().toProto(),\n\t\t\t\t\tepValuesStdev: new Stats().toProto(),\n\t\t\t\t},\n\t\t\t})\n\t\t);\n\t}\n\n\tprivate async optimizeGems(eventID: EventID) {\n\t\t// Replace 0 weights with a very tiny value, so we always prefer to take free stats even if the user gave a 0 weight.\n\t\tlet epWeights = this.simUI.player.getEpWeights();\n\t\tepWeights = new Stats(epWeights.asArray().map(w => (w == 0 ? 1e-8 : w)));\n\n\t\tconst gear = this.simUI.player.getGear();\n\t\tconst allGems = this.simUI.sim.db.getGems();\n\t\tconst phase = this.simUI.sim.getPhase();\n\t\tconst isBlacksmithing = this.simUI.player.isBlacksmithing();\n\t\tconst isJewelcrafting = this.simUI.player.hasProfession(Profession.Jewelcrafting);\n\n\t\tconst optimizedGear = EpWeightsMenu.optimizeGemsForWeights(epWeights, gear, allGems, phase, isBlacksmithing, isJewelcrafting);\n\t\tthis.simUI.player.setGear(eventID, optimizedGear);\n\t}\n\n\tprivate static optimizeGemsForWeights(\n\t\tepWeights: Stats,\n\t\tgear: Gear,\n\t\tallGems: Array<Gem>,\n\t\tphase: number,\n\t\tisBlacksmithing: boolean,\n\t\tisJewelcrafting: boolean,\n\t): Gear {\n\t\tconst unrestrictedGems = allGems.filter(gem => Gems.isUnrestrictedGem(gem, phase));\n\n\t\tconst {\n\t\t\tbestGemForColor: bestGemForColor,\n\t\t\tbestGemForColorEP: bestGemForColorEP,\n\t\t\tbestGemForSocket: bestGemForSocket,\n\t\t\tbestGemForSocketEP: bestGemForSocketEP,\n\t\t\tbestGem: bestGem,\n\t\t\tbestGemEP: bestGemEP,\n\t\t} = EpWeightsMenu.findBestGems(unrestrictedGems, epWeights);\n\n\t\tconst items = gear.asMap();\n\t\tconst socketBonusEPs = Object.values(items).map(item => (item != null ? new Stats(item.item.socketBonus).computeEP(epWeights) : 0));\n\n\t\t// Start by optimally filling all items, ignoring meta condition.\n\t\tObject.entries(items).forEach(([itemSlot, equippedItem], i) => {\n\t\t\tif (equippedItem == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t//const item = equippedItem.item;\n\t\t\tconst socketColors = equippedItem.curSocketColors(isBlacksmithing);\n\n\t\t\t// Compare whether its better to match sockets + get socket bonus, or just use best gems.\n\t\t\tconst bestGemEPNotMatchingSockets = sum(socketColors.map(socketColor => (socketColor == GemColor.GemColorMeta ? 0 : bestGemEP)));\n\t\t\tconst bestGemEPMatchingSockets =\n\t\t\t\tsocketBonusEPs[i] + sum(socketColors.map(socketColor => (socketColor == GemColor.GemColorMeta ? 0 : bestGemForSocketEP[socketColor])));\n\n\t\t\tif (bestGemEPNotMatchingSockets > bestGemEPMatchingSockets) {\n\t\t\t\tsocketColors.forEach((socketColor, i) => {\n\t\t\t\t\tif (socketColor != GemColor.GemColorMeta) {\n\t\t\t\t\t\tequippedItem = equippedItem!.withGem(bestGem, i);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsocketColors.forEach((socketColor, i) => {\n\t\t\t\t\tif (socketColor != GemColor.GemColorMeta) {\n\t\t\t\t\t\tequippedItem = equippedItem!.withGem(bestGemForSocket[socketColor], i);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\titems[Number(itemSlot) as ItemSlot] = equippedItem;\n\t\t});\n\t\tgear = new Gear(items);\n\n\t\tconst allSockets: Array<{ itemSlot: ItemSlot; socketIdx: number }> = Object.keys(items)\n\t\t\t.map(itemSlotStr => {\n\t\t\t\tconst itemSlot = parseInt(itemSlotStr) as ItemSlot;\n\t\t\t\tconst item = items[itemSlot];\n\t\t\t\tif (!item) {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\n\t\t\t\tconst numSockets = item.numSockets(isBlacksmithing);\n\t\t\t\treturn [...Array(numSockets).keys()]\n\t\t\t\t\t.filter(socketIdx => item.item.gemSockets[socketIdx] != GemColor.GemColorMeta)\n\t\t\t\t\t.map(socketIdx => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\titemSlot: itemSlot,\n\t\t\t\t\t\t\tsocketIdx: socketIdx,\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.flat();\n\t\tconst threeSocketCombos = permutations(allSockets, 3);\n\t\tconst calculateGearGemsEP = (gear: Gear): number => gear.statsFromGems(isBlacksmithing).computeEP(epWeights);\n\n\t\t// Now make adjustments to satisfy meta condition.\n\t\t// Use a wrapper function so we can return for readability.\n\t\tgear = ((gear: Gear): Gear => {\n\t\t\tconst metaGem = gear.getMetaGem();\n\t\t\tif (!metaGem) {\n\t\t\t\treturn gear;\n\t\t\t}\n\n\t\t\tconst condition = Gems.getMetaGemCondition(metaGem.id);\n\t\t\t// Only TBC gems use compare color conditions, so just ignore them.\n\t\t\tif (!condition || condition.isCompareColorCondition()) {\n\t\t\t\treturn gear;\n\t\t\t}\n\n\t\t\t// If there are very few non-meta gem slots, just skip because it's annoying to deal with.\n\t\t\tif (gear.getAllGems(isBlacksmithing).length - 1 < 3) {\n\t\t\t\treturn gear;\n\t\t\t}\n\n\t\t\t// In wrath, all meta gems use min colors condition (numRed >= r && numYellow >= y && numBlue >= b)\n\t\t\t// All conditions require 3 gems, e.g. 3 of a single color, 2 of one color and 1 of another, or 1 of each.\n\t\t\t// So the maximum number of gems that ever need to change is 3.\n\n\t\t\tconst colorCombos = EpWeightsMenu.getColorCombosToSatisfyCondition(condition);\n\n\t\t\tlet bestGear = gear;\n\t\t\tlet bestGearEP = calculateGearGemsEP(gear);\n\n\t\t\t// Use brute-force to try every possibility.\n\t\t\tcolorCombos.forEach(colorCombo => {\n\t\t\t\tthreeSocketCombos.forEach(socketCombo => {\n\t\t\t\t\tconst curItems = gear.asMap();\n\t\t\t\t\tfor (let i = 0; i < colorCombo.length; i++) {\n\t\t\t\t\t\tconst gemColor = colorCombo[i];\n\t\t\t\t\t\tconst { itemSlot, socketIdx } = socketCombo[i];\n\t\t\t\t\t\tcurItems[itemSlot] = curItems[itemSlot]!.withGem(bestGemForColor[gemColor], socketIdx);\n\t\t\t\t\t}\n\t\t\t\t\tconst curGear = new Gear(curItems);\n\t\t\t\t\tif (curGear.hasActiveMetaGem(isBlacksmithing)) {\n\t\t\t\t\t\tconst curGearEP = calculateGearGemsEP(curGear);\n\t\t\t\t\t\tif (curGearEP > bestGearEP) {\n\t\t\t\t\t\t\tbestGear = curGear;\n\t\t\t\t\t\t\tbestGearEP = curGearEP;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn bestGear;\n\t\t})(gear);\n\n\t\t// Now insert 3 JC gems, if Jewelcrafting is selected.\n\t\t// Use a wrapper function so we can return for readability.\n\t\tgear = ((gear: Gear): Gear => {\n\t\t\tif (!isJewelcrafting) {\n\t\t\t\treturn gear;\n\t\t\t}\n\n\t\t\tconst jcGems = allGems.filter(gem => gem.requiredProfession == Profession.Jewelcrafting);\n\n\t\t\tconst {\n\t\t\t\tbestGemForColor: bestJcGemForColor,\n\t\t\t\tbestGemForColorEP: bestJcGemForColorEP,\n\t\t\t\tbestGemForSocket: bestJcGemForSocket,\n\t\t\t\tbestGemForSocketEP: bestJcGemForSocketEP,\n\t\t\t\tbestGem: bestJcGem,\n\t\t\t\tbestGemEP: bestJcGemEP,\n\t\t\t} = EpWeightsMenu.findBestGems(jcGems, epWeights);\n\n\t\t\tlet bestGear = gear;\n\t\t\tlet bestGearEP = calculateGearGemsEP(gear);\n\n\t\t\tthreeSocketCombos.forEach(socketCombo => {\n\t\t\t\tconst curItems = gear.asMap();\n\t\t\t\tfor (let i = 0; i < socketCombo.length; i++) {\n\t\t\t\t\tconst { itemSlot, socketIdx } = socketCombo[i];\n\t\t\t\t\tconst ei = curItems[itemSlot]!;\n\t\t\t\t\tconst gemColor = ei.gems[socketIdx]!.color;\n\t\t\t\t\tcurItems[itemSlot] = ei.withGem(bestJcGemForColor[gemColor], socketIdx);\n\t\t\t\t}\n\n\t\t\t\tconst curGear = new Gear(curItems);\n\t\t\t\tif (curGear.hasActiveMetaGem(isBlacksmithing)) {\n\t\t\t\t\tconst curGearEP = calculateGearGemsEP(curGear);\n\t\t\t\t\tif (curGearEP > bestGearEP) {\n\t\t\t\t\t\tbestGear = curGear;\n\t\t\t\t\t\tbestGearEP = curGearEP;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn bestGear;\n\t\t})(gear);\n\n\t\treturn gear;\n\t}\n\n\t// Returns every possible way we could satisfy the gem condition.\n\tprivate static getColorCombosToSatisfyCondition(condition: Gems.MetaGemCondition): Array<Array<GemColor>> {\n\t\tif (condition.isOneOfEach()) {\n\t\t\treturn [Gems.PRIMARY_COLORS, [GemColor.GemColorPrismatic]].concat(\n\t\t\t\tGems.SECONDARY_COLORS.map((secondaryColor, i) => {\n\t\t\t\t\tconst remainingColor = Gems.PRIMARY_COLORS[i];\n\t\t\t\t\treturn Gems.socketToMatchingColors.get(remainingColor)!.map(matchingColor => [matchingColor, secondaryColor]);\n\t\t\t\t}).flat(),\n\t\t\t);\n\t\t} else if (condition.isTwoAndOne()) {\n\t\t\tconst oneColor = Gems.PRIMARY_COLORS[[condition.minRed, condition.minYellow, condition.minBlue].indexOf(1)];\n\t\t\tconst twoColor = Gems.PRIMARY_COLORS[[condition.minRed, condition.minYellow, condition.minBlue].indexOf(2)];\n\t\t\tconst secondaryColor = Gems.SECONDARY_COLORS.find(\n\t\t\t\tcolor => Gems.gemColorMatchesSocket(color, oneColor) && Gems.gemColorMatchesSocket(color, twoColor),\n\t\t\t)!;\n\n\t\t\treturn [\n\t\t\t\t// All the ways to get 1 point in both colors. These are partial combos,\n\t\t\t\t// which still need 1 more gem in the 2-color.\n\t\t\t\t[GemColor.GemColorPrismatic],\n\t\t\t\t[secondaryColor],\n\t\t\t\t[oneColor, twoColor],\n\t\t\t]\n\t\t\t\t.map(partialCombo => {\n\t\t\t\t\treturn Gems.socketToMatchingColors.get(twoColor)!.map(matchingColor => partialCombo.concat([matchingColor]));\n\t\t\t\t})\n\t\t\t\t.flat();\n\t\t} else if (condition.isThreeOfAColor()) {\n\t\t\tconst threeColor = Gems.PRIMARY_COLORS[[condition.minRed, condition.minYellow, condition.minBlue].indexOf(3)];\n\t\t\tconst matchingColors = Gems.socketToMatchingColors.get(threeColor)!;\n\t\t\treturn combinationsWithDups(matchingColors, 3);\n\t\t} else {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tprivate static findBestGems(gemList: Array<Gem>, epWeights: Stats): BestGemsResult {\n\t\t// Best gem when we need a gem of a specific color.\n\t\tconst bestGemForColor: Array<Gem> = Gems.GEM_COLORS.map(color => null as unknown as Gem);\n\t\tconst bestGemForColorEP: Array<number> = Gems.GEM_COLORS.map(color => 0);\n\t\t// Best gem when we need to match a socket to activate a bonus.\n\t\tconst bestGemForSocket: Array<Gem> = bestGemForColor.slice();\n\t\tconst bestGemForSocketEP: Array<number> = bestGemForColorEP.slice();\n\t\t// The single best gem, when color doesn't matter.\n\t\tlet bestGem = gemList[0];\n\t\tlet bestGemEP = 0;\n\t\tgemList.forEach(gem => {\n\t\t\tconst gemEP = new Stats(gem.stats).computeEP(epWeights);\n\t\t\tif (gemEP > bestGemForColorEP[gem.color]) {\n\t\t\t\tbestGemForColorEP[gem.color] = gemEP;\n\t\t\t\tbestGemForColor[gem.color] = gem;\n\n\t\t\t\tif (gem.color != GemColor.GemColorMeta && gemEP > bestGemEP) {\n\t\t\t\t\tbestGemEP = gemEP;\n\t\t\t\t\tbestGem = gem;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tGems.GEM_COLORS.forEach(socketColor => {\n\t\t\t\tif (Gems.gemMatchesSocket(gem, socketColor) && gemEP > bestGemForSocketEP[socketColor]) {\n\t\t\t\t\tbestGemForSocketEP[socketColor] = gemEP;\n\t\t\t\t\tbestGemForSocket[socketColor] = gem;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn {\n\t\t\tbestGemForColor: bestGemForColor,\n\t\t\tbestGemForColorEP: bestGemForColorEP,\n\t\t\tbestGemForSocket: bestGemForSocket,\n\t\t\tbestGemForSocketEP: bestGemForSocketEP,\n\t\t\tbestGem: bestGem,\n\t\t\tbestGemEP: bestGemEP,\n\t\t};\n\t}\n\n\tprivate static epUnitStats: Array<UnitStat> = UnitStat.getAll().filter(stat => {\n\t\tif (stat.isStat()) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn [PseudoStat.PseudoStatMainHandDps, PseudoStat.PseudoStatOffHandDps, PseudoStat.PseudoStatRangedDps].includes(stat.getPseudoStat());\n\t\t}\n\t});\n}\n\ninterface BestGemsResult {\n\tbestGemForColor: Array<Gem>;\n\tbestGemForColorEP: Array<number>;\n\tbestGemForSocket: Array<Gem>;\n\tbestGemForSocketEP: Array<number>;\n\tbestGem: Gem;\n\tbestGemEP: number;\n}\n","import { Phase } from './constants/other';\nimport { Spec } from './proto/common';\n\n// This file is for anything related to launching a new sim. DO NOT touch this\n// file until your sim is ready to launch!\n\nexport enum LaunchStatus {\n\tUnlaunched,\n\tAlpha,\n\tBeta,\n\tLaunched,\n};\n\nexport type SimStatus = {\n\tphase: Phase,\n\tstatus: LaunchStatus\n}\n\nexport const raidSimStatus: SimStatus = {\n\tphase: Phase.Phase1,\n\tstatus: LaunchStatus.Unlaunched,\n}\n\n// This list controls which links are shown in the top-left dropdown menu.\nexport const simLaunchStatuses: Record<Spec, SimStatus> = {\n\t[Spec.SpecUnknown]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t// Death Knight\n\t[Spec.SpecBloodDeathKnight]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecFrostDeathKnight]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Alpha,\n\t},\n\t[Spec.SpecUnholyDeathKnight]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Alpha,\n\t},\n\t// Druid\n\t[Spec.SpecBalanceDruid]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecFeralDruid]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecRestorationDruid]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t// Hunter\n\t[Spec.SpecBeastMasteryHunter]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecMarksmanshipHunter]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecSurvivalHunter]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t// Mage\n\t[Spec.SpecArcaneMage]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecFireMage]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecFrostMage]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t// Paladin\n\t[Spec.SpecHolyPaladin]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecProtectionPaladin]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecRetributionPaladin]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t// Priest\n\t[Spec.SpecDisciplinePriest]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecHolyPriest]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecShadowPriest]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Alpha,\n\t},\n\t// Rogue\n\t[Spec.SpecAssassinationRogue]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecCombatRogue]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecSubtletyRogue]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t// Shaman\n\t[Spec.SpecElementalShaman]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Alpha,\n\t},\n\t[Spec.SpecEnhancementShaman]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Alpha,\n\t},\n\t[Spec.SpecRestorationShaman]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t// Warlock\n\t[Spec.SpecAfflictionWarlock]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecDemonologyWarlock]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecDestructionWarlock]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t// Warrior\n\t[Spec.SpecArmsWarrior]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecFuryWarrior]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n\t[Spec.SpecProtectionWarrior]: {\n\t\tphase: Phase.Phase1,\n\t\tstatus: LaunchStatus.Unlaunched,\n\t},\n};\n","import { SimUI } from '../sim_ui.js';\nimport { Sim } from '../sim.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { wowheadSupportedLanguages } from '../constants/lang.js';\nimport { BooleanPicker } from '../components/boolean_picker.js';\nimport { EnumPicker } from '../components/enum_picker.js';\nimport { NumberPicker } from '../components/number_picker.js';\nimport { BaseModal } from './base_modal.js';\nimport { Tooltip } from 'bootstrap';\n\nexport class SettingsMenu extends BaseModal {\n\tprivate readonly simUI: SimUI;\n\n\tconstructor(parent: HTMLElement, simUI: SimUI) {\n\t\tsuper(parent, 'settings-menu', { title: \"Options\", footer: true });\n\t\tthis.simUI = simUI;\n\n\t\tthis.body.innerHTML = `\n\t\t\t<div class=\"picker-group\">\n\t\t\t\t<div class=\"fixed-rng-seed-container\">\n\t\t\t\t\t<div class=\"fixed-rng-seed\"></div>\n\t\t\t\t\t<div class=\"form-text\">\n\t\t\t\t\t\t<span>Last used RNG seed:</span>&nbsp;<span class=\"last-used-rng-seed\">0</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"language-picker within-raid-sim-hide\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"show-threat-metrics-picker w-50 pe-2\"></div>\n\t\t\t<div class=\"show-experimental-picker w-50 pe-2\"></div>\n\t\t`;\n\t\tthis.footer!.innerHTML = `\n\t\t\t<button\n\t\t\t\tclass=\"restore-defaults-button btn btn-primary\"\n\t\t\t>Restore Defaults</button>\n\t\t`\n\n\t\tconst restoreDefaultsButton = this.rootElem.getElementsByClassName('restore-defaults-button')[0] as HTMLElement;\n\t\tTooltip.getOrCreateInstance(restoreDefaultsButton, {\n\t\t\ttitle: \"Restores all default settings (gear, consumes, buffs, talents, EP weights, etc). Saved settings are preserved.\"\n\t\t});\n\t\trestoreDefaultsButton.addEventListener('click', event => {\n\t\t\tthis.simUI.applyDefaults(TypedEvent.nextEventID());\n\t\t});\n\n\t\tconst fixedRngSeed = this.rootElem.getElementsByClassName('fixed-rng-seed')[0] as HTMLElement;\n\t\tnew NumberPicker(fixedRngSeed, this.simUI.sim, {\n\t\t\tlabel: 'Fixed RNG Seed',\n\t\t\tlabelTooltip: 'Seed value for the random number generator used during sims, or 0 to use different randomness each run. Use this to share exact sim results or for debugging.',\n\t\t\textraCssClasses: ['mb-0'],\n\t\t\tchangedEvent: (sim: Sim) => sim.fixedRngSeedChangeEmitter,\n\t\t\tgetValue: (sim: Sim) => sim.getFixedRngSeed(),\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\n\t\t\t\tsim.setFixedRngSeed(eventID, newValue);\n\t\t\t},\n\t\t});\n\n\t\tconst lastUsedRngSeed = this.rootElem.getElementsByClassName('last-used-rng-seed')[0] as HTMLElement;\n\t\tlastUsedRngSeed.textContent = String(this.simUI.sim.getLastUsedRngSeed());\n\t\tthis.simUI.sim.lastUsedRngSeedChangeEmitter.on(() => lastUsedRngSeed.textContent = String(this.simUI.sim.getLastUsedRngSeed()));\n\n\t\tconst language = this.rootElem.getElementsByClassName('language-picker')[0] as HTMLElement;\n\t\tconst langs = Object.keys(wowheadSupportedLanguages);\n\t\tconst defaultLang = langs.indexOf('en');\n\t\tconst languagePicker = new EnumPicker(language, this.simUI.sim, {\n\t\t\tlabel: 'Language',\n\t\t\tlabelTooltip: 'Controls the language for Wowhead tooltips.',\n\t\t\tvalues: langs.map((lang, i) => {\n\t\t\t\treturn {\n\t\t\t\t\tname: wowheadSupportedLanguages[lang],\n\t\t\t\t\tvalue: i,\n\t\t\t\t};\n\t\t\t}),\n\t\t\tchangedEvent: (sim: Sim) => sim.languageChangeEmitter,\n\t\t\tgetValue: (sim: Sim) => {\n\t\t\t\tconst idx = langs.indexOf(sim.getLanguage());\n\t\t\t\treturn idx == -1 ? defaultLang : idx;\n\t\t\t},\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\n\t\t\t\tsim.setLanguage(eventID, langs[newValue] || 'en');\n\t\t\t},\n\t\t});\n\t\t// Refresh page after language change, to apply the changes.\n\t\tlanguagePicker.changeEmitter.on(() => setTimeout(() => location.reload(), 100));\n\n\t\tconst showThreatMetrics = this.rootElem.getElementsByClassName('show-threat-metrics-picker')[0] as HTMLElement;\n\t\tnew BooleanPicker(showThreatMetrics, this.simUI.sim, {\n\t\t\tlabel: 'Show Threat/Tank Options',\n\t\t\tlabelTooltip: 'Shows all options and metrics relevant to tanks, like TPS/DTPS.',\n\t\t\tinline: true,\n\t\t\tchangedEvent: (sim: Sim) => sim.showThreatMetricsChangeEmitter,\n\t\t\tgetValue: (sim: Sim) => sim.getShowThreatMetrics(),\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\t\tsim.setShowThreatMetrics(eventID, newValue);\n\t\t\t},\n\t\t});\n\n\t\tconst showExperimental = this.rootElem.getElementsByClassName('show-experimental-picker')[0] as HTMLElement;\n\t\tnew BooleanPicker(showExperimental, this.simUI.sim, {\n\t\t\tlabel: 'Show Experimental',\n\t\t\tlabelTooltip: 'Shows experimental options, if there are any active experiments.',\n\t\t\tinline: true,\n\t\t\tchangedEvent: (sim: Sim) => sim.showExperimentalChangeEmitter,\n\t\t\tgetValue: (sim: Sim) => sim.getShowExperimental(),\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\n\t\t\t\tsim.setShowExperimental(eventID, newValue);\n\t\t\t},\n\t\t});\n\t}\n}\n","import { Tooltip } from 'bootstrap';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { element } from 'tsx-vanilla';\n\nimport { Component } from './component';\n\nexport class SocialLinks extends Component {\n\tstatic buildDiscordLink(): Element {\n\t\tconst anchor = (\n\t\t\t<a\n\t\t\t\thref=\"https://discord.gg/p3DgvmnDCS\"\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\tclassName=\"discord-link link-alt\"\n\t\t\t\tdataset={{ bsToggle: 'tooltip', bsTitle: 'Join us on Discord' }}>\n\t\t\t\t<i className=\"fab fa-discord fa-lg\" />\n\t\t\t</a>\n\t\t);\n\t\tTooltip.getOrCreateInstance(anchor);\n\t\treturn anchor;\n\t}\n\n\tstatic buildGitHubLink(): Element {\n\t\tconst anchor = (\n\t\t\t<a\n\t\t\t\thref=\"https://github.com/wowsims/sod\"\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\tclassName=\"github-link link-alt\"\n\t\t\t\tdataset={{ bsToggle: 'tooltip', bsTitle: 'Contribute on GitHub' }}>\n\t\t\t\t<i className=\"fab fa-github fa-lg\" />\n\t\t\t</a>\n\t\t);\n\t\tTooltip.getOrCreateInstance(anchor);\n\t\treturn anchor;\n\t}\n\n\tstatic buildPatreonLink(): Element {\n\t\tconst anchor = (\n\t\t\t<a\n\t\t\t\thref=\"https://patreon.com/wowsims\"\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\tclassName=\"patreon-link link-alt\"\n\t\t\t\tdataset={{ bsToggle: 'tooltip', bsTitle: 'Support us on Patreon' }}>\n\t\t\t\t<i className=\"fab fa-patreon fa-lg\" /> Patreon\n\t\t\t</a>\n\t\t);\n\t\tTooltip.getOrCreateInstance(anchor);\n\t\treturn anchor;\n\t}\n}\n","import { Tooltip } from 'bootstrap';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { element } from 'tsx-vanilla';\n\nimport { SimUI } from '../sim_ui';\nimport { Component } from './component';\nimport { SettingsMenu } from './settings_menu';\nimport { SimTab } from './sim_tab';\nimport { SocialLinks } from './social_links';\n\ninterface ToolbarLinkArgs {\n\tparent: HTMLElement;\n\thref?: string;\n\ttext?: string;\n\ticon?: string;\n\ttooltip?: string | HTMLElement;\n\tclasses?: string;\n\tonclick?: () => void;\n}\n\nexport class SimHeader extends Component {\n\tprivate simUI: SimUI;\n\n\tprivate simTabsContainer: HTMLElement;\n\tprivate simToolbar: HTMLElement;\n\tprivate knownIssuesLink: HTMLElement;\n\tprivate knownIssuesContent: HTMLElement;\n\n\tconstructor(parentElem: HTMLElement, simUI: SimUI) {\n\t\tsuper(parentElem, 'sim-header');\n\t\tthis.simUI = simUI;\n\t\tthis.simTabsContainer = this.rootElem.querySelector('.sim-tabs') as HTMLElement;\n\t\tthis.simToolbar = this.rootElem.querySelector('.sim-toolbar') as HTMLElement;\n\n\t\tthis.knownIssuesContent = (<ul className=\"text-start ps-3 mb-0\"></ul>) as HTMLElement;\n\t\tthis.knownIssuesLink = this.addKnownIssuesLink();\n\t\tthis.addBugReportLink();\n\t\tthis.addDownloadBinaryLink();\n\t\tthis.addSimOptionsLink();\n\t\tthis.addSocialLinks();\n\n\t\t// Allow styling the sticky header\n\t\tnew IntersectionObserver(([e]) => e.target.classList.toggle('stuck', e.intersectionRatio < 1), { threshold: [1] }).observe(this.rootElem);\n\t}\n\n\tactivateTab(className: string) {\n\t\t(this.simTabsContainer.getElementsByClassName(className)[0] as HTMLElement).click();\n\t}\n\n\taddTab(title: string, contentId: string) {\n\t\tconst isFirstTab = this.simTabsContainer.children.length == 0;\n\n\t\tconst classes = `${contentId} nav-item`;\n\t\tconst tab = (\n\t\t\t<li className={classes} attributes={{ role: 'presentation' }}>\n\t\t\t\t<a\n\t\t\t\t\tclassName={`nav-link ${isFirstTab && 'active'}`}\n\t\t\t\t\tdataset={{\n\t\t\t\t\t\tbsToggle: 'tab',\n\t\t\t\t\t\tbsTarget: `#${contentId}`,\n\t\t\t\t\t}}\n\t\t\t\t\tattributes={{\n\t\t\t\t\t\trole: 'tab',\n\t\t\t\t\t\t'aria-selected': isFirstTab,\n\t\t\t\t\t}}\n\t\t\t\t\ttype=\"button\">\n\t\t\t\t\t{title}\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t);\n\t\ttab.setAttribute('aria-controls', contentId);\n\n\t\tthis.simTabsContainer.appendChild(tab);\n\t}\n\n\taddSimTabLink(tab: SimTab) {\n\t\tconst isFirstTab = this.simTabsContainer.children.length == 0;\n\n\t\ttab.navLink.setAttribute('aria-selected', isFirstTab.toString());\n\n\t\tif (isFirstTab) tab.navLink.classList.add('active', 'show');\n\n\t\tthis.simTabsContainer.appendChild(tab.navItem);\n\t}\n\n\taddImportLink(label: string, onClick: (parent: HTMLElement) => void, hideInRaidSim?: boolean) {\n\t\tthis.addImportExportLink('import-dropdown', label, onClick, hideInRaidSim);\n\t}\n\taddExportLink(label: string, onClick: (parent: HTMLElement) => void, hideInRaidSim?: boolean) {\n\t\tthis.addImportExportLink('export-dropdown', label, onClick, hideInRaidSim);\n\t}\n\tprivate addImportExportLink(cssClass: string, label: string, onClick: (parent: HTMLElement) => void, hideInRaidSim?: boolean) {\n\t\tconst dropdownElem = this.rootElem.getElementsByClassName(cssClass)[0] as HTMLElement;\n\t\tconst menuElem = dropdownElem.getElementsByClassName('dropdown-menu')[0] as HTMLElement;\n\n\t\tconst itemElem = (\n\t\t\t<li>\n\t\t\t\t<a\n\t\t\t\t\thref=\"javascript:void(0)\"\n\t\t\t\t\tclassName=\"dropdown-item\"\n\t\t\t\t\tattributes={{\n\t\t\t\t\t\trole: 'button',\n\t\t\t\t\t}}>\n\t\t\t\t\t{label}\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t);\n\n\t\tconst linkElem = itemElem.children[0];\n\t\tlinkElem.addEventListener('click', () => onClick(menuElem));\n\t\tmenuElem.appendChild(itemElem);\n\t}\n\n\tprivate addToolbarLink(args: ToolbarLinkArgs): HTMLElement {\n\t\tconst item = (\n\t\t\t<div className=\"sim-toolbar-item\">\n\t\t\t\t<a href={args.href ? args.href : 'javascript:void(0)'} className={args.classes} target={args.href ? '_blank' : '_self'}>\n\t\t\t\t\t{args.icon && <i className={args.icon}></i>}\n\t\t\t\t\t{args.text ? ` ${args.text} ` : ''}\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t);\n\n\t\tconst link = item.children[0];\n\n\t\tif (args.onclick) {\n\t\t\tlink.addEventListener('click', () => {\n\t\t\t\t// Typescript is requiring this even though the condition is being done already above\n\t\t\t\tif (args.onclick) args.onclick();\n\t\t\t});\n\t\t}\n\n\t\tif (args.tooltip) {\n\t\t\tnew Tooltip(link, {\n\t\t\t\tplacement: 'bottom',\n\t\t\t\ttitle: args.tooltip,\n\t\t\t\thtml: true,\n\t\t\t});\n\t\t}\n\n\t\treturn args.parent.appendChild(item) as HTMLElement;\n\t}\n\n\tprivate addKnownIssuesLink(): HTMLElement {\n\t\treturn this.addToolbarLink({\n\t\t\tparent: this.simToolbar,\n\t\t\ttext: 'Known Issues',\n\t\t\ttooltip: this.knownIssuesContent,\n\t\t\tclasses: 'known-issues link-danger hide',\n\t\t}).children[0] as HTMLElement;\n\t}\n\n\taddKnownIssue(issue: string) {\n\t\tthis.knownIssuesContent.appendChild(<li>{issue}</li>);\n\t\tthis.knownIssuesLink.classList.remove('hide');\n\t\tTooltip.getInstance(this.knownIssuesLink)?.setContent({ '.tooltip-inner': this.knownIssuesContent });\n\t}\n\n\tprivate addBugReportLink() {\n\t\tthis.addToolbarLink({\n\t\t\thref: 'https://github.com/wowsims/cata/issues/new/choose',\n\t\t\tparent: this.simToolbar,\n\t\t\ticon: 'fas fa-bug fa-lg',\n\t\t\ttooltip: 'Report a bug or<br>Request a feature',\n\t\t});\n\t}\n\n\tprivate addDownloadBinaryLink() {\n\t\tconst href = 'https://github.com/wowsims/cata/releases';\n\t\tconst icon = 'fas fa-gauge-high fa-lg';\n\t\tconst parent = this.simToolbar;\n\n\t\tif (document.location.href.includes('localhost')) {\n\t\t\tfetch('/version').then(resp => {\n\t\t\t\tresp.json()\n\t\t\t\t\t.then(versionInfo => {\n\t\t\t\t\t\tif (versionInfo.outdated == 2) {\n\t\t\t\t\t\t\tthis.addToolbarLink({\n\t\t\t\t\t\t\t\thref: href,\n\t\t\t\t\t\t\t\tparent: parent,\n\t\t\t\t\t\t\t\ticon: icon,\n\t\t\t\t\t\t\t\ttooltip: 'Newer version of simulator available for download',\n\t\t\t\t\t\t\t\tclasses: 'downbin link-danger',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch(_error => {\n\t\t\t\t\t\tconsole.warn('No version info found!');\n\t\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\tthis.addToolbarLink({\n\t\t\t\thref: href,\n\t\t\t\tparent: parent,\n\t\t\t\ticon: icon,\n\t\t\t\ttooltip: 'Download simulator for faster simulating',\n\t\t\t\tclasses: 'downbin',\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate addSimOptionsLink() {\n\t\tthis.addToolbarLink({\n\t\t\tparent: this.simToolbar,\n\t\t\ticon: 'fas fa-cog fa-lg',\n\t\t\ttooltip: 'Show Sim Options',\n\t\t\tclasses: 'sim-options',\n\t\t\tonclick: () => new SettingsMenu(this.simUI.rootElem, this.simUI),\n\t\t});\n\t}\n\n\tprivate addSocialLinks() {\n\t\tconst container = document.createElement('div');\n\t\tcontainer.classList.add('sim-toolbar-socials');\n\t\tthis.simToolbar.appendChild(container);\n\n\t\tthis.addDiscordLink(container);\n\t\tthis.addGitHubLink(container);\n\t\tthis.addPatreonLink(container);\n\t}\n\n\tprivate addDiscordLink(container: HTMLElement) {\n\t\tcontainer.appendChild(<div className=\"sim-toolbar-item\">{SocialLinks.buildDiscordLink()}</div>);\n\t}\n\n\tprivate addGitHubLink(container: HTMLElement) {\n\t\tcontainer.appendChild(<div className=\"sim-toolbar-item\">{SocialLinks.buildGitHubLink()}</div>);\n\t}\n\n\tprivate addPatreonLink(container: HTMLElement) {\n\t\tcontainer.appendChild(<div className=\"sim-toolbar-item\">{SocialLinks.buildPatreonLink()}</div>);\n\t}\n\n\tprotected customRootElement(): HTMLElement {\n\t\treturn (\n\t\t\t<header className=\"sim-header\">\n\t\t\t\t<div className=\"sim-header-container\">\n\t\t\t\t\t<ul className=\"sim-tabs nav nav-tabs\" attributes={{ role: 'tablist' }}></ul>\n\t\t\t\t\t<div className=\"import-export within-raid-sim-hide\">\n\t\t\t\t\t\t<div className=\"dropdown sim-dropdown-menu import-dropdown\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref=\"javascript:void(0)\"\n\t\t\t\t\t\t\t\tclassName=\"import-link\"\n\t\t\t\t\t\t\t\tattributes={{ role: 'button', 'aria-expanded': 'false' }}\n\t\t\t\t\t\t\t\tdataset={{ bsToggle: 'dropdown', bsDisplay: 'dynamic' }}>\n\t\t\t\t\t\t\t\t<i className=\"fa fa-download\"></i>\n\t\t\t\t\t\t\t\t{' Import '}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t<ul className=\"dropdown-menu\"></ul>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"dropdown sim-dropdown-menu export-dropdown\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref=\"javascript:void(0)\"\n\t\t\t\t\t\t\t\tclassName=\"export-link\"\n\t\t\t\t\t\t\t\tattributes={{ role: 'button', 'aria-expanded': 'false' }}\n\t\t\t\t\t\t\t\tdataset={{ bsToggle: 'dropdown', bsDisplay: 'dynamic' }}>\n\t\t\t\t\t\t\t\t<i className=\"fa fa-right-from-bracket\"></i>\n\t\t\t\t\t\t\t\t{' Export '}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t<ul className=\"dropdown-menu\"></ul>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"sim-toolbar\"></div>\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t) as HTMLElement;\n\t}\n}\n","import { LaunchStatus, raidSimStatus, simLaunchStatuses } from '../launched_sims.js';\nimport { PlayerClass } from '../player_class';\nimport { PlayerClasses } from '../player_classes';\nimport { PlayerSpec } from '../player_spec';\nimport { PlayerSpecs } from '../player_specs';\nimport { Class, Spec } from '../proto/common';\nimport { raidSimIcon, raidSimLabel, raidSimSiteUrl, textCssClassForClass, textCssClassForSpec } from '../proto_utils/utils.js';\nimport { Component } from './component.js';\n\ninterface ClassOptions {\n\ttype: 'Class';\n\tclass: PlayerClass<Class>;\n}\n\ninterface SpecOptions {\n\ttype: 'Spec';\n\tspec: PlayerSpec<any>;\n}\n\ninterface RaidOptions {\n\ttype: 'Raid';\n}\n\ntype SimTitleDropdownConfig = {\n\tnoDropdown?: boolean;\n};\n\n// Dropdown menu for selecting a player.\nexport class SimTitleDropdown extends Component {\n\tprivate readonly dropdownMenu: HTMLElement | undefined;\n\n\tconstructor(parent: HTMLElement, currentSpec: PlayerSpec<any> | null, config: SimTitleDropdownConfig = {}) {\n\t\tsuper(parent, 'sim-title-dropdown-root');\n\n\t\tconst rootLinkArgs: SpecOptions | RaidOptions = !!currentSpec ? { type: 'Spec', spec: currentSpec } : { type: 'Raid' };\n\t\tconst rootLink = this.buildRootSimLink(rootLinkArgs);\n\n\t\tif (config.noDropdown) {\n\t\t\tthis.rootElem.innerHTML = rootLink.outerHTML;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"dropdown sim-link-dropdown\">\n\t\t\t\t${rootLink.outerHTML}\n\t\t\t\t<ul class=\"dropdown-menu\"></ul>\n\t\t\t</div>\n    \t`;\n\n\t\tthis.dropdownMenu = this.rootElem.getElementsByClassName('dropdown-menu')[0] as HTMLElement;\n\t\tthis.buildDropdown();\n\n\t\t// Prevent Bootstrap from closing the menu instead of opening class menus\n\t\tthis.dropdownMenu.addEventListener('click', event => {\n\t\t\tconst target = event.target as HTMLElement;\n\t\t\tconst link = target.closest('a:not([href=\"javascript:void(0)\"]');\n\n\t\t\tif (!link) {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate buildDropdown() {\n\t\tif (raidSimStatus.status >= LaunchStatus.Alpha) {\n\t\t\t// Add the raid sim to the top of the dropdown\n\t\t\tconst raidListItem = document.createElement('li');\n\t\t\traidListItem.appendChild(this.buildRaidLink());\n\t\t\tthis.dropdownMenu?.appendChild(raidListItem);\n\t\t}\n\n\t\tPlayerClasses.naturalOrder.forEach(klass => {\n\t\t\tconst listItem = document.createElement('li');\n\t\t\t// Add the class to the dropdown with an additional spec dropdown\n\t\t\tlistItem.appendChild(this.buildClassDropdown(klass));\n\t\t\tthis.dropdownMenu?.appendChild(listItem);\n\t\t});\n\t}\n\n\tprivate buildClassDropdown(klass: PlayerClass<Class>) {\n\t\tconst dropdownFragment = document.createElement('fragment');\n\t\tconst dropdownMenu = document.createElement('ul');\n\t\tdropdownMenu.classList.add('dropdown-menu');\n\n\t\t// Generate the class link to act as a dropdown toggle for the spec dropdown\n\t\tconst classLink = this.buildClassLink(klass);\n\n\t\t// Generate links for a class's specs\n\t\tObject.values(klass.specs).forEach(spec => {\n\t\t\tconst listItem = document.createElement('li');\n\t\t\tconst link = this.buildSpecLink(spec);\n\n\t\t\tlistItem.appendChild(link);\n\t\t\tdropdownMenu.appendChild(listItem);\n\t\t});\n\n\t\tdropdownFragment.innerHTML = `\n\t\t\t<div class=\"dropend sim-link-dropdown\">\n\t\t\t\t${classLink.outerHTML}\n\t\t\t\t${dropdownMenu.outerHTML}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn dropdownFragment.children[0] as HTMLElement;\n\t}\n\n\tprivate buildRootSimLink(data: SpecOptions | RaidOptions): HTMLElement {\n\t\tconst iconPath = this.getSimIconPath(data);\n\t\tconst textKlass = this.getContextualKlass(data);\n\n\t\tlet label = '';\n\t\tif (data.type == 'Raid') {\n\t\t\tlabel = raidSimLabel;\n\t\t} else if (data.type == 'Spec') {\n\t\t\tlabel = PlayerSpecs.getFullSpecName(data.spec);\n\t\t}\n\n\t\tconst fragment = document.createElement('fragment');\n\t\tfragment.innerHTML = `\n\t\t\t<a href=\"javascript:void(0)\" class=\"sim-link ${textKlass}\" role=\"button\" data-bs-toggle=\"dropdown\" data-bs-trigger=\"click\" aria-expanded=\"false\">\n\t\t\t\t<div class=\"sim-link-content\">\n\t\t\t\t<img src=\"${iconPath}\" class=\"sim-link-icon\">\n\t\t\t\t<div class=\"d-flex flex-column\">\n\t\t\t\t\t<span class=\"sim-link-label text-white\">WoWSims - Cataclysm</span>\n\t\t\t\t\t<span class=\"sim-link-title\">${label}</span>\n\t\t\t\t\t${this.launchStatusLabel(data)}\n\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t`;\n\n\t\treturn fragment.children[0] as HTMLElement;\n\t}\n\n\tprivate buildRaidLink(): HTMLElement {\n\t\tconst textKlass = this.getContextualKlass({ type: 'Raid' });\n\t\tconst iconPath = this.getSimIconPath({ type: 'Raid' });\n\t\tconst label = raidSimLabel;\n\n\t\tconst fragment = document.createElement('fragment');\n\t\tfragment.innerHTML = `\n\t\t\t<a href=\"${raidSimSiteUrl}\" class=\"sim-link ${textKlass}\">\n\t\t\t\t<div class=\"sim-link-content\">\n\t\t\t\t<img src=\"${iconPath}\" class=\"sim-link-icon\">\n\t\t\t\t<div class=\"d-flex flex-column\">\n\t\t\t\t\t<span class=\"sim-link-title\">${label}</span>\n\t\t\t\t\t${this.launchStatusLabel({ type: 'Raid' })}\n\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t`;\n\n\t\treturn fragment.children[0] as HTMLElement;\n\t}\n\n\tprivate buildClassLink(klass: PlayerClass<Class>): HTMLElement {\n\t\tconst textKlass = this.getContextualKlass({ type: 'Class', class: klass });\n\t\tconst iconPath = this.getSimIconPath({ type: 'Class', class: klass });\n\t\tconst label = klass.friendlyName;\n\n\t\tconst fragment = document.createElement('fragment');\n\t\tfragment.innerHTML = `\n\t\t\t<a href=\"javascript:void(0)\" class=\"sim-link ${textKlass}\" role=\"button\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\n\t\t\t\t<div class=\"sim-link-content\">\n\t\t\t\t<img src=\"${iconPath}\" class=\"sim-link-icon\">\n\t\t\t\t<div class=\"d-flex flex-column\">\n\t\t\t\t\t<span class=\"sim-link-title\">${label}</span>\n\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t`;\n\n\t\treturn fragment.children[0] as HTMLElement;\n\t}\n\n\tprivate buildSpecLink(spec: PlayerSpec<any>): HTMLElement {\n\t\tconst textKlass = this.getContextualKlass({ type: 'Spec', spec: spec });\n\t\tconst iconPath = this.getSimIconPath({ type: 'Spec', spec: spec });\n\n\t\tconst fragment = document.createElement('fragment');\n\t\tfragment.innerHTML = `\n\t\t\t<a href=\"${spec.simLink}\" class=\"sim-link ${textKlass}\" role=\"button\">\n\t\t\t\t<div class=\"sim-link-content\">\n\t\t\t\t<img src=\"${iconPath}\" class=\"sim-link-icon\">\n\t\t\t\t<div class=\"d-flex flex-column\">\n\t\t\t\t\t<span class=\"sim-link-label\">${PlayerSpecs.getPlayerClass(spec).friendlyName}</span>\n\t\t\t\t\t<span class=\"sim-link-title\">${spec.friendlyName}</span>\n\t\t\t\t\t${this.launchStatusLabel({ type: 'Spec', spec: spec })}\n\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t`;\n\n\t\treturn fragment.children[0] as HTMLElement;\n\t}\n\n\tprivate launchStatusLabel(data: SpecOptions | RaidOptions): string {\n\t\tif (\n\t\t\t(data.type == 'Raid' && raidSimStatus.status == LaunchStatus.Launched) ||\n\t\t\t(data.type == 'Spec' && simLaunchStatuses[data.spec.specID as Spec].status == LaunchStatus.Launched)\n\t\t)\n\t\t\treturn '';\n\n\t\tconst status = data.type == 'Raid' ? raidSimStatus.status : simLaunchStatuses[data.spec.specID as Spec].status;\n\t\tconst phase = data.type == 'Raid' ? raidSimStatus.phase : simLaunchStatuses[data.spec.specID as Spec].phase;\n\n\t\tconst elem = document.createElement('span');\n\t\telem.classList.add('launch-status-label', 'text-brand');\n\t\telem.textContent = status == LaunchStatus.Unlaunched ? 'Not Yet Supported' : `Phase ${phase} - ${LaunchStatus[status]}`;\n\n\t\treturn elem.outerHTML;\n\t}\n\n\tprivate getSimIconPath(data: ClassOptions | SpecOptions | RaidOptions): string {\n\t\tlet iconPath = '';\n\t\tif (data.type == 'Raid') {\n\t\t\ticonPath = raidSimIcon;\n\t\t} else if (data.type == 'Class') {\n\t\t\ticonPath = data.class.getIcon('large');\n\t\t} else if (data.type == 'Spec') {\n\t\t\ticonPath = data.spec.getIcon('large');\n\t\t}\n\n\t\treturn iconPath;\n\t}\n\n\tprivate getContextualKlass(data: ClassOptions | SpecOptions | RaidOptions): string {\n\t\tswitch (data.type) {\n\t\t\tcase 'Class':\n\t\t\t\treturn textCssClassForClass(data.class);\n\t\t\tcase 'Spec':\n\t\t\t\treturn textCssClassForSpec(data.spec);\n\t\t\tdefault:\n\t\t\t\treturn 'text-white';\n\t\t}\n\t}\n}\n","import { BaseModal } from './components/base_modal.js';\nimport { Component } from './components/component.js';\nimport { NumberPicker } from './components/number_picker.js';\nimport { ResultsViewer } from './components/results_viewer.js';\nimport { SimHeader } from './components/sim_header';\nimport { SimTab } from './components/sim_tab.js';\nimport { SimTitleDropdown } from './components/sim_title_dropdown.js';\nimport { SocialLinks } from './components/social_links';\nimport { LaunchStatus, SimStatus } from './launched_sims.js';\nimport { PlayerSpec } from './player_spec';\nimport { ActionId } from './proto_utils/action_id.js';\nimport { Sim, SimError } from './sim.js';\nimport { EventID, TypedEvent } from './typed_event.js';\n\nconst URLMAXLEN = 2048;\nconst globalKnownIssues: Array<string> = [];\n\n// Config for displaying a warning to the user whenever a condition is met.\nexport interface SimWarning {\n\tupdateOn: TypedEvent<any>;\n\tgetContent: () => string | Array<string>;\n}\n\nexport interface SimUIConfig {\n\t// Additional css class to add to the root element.\n\tcssClass: string;\n\t// Scheme used for themeing on a per-class Basis or for other sims\n\tcssScheme: string;\n\t// The spec, if an individual sim, or null if the raid sim.\n\tspec: PlayerSpec<any> | null;\n\tsimStatus: SimStatus;\n\tknownIssues?: Array<string>;\n\tnoticeText?: string;\n}\n\n// Shared UI for all individual sims and the raid sim.\nexport abstract class SimUI extends Component {\n\treadonly sim: Sim;\n\treadonly cssClass: string;\n\treadonly cssScheme: string;\n\treadonly isWithinRaidSim: boolean;\n\n\t// Emits when anything from the sim, raid, or encounter changes.\n\treadonly changeEmitter;\n\n\treadonly resultsViewer: ResultsViewer;\n\treadonly simHeader: SimHeader;\n\n\treadonly simContentContainer: HTMLElement;\n\treadonly simMain: HTMLElement;\n\treadonly simActionsContainer: HTMLElement;\n\treadonly iterationsPicker: HTMLElement;\n\treadonly simTabContentsContainer: HTMLElement;\n\n\tconstructor(parentElem: HTMLElement, sim: Sim, config: SimUIConfig) {\n\t\tsuper(parentElem, 'sim-ui');\n\t\tthis.sim = sim;\n\t\tthis.cssClass = config.cssClass;\n\t\tthis.cssScheme = config.cssScheme;\n\t\tthis.isWithinRaidSim = this.rootElem.closest('.within-raid-sim') != null;\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"sim-root\">\n\t\t\t\t<div class=\"sim-bg\"></div>\n\t\t\t\t${config.noticeText ? `<div class=\"notices-banner alert border-bottom mb-0 text-center within-raid-sim-hide\">${config.noticeText}</div>` : ''}\n\t\t\t\t<div class=\"sim-container\">\n\t\t\t\t\t<aside class=\"sim-sidebar\">\n\t\t\t\t\t\t<div class=\"sim-title\"></div>\n\t\t\t\t\t\t<div class=\"sim-sidebar-content\">\n\t\t\t\t\t\t\t<div class=\"sim-sidebar-actions within-raid-sim-hide\"></div>\n\t\t\t\t\t\t\t<div class=\"sim-sidebar-results within-raid-sim-hide\"></div>\n\t\t\t\t\t\t\t<div class=\"sim-sidebar-stats\"></div>\n\t\t\t\t\t\t\t<div class=\"sim-sidebar-socials\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</aside>\n\t\t\t\t\t<div class=\"sim-content container-fluid\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tthis.simContentContainer = this.rootElem.querySelector('.sim-content') as HTMLElement;\n\t\tthis.simHeader = new SimHeader(this.simContentContainer, this);\n\t\tthis.simMain = document.createElement('main');\n\t\tthis.simMain.classList.add('sim-main', 'tab-content');\n\t\tthis.simContentContainer.appendChild(this.simMain);\n\n\t\tthis.rootElem.classList.add(this.cssClass);\n\n\t\tif (!this.isWithinRaidSim) {\n\t\t\tthis.rootElem.classList.add('not-within-raid-sim');\n\t\t}\n\n\t\tthis.changeEmitter = TypedEvent.onAny([this.sim.changeEmitter], 'SimUIChange');\n\n\t\tthis.sim.crashEmitter.on((eventID: EventID, error: SimError) => this.handleCrash(error));\n\n\t\tconst updateShowDamageMetrics = () => {\n\t\t\tif (this.sim.getShowDamageMetrics()) this.rootElem.classList.remove('hide-damage-metrics');\n\t\t\telse this.rootElem.classList.add('hide-damage-metrics');\n\t\t};\n\t\tupdateShowDamageMetrics();\n\t\tthis.sim.showDamageMetricsChangeEmitter.on(updateShowDamageMetrics);\n\n\t\tconst updateShowThreatMetrics = () => {\n\t\t\tif (this.sim.getShowThreatMetrics()) this.rootElem.classList.remove('hide-threat-metrics');\n\t\t\telse this.rootElem.classList.add('hide-threat-metrics');\n\t\t};\n\t\tupdateShowThreatMetrics();\n\t\tthis.sim.showThreatMetricsChangeEmitter.on(updateShowThreatMetrics);\n\n\t\tconst updateShowHealingMetrics = () => {\n\t\t\tif (this.sim.getShowHealingMetrics()) this.rootElem.classList.remove('hide-healing-metrics');\n\t\t\telse this.rootElem.classList.add('hide-healing-metrics');\n\t\t};\n\t\tupdateShowHealingMetrics();\n\t\tthis.sim.showHealingMetricsChangeEmitter.on(updateShowHealingMetrics);\n\n\t\tconst updateShowEpRatios = () => {\n\t\t\t// Threat metrics *always* shows multiple columns, so\n\t\t\t// always show ratios when they are shown\n\t\t\tif (this.sim.getShowThreatMetrics()) {\n\t\t\t\tthis.rootElem.classList.remove('hide-ep-ratios');\n\t\t\t\t// This case doesn't currently happen, but who knows\n\t\t\t\t// what the future holds...\n\t\t\t} else if (this.sim.getShowDamageMetrics() && this.sim.getShowHealingMetrics()) {\n\t\t\t\tthis.rootElem.classList.remove('hide-ep-ratios');\n\t\t\t} else {\n\t\t\t\tthis.rootElem.classList.add('hide-ep-ratios');\n\t\t\t}\n\t\t};\n\n\t\tupdateShowEpRatios();\n\t\tthis.sim.showDamageMetricsChangeEmitter.on(updateShowEpRatios);\n\t\tthis.sim.showHealingMetricsChangeEmitter.on(updateShowEpRatios);\n\t\tthis.sim.showThreatMetricsChangeEmitter.on(updateShowEpRatios);\n\n\t\tconst updateShowExperimental = () => {\n\t\t\tif (this.sim.getShowExperimental()) this.rootElem.classList.remove('hide-experimental');\n\t\t\telse this.rootElem.classList.add('hide-experimental');\n\t\t};\n\t\tupdateShowExperimental();\n\t\tthis.sim.showExperimentalChangeEmitter.on(updateShowExperimental);\n\n\t\tthis.addKnownIssues(config);\n\n\t\t// Sidebar Contents\n\n\t\tconst titleElem = this.rootElem.querySelector('.sim-title') as HTMLElement;\n\t\tnew SimTitleDropdown(titleElem, config.spec, { noDropdown: this.isWithinRaidSim });\n\n\t\tthis.simActionsContainer = this.rootElem.querySelector('.sim-sidebar-actions') as HTMLElement;\n\t\tthis.iterationsPicker = new NumberPicker(this.simActionsContainer, this.sim, {\n\t\t\tlabel: 'Iterations',\n\t\t\textraCssClasses: ['iterations-picker', 'within-raid-sim-hide'],\n\t\t\tchangedEvent: (sim: Sim) => sim.iterationsChangeEmitter,\n\t\t\tgetValue: (sim: Sim) => sim.getIterations(),\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\n\t\t\t\tsim.setIterations(eventID, newValue);\n\t\t\t},\n\t\t}).rootElem;\n\n\t\tconst resultsViewerElem = this.rootElem.querySelector('.sim-sidebar-results') as HTMLElement;\n\t\tthis.resultsViewer = new ResultsViewer(resultsViewerElem);\n\n\t\tconst socialsContainer = this.rootElem.querySelector('.sim-sidebar-socials') as HTMLElement;\n\t\tsocialsContainer.appendChild(SocialLinks.buildDiscordLink());\n\t\tsocialsContainer.appendChild(SocialLinks.buildGitHubLink());\n\t\tsocialsContainer.appendChild(SocialLinks.buildPatreonLink());\n\n\t\tthis.simTabContentsContainer = this.rootElem.querySelector('.sim-main.tab-content') as HTMLElement;\n\n\t\tif (!this.isWithinRaidSim) {\n\t\t\twindow.addEventListener('message', async event => {\n\t\t\t\tif (event.data == 'runOnce') {\n\t\t\t\t\tthis.runSimOnce();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\taddAction(name: string, cssClass: string, actFn: () => void) {\n\t\tconst button = document.createElement('button');\n\t\tbutton.classList.add('btn', 'btn-primary', 'w-100', cssClass);\n\t\tbutton.textContent = name;\n\t\tbutton.addEventListener('click', actFn);\n\t\tthis.simActionsContainer.appendChild(button);\n\t}\n\n\taddTab(title: string, cssClass: string, innerHTML: string) {\n\t\tconst contentId = cssClass.replace(/\\s+/g, '-') + '-tab';\n\t\tconst isFirstTab = this.simTabContentsContainer.children.length == 0;\n\n\t\tthis.simHeader.addTab(title, contentId);\n\n\t\tconst tabContentFragment = document.createElement('fragment');\n\t\ttabContentFragment.innerHTML = `\n\t\t\t<div\n\t\t\t\tid=\"${contentId}\"\n\t\t\t\tclass=\"tab-pane fade ${isFirstTab ? 'active show' : ''}\"\n\t\t\t>${innerHTML}</div>\n\t\t`;\n\t\tthis.simTabContentsContainer.appendChild(tabContentFragment.children[0] as HTMLElement);\n\t}\n\n\taddSimTab(tab: SimTab) {\n\t\tthis.simHeader.addSimTabLink(tab);\n\t}\n\n\taddWarning(warning: SimWarning) {\n\t\tthis.resultsViewer.addWarning(warning);\n\t}\n\n\tprivate addKnownIssues(config: SimUIConfig) {\n\t\tlet statusStr = '';\n\t\tif (config.simStatus.status == LaunchStatus.Unlaunched) {\n\t\t\tstatusStr = 'This sim is a WORK IN PROGRESS. It is not fully developed and should not be used for general purposes.';\n\t\t} else if (config.simStatus.status == LaunchStatus.Alpha) {\n\t\t\tstatusStr = 'This sim is in ALPHA. Bugs are expected; please let us know if you find one!';\n\t\t} else if (config.simStatus.status == LaunchStatus.Beta) {\n\t\t\tstatusStr = 'This sim is in BETA. There may still be a few bugs; please let us know if you find one!';\n\t\t}\n\t\tif (statusStr) {\n\t\t\tconfig.knownIssues = [statusStr].concat(config.knownIssues || []);\n\t\t}\n\t\tif (config.knownIssues && config.knownIssues.length) {\n\t\t\tconfig.knownIssues.forEach(issue => this.simHeader.addKnownIssue(issue));\n\t\t}\n\t\tglobalKnownIssues.forEach(issue => this.simHeader.addKnownIssue(issue));\n\t}\n\n\t// Returns a key suitable for the browser's localStorage feature.\n\tabstract getStorageKey(postfix: string): string;\n\n\tgetSettingsStorageKey(): string {\n\t\treturn this.getStorageKey('__currentSettings__');\n\t}\n\n\tgetSavedEncounterStorageKey(): string {\n\t\t// By skipping the call to this.getStorageKey(), saved encounters will be\n\t\t// shared across all sims.\n\t\treturn 'sharedData__savedEncounter__';\n\t}\n\n\tisIndividualSim(): boolean {\n\t\treturn this.rootElem.classList.contains('individual-sim-ui');\n\t}\n\n\tasync runSim(onProgress: (_?: any) => void) {\n\t\tthis.resultsViewer.setPending();\n\t\ttry {\n\t\t\tawait this.sim.runRaidSim(TypedEvent.nextEventID(), onProgress);\n\t\t} catch (e) {\n\t\t\tthis.resultsViewer.hideAll();\n\t\t\tthis.handleCrash(e);\n\t\t}\n\t}\n\n\tasync runSimOnce() {\n\t\tthis.resultsViewer.setPending();\n\t\ttry {\n\t\t\tawait this.sim.runRaidSimWithLogs(TypedEvent.nextEventID());\n\t\t} catch (e) {\n\t\t\tthis.resultsViewer.hideAll();\n\t\t\tthis.handleCrash(e);\n\t\t}\n\t}\n\n\tasync handleCrash(error: any): Promise<void> {\n\t\tif (!(error instanceof SimError)) {\n\t\t\talert(error);\n\t\t\treturn;\n\t\t}\n\n\t\tconst errorStr = (error as SimError).errorStr;\n\t\tif (errorStr.startsWith('[USER_ERROR] ')) {\n\t\t\tlet alertStr = errorStr.substring('[USER_ERROR] '.length);\n\t\t\talertStr = await ActionId.replaceAllInString(alertStr);\n\t\t\talert(alertStr);\n\t\t\treturn;\n\t\t}\n\n\t\tif (window.confirm('Simulation Failure:\\n' + errorStr + '\\nPress Ok to file crash report')) {\n\t\t\t// Splice out just the line numbers\n\t\t\tconst hash = this.hashCode(errorStr);\n\t\t\tconst link = this.toLink();\n\t\t\tconst rngSeed = this.sim.getLastUsedRngSeed();\n\t\t\tfetch('https://api.github.com/search/issues?q=is:issue+is:open+repo:wowsims/cata+' + hash)\n\t\t\t\t.then(resp => {\n\t\t\t\t\tresp.json().then(issues => {\n\t\t\t\t\t\tif (issues.total_count > 0) {\n\t\t\t\t\t\t\twindow.open(issues.items[0].html_url, '_blank');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst base_url = 'https://github.com/wowsims/cata/issues/new?assignees=&labels=&title=Crash%20Report%20';\n\t\t\t\t\t\t\tconst base = `${base_url}${hash}&body=`;\n\t\t\t\t\t\t\tconst maxBodyLength = URLMAXLEN - base.length;\n\t\t\t\t\t\t\tlet issueBody = encodeURIComponent(`Link:\\n${link}\\n\\nRNG Seed: ${rngSeed}\\n\\n${errorStr}`);\n\t\t\t\t\t\t\tif (link.includes('/raid/')) {\n\t\t\t\t\t\t\t\t// Move the actual error before the link, as it will likely get truncated.\n\t\t\t\t\t\t\t\tissueBody = encodeURIComponent(`${errorStr}\\nRNG Seed: ${rngSeed}\\nLink:\\n${link}`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlet truncated = false;\n\t\t\t\t\t\t\twhile (issueBody.length > maxBodyLength - (truncated ? 3 : 0)) {\n\t\t\t\t\t\t\t\tissueBody = issueBody.slice(0, issueBody.lastIndexOf('%')); // Avoid truncating in the middle of a URLencoded segment.\n\t\t\t\t\t\t\t\ttruncated = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (truncated) {\n\t\t\t\t\t\t\t\tissueBody += '...';\n\t\t\t\t\t\t\t\t// The raid links are too large and will always cause truncation.\n\t\t\t\t\t\t\t\t// Prompt the user to add more information to the issue.\n\t\t\t\t\t\t\t\tnew CrashModal(this.rootElem, link);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\twindow.open(base + issueBody, '_blank');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch(fetchErr => {\n\t\t\t\t\talert('Failed to file report... try again another time:' + fetchErr);\n\t\t\t\t});\n\t\t}\n\t}\n\n\thashCode(str: string): number {\n\t\tlet hash = 0;\n\t\tfor (let i = 0, len = str.length; i < len; i++) {\n\t\t\tconst chr = str.charCodeAt(i);\n\t\t\thash = (hash << 5) - hash + chr;\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\t\treturn hash;\n\t}\n\n\tabstract applyDefaults(eventID: EventID): void;\n\tabstract toLink(): string;\n}\n\nclass CrashModal extends BaseModal {\n\tconstructor(parent: HTMLElement, link: string) {\n\t\tsuper(parent, 'crash', { title: 'Extra Crash Information' });\n\t\tthis.body.innerHTML = `\n\t\t\t<div class=\"sim-crash-report\">\n\t\t\t\t<h3 class=\"sim-crash-report-header\">Please append the following complete link to the issue you just created. This will simplify debugging the issue.</h3>\n\t\t\t\t<textarea class=\"sim-crash-report-text form-control\"></textarea>\n\t\t\t</div>\n\t\t`;\n\t\tconst text = document.createTextNode(link);\n\t\tthis.body.querySelector('textarea')?.appendChild(text);\n\t}\n}\n","import { CharacterStats, StatMods, StatWrites } from './components/character_stats';\nimport { ContentBlock } from './components/content_block';\nimport { EmbeddedDetailedResults } from './components/detailed_results';\nimport { EncounterPickerConfig } from './components/encounter_picker';\nimport * as Exporters from './components/exporters';\nimport * as IconInputs from './components/icon_inputs';\nimport * as Importers from './components/importers';\nimport { BulkTab } from './components/individual_sim_ui/bulk_tab';\nimport { GearTab } from './components/individual_sim_ui/gear_tab';\nimport { RotationTab } from './components/individual_sim_ui/rotation_tab';\nimport { SettingsTab } from './components/individual_sim_ui/settings_tab';\nimport { TalentsTab } from './components/individual_sim_ui/talents_tab';\nimport * as InputHelpers from './components/input_helpers';\nimport { addRaidSimAction, RaidSimResultsManager } from './components/raid_sim_action';\nimport { SavedDataConfig } from './components/saved_data_manager';\nimport { addStatWeightsAction } from './components/stat_weights_action';\nimport * as Mechanics from './constants/mechanics';\nimport * as Tooltips from './constants/tooltips';\nimport { simLaunchStatuses } from './launched_sims';\nimport { Player, PlayerConfig, registerSpecConfig as registerPlayerConfig } from './player';\nimport { PlayerSpecs } from './player_specs';\nimport { PresetGear, PresetRotation } from './preset_utils';\nimport { StatWeightsResult } from './proto/api';\nimport {\n\tConsumes,\n\tDebuffs,\n\tEncounter as EncounterProto,\n\tEquipmentSpec,\n\tFaction,\n\tGlyphs,\n\tHandType,\n\tIndividualBuffs,\n\tItemSlot,\n\tPartyBuffs,\n\tProfession,\n\tPseudoStat,\n\tRace,\n\tRaidBuffs,\n\tSpec,\n\tStat,\n} from './proto/common';\nimport { IndividualSimSettings, SavedTalents } from './proto/ui';\nimport { getMetaGemConditionDescription } from './proto_utils/gems';\nimport { professionNames } from './proto_utils/names';\nimport { Stats } from './proto_utils/stats';\nimport { getTalentPoints, SpecOptions } from './proto_utils/utils';\nimport { SimSettingCategories } from './sim';\nimport { SimUI, SimWarning } from './sim_ui';\nimport { MAX_POINTS_PLAYER } from './talents/talents_picker';\nimport { EventID, TypedEvent } from './typed_event';\n\nconst SAVED_GEAR_STORAGE_KEY = '__savedGear__';\nconst SAVED_ROTATION_STORAGE_KEY = '__savedRotation__';\nconst SAVED_SETTINGS_STORAGE_KEY = '__savedSettings__';\nconst SAVED_TALENTS_STORAGE_KEY = '__savedTalents__';\n\nexport type InputConfig<ModObject> =\n\t| InputHelpers.TypedBooleanPickerConfig<ModObject>\n\t| InputHelpers.TypedNumberPickerConfig<ModObject>\n\t| InputHelpers.TypedEnumPickerConfig<ModObject>;\n\nexport interface InputSection {\n\ttooltip?: string;\n\tinputs: Array<InputConfig<Player<any>>>;\n}\n\nexport interface OtherDefaults {\n\tprofession1?: Profession;\n\tprofession2?: Profession;\n\tdistanceFromTarget?: number;\n\tchannelClipDelay?: number;\n\tdarkIntentUptime?: number;\n}\n\nexport interface RaidSimPreset<SpecType extends Spec> {\n\tspec: Spec;\n\ttalents: SavedTalents;\n\tspecOptions: SpecOptions<SpecType>;\n\tconsumes: Consumes;\n\n\tdefaultName?: string;\n\tdefaultFactionRaces: Record<Faction, Race>;\n\tdefaultGear: Record<Faction, Record<number, EquipmentSpec>>;\n\totherDefaults?: OtherDefaults;\n\n\ttooltip?: string;\n\ticonUrl?: string;\n}\n\nexport interface IndividualSimUIConfig<SpecType extends Spec> extends PlayerConfig<SpecType> {\n\t// Additional css class to add to the root element.\n\tcssClass: string;\n\t// Used to generate schemed components. E.g. 'shaman', 'druid', 'raid'\n\tcssScheme: string;\n\n\tknownIssues?: Array<string>;\n\twarnings?: Array<(simUI: IndividualSimUI<SpecType>) => SimWarning>;\n\n\tepStats: Array<Stat>;\n\tepPseudoStats?: Array<PseudoStat>;\n\tepReferenceStat: Stat;\n\tdisplayStats: Array<Stat>;\n\tmodifyDisplayStats?: (player: Player<SpecType>) => StatMods;\n\toverwriteDisplayStats?: (player: Player<SpecType>) => StatWrites;\n\n\tdefaults: {\n\t\tgear: EquipmentSpec;\n\t\tepWeights: Stats;\n\t\tconsumes: Consumes;\n\t\ttalents: SavedTalents;\n\t\tspecOptions: SpecOptions<SpecType>;\n\n\t\traidBuffs: RaidBuffs;\n\t\tpartyBuffs: PartyBuffs;\n\t\tindividualBuffs: IndividualBuffs;\n\n\t\tdebuffs: Debuffs;\n\n\t\tother?: OtherDefaults;\n\t};\n\n\tplayerInputs?: InputSection;\n\tplayerIconInputs: Array<IconInputs.IconInputConfig<Player<SpecType>, any>>;\n\tpetConsumeInputs?: Array<IconInputs.IconInputConfig<Player<SpecType>, any>>;\n\trotationInputs?: InputSection;\n\trotationIconInputs?: Array<IconInputs.IconInputConfig<Player<SpecType>, any>>;\n\tincludeBuffDebuffInputs: Array<any>;\n\texcludeBuffDebuffInputs: Array<any>;\n\totherInputs: InputSection;\n\t// Currently, many classes don't support item swapping, and only in certain slots.\n\t// So enable it only where it is supported.\n\titemSwapSlots?: Array<ItemSlot>;\n\n\t// For when extra sections are needed (e.g. Shaman totems)\n\tcustomSections?: Array<(parentElem: HTMLElement, simUI: IndividualSimUI<SpecType>) => ContentBlock>;\n\n\tencounterPicker: EncounterPickerConfig;\n\n\tpresets: {\n\t\tgear: Array<PresetGear>;\n\t\ttalents: Array<SavedDataConfig<Player<SpecType>, SavedTalents>>;\n\t\trotations: Array<PresetRotation>;\n\t};\n\n\traidSimPresets: Array<RaidSimPreset<SpecType>>;\n}\n\nexport function registerSpecConfig<SpecType extends Spec>(spec: SpecType, config: IndividualSimUIConfig<SpecType>): IndividualSimUIConfig<SpecType> {\n\tregisterPlayerConfig(spec, config);\n\treturn config;\n}\n\nexport const itemSwapEnabledSpecs: Array<any> = [];\n\nexport interface Settings {\n\traidBuffs: RaidBuffs;\n\tpartyBuffs: PartyBuffs;\n\tindividualBuffs: IndividualBuffs;\n\tconsumes: Consumes;\n\trace: Race;\n\tprofessions?: Array<Profession>;\n}\n\n// Extended shared UI for all individual player sims.\nexport abstract class IndividualSimUI<SpecType extends Spec> extends SimUI {\n\treadonly player: Player<SpecType>;\n\treadonly individualConfig: IndividualSimUIConfig<SpecType>;\n\n\tprivate raidSimResultsManager: RaidSimResultsManager | null;\n\n\tprevEpIterations: number;\n\tprevEpSimResult: StatWeightsResult | null;\n\tdpsRefStat?: Stat;\n\thealRefStat?: Stat;\n\ttankRefStat?: Stat;\n\n\treadonly bt: BulkTab;\n\n\tconstructor(parentElem: HTMLElement, player: Player<SpecType>, config: IndividualSimUIConfig<SpecType>) {\n\t\tsuper(parentElem, player.sim, {\n\t\t\tcssClass: config.cssClass,\n\t\t\tcssScheme: config.cssScheme,\n\t\t\tspec: player.getPlayerSpec(),\n\t\t\tknownIssues: config.knownIssues,\n\t\t\tsimStatus: simLaunchStatuses[player.getSpec()],\n\t\t\tnoticeText: 'WoWSims - Cataclysm is still in the very early stages of development and all sims are considered non-functional at this time.',\n\t\t});\n\t\tthis.rootElem.classList.add('individual-sim-ui');\n\t\tthis.player = player;\n\t\tthis.individualConfig = config;\n\t\tthis.raidSimResultsManager = null;\n\t\tthis.prevEpIterations = 0;\n\t\tthis.prevEpSimResult = null;\n\n\t\tif ((config.itemSwapSlots || []).length > 0 && !itemSwapEnabledSpecs.includes(player.getSpec())) {\n\t\t\titemSwapEnabledSpecs.push(player.getSpec());\n\t\t}\n\n\t\tthis.addWarning({\n\t\t\tupdateOn: this.player.gearChangeEmitter,\n\t\t\tgetContent: () => {\n\t\t\t\tif (!this.player.getGear().hasInactiveMetaGem(this.player.isBlacksmithing())) {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\tconst metaGem = this.player.getGear().getMetaGem()!;\n\t\t\t\treturn `Meta gem disabled (${metaGem.name}): ${getMetaGemConditionDescription(metaGem)}`;\n\t\t\t},\n\t\t});\n\t\tthis.addWarning({\n\t\t\tupdateOn: TypedEvent.onAny([this.player.gearChangeEmitter, this.player.professionChangeEmitter]),\n\t\t\tgetContent: () => {\n\t\t\t\tconst failedProfReqs = this.player.getGear().getFailedProfessionRequirements(this.player.getProfessions());\n\t\t\t\tif (failedProfReqs.length == 0) {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\treturn failedProfReqs.map(fpr => `${fpr.name} requires ${professionNames.get(fpr.requiredProfession)!}, but it is not selected.`);\n\t\t\t},\n\t\t});\n\t\tthis.addWarning({\n\t\t\tupdateOn: this.player.gearChangeEmitter,\n\t\t\tgetContent: () => {\n\t\t\t\tconst jcGems = this.player.getGear().getJCGems(this.player.isBlacksmithing());\n\t\t\t\tif (jcGems.length <= 3) {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\treturn `Only 3 Jewelcrafting Gems are allowed, but ${jcGems.length} are equipped.`;\n\t\t\t},\n\t\t});\n\t\tthis.addWarning({\n\t\t\tupdateOn: this.player.talentsChangeEmitter,\n\t\t\tgetContent: () => {\n\t\t\t\tconst talentPoints = getTalentPoints(this.player.getTalentsString());\n\n\t\t\t\tif (talentPoints == 0) {\n\t\t\t\t\t// Just return here, so we don't show a warning during page load.\n\t\t\t\t\treturn '';\n\t\t\t\t} else if (talentPoints < MAX_POINTS_PLAYER) {\n\t\t\t\t\treturn 'Unspent talent points.';\n\t\t\t\t} else if (talentPoints > MAX_POINTS_PLAYER) {\n\t\t\t\t\treturn 'More than maximum talent points spent.';\n\t\t\t\t} else {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tthis.addWarning({\n\t\t\tupdateOn: TypedEvent.onAny([this.player.gearChangeEmitter, this.player.talentsChangeEmitter]),\n\t\t\tgetContent: () => {\n\t\t\t\tif (\n\t\t\t\t\t!this.player.canDualWield2H() &&\n\t\t\t\t\t((this.player.getEquippedItem(ItemSlot.ItemSlotMainHand)?.item.handType == HandType.HandTypeTwoHand &&\n\t\t\t\t\t\tthis.player.getEquippedItem(ItemSlot.ItemSlotOffHand) != null) ||\n\t\t\t\t\t\tthis.player.getEquippedItem(ItemSlot.ItemSlotOffHand)?.item.handType == HandType.HandTypeTwoHand)\n\t\t\t\t) {\n\t\t\t\t\treturn \"Dual wielding two-handed weapon(s) without Titan's Grip spec.\";\n\t\t\t\t} else {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\t(config.warnings || []).forEach(warning => this.addWarning(warning(this)));\n\n\t\tif (!this.isWithinRaidSim) {\n\t\t\t// This needs to go before all the UI components so that gear loading is the\n\t\t\t// first callback invoked from waitForInit().\n\t\t\tthis.sim.waitForInit().then(() => {\n\t\t\t\tthis.loadSettings();\n\n\t\t\t\tif (this.player.getPlayerSpec().isHealingSpec) {\n\t\t\t\t\talert(Tooltips.HEALING_SIM_DISCLAIMER);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.addSidebarComponents();\n\t\tthis.addGearTab();\n\t\tthis.bt = this.addBulkTab();\n\t\tthis.addSettingsTab();\n\t\tthis.addTalentsTab();\n\t\tthis.addRotationTab();\n\n\t\tif (!this.isWithinRaidSim) {\n\t\t\tthis.addDetailedResultsTab();\n\t\t}\n\n\t\tthis.addTopbarComponents();\n\t}\n\n\tprivate loadSettings() {\n\t\tconst initEventID = TypedEvent.nextEventID();\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.applyDefaults(initEventID);\n\n\t\t\tconst savedSettings = window.localStorage.getItem(this.getSettingsStorageKey());\n\t\t\tif (savedSettings != null) {\n\t\t\t\ttry {\n\t\t\t\t\tconst settings = IndividualSimSettings.fromJsonString(savedSettings);\n\t\t\t\t\tthis.fromProto(initEventID, settings);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Failed to parse saved settings: ' + e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Loading from link needs to happen after loading saved settings, so that partial link imports\n\t\t\t// (e.g. rotation only) include the previous settings for other categories.\n\t\t\ttry {\n\t\t\t\tconst urlParseResults = Importers.IndividualLinkImporter.tryParseUrlLocation(window.location);\n\t\t\t\tif (urlParseResults) {\n\t\t\t\t\tthis.fromProto(initEventID, urlParseResults.settings, urlParseResults.categories);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('Failed to parse link settings: ' + e);\n\t\t\t}\n\t\t\twindow.location.hash = '';\n\n\t\t\tthis.player.setName(initEventID, 'Player');\n\n\t\t\t// This needs to go last so it doesn't re-store things as they are initialized.\n\t\t\tthis.changeEmitter.on(_eventID => {\n\t\t\t\tconst jsonStr = IndividualSimSettings.toJsonString(this.toProto());\n\t\t\t\twindow.localStorage.setItem(this.getSettingsStorageKey(), jsonStr);\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate addSidebarComponents() {\n\t\tthis.raidSimResultsManager = addRaidSimAction(this);\n\t\taddStatWeightsAction(this, this.individualConfig.epStats, this.individualConfig.epPseudoStats, this.individualConfig.epReferenceStat);\n\n\t\tconst _characterStats = new CharacterStats(\n\t\t\tthis.rootElem.querySelector('.sim-sidebar-stats') as HTMLElement,\n\t\t\tthis.player,\n\t\t\tthis.individualConfig.displayStats,\n\t\t\tthis.individualConfig.modifyDisplayStats,\n\t\t\tthis.individualConfig.overwriteDisplayStats,\n\t\t);\n\t}\n\n\tprivate addGearTab() {\n\t\tconst gearTab = new GearTab(this.simTabContentsContainer, this);\n\t\tgearTab.rootElem.classList.add('active', 'show');\n\t}\n\n\tprivate addBulkTab(): BulkTab {\n\t\tconst bulkTab = new BulkTab(this.simTabContentsContainer, this);\n\t\tbulkTab.navLink.hidden = !this.sim.getShowExperimental();\n\t\tthis.sim.showExperimentalChangeEmitter.on(() => {\n\t\t\tbulkTab.navLink.hidden = !this.sim.getShowExperimental();\n\t\t});\n\t\treturn bulkTab;\n\t}\n\n\tprivate addSettingsTab() {\n\t\tnew SettingsTab(this.simTabContentsContainer, this);\n\t}\n\n\tprivate addTalentsTab() {\n\t\tnew TalentsTab(this.simTabContentsContainer, this);\n\t}\n\n\tprivate addRotationTab() {\n\t\tnew RotationTab(this.simTabContentsContainer, this);\n\t}\n\n\tprivate addDetailedResultsTab() {\n\t\tthis.addTab(\n\t\t\t'Results',\n\t\t\t'detailed-results-tab',\n\t\t\t`\n\t\t\t<div class=\"detailed-results\">\n\t\t\t</div>\n\t\t`,\n\t\t);\n\n\t\tconst _detailedResults = new EmbeddedDetailedResults(\n\t\t\tthis.rootElem.getElementsByClassName('detailed-results')[0] as HTMLElement,\n\t\t\tthis,\n\t\t\tthis.raidSimResultsManager!,\n\t\t);\n\t}\n\n\tprivate addTopbarComponents() {\n\t\tthis.simHeader.addImportLink('JSON', _parent => new Importers.IndividualJsonImporter(this.rootElem, this), true);\n\t\tthis.simHeader.addImportLink('80U', _parent => new Importers.Individual80UImporter(this.rootElem, this), true);\n\t\tthis.simHeader.addImportLink('WoWHead', _parent => new Importers.IndividualWowheadGearPlannerImporter(this.rootElem, this), false);\n\t\tthis.simHeader.addImportLink('Addon', _parent => new Importers.IndividualAddonImporter(this.rootElem, this), true);\n\n\t\tthis.simHeader.addExportLink('Link', _parent => new Exporters.IndividualLinkExporter(this.rootElem, this), false);\n\t\tthis.simHeader.addExportLink('JSON', _parent => new Exporters.IndividualJsonExporter(this.rootElem, this), true);\n\t\tthis.simHeader.addExportLink('WoWHead', _parent => new Exporters.IndividualWowheadGearPlannerExporter(this.rootElem, this), false);\n\t\tthis.simHeader.addExportLink('80U EP', _parent => new Exporters.Individual80UEPExporter(this.rootElem, this), false);\n\t\tthis.simHeader.addExportLink('Pawn EP', _parent => new Exporters.IndividualPawnEPExporter(this.rootElem, this), false);\n\t\tthis.simHeader.addExportLink('CLI', _parent => new Exporters.IndividualCLIExporter(this.rootElem, this), true);\n\t}\n\n\tapplyDefaults(eventID: EventID) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tconst tankSpec = this.player.getPlayerSpec().isTankSpec;\n\t\t\tconst healingSpec = this.player.getPlayerSpec().isHealingSpec;\n\n\t\t\tthis.player.applySharedDefaults(eventID);\n\t\t\tthis.player.setRace(eventID, this.player.getPlayerClass().races[0]);\n\t\t\tthis.player.setGear(eventID, this.sim.db.lookupEquipmentSpec(this.individualConfig.defaults.gear));\n\t\t\tthis.player.setConsumes(eventID, this.individualConfig.defaults.consumes);\n\t\t\tthis.player.setTalentsString(eventID, this.individualConfig.defaults.talents.talentsString);\n\t\t\tthis.player.setGlyphs(eventID, this.individualConfig.defaults.talents.glyphs || Glyphs.create());\n\t\t\tthis.player.setSpecOptions(eventID, this.individualConfig.defaults.specOptions);\n\t\t\tthis.player.setBuffs(eventID, this.individualConfig.defaults.individualBuffs);\n\t\t\tthis.player.getParty()!.setBuffs(eventID, this.individualConfig.defaults.partyBuffs);\n\t\t\tthis.player.getRaid()!.setBuffs(eventID, this.individualConfig.defaults.raidBuffs);\n\t\t\tthis.player.setEpWeights(eventID, this.individualConfig.defaults.epWeights);\n\t\t\tconst defaultRatios = this.player.getDefaultEpRatios(tankSpec, healingSpec);\n\t\t\tthis.player.setEpRatios(eventID, defaultRatios);\n\t\t\tthis.player.setProfession1(eventID, this.individualConfig.defaults.other?.profession1 || Profession.Engineering);\n\t\t\tthis.player.setProfession2(eventID, this.individualConfig.defaults.other?.profession2 || Profession.Jewelcrafting);\n\t\t\tthis.player.setDistanceFromTarget(eventID, this.individualConfig.defaults.other?.distanceFromTarget || 0);\n\t\t\tthis.player.setChannelClipDelay(eventID, this.individualConfig.defaults.other?.channelClipDelay || 0);\n\t\t\tthis.player.setDarkIntentUptime(eventID, this.individualConfig.defaults.other?.darkIntentUptime || 100);\n\n\t\t\tif (this.isWithinRaidSim) {\n\t\t\t\tthis.sim.raid.setTargetDummies(eventID, 0);\n\t\t\t} else {\n\t\t\t\tthis.sim.raid.setTargetDummies(eventID, healingSpec ? 9 : 0);\n\t\t\t\tthis.sim.encounter.applyDefaults(eventID);\n\t\t\t\tthis.sim.raid.setDebuffs(eventID, this.individualConfig.defaults.debuffs);\n\t\t\t\tthis.sim.applyDefaults(eventID, tankSpec, healingSpec);\n\n\t\t\t\tif (tankSpec) {\n\t\t\t\t\tthis.sim.raid.setTanks(eventID, [this.player.makeUnitReference()]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.sim.raid.setTanks(eventID, []);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tgetSavedGearStorageKey(): string {\n\t\treturn this.getStorageKey(SAVED_GEAR_STORAGE_KEY);\n\t}\n\n\tgetSavedRotationStorageKey(): string {\n\t\treturn this.getStorageKey(SAVED_ROTATION_STORAGE_KEY);\n\t}\n\n\tgetSavedSettingsStorageKey(): string {\n\t\treturn this.getStorageKey(SAVED_SETTINGS_STORAGE_KEY);\n\t}\n\n\tgetSavedTalentsStorageKey(): string {\n\t\treturn this.getStorageKey(SAVED_TALENTS_STORAGE_KEY);\n\t}\n\n\t// Returns the actual key to use for local storage, based on the given key part and the site context.\n\tgetStorageKey(keyPart: string): string {\n\t\t// Local storage is shared by all sites under the same domain, so we need to use\n\t\t// different keys for each spec site.\n\t\treturn PlayerSpecs.getLocalStorageKey(this.player.getPlayerSpec()) + keyPart;\n\t}\n\n\ttoProto(exportCategories?: Array<SimSettingCategories>): IndividualSimSettings {\n\t\tconst exportCategory = (cat: SimSettingCategories) => !exportCategories || exportCategories.length == 0 || exportCategories.includes(cat);\n\n\t\tconst proto = IndividualSimSettings.create({\n\t\t\tplayer: this.player.toProto(true, false, exportCategories),\n\t\t});\n\n\t\tif (exportCategory(SimSettingCategories.Miscellaneous)) {\n\t\t\tIndividualSimSettings.mergePartial(proto, {\n\t\t\t\ttanks: this.sim.raid.getTanks(),\n\t\t\t});\n\t\t}\n\t\tif (exportCategory(SimSettingCategories.Encounter)) {\n\t\t\tIndividualSimSettings.mergePartial(proto, {\n\t\t\t\tencounter: this.sim.encounter.toProto(),\n\t\t\t});\n\t\t}\n\t\tif (exportCategory(SimSettingCategories.External)) {\n\t\t\tIndividualSimSettings.mergePartial(proto, {\n\t\t\t\tpartyBuffs: this.player.getParty()?.getBuffs() || PartyBuffs.create(),\n\t\t\t\traidBuffs: this.sim.raid.getBuffs(),\n\t\t\t\tdebuffs: this.sim.raid.getDebuffs(),\n\t\t\t\ttargetDummies: this.sim.raid.getTargetDummies(),\n\t\t\t});\n\t\t}\n\t\tif (exportCategory(SimSettingCategories.UISettings)) {\n\t\t\tIndividualSimSettings.mergePartial(proto, {\n\t\t\t\tsettings: this.sim.toProto(),\n\t\t\t\tepWeightsStats: this.player.getEpWeights().toProto(),\n\t\t\t\tepRatios: this.player.getEpRatios(),\n\t\t\t\tdpsRefStat: this.dpsRefStat,\n\t\t\t\thealRefStat: this.healRefStat,\n\t\t\t\ttankRefStat: this.tankRefStat,\n\t\t\t});\n\t\t}\n\n\t\treturn proto;\n\t}\n\n\ttoLink(): string {\n\t\treturn Exporters.IndividualLinkExporter.createLink(this);\n\t}\n\n\tfromProto(eventID: EventID, settings: IndividualSimSettings, includeCategories?: Array<SimSettingCategories>) {\n\t\tconst loadCategory = (cat: SimSettingCategories) => !includeCategories || includeCategories.length == 0 || includeCategories.includes(cat);\n\n\t\tconst tankSpec = this.player.getPlayerSpec().isTankSpec;\n\t\tconst healingSpec = this.player.getPlayerSpec().isHealingSpec;\n\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tif (!settings.player) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.player.fromProto(eventID, settings.player, includeCategories);\n\n\t\t\tif (loadCategory(SimSettingCategories.Miscellaneous)) {\n\t\t\t\tthis.sim.raid.setTanks(eventID, settings.tanks || []);\n\t\t\t}\n\t\t\tif (loadCategory(SimSettingCategories.External)) {\n\t\t\t\tthis.sim.raid.setBuffs(eventID, settings.raidBuffs || RaidBuffs.create());\n\t\t\t\tthis.sim.raid.setDebuffs(eventID, settings.debuffs || Debuffs.create());\n\t\t\t\tconst party = this.player.getParty();\n\t\t\t\tif (party) {\n\t\t\t\t\tparty.setBuffs(eventID, settings.partyBuffs || PartyBuffs.create());\n\t\t\t\t}\n\t\t\t\tthis.sim.raid.setTargetDummies(eventID, settings.targetDummies);\n\t\t\t}\n\t\t\tif (loadCategory(SimSettingCategories.Encounter)) {\n\t\t\t\tthis.sim.encounter.fromProto(eventID, settings.encounter || EncounterProto.create());\n\t\t\t}\n\t\t\tif (loadCategory(SimSettingCategories.UISettings)) {\n\t\t\t\tif (settings.epWeightsStats) {\n\t\t\t\t\tthis.player.setEpWeights(eventID, Stats.fromProto(settings.epWeightsStats));\n\t\t\t\t} else {\n\t\t\t\t\tthis.player.setEpWeights(eventID, this.individualConfig.defaults.epWeights);\n\t\t\t\t}\n\n\t\t\t\tconst defaultRatios = this.player.getDefaultEpRatios(tankSpec, healingSpec);\n\t\t\t\tif (settings.epRatios) {\n\t\t\t\t\tconst missingRatios = new Array<number>(defaultRatios.length - settings.epRatios.length).fill(0);\n\t\t\t\t\tthis.player.setEpRatios(eventID, settings.epRatios.concat(missingRatios));\n\t\t\t\t} else {\n\t\t\t\t\tthis.player.setEpRatios(eventID, defaultRatios);\n\t\t\t\t}\n\n\t\t\t\tif (settings.dpsRefStat) {\n\t\t\t\t\tthis.dpsRefStat = settings.dpsRefStat;\n\t\t\t\t}\n\t\t\t\tif (settings.healRefStat) {\n\t\t\t\t\tthis.healRefStat = settings.healRefStat;\n\t\t\t\t}\n\t\t\t\tif (settings.tankRefStat) {\n\t\t\t\t\tthis.tankRefStat = settings.tankRefStat;\n\t\t\t\t}\n\n\t\t\t\tif (settings.settings) {\n\t\t\t\t\tthis.sim.fromProto(eventID, settings.settings);\n\t\t\t\t} else {\n\t\t\t\t\tthis.sim.applyDefaults(eventID, tankSpec, healingSpec);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n","import {\n\tAPLRotation,\n\tAPLRotation_Type as APLRotationType,\n} from './proto/apl';\nimport {\n\tEquipmentSpec,\n    Faction,\n    Spec,\n} from './proto/common';\nimport {\n    SavedRotation,\n} from './proto/ui';\n\nimport { Player } from './player';\nimport {\n    SpecRotation,\n\tspecTypeFunctions,\n} from './proto_utils/utils';\n\nimport * as Tooltips from './constants/tooltips.js';\n\nexport interface PresetGear {\n\tname: string;\n\tgear: EquipmentSpec;\n\ttooltip?: string;\n\tenableWhen?: (obj: Player<any>) => boolean;\n}\n\nexport interface PresetRotation {\n\tname: string;\n\trotation: SavedRotation;\n\ttooltip?: string;\n\tenableWhen?: (obj: Player<any>) => boolean;\n}\n\nexport interface PresetGearOptions {\n    talentTree?: number,\n    talentTrees?: Array<number>,\n    faction?: Faction,\n    customCondition?: (player: Player<any>) => boolean,\n\n    tooltip?: string,\n}\n\nexport interface PresetRotationOptions {\n    talentTree?: number,\n}\n\nexport function makePresetGear(name: string, gearJson: any, options?: PresetGearOptions): PresetGear {\n    const gear = EquipmentSpec.fromJson(gearJson);\n    return makePresetGearHelper(name, gear, options || {});\n}\n\nfunction makePresetGearHelper(name: string, gear: EquipmentSpec, options: PresetGearOptions): PresetGear {\n    let conditions: Array<(player: Player<any>) => boolean> = [];\n    if (options.talentTree != undefined) {\n        conditions.push((player: Player<any>) => player.getTalentTree() == options.talentTree);\n    }\n    if (options.talentTrees != undefined) {\n        conditions.push((player: Player<any>) => (options.talentTrees || []).includes(player.getTalentTree()));\n    }\n    if (options.faction != undefined) {\n        conditions.push((player: Player<any>) => player.getFaction() == options.faction);\n    }\n    if (options.customCondition != undefined) {\n        conditions.push(options.customCondition);\n    }\n\n    return {\n        name: name,\n        tooltip: options.tooltip || Tooltips.BASIC_BIS_DISCLAIMER,\n        gear: gear,\n        enableWhen: conditions.length > 0\n            ? (player: Player<any>) => conditions.every(cond => cond(player))\n            : undefined,\n    };\n}\n\nexport function makePresetAPLRotation(name: string, rotationJson: any, options?: PresetRotationOptions): PresetRotation {\n    const rotation = SavedRotation.create({\n        rotation: APLRotation.fromJson(rotationJson),\n    });\n    return makePresetRotationHelper(name, rotation, options);\n}\n\nexport function makePresetSimpleRotation<SpecType extends Spec>(name: string, spec: SpecType, simpleRotation: SpecRotation<SpecType>, options?: PresetRotationOptions): PresetRotation {\n    const rotation = SavedRotation.create({\n\t\trotation: {\n\t\t\ttype: APLRotationType.TypeSimple,\n\t\t\tsimple: {\n\t\t\t\tspecRotationJson: JSON.stringify(specTypeFunctions[spec].rotationToJson(simpleRotation)),\n\t\t\t},\n\t\t},\n    });\n    return makePresetRotationHelper(name, rotation, options);\n}\n\nfunction makePresetRotationHelper(name: string, rotation: SavedRotation, options?: PresetRotationOptions): PresetRotation {\n    let conditions: Array<(player: Player<any>) => boolean> = [];\n    if (options?.talentTree != undefined) {\n        conditions.push((player: Player<any>) => player.getTalentTree() == options.talentTree);\n    }\n\n    return {\n        name: name,\n        rotation: rotation,\n        enableWhen: conditions.length > 0\n            ? (player: Player<any>) => conditions.every(cond => cond(player))\n            : undefined,\n    };\n}"],"names":["MAX_PARTY_SIZE","Party","constructor","raid","sim","this","buffs","PartyBuffs","create","compChangeEmitter","TypedEvent","buffsChangeEmitter","players","Array","keys","map","_i","playerChangeListener","eventID","changeEmitter","emit","onAny","size","filter","player","length","isEmpty","clear","setBuffs","i","setPlayer","getIndex","getParties","indexOf","getPlayers","slice","getPlayer","playerIndex","newPlayer","Error","freezeAllAndDo","oldPlayer","off","setParty","newPlayerOldParty","getParty","getPartyIndex","on","getBuffs","clone","newBuffs","equals","toProto","forExport","forSimming","PartyProto","PlayerProto","fromProto","proto","class","Class","ClassUnknown","playerProto","spec","getPlayerSpecFromPlayer","currentPlayer","getSpec","Player","Encounter","duration","durationVariation","executeProportion20","executeProportion25","executeProportion35","executeProportion90","useHealth","targetsChangeEmitter","durationChangeEmitter","executeProportionChangeEmitter","targets","defaultTargetProto","targetsMetadata","UnitMetadataList","forEach","emitter","primaryTarget","TargetProto","getDurationVariation","setDurationVariation","newDuration","getDuration","setDuration","getExecuteProportion20","setExecuteProportion20","newExecuteProportion20","getExecuteProportion25","setExecuteProportion25","newExecuteProportion25","getExecuteProportion35","setExecuteProportion35","newExecuteProportion35","getExecuteProportion90","setExecuteProportion90","newExecuteProportion90","getUseHealth","setUseHealth","newUseHealth","matchesPreset","preset","every","t","target","applyPreset","presetTarget","applyPresetTarget","index","EncounterProto","applyDefaults","level","Mechanics.BOSS_LEVEL","mobType","MobType","MobTypeGiant","tankIndex","swingSpeed","minBaseDamage","dualWield","dualWieldPenalty","suppressDodge","parryHaste","spellSchool","SpellSchool","SpellSchoolPhysical","stats","Stats","fromMap","Stat","StatArmor","StatAttackPower","StatBlockValue","asArray","targetInputs","MAX_NUM_PARTIES","Raid","RaidBuffs","debuffs","Debuffs","tanks","targetDummies","numActiveParties","debuffsChangeEmitter","tanksChangeEmitter","targetDummiesChangeEmitter","numActivePartiesChangeEmitter","parties","newParty","activePlayers","sum","party","flat","Math","floor","getPlayerFromUnitReference","raidTarget","contextPlayer","type","UnitType","Unknown","Self","getClassCount","playerClass","getClass","getDebuffs","setDebuffs","newDebuffs","getTanks","UnitReference","tank","setTanks","newTanks","getTargetDummies","setTargetDummies","newTargetDummies","getNumActiveParties","setNumActiveParties","newNumActiveParties","getActivePlayers","activeParties","RaidProto","SIM_WORKER_URL","REPO_NAME","WorkerPool","numWorkers","workers","push","SimWorker","getLeastBusyWorker","reduce","curMinWorker","nextWorker","numTasksRunning","makeApiCall","requestName","request","doApiCall","computeStats","result","ComputeStatsRequest","toBinary","ComputeStatsResult","fromBinary","statWeightsAsync","onProgress","console","log","StatWeightsRequest","toJsonString","worker","id","makeTaskId","addPromiseFunc","newProgressHandler","err","resultData","ProgressMetrics","StatWeightsResult","finalWeightResult","bulkSimAsync","BulkSimRequest","enumAsInteger","resultJson","BulkSimResult","toJson","finalBulkResult","JSON","stringify","raidSimAsync","RaidSimRequest","RaidSimResult","finalRaidResult","progressData","progress","taskIdsToPromiseFuncs","window","Worker","resolveReady","onReady","Promise","_resolve","_reject","onmessage","event","data","msg","postMessage","warn","promiseFuncs","outputData","callback","onError","characters","charAt","random","taskPromise","resolve","reject","inputData","SimSettingCategories","SimSettingCategories2","_Sim","iterations","phase","OtherConstants.CURRENT_PHASE","faction","Faction","Alliance","fixedRngSeed","filters","defaultFilters","showDamageMetrics","showThreatMetrics","showHealingMetrics","showExperimental","showEPValues","language","db_","iterationsChangeEmitter","phaseChangeEmitter","factionChangeEmitter","fixedRngSeedChangeEmitter","lastUsedRngSeedChangeEmitter","filtersChangeEmitter","showDamageMetricsChangeEmitter","showThreatMetricsChangeEmitter","showHealingMetricsChangeEmitter","showExperimentalChangeEmitter","showEPValuesChangeEmitter","languageChangeEmitter","crashEmitter","unitMetadataEmitter","simResultEmitter","bulkSimStartEmitter","bulkSimResultEmitter","lastUsedRngSeed","modifyRaidProto","workerPool","_initPromise","Database","get","then","db","encounter","settingsChangeEmitter","updateCharacterStats","waitForInit","setModifyRaidProto","newModFn","getModifiedRaidProto","raidProto","equipment","gear","lookupEquipmentSpec","gearChanged","isBlacksmith","profession1","profession2","includes","Profession","Blacksmithing","hasInactiveMetaGem","withoutMetaGem","withoutBlacksmithSockets","asSpec","makeRaidSimRequest","debug","simOptions","SimOptions","getIterations","randomSeed","BigInt","nextRngSeed","debugFirstIteration","runBulkSim","bulkSettings","bulkItemsDb","baseSettings","playerDatabase","database","items","enchants","gems","nextEventID","errorResult","SimError","runRaidSim","simResult","SimResult","makeNew","runRaidSimWithLogs","req","async","playerUpdatePromises","raidStats","partyStats","partyIndex","playerStats","setCurrentStats","updateMetadata","p","targetUpdatePromise","update","encounterStats","metadata","all","concat","some","v","statWeights","epStats","epPseudoStats","epReferenceStat","getRaidIndex","raidBuffs","partyBuffs","statsToWeigh","pseudoStatsToWeigh","getUnitMetadata","ref","defaultRef","getMetadata","Target","asList","Pet","owner","getPetMetadatas","CurrentTarget","getPhase","setPhase","newPhase","getFaction","setFaction","newFaction","getFixedRngSeed","setFixedRngSeed","newFixedRngSeed","rngSeed","MAX_RNG_SEED","getLastUsedRngSeed","getFilters","DatabaseFilters","setFilters","newFilters","getShowDamageMetrics","setShowDamageMetrics","newShowDamageMetrics","getShowThreatMetrics","setShowThreatMetrics","newShowThreatMetrics","getShowHealingMetrics","setShowHealingMetrics","newShowHealingMetrics","getShowExperimental","setShowExperimental","newShowExperimental","getShowEPValues","setShowEPValues","newShowEPValues","getLanguage","setLanguage","newLanguage","getBrowserLanguageCode","setLanguageCode","setIterations","newIterations","armorTypes","ALL_ARMOR_TYPES","weaponTypes","ALL_WEAPON_TYPES","rangedWeaponTypes","ALL_RANGED_WEAPON_TYPES","sources","ALL_SOURCES","raids","ALL_RAIDS","SimSettingsProto","showEpValues","Number","isTankSim","isHealingSim","oneHandedWeapons","twoHandedWeapons","pow","getEnumValues","ArmorType","WeaponType","RangedWeaponType","SourceFilterOption","RaidFilterOption","Sim","errorStr","super","CopyButton","Component","parent","config","btnRef","element","className","extraCssClasses","join","text","button","value","clicked","addEventListener","_event","getContent","navigator","clipboard","alert","writeText","originalContent","innerHTML","setTimeout","tooltip","Tooltip","getOrCreateInstance","title","DEFAULT_CONFIG","footer","header","scrollContents","BaseModal","cssClass","modalConfig","dialogRef","headerRef","bodyRef","footerRef","modalSizeKlass","rootElem","classList","add","appendChild","closeButton","fixed","onclick","close","attributes","dialog","body","modal","Modal","keyboard","open","_","remove","dispose","onShow","_e","showBSFn","bind","hideBSFn","hiddenBSFn","show","hide","removeEventListener","stopImmediatePropagation","backdrop","_backdrop","_element","insertAdjacentElement","stopPropagation","ContentBlock","headerElement","buildHeader","bodyElement","buildBody","bodyClasses","cl","Object","TitleTag","titleTag","querySelector","html","bodyElem","document","createElement","itemQualityCssClasses","ItemQuality","ItemQualityJunk","ItemQualityCommon","ItemQualityUncommon","ItemQualityRare","ItemQualityEpic","ItemQualityLegendary","ItemQualityArtifact","ItemQualityHeirloom","setItemQualityCssClass","elem","quality","values","emptyGlyphData","name","description","iconUrl","GlyphsPicker","glyphsConfig","primeGlyphPickers","majorGlyphPickers","minorGlyphPickers","primeGlyphs","idStr","majorGlyphs","minorGlyphs","primeGlyphsData","getGlyphData","glyph","majorGlyphsData","minorGlyphsData","sort","a","b","stringComparator","primeGlyphsBlock","majorGlyphsBlock","minorGlyphsBlock","glyphField","GlyphPicker","glyphConfig","Input","glyphOptions","inline","changedEvent","glyphsChangeEmitter","getValue","getGlyphs","setValue","newValue","glyphs","player2","setGlyphs","selectedGlyph","anchorElemRef","iconElemRef","nameElemRef","role","anchorElem","iconElem","nameElem","openGlyphSelectorModal","preventDefault","GlyphSelectorModal","closest","addOnDisposeCallback","init","getInputElem","getInputValue","setInputValue","find","glyphData","lang","getLanguageCode","langPrefix","href","ActionId","makeItemUrl","dataset","wowhead","whtticon","src","textContent","removeAttribute","glyphPicker","listElem","getElementsByClassName","listItemElems","glyphIdx","listItemElem","idx","String","children","updateSelected","selectedGlyphId","listItemIdx","parseInt","listItemData","applyFilters","validItemElems","searchInput","searchQuery","toLowerCase","split","include","append","ev","key","ele","contains","click","TalentsPicker","modObject","pointsPerRow","numRows","max","trees","treeConfig","talents","talentConfig","location","rowIdx","numCols","colIdx","isHunterPet","isSpec","Spec","SpecBeastMasteryHunter","maxPoints","getPointsRemaining","getTalentTreePoints","points","containerElemRef","pointsRemainingElemRef","actionsContainerRef","carouselContainerRef","carouselPrevBtnRef","carouselNextBtnRef","containerElem","carouselContainer","carouselPrevBtn","carouselNextBtn","talentsChangeEmitter","getTalentsString","carouselItem","TalentTreePicker","klass","tree","talent","setPoints","updatePlayerTrees","carouselitemIdx","slidePrev","style","transform","abs","slideNext","isPlayer","classGlyphsConfig","replace","parts","setTalentsString","updateTrees","isFull","numPoints","setMaxPoints","newMaxPoints","specNumber","getPlayerSpec","specIndex","resetPoints","enableSecondaryPlayerTrees","picker","fragment","getTreeIcon","pointsElem","backgroundImage","backgroundUrl","main","gridTemplateRows","gridTemplateColumns","iconSize","height","maxWidth","TalentPicker","prereqLocation","getTalent","childLocations","recurseCalcIdx","z","initChildReqs","zIndex","c","parentReq","getChildReqArrow","resetBtn","getRow","getCol","getPoints","str","inputChanged","PlayerClasses","specs","getIcon","TalentReqArrow","parentLoc","childLoc","zIdx","gridRow","gridColumn","rowEnd","colEnd","dir","reqArrowColSize","reqArrowRowSize","gridRowEnd","gridColumnEnd","setReqFufilled","isFufilled","reqActive","childReqs","pointsDisplay","longTouchTimer","clearTimeout","newPoints","isRightClick","parentElement","loc","pts","isNaN","canSetPoints","oldPoints","additionalPoints","removedPoints","pointTotalsByRow","talentsInRow","cumulativeTotalsByRow","checkValidity","min","spellId","getSpellIdForPoints","fromSpellId","fill","actionId","setWowheadHref","rank","spellIds","fieldName","newTalentsConfig","prevTalent","curSpellId","pointIdx","deathKnightTalentsConfig","deathKnightGlyphsConfig","DeathKnightPrimeGlyph","GlyphOfDeathAndDecay","GlyphOfDeathCoil","GlyphOfDeathStrike","GlyphOfFrostStrike","GlyphOfHeartStrike","GlyphOfHowlingBlast","GlyphOfIcyTouch","GlyphOfObliterate","GlyphOfRaiseDead","GlyphOfRuneStrike","GlyphOfScourgeStrike","DeathKnightMajorGlyph","GlyphOfAntiMagicShell","GlyphOfBloodBoil","GlyphOfBoneShield","GlyphOfChainsOfIce","GlyphOfDancingRuneWeapon","GlyphOfDarkSuccor","GlyphOfDeathGrip","GlyphOfHungeringCold","GlyphOfPestilence","GlyphOfPillarOfFrost","GlyphOfRuneTap","GlyphOfStrangulate","GlyphOfVampiricBlood","DeathKnightMinorGlyph","GlyphOfBloodTap","GlyphOfDeathGate","GlyphOfDeathSEmbrace","GlyphOfHornOfWinter","GlyphOfPathOfFrost","GlyphOfResilientGrip","druidTalentsConfig","druidGlyphsConfig","DruidPrimeGlyph","GlyphOfBerserk","GlyphOfBloodletting","GlyphOfInsectSwarm","GlyphOfLacerate","GlyphOfLifebloom","GlyphOfMangle","GlyphOfMoonfire","GlyphOfRegrowth","GlyphOfRejuvenation","GlyphOfRip","GlyphOfSavageRoar","GlyphOfStarfire","GlyphOfStarsurge","GlyphOfSwiftmend","GlyphOfTigersFury","GlyphOfWrath","DruidMajorGlyph","GlyphOfBarkskin","GlyphOfEntanglingRoots","GlyphOfFaerieFire","GlyphOfFeralCharge","GlyphOfFerociousBite","GlyphOfFocus","GlyphOfFrenziedRegeneration","GlyphOfHealingTouch","GlyphOfHurricane","GlyphOfInnervate","GlyphOfMaul","GlyphOfMonsoon","GlyphOfOmenOfClarity","GlyphOfPounce","GlyphOfRebirth","GlyphOfSolarBeam","GlyphOfStarfall","GlyphOfThorns","GlyphOfWildGrowth","DruidMinorGlyph","GlyphOfAquaticForm","GlyphOfChallengingRoar","GlyphOfDash","GlyphOfMarkOfTheWild","GlyphOfTheTreant","GlyphOfTyphoon","GlyphOfUnburdenedRebirth","hunterTalentsConfig","hunterGlyphsConfig","HunterPrimeGlyph","GlyphOfAimedShot","GlyphOfArcaneShot","GlyphOfChimeraShot","GlyphOfDazzledPrey","GlyphOfExplosiveShot","GlyphOfKillCommand","GlyphOfKillShot","GlyphOfRapidFire","GlyphOfSerpentSting","GlyphOfSteadyShot","HunterMajorGlyph","GlyphOfBestialWrath","GlyphOfConcussiveShot","GlyphOfDeterrence","GlyphOfDisengage","GlyphOfFreezingTrap","GlyphOfIceTrap","GlyphOfImmolationTrap","GlyphOfMasterSCall","GlyphOfMending","GlyphOfMisdirection","GlyphOfRaptorStrike","GlyphOfScatterShot","GlyphOfSilencingShot","GlyphOfSnakeTrap","GlyphOfTrapLauncher","GlyphOfWyvernSting","HunterMinorGlyph","GlyphOfAspectOfThePack","GlyphOfFeignDeath","GlyphOfLesserProportion","GlyphOfRevivePet","GlyphOfScareBeast","mageTalentsConfig","mageGlyphsConfig","MagePrimeGlyph","GlyphOfArcaneBarrage","GlyphOfArcaneBlast","GlyphOfArcaneMissiles","GlyphOfConeOfCold","GlyphOfDeepFreeze","GlyphOfFireball","GlyphOfFrostbolt","GlyphOfFrostfire","GlyphOfIceLance","GlyphOfLivingBomb","GlyphOfMageArmor","GlyphOfMoltenArmor","GlyphOfPyroblast","MageMajorGlyph","GlyphOfArcanePower","GlyphOfBlastWave","GlyphOfBlink","GlyphOfDragonSBreath","GlyphOfEvocation","GlyphOfFrostArmor","GlyphOfFrostNova","GlyphOfIceBarrier","GlyphOfIceBlock","GlyphOfIcyVeins","GlyphOfInvisibility","GlyphOfManaShield","GlyphOfPolymorph","GlyphOfSlow","MageMinorGlyph","GlyphOfArcaneBrilliance","GlyphOfArmors","GlyphOfConjuring","GlyphOfMirrorImage","GlyphOfSlowFall","GlyphOfTheMonkey","GlyphOfThePenguin","paladinTalentsConfig","paladinGlyphsConfig","PaladinPrimeGlyph","GlyphOfCrusaderStrike","GlyphOfDivineFavor","GlyphOfExorcism","GlyphOfHammerOfTheRighteous","GlyphOfHolyShock","GlyphOfJudgement","GlyphOfSealOfInsight","GlyphOfSealOfTruth","GlyphOfShieldOfTheRighteous","GlyphOfTemplarSVerdict","GlyphOfWordOfGlory","PaladinMajorGlyph","GlyphOfBeaconOfLight","GlyphOfCleansing","GlyphOfConsecration","GlyphOfDazingShield","GlyphOfDivinePlea","GlyphOfDivineProtection","GlyphOfDivinity","GlyphOfFocusedShield","GlyphOfHammerOfJustice","GlyphOfHammerOfWrath","GlyphOfHolyWrath","GlyphOfLayOnHands","GlyphOfLightOfDawn","GlyphOfRebuke","GlyphOfReckoning","GlyphOfSalvation","GlyphOfTheAsceticCrusader","GlyphOfTheLongWord","GlyphOfTurnEvil","PaladinMinorGlyph","GlyphOfBlessingOfKings","GlyphOfBlessingOfMight","GlyphOfInsight","GlyphOfJustice","GlyphOfRighteousness","GlyphOfTruth","priestTalentsConfig","priestGlyphsConfig","PriestPrimeGlyph","GlyphOfDispersion","GlyphOfFlashHeal","GlyphOfGuardianSpirit","GlyphOfLightwell","GlyphOfMindFlay","GlyphOfPenance","GlyphOfPowerWordBarrier","GlyphOfPowerWordShield","GlyphOfPrayerOfHealing","GlyphOfRenew","GlyphOfShadowWordDeath","GlyphOfShadowWordPain","PriestMajorGlyph","GlyphOfCircleOfHealing","GlyphOfDesperation","GlyphOfDispelMagic","GlyphOfDivineAccuracy","GlyphOfFade","GlyphOfFearWard","GlyphOfHolyNova","GlyphOfInnerFire","GlyphOfMassDispel","GlyphOfPrayerOfMending","GlyphOfPsychicHorror","GlyphOfPsychicScream","GlyphOfScourgeImprisonment","GlyphOfSmite","GlyphOfSpiritTap","PriestMinorGlyph","GlyphOfFading","GlyphOfFortitude","GlyphOfLevitate","GlyphOfShackleUndead","GlyphOfShadow","GlyphOfShadowProtection","GlyphOfShadowfiend","rogueTalentsConfig","rogueGlyphsConfig","RoguePrimeGlyph","GlyphOfAdrenalineRush","GlyphOfBackstab","GlyphOfEviscerate","GlyphOfHemorrhage","GlyphOfKillingSpree","GlyphOfMutilate","GlyphOfRevealingStrike","GlyphOfRupture","GlyphOfShadowDance","GlyphOfSinisterStrike","GlyphOfSliceAndDice","GlyphOfVendetta","RogueMajorGlyph","GlyphOfAmbush","GlyphOfBladeFlurry","GlyphOfBlind","GlyphOfCloakOfShadows","GlyphOfCripplingPoison","GlyphOfDeadlyThrow","GlyphOfEvasion","GlyphOfExposeArmor","GlyphOfFanOfKnives","GlyphOfFeint","GlyphOfGarrote","GlyphOfGouge","GlyphOfKick","GlyphOfPreparation","GlyphOfSap","GlyphOfSprint","GlyphOfTricksOfTheTrade","GlyphOfVanish","RogueMinorGlyph","GlyphOfBlurredSpeed","GlyphOfDistract","GlyphOfPickLock","GlyphOfPickPocket","GlyphOfPoisons","GlyphOfSafeFall","shamanTalentsConfig","shamanGlyphsConfig","ShamanPrimeGlyph","GlyphOfEarthShield","GlyphOfEarthlivingWeapon","GlyphOfFeralSpirit","GlyphOfFireElementalTotem","GlyphOfFlameShock","GlyphOfFlametongueWeapon","GlyphOfLavaBurst","GlyphOfLavaLash","GlyphOfLightningBolt","GlyphOfRiptide","GlyphOfShocking","GlyphOfStormstrike","GlyphOfUnleashedLightning","GlyphOfWaterShield","GlyphOfWindfuryWeapon","ShamanMajorGlyph","GlyphOfChainHeal","GlyphOfChainLightning","GlyphOfElementalMastery","GlyphOfFireNova","GlyphOfFrostShock","GlyphOfGhostWolf","GlyphOfGroundingTotem","GlyphOfHealingStreamTotem","GlyphOfHealingWave","GlyphOfHex","GlyphOfLightningShield","GlyphOfShamanisticRage","GlyphOfStoneclawTotem","GlyphOfThunder","GlyphOfTotemicRecall","ShamanMinorGlyph","GlyphOfAstralRecall","GlyphOfRenewedLife","GlyphOfTheArcticWolf","GlyphOfThunderstorm","GlyphOfWaterBreathing","GlyphOfWaterWalking","warlockTalentsConfig","warlockGlyphsConfig","WarlockPrimeGlyph","GlyphOfBaneOfAgony","GlyphOfChaosBolt","GlyphOfConflagrate","GlyphOfCorruption","GlyphOfFelguard","GlyphOfHaunt","GlyphOfImmolate","GlyphOfImp","GlyphOfIncinerate","GlyphOfLashOfPain","GlyphOfMetamorphosis","GlyphOfShadowburn","GlyphOfUnstableAffliction","WarlockMajorGlyph","GlyphOfDeathCoilWl","GlyphOfDemonicCircle","GlyphOfFear","GlyphOfFelhunter","GlyphOfHealthstone","GlyphOfHowlOfTerror","GlyphOfLifeTap","GlyphOfSeduction","GlyphOfShadowBolt","GlyphOfShadowflame","GlyphOfSoulLink","GlyphOfSoulSwap","GlyphOfSoulstone","GlyphOfVoidwalker","WarlockMinorGlyph","GlyphOfCurseOfExhaustion","GlyphOfDrainSoul","GlyphOfEyeOfKilrogg","GlyphOfHealthFunnel","GlyphOfRitualOfSouls","GlyphOfSubjugateDemon","GlyphOfUnendingBreath","warriorTalentsConfig","warriorGlyphsConfig","WarriorPrimeGlyph","GlyphOfBladestorm","GlyphOfBloodthirst","GlyphOfDevastate","GlyphOfMortalStrike","GlyphOfOverpower","GlyphOfRagingBlow","GlyphOfRevenge","GlyphOfShieldSlam","GlyphOfSlam","WarriorMajorGlyph","GlyphOfCleaving","GlyphOfColossusSmash","GlyphOfDeathWish","GlyphOfHeroicThrow","GlyphOfIntercept","GlyphOfIntervene","GlyphOfLongCharge","GlyphOfPiercingHowl","GlyphOfRapidCharge","GlyphOfResonatingPower","GlyphOfShieldWall","GlyphOfShockwave","GlyphOfSpellReflection","GlyphOfSunderArmor","GlyphOfSweepingStrikes","GlyphOfThunderClap","GlyphOfVictoryRush","WarriorMinorGlyph","GlyphOfBattle","GlyphOfBerserkerRage","GlyphOfBloodyHealing","GlyphOfCommand","GlyphOfDemoralizingShout","GlyphOfEnduringVictory","GlyphOfFuriousSundering","GlyphOfIntimidatingShout","GlyphOfShatteringThrow","classTalentsConfig","ClassDeathKnight","ClassDruid","ClassShaman","ClassHunter","ClassMage","ClassRogue","ClassPaladin","ClassPriest","ClassWarlock","ClassWarrior","talentStringToProto","talentString","talentsConfig","treeString","treeIdx","protoToTalentString","UnitMetadata","auras","spells","getName","getAuras","getSpells","newSpells","spell","newAuras","aura","newSpell","newId","anyUpdates","newAura","metadatas","newMetadatas","oldLen","SPEC_CONFIGS","getSpecConfig","_Player","IndividualBuffs","consumes","Consumes","bonusStats","Gear","enableItemSwap","itemSwapGear","ItemSwapGear","aplRotation","APLRotation","talentsString","Glyphs","reactionTime","channelClipDelay","inFrontOfTarget","distanceFromTarget","darkIntentUptime","healingModel","HealingModel","healingEnabled","autoRotationGenerator","simpleRotationGenerator","itemEPCache","gemEPCache","Map","randomSuffixEPCache","enchantEPCache","epRatios","numEpRatios","epWeights","currentStats","PlayerStats","petMetadatas","nameChangeEmitter","consumesChangeEmitter","bonusStatsChangeEmitter","gearChangeEmitter","itemSwapChangeEmitter","professionChangeEmitter","raceChangeEmitter","rotationChangeEmitter","specOptionsChangeEmitter","inFrontOfTargetChangeEmitter","distanceFromTargetChangeEmitter","healingModelChangeEmitter","epWeightsChangeEmitter","miscOptionsChangeEmitter","currentStatsEmitter","epRatiosChangeEmitter","epRefStatChangeEmitter","playerSpec","PlayerSpecs","getPlayerClass","race","races","specTypeFunctions","specOptions","optionsCreate","specConfig","friendlyName","autoRotation","simpleRotation","ItemSlot","ItemSlotRanged","getSpecIcon","specID","classID","getClassColor","hexColor","specId","isClass","classId","getRaid","getOtherPartyMembers","getItems","slot","item","canEquipItem","getRandomSuffixes","randomSuffixOptions","getRandomSuffixById","suffix","computeRandomSuffixEP","getAvailableReforgings","getAvailableReforges","getReforge","getEnchants","enchant","canEquipEnchant","getGems","socketColor","getEpWeights","setEpWeights","newEpWeights","getDefaultEpRatios","isTankSpec","isHealingSpec","defaultRatios","getEpRatios","setEpRatios","newRatios","computeStatWeights","getCurrentStats","newStats","playerPromise","petsPromise","pets","playerUpdated","petsUpdated","setName","newName","getLabel","getRace","setRace","newRace","getProfession1","setProfession1","newProfession","getProfession2","setProfession2","getProfessions","ProfessionUnknown","setProfessions","newProfessions","hasProfession","prof","isBlacksmithing","raceToFaction","getConsumes","setConsumes","newConsumes","canDualWield2H","SpecFuryWarrior","getTalents","titansGrip","equipItem","newItem","setGear","withEquippedItem","getEquippedItem","getGear","newGear","getEnableItemSwap","setEnableItemSwap","newEnableItemSwap","equipItemSwapitem","setItemSwapGear","getItemSwapItem","getItemSwapGear","newItemSwapGear","getBonusStats","setBonusStats","newBonusStats","getMeleeCritCapInfo","meleeCrit","finalStats","StatMeleeCrit","Mechanics.MELEE_CRIT_RATING_PER_CRIT_CHANCE","meleeHit","StatMeleeHit","Mechanics.MELEE_HIT_RATING_PER_HIT_CHANCE","expertise","StatExpertise","Mechanics.EXPERTISE_PER_QUARTER_PERCENT_REDUCTION","hasOffhandWeapon","ItemSlotOffHand","weaponSpeed","meleeHitCap","parryCap","getInFrontOfTarget","expertiseCap","remainingMeleeHitCap","remainingExpertiseCap","specSpecificOffset","SpecEnhancementShaman","elementalDevastation","baseCritCap","suppression","glancing","playerCritCapDelta","getMeleeCritCap","setAplRotation","newRotation","getSimpleRotation","jsonStr","simple","specRotationJson","rotationCreate","json","parse","rotationFromJson","e","setSimpleRotation","rotationEquals","SimpleRotation","rotationToJson","getSimpleCooldowns","Cooldowns","cooldowns","setSimpleCooldowns","newCooldowns","getRotationType","APLRotationType","TypeUnknown","TypeAPL","hasSimpleRotationGenerator","getResolvedAplRotation","TypeAuto","rot","TypeSimple","simpleRot","talentsCreate","newTalentsString","getTalentTree","getTalentTreeIcon","newGlyphs","getPrimeGlyps","prime1","prime2","prime3","getMajorGlyphs","major1","major2","major3","getMinorGlyphs","minor1","minor2","minor3","getAllGlyphs","getClassOptions","getSpecOptions","classOptions","setClassOptions","newClassOptions","newSpecOptions","optionsEquals","optionsCopy","setSpecOptions","getReactionTime","setReactionTime","newReactionTime","getChannelClipDelay","setChannelClipDelay","newChannelClipDelay","getDarkIntentUptime","setDarkIntentUptime","newDarkIntentUptime","setInFrontOfTarget","newInFrontOfTarget","getDistanceFromTarget","setDistanceFromTarget","newDistanceFromTarget","setDefaultHealingParams","hm","boss","cadenceSeconds","hps","enableHealing","getHealingModel","setHealingModel","newHealingModel","computeStatsEP","computeEP","computeGemEP","gem","has","epFromStats","epFromEffect","getMetaGemEffectEP","bonusEP","unique","ep","set","computeEnchantEP","effectId","randomSuffix","computeReforgingEP","reforging","fromStat","stat","addStat","fromAmount","toStat","toAmount","computeItemEP","cached","itemStats","weaponDps","getWeaponDPS","ItemSlotMainHand","withPseudoStat","PseudoStat","PseudoStatMainHandDps","PseudoStatOffHandDps","PseudoStatRangedDps","maxSuffixEP","suffixEPs","randPropPoints","bestGemEPNotMatchingSockets","gemSockets","isUnrestrictedGem","bestGemEPMatchingSockets","gemMatchesSocket","socketBonus","setWowheadData","equippedItem","curGems","ei","hasExtraSocket","filterItemData","itemData","getItemFunc","filterItems","filterFunc","itemElem","factionRestriction","UIItem_FactionRestriction","UNSPECIFIED","SourceCrafting","itemSrc","source","oneofKind","SourceQuest","srcOptionStr","difficulty","entries","DIFFICULTY_SRCS","srcOption","drop","DungeonDifficulty","DifficultyRaid10H","DifficultyRaid25H","normalDifficulty","HEROIC_TO_NORMAL","category","AL_CATEGORY_HARD_MODE","RaidVanilla","expansion","Expansion","ExpansionVanilla","RaidTbc","ExpansionTbc","raidOptionStr","zoneId","RAID_IDS","raidOption","ARMOR_SLOTS","armorType","WEAPON_SLOTS","weaponType","handType","HandType","HandTypeTwoHand","minSpeed","minMhWeaponSpeed","minOhWeaponSpeed","maxSpeed","maxMhWeaponSpeed","maxOhWeaponSpeed","rangedWeaponType","minRangedWeaponSpeed","maxRangedWeaponSpeed","filterEnchantData","enchantData","getEnchantFunc","currentEquippedItem","enchantElem","enchantAppliesToItem","filterGemData","gemData","getGemFunc","isJewelcrafting","Jewelcrafting","gemElem","requiredProfession","matchingGemsOnly","makeUnitReference","emptyUnitReference","newUnitReference","toDatabase","dbGear","dbItemSwapGear","mergeSimDatabases","exportCategories","exportCategory","cat","mergePartial","itemSwap","Talents","Rotation","hpPercentForDefensives","rotation","Miscellaneous","reactionTimeMs","channelClipDelayMs","withSpec","External","includeCategories","loadCategory","lookupItemSwap","UnitStats","optionsFromPlayer","applySharedDefaults","burstWindow","getBaseMastery","SpecFrostMage","getMasteryPerPointModifier","Mechanics.masteryPercentPerPoint","ItemSlotHead","ItemSlotShoulder","ItemSlotChest","ItemSlotWrist","ItemSlotHands","ItemSlotLegs","ItemSlotWaist","ItemSlotFeet","SourceDungeon","DifficultyNormal","SourceDungeonH","DifficultyHeroic","SourceRaid10","DifficultyRaid10","SourceRaid10H","SourceRaid25","DifficultyRaid25","SourceRaid25H","RaidNaxxramas","RaidEyeOfEternity","RaidObsidianSanctum","RaidVaultOfArchavon","RaidUlduar","RaidTrialOfTheCrusader","RaidOnyxiasLair","RaidIcecrownCitadel","RaidRubySanctum","IconEnumPicker","modObj","direction","currentValue","zeroValue","showWhen","restoreValue","storeValue","bsToggle","disableWowheadTouchTooltip","buttonElem","buttonText","dropdownMenu","numColumns","gridAutoFlow","valueConfig","optionContainer","option","updateOption","setImage","showValueWhen","storedValue","setActionImage","fillAndSet","backgroundColor","color","setActive","enabled","display","backupIconUrl","backupId","active","IconPicker","rootAnchor","prepend","useImprovedIcons","Boolean","improvedId","improvedId2","states","ia","ia2","ce","improvedAnchor","improvedAnchor2","counterElem","handleLeftClick","handleRightClick","getActionId","hidden","makeMultiIconInput","inputs","label","categoryId","makeWrappedBooleanInput","getModObject","labelTooltip","enableWhen","makeClassOptionsBooleanInput","newVal","newMessage","makeSpecOptionsBooleanInput","makeRotationBooleanInput","makeWrappedNumberInput","float","positive","makeClassOptionsNumberInput","internalConfig","percent","makeSpecOptionsNumberInput","makeRotationNumberInput","makeWrappedEnumInput","makeSpecOptionsEnumInput","makeRotationEnumInput","makeWrappedIconInput","makeBooleanIconInput","getFieldValue","setFieldValue","makeClassOptionsBooleanIconInput","makeSpecOptionsBooleanIconInput","makeMultistateIconInput","numStates","multiplier","input","sign","makeNumberIconInput","makeWrappedEnumIconInput","makeClassOptionsEnumIconInput","makeSpecOptionsEnumIconInput","buildIconInput","inputConfig","makeBooleanRaidBuffInput","InputHelpers.makeBooleanIconInput","makeBooleanIndividualBuffInput","makeBooleanConsumeInput","makeBooleanDebuffInput","makeMultistateIndividualBuffInput","InputHelpers.makeMultistateIconInput","MultiIconPicker","simUI","labelElem","hasOwnProperty","clearPicker","buildBlankOption","pickers","pickerConfig","updateButtonImage","listItem","getMaxValue","AllStatsBuff","InputHelpers.makeMultiIconInput","fromItemId","ArmorBuff","AttackPowerPercentBuff","Bloodlust","DamagePercentBuff","SpellHasteBuff","ManaBuff","CritBuff","MeleeHasteBuff","MP5Buff","ReplenishmentBuff","ResistanceBuff","SpellPowerBuff","StaminaBuff","StrengthAndAgilityBuff","RetributionAura","ManaTideTotem","Innervate","PowerInfusion","FocusMagic","TricksOfTheTrade","UnholyFrenzy","DarkIntent","MajorArmorDebuff","DamageReduction","BleedDebuff","SpellCritDebuff","MeleeAttackSpeedDebuff","PhysicalDamageDebuff","SpellDamageDebuff","JudgementOfLight","RAID_BUFFS_CONFIG","StatStamina","StatStrength","StatAgility","StatMana","StatRangedAttackPower","StatSpellCrit","StatMeleeHaste","StatSpellPower","StatSpellHaste","StatNatureResistance","StatShadowResistance","StatFrostResistance","StatMP5","RAID_BUFFS_MISC_CONFIG","DEBUFFS_CONFIG","DEBUFFS_MISC_CONFIG","EnumPicker","selectElem","ReactionTime","ChannelClipDelay","DarkIntentUptime","darkIntent","InFrontOfTarget","DistanceFromTarget","TankAssignment","findIndex","IncomingHps","HealingCadence","HealingCadenceVariation","cadenceVariation","BurstWindow","HpPercentForDefensives","InspirationUptime","inspirationUptime","NumberPicker","inputElem","onchange","parseFloat","toFixed","toString","updateSize","newSize","CharacterStats","modifyDisplayStats","overwriteDisplayStats","statOrder","table","valueElems","statName","getClassStatName","row","StatMastery","masterySpellNames","bonusStatsLink","valueElem","shouldShowMeleeCritCap","meleeCritCapValueElem","updateStats","statMods","baseStats","gearStats","talentsStats","buffsStats","consumesStats","debuffStats","getDebuffStats","baseDelta","base","gearDelta","subtract","talentsDelta","buffsDelta","consumesDelta","final","statOverwrites","withStat","getStat","masteryPoints","Mechanics.MASTERY_RATING_PER_MASTERY_POINT","bonusStatValue","contextualKlass","statLinkElemRef","statDisplayString","makeSpellUrl","masterySpellIDs","statLinkElem","tooltipContent","meleeCritCapInfo","meleeCritCapDisplayString","capDelta","deltaStats","includeBase","rawValue","getPseudoStat","PseudoStatBlockValueMultiplier","displayStr","round","StatSpellHit","Mechanics.SPELL_HIT_RATING_PER_HIT_CHANCE","Mechanics.SPELL_CRIT_RATING_PER_CRIT_CHANCE","Mechanics.HASTE_RATING_PER_HASTE_PERCENT","StatArmorPenetration","Mechanics.ARMOR_PEN_PER_PERCENT_ARMOR","StatDefense","Mechanics.CHARACTER_LEVEL","Mechanics.DEFENSE_RATING_PER_DEFENSE","StatBlock","Mechanics.BLOCK_RATING_PER_BLOCK_CHANCE","Mechanics.MISS_DODGE_PARRY_BLOCK_CRIT_CHANCE_PER_DEFENSE","StatDodge","PseudoStatDodge","StatParry","PseudoStatParry","StatResilience","Mechanics.RESILIENCE_RATING_PER_CRIT_REDUCTION_CHANCE","criticalMass","shadowAndFlame","link","popover","Popover","customClass","placement","fallbackPlacements","sanitize","content","isMeleeDpsSpec","Importer","includeFile","uploadInputId","replaceAll","textElem","descriptionElem","files","importButton","onImport","error","finishIndividualImport","charClass","equipmentSpec","talentsStr","professions","classNames","loadLeftoversIfNecessary","expectedEnchantIds","foundEnchantIds","missingEnchants","expectedId","expectedItemIds","foundItemIds","missingItems","_IndividualLinkImporter","tryParseUrlLocation","hash","substring","binary","atob","bytes","Uint8Array","charCodeAt","settingsBytes","pako","inflate","settings","IndividualSimSettings","DEFAULT_CATEGORIES","urlParams","URLSearchParams","search","CATEGORY_PARAM","char","CATEGORY_KEYS","categories","UISettings","IndividualLinkImporter","IndividualJsonImporter","fromJsonString","ignoreUnknownFields","isWithinRaidSim","Individual80UImporter","importJson","nameToClass","character","gameClass","nameToRace","Race","RaceUnknown","talentIds","spellIdIndex","talentSpellIdsToTalentString","talentJson","EquipmentSpec","itemJson","itemSpec","ItemSpec","gemJson","_IndividualWowheadGearPlannerImporter","url","match","base64Data","from","numTalentBytes","talentBytes","subarray","buf2hex","cur","numGlyphBytes","glyphBytes","gearBytes","hasGlyphs","d","glyphStr","fromCharCode","glyphIds","glyphPosition","itemId","glyphSpellToItemId","slotId","isEnchanted","numGems","highid","enchantSpellId","enchantSpellIdToEffectId","gemIdx","gemPosition","highgemid","gemId","slotIDs","ItemSlotNeck","ItemSlotBack","ItemSlotFinger1","ItemSlotFinger2","ItemSlotTrinket1","ItemSlotTrinket2","IndividualWowheadGearPlannerImporter","IndividualAddonImporter","profData","nameToProfession","majorGlyphIDs","g","glyphToID","minorGlyphIDs","gearJson","fromJson","glyphName","glyphIDStr","glyphNameToID","Exporter","options","allowDownload","downloadBtnRef","downloadString","updateContent","getData","_IndividualLinkExporter","pickersContainer","exportPickerConfigs","exportConfig","BooleanPicker","createLink","protoBytes","deflated","deflate","to","encoded","btoa","linkUrl","URL","arrayEquals","searchParams","delete","categoryCharString","IndividualLinkExporter","IndividualJsonExporter","jsonStringifyWithFlattenedPaths","path","IndividualWowheadGearPlannerExporter","raceNames","addGlyph","glyphItemId","glyphItemToSpellId","to2Bytes","val","getItemSlots","slot1","slot2","itemSlot","curEquippedGems","numSockets","binaryString","_Individual80UEPExporter","epValues","allUnitStats","UnitStat","getAll","namesToWeights","weight","getUnitStat","encodeURIComponent","isStat","statNames","pseudoStatNames","StatIntellect","StatSpirit","StatSpellPenetration","StatHealth","StatArcaneResistance","StatFireResistance","StatBonusArmor","Individual80UEPExporter","_IndividualPawnEPExporter","IndividualPawnEPExporter","IndividualCLIExporter","raidSimJson","descriptionsPromise","getEnchantDescription","fetch","response","descriptionsMap","getUniqueEnchantString","factionRestrictionsToLabels","ALLIANCE_ONLY","HORDE_ONLY","FiltersMenu","section","newSection","restriction","s","SourceUnknown","sourceNames","RaidUnknown","raidNames","section2","armorTypeNames","at","weaponTypeSection","ewt","weaponTypeNames","weaponSpeedSection","canDualWield","rangedweapontypes","rangedWeaponTypeSection","rangedWeaponTypeNames","rangedWeaponSpeedSection","defaults","rows_in_block","blocks_in_cluster","tag","show_no_data_row","no_data_class","no_data_text","keep_parity","callbacks","getStyle","prop","getComputedStyle","Clusterize","ds","params","last_cluster","scroll_debounce","pointer_events_set","resize_debounce","cache","cluster_height","item_height","content_tag","block_height","scroll_top","rows_in_cluster","displayedRows","rows","scroll_elem","content_elem","hasAttribute","setAttribute","scrollTop","getRowsHeight","insertToDom","scrollEv","resizeEv","destroy","clean","setContentElemRows","generateEmptyRow","refresh","force","getNumberOfRows","elementUpdate","cb","r","getScrollProgress","platform","pointerEvents","getClusterNum","scrollingProgress","exploreEnvironment","generate","this_cluster_rows","this_cluster_content_changed","checkChanges","top_offset_changed","top_offset","only_bottom_offset_changed","bottom_offset","layout","parity","renderExtraTag","clusterWillChange","rows_above","counterIncrement","clusterChanged","lastChild","opts","tagName","prev_item_height","nodes","node","offsetHeight","marginTop","marginBottom","rows_len","generateRows","items_start","items_end","td","empty_row","no_data_content","createTextNode","colSpan","num_rows","cluster_divider","current_cluster","max_cluster","class_name","clusterize_prefix","changed","createHeroicLabel","createGemContainer","gemIconElem","gemContainer","getEmptyGemSocketIconUrl","filledId","GearPicker","leftSide","rightSide","leftItemPickers","ItemPicker","rightItemPickers","itemPickers","ItemRenderer","root","reforgeElem","sce","socketsContainerElem","innerText","heroic","_reforging","reforge","shortSecondaryStatNames","asActionId","setBackgroundAndHref","allSocketColors","numPossibleSockets","ItemType","ItemTypeWrist","ItemTypeHands","updateProfession","_items","_enchants","_equippedItem","gearData","changeEvent","openGearSelector","openSelectorModal","slotNames","getEmptySlotIconUrl","tab","SelectorModal","selectedTab","eligibleItems","eligibleEnchants","IconItemSwapPicker","iconAnchor","SelectorModalTabs","ilists","updateReforgeList","_newReforgeData","scrollTo","top","tabsElem","contentElem","setData","openTabName","getAttribute","openTab","addTab","fromItem","baseEP","ignoreEPFilter","onEquip","withItem","EquippedItem","GemColor","GemColorUnknown","removeTabs","withEnchant","addRandomSuffixTab","addReforgingTab","addGemTabs","contentId","sizeRefresh","socketBonusEP","curSocketColors","socketIdx","withGem","gemEP","tabAnchor","emptySocketUrl","updateGemIcon","itemProto","fromRandomSuffix","withRandomSuffix","prepareReforgeData","ceil","forge","reforgeId","_item","reforgings","addReforgeTabs","reforgeData","onAdd","tabContentId","selected","bsTarget","tabContent","newReforgeData","listElement","withReforge","lossSpan","gainSpan","epSpan","equippedToItemFn","onRemove","setTabContent","ilist","ItemList","Item","is","invokeUpdate","applyFilter","hideOrShowEPValues","labelSubstring","tabElems","prototype","call","contentElems","tabElem","getElementById","emptySlotIcons","onItemClick","currentFilters","epButton","placeholder","sim2","makeShow1hWeaponsSelector","makeShow2hWeaponsSelector","makeShowEPValuesSelector","makeShowMatchingGemsSelector","startsWith","makePhaseSelector","itemsToDisplay","scroller","startIdx","endIdx","createItemElem","removeButton","simAllButton","IndividualSimUI","itemSpecs","isRangedOrTrinket","curItem","curEP","idata","bt","addItems","newEquippedItem","newItemId","newEP","epDeltaElem","listItemEP","formatDeltaTextElem","itemIdxs","sortFn","itemA","itemB","ilvl","diff","dataA","dataB","isItemFavorited","labels","container","itemEP","equippedItemID","equippedItemEP","getSourceInfo","favoriteElem","setFavorite","fav","isFavorite","favId","favoriteItems","favIdx","splice","favoriteEnchants","favoriteGems","toggle","makeAnchor","inner","crafted","professionNames","profession","zone","getZone","npc","getNpc","npcId","makeNpcUrl","difficultyNames","otherName","makeZoneUrl","quest","makeQuestUrl","width","factionNames","REP_FACTION_NAMES","rep","repFactionId","RepFaction","RepFactionUnknown","REP_LEVEL_NAMES","repLevel","soldBy","npcName","ResultsViewer","parentElem","warnings","pendingElem","warningElem","warningsLink","addWarningsLink","updateWarnings","hideAll","addWarningLink","args","classes","icon","cfg","addWarning","warning","updateOn","activeWarnings","tooltipFragment","list","outerHTML","setPending","setContent","SimTab","identifier","childNodes","navItem","buildNavItem","navLink","contentContainer","simHeader","addSimTabLink","tabFragment","buildColumn","customCssClass","column","BulkGearJsonImporter","bulkUI","lookupItemSpec","BulkSimResultRenderer","baseResult","dpsDivParent","dpsDiv","dpsNumber","formatDps","unitMetrics","dps","avg","dpsDelta","dpsDeltaSpan","formatDpsDelta","itemsContainer","talentText","talentLoadout","itemsAdded","equipBtn","itemAdded","activateTab","renderer","itemSlotName","delta","ItemSpecWithSlot","emitDefaultValues","BulkItemPicker","setItem","getEligibleItemSlots","openEnchantGemSelector","Enchants","allItems","setItems","_gems","destroyItemButton","closeX","insertBefore","opacity","alignItems","BulkTab","itemsChangedEmitter","column1","leftPanel","rightPanel","pendingDiv","pendingResults","doCombos","fastMode","autoGem","autoEnchant","savedTalents","simTalents","defaultGems","UIGem","gemIconElements","buildTabContent","loadSettings","getSettingsKey","getStorageKey","storedSettings","localStorage","getItem","BulkSettings","combinations","talentsToSim","SimGem","defaultRedGem","defaultYellowGem","defaultBlueGem","defaultMetaGem","storeSettings","createBulkSettings","setStr","iterationsPerCombo","createBulkItemsDatabase","itemsDb","SimDatabase","SimItem","UIItem","SimEnchant","UIEnchant","clearItems","setCombinations","setFastMode","handleCrash","itemsBlock","noticeWorkInProgress","itemTextIntro","itemList","resultsBlock","bulkSimResult","results","resultBlock","equippedGearResult","settingsBlock","bulkSimButton","previousContents","disabled","simStart","Date","getTime","lastTotal","rounds","currentRound","progressMetrics","msSinceStart","iterPerSecond","completedIterations","totalSims","setSimProgress","importFavsButton","itemID","searchButton","searchText","searchResults","toAdd","strID","searchString","pieces","displayCount","matched","lcName","lcSetName","piece","lcPiece","itemElement","_ev","htxt","ftxt","baseSearchHTML","getAllItems","focus","clearButton","talentsToSimDiv","talentsLabel","talentsContainerDiv","dataStr","getSavedTalentsStorageKey","jsonData","handleToggle","frag","load","chipDiv","exists","indexToRemove","savedTalentLoadout","SavedTalents","loadout","talentFragment","defaultGemDiv","gemLabel","gemSocketsDiv","GemColorRed","GemColorYellow","GemColorBlue","GemColorMeta","socketIndex","gemFragment","selector","handleChoose","openGemSelector","_color","_socketIndex","GemSelectorModal","_obj","obj","secondsRemain","totalIterations","roundsText","completedSims","onSelect","insertAdjacentHTML","Gem1","_eventID","_gem","SavedDataManager","userData","presets","frozen","contentBlock","savedDataDiv","presetDataDiv","customDataDiv","presetsOnly","buildCreateContainer","saveInput","addSavedData","newData","makeSavedData","dataArr","isPreset","oldIdx","replaceWith","dataElemFragment","dataElem","deleteFragment","deleteButton","confirm","saveUserData","checkActive","changeEmitters","savedData","storageKey","loadUserData","freeze","savedDataCreateFragment","GemSummary","updateTable","fullGemList","getAllGems","gemCounts","count","gemName","gemLinkElem","GearTab","buildGearPickers","buildGemSummary","buildSavedGearsetPicker","savedGearManager","getSavedGearStorageKey","SavedGearSet","bonusStatsStats","newSavedGear","individualConfig","presetGear","BLESSINGS_SECTION","BASIC_BIS_DISCLAIMER","actions","useIcon","curDragData","ListPicker","itemPickerPairs","hideUi","horizontalLayout","inlineMenuBar","titleTooltip","itemsDiv","actionEnabled","newItemButton","newButtonTooltip","makeActionElem","itemLabel","newList","pair","ipp","numToAdd","addNewPicker","action","allowedActions","itemContainer","itemHeader","itemPicker","newItemPicker","getSourceValue","moveButton","moveButtonTooltip","draggable","ondragstart","dataTransfer","dropEffect","effectAllowed","listPicker","dragEnterCounter","ondragenter","ondragleave","ondragover","ondrop","srcIdx","dstIdx","arrElem","copyButton","copyButtonTooltip","copyItem","deleteButtonTooltip","iconCssClass","actionElem","getItemHeaderElem","headerElem","nextElementSibling","previousElementSibling","AdaptiveStringPicker","actionIdSets","defaultLabel","getActionIDs","stackable_auras","maxStacks","icd_auras","hasIcd","exclusive_effect_auras","hasExclusiveEffect","isCastable","castable_spells","castableSpells","bucket","isMajorCooldown","placeholders","fromOtherId","OtherAction","OtherActionPotion","fromEmpty","headerText","submenu","prepullOnly","encounterOnly","non_instant_spells","hasCastTime","channel_spells","isChanneled","dot_spells","hasDot","shield_spells","hasShield","APLActionIDPicker","DropdownPicker","actionIdSet","sourceToValue","valueToSource","setOptionContent","createMissingValue","anyId","getUnitRef","defaultUnitRef","updateValues","unitRef","setOptions","unitSets","aura_sources","getUnits","petMetadata","targetMetadata","aura_sources_targets_first","targetUI","APLUnitPicker","UnitPicker","unitSet","refToValue","hideLabelWhenDefaultSelected","thisPlayer","defaultTargetIcon","petName","rmIdx","getPetIconFromName","APLPickerBuilder","fieldPickers","fields","makeFieldPicker","fieldConfig","builder","field","factory","pickerData","actionIdFieldConfig","unitRefField","ActionID","getParentValue","unitFieldConfig","booleanFieldConfig","numberFieldConfig","numberPickerConfig","stringFieldConfig","runeTypeFieldConfig","includeDeath","APLValueRuneType","RuneBlood","RuneFrost","RuneUnholy","RuneDeath","TextDropdownPicker","runeSlotFieldConfig","APLValueRuneSlot","SlotLeftBlood","SlotRightBlood","SlotLeftFrost","SlotRightFrost","SlotLeftUnholy","SlotRightUnholy","aplInputBuilder","APLValuePicker","isPrepull","allValueKinds","valueKindFactories","valueKind","includeIf","kindPicker","kind","fullDescription","shortDescription","_player","newKind","sourceValue","oldKind","newSourceValue","makeAPLValue","valuePicker","not","and","vals","or","cmp","lhs","setSourceValue","currentKind","APLValue","updateValuePicker","implVal","sourceVal","valueFieldConfig","valueListFieldConfig","oldValue","inputBuilder","AplHelpers.aplInputBuilder","const","APLValueConst","AplHelpers.stringFieldConfig","APLValueCompare","ComparisonOperator","OpEq","OpNe","OpGe","OpGt","OpLe","OpLt","math","APLValueMath","MathOperator","OpAdd","OpSub","OpMul","OpDiv","mathOperatorFieldConfig","APLValueMax","APLValueMin","APLValueAnd","APLValueOr","APLValueNot","currentTime","APLValueCurrentTime","currentTimePercent","APLValueCurrentTimePercent","remainingTime","APLValueRemainingTime","remainingTimePercent","APLValueRemainingTimePercent","isExecutePhase","APLValueIsExecutePhase","ExecutePhaseThreshold","E20","E25","E35","E90","executePhaseThresholdFieldConfig","numberTargets","APLValueNumberTargets","frontOfTarget","APLValueFrontOfTarget","bossSpellIsCasting","APLValueBossSpellIsCasting","AplHelpers.unitFieldConfig","AplHelpers.actionIdFieldConfig","bossSpellTimeToReady","APLValueBossSpellTimeToReady","currentHealth","APLValueCurrentHealth","currentHealthPercent","APLValueCurrentHealthPercent","currentMana","APLValueCurrentMana","currentManaPercent","APLValueCurrentManaPercent","currentRage","APLValueCurrentRage","currentFocus","APLValueCurrentFocus","currentEnergy","APLValueCurrentEnergy","currentComboPoints","APLValueCurrentComboPoints","currentRunicPower","APLValueCurrentRunicPower","_isPrepull","currentRuneCount","APLValueCurrentRuneCount","AplHelpers.runeTypeFieldConfig","currentNonDeathRuneCount","APLValueCurrentNonDeathRuneCount","currentRuneActive","APLValueCurrentRuneActive","AplHelpers.runeSlotFieldConfig","currentRuneDeath","APLValueCurrentRuneDeath","runeCooldown","APLValueRuneCooldown","nextRuneCooldown","APLValueNextRuneCooldown","runeSlotCooldown","APLValueRuneSlotCooldown","gcdIsReady","APLValueGCDIsReady","gcdTimeToReady","APLValueGCDTimeToReady","autoTimeToNext","APLValueAutoTimeToNext","spellCurrentCost","APLValueSpellCurrentCost","spellCanCast","APLValueSpellCanCast","spellIsReady","APLValueSpellIsReady","spellTimeToReady","APLValueSpellTimeToReady","spellCastTime","APLValueSpellCastTime","spellTravelTime","APLValueSpellTravelTime","spellCpm","APLValueSpellCPM","spellIsChanneling","APLValueSpellIsChanneling","spellChanneledTicks","APLValueSpellChanneledTicks","APLValueChannelClipDelay","auraIsActive","APLValueAuraIsActive","auraIsActiveWithReactionTime","APLValueAuraIsActiveWithReactionTime","auraRemainingTime","APLValueAuraRemainingTime","auraNumStacks","APLValueAuraNumStacks","auraInternalCooldown","APLValueAuraInternalCooldown","auraIcdIsReadyWithReactionTime","APLValueAuraICDIsReadyWithReactionTime","auraShouldRefresh","APLValueAuraShouldRefresh","maxOverlap","dotIsActive","APLValueDotIsActive","dotRemainingTime","APLValueDotRemainingTime","dotTickFrequency","APLValueDotTickFrequency","sequenceIsComplete","APLValueSequenceIsComplete","sequenceIsReady","APLValueSequenceIsReady","sequenceTimeToReady","APLValueSequenceTimeToReady","totemRemainingTime","APLValueTotemRemainingTime","TotemType","Water","Earth","Air","Fire","totemTypeFieldConfig","catExcessEnergy","APLValueCatExcessEnergy","SpecFeralDruid","catNewSavageRoarDuration","APLValueCatNewSavageRoarDuration","warlockShouldRecastDrainSoul","APLValueWarlockShouldRecastDrainSoul","warlockShouldRefreshCorruption","APLValueWarlockShouldRefreshCorruption","APLActionPicker","conditionPicker","AplValues.APLValuePicker","condition","srcVal","APLAction","actionDiv","allActionKinds","actionKindFactories","actionKind","makeAPLAction","actionPicker","sequence","strictSequence","newActionKind","updateActionPicker","actionListFieldConfig","castSpell","APLActionCastSpell","multidot","APLActionMultidot","maxDots","AplHelpers.numberFieldConfig","AplValues.valueFieldConfig","multishield","APLActionMultishield","maxShields","channelSpell","APLActionChannelSpell","interruptIf","AplHelpers.booleanFieldConfig","autocastOtherCooldowns","APLActionAutocastOtherCooldowns","wait","APLActionWait","waitUntil","APLActionWaitUntil","schedule","APLActionSchedule","innerAction","actionFieldConfig","APLActionSequence","resetSequence","APLActionResetSequence","APLActionStrictSequence","changeTarget","APLActionChangeTarget","activateAura","APLActionActivateAura","cancelAura","APLActionCancelAura","triggerIcd","APLActionTriggerICD","itemSwapEnabledSpecs","APLActionItemSwap","ItemSwapSet","Swap1","Main","itemSwapSetFieldConfig","customRotation","APLActionCustomRotation","catOptimalRotationAction","APLActionCatOptimalRotationAction","rotationType","FeralDruid_Rotation_AplType","SingleTarget","maintainFaerieFire","manualParams","minRoarOffset","ripLeeway","useRake","useBite","biteTime","Aoe","AplHelpers.rotationTypeFieldConfig","APLRotationPicker","modPlayer","prepullActions","APLPrepullAction","doAtValue","oldItem","APLPrepullActionPicker","priorityList","APLListItem","APLListItemPicker","itemHeaderElem","makeListItemWarnings","rotationStats","hidePicker","HidePicker","doAtPicker","getWarnings","warningsElem","warningsTooltip","visibility","formattedWarnings","w","replaceAllInString","NumberListPicker","CooldownsPicker","cooldownPickers","cooldown","makeActionPicker","makeTimingsPicker","deleteButtonFragment","cooldownIndex","availableCooldowns","ActionIdProto","cooldownAction","Cooldown","timings","curCooldown","RotationTab","updateSections","buildAutoContent","buildAplContent","buildSimpleContent","buildSavedDataPickers","rotType","rotationInputs","rotationIconGroup","newGroupContainer","rotationIconInputs","configureIconSection","iconInput","IconInputs.buildIconInput","configureInputSection","querySelectorAll","cooldownsContentBlock","sectionElem","sectionConfig","iconPickers","adjustColumns","savedRotationsManager","getSavedRotationStorageKey","SavedRotation","rotations","presetRotation","rotData","EncounterPicker","modEncounter","addEncounterFieldPickers","showExecuteProportion","presetTargets","getAllPresetTargets","pe","equalTargetsIgnoreInputs","isIndividualSim","targetIndex","ti","makeTargetInputsPicker","advancedButton","AdvancedEncounterModal","addHeader","targetsElem","encounter2","TargetPicker","presetEncounters","getAllPresetEncounters","getTarget","section1","section3","aiPicker","TargetInput","levelPicker","mobTypePicker","mobTypeEnumValues","tankIndexPicker","targetInputPickers","statPickers","ALL_TARGET_STATS","statData","swingSpeedPicker","minBaseDamagePicker","damageSpreadPicker","damageSpread","dualWieldPicker","reverse","dwMissPenaltyPicker","parryHastePicker","spellSchoolPicker","SpellSchoolArcane","SpellSchoolFire","SpellSchoolFrost","SpellSchoolHoly","SpellSchoolNature","SpellSchoolShadow","statValue","totalStats","curStats","TargetInputPicker","getTargetInput","targetInputIndex","boolPicker","numberPicker","boolValue","numberValue","inputType","InputType","Bool","durationGroup","executeGroup","target1","target2","modTarget2","MobTypeUnknown","MobTypeBeast","MobTypeDemon","MobTypeDragonkin","MobTypeElemental","MobTypeHumanoid","MobTypeMechanical","MobTypeUndead","relevantStatOptions","includeBuffDebuffInputs","excludeBuffDebuffInputs","ItemSwapPicker","itemSlots","enableItemSwapPicker","swapPickerContainer","noteElem","note","toggleEnabled","itemSwapContainer","swapButtonFragment","swapButton","swapWithGear","newIsg","gearItem","swapItem","makeConsumeInputFactory","consumesFieldName","onSet","ConjuredDarkRune","Conjured","ConjuredFlameCap","ConjuredHealthstone","CONJURED_CONFIG","ConjuredRogueThistleTea","makeConjuredInput","EXPLOSIVES_CONFIG","Explosive","ExplosiveSaroniteBomb","ExplosiveCobaltFragBomb","makeExplosivesInput","Engineering","ThermalSapper","ExplosiveDecoy","TINKERS_HANDS_CONFIG","TinkerHands","TinkerHandsSynapseSprings","TinkerHandsQuickflipDeflectionPlates","TinkerHandsTazikShocker","TinkerHandsSpinalHealingInjector","TinkerHandsZ50ManaGulper","makeTinkerHandsInput","FlaskOfTitanicStrength","Flask","FlaskOfTheWinds","FlaskOfSteelskin","FlaskOfFlowingWater","FlaskOfTheDraconicMind","FlaskOfTheFrostWyrm","FlaskOfEndlessRage","FlaskOfPureMojo","FlaskOfStoneblood","LesserFlaskOfToughness","LesserFlaskOfResistance","FLASKS_CONFIG","makeFlasksInput","battleElixir","BattleElixir","BattleElixirUnknown","guardianElixir","GuardianElixir","GuardianElixirUnknown","ElixirOfTheMaster","ElixirOfMightySpeed","ElixirOfImpossibleAccuracy","ElixirOfTheCobra","ElixirOfTheNaga","GhostElixir","ElixirOfAccuracy","ElixirOfArmorPiercing","ElixirOfDeadlyStrikes","ElixirOfExpertise","ElixirOfLightningSpeed","ElixirOfMightyAgility","ElixirOfMightyStrength","GurusElixir","SpellpowerElixir","WrathElixir","ElixirOfDemonslaying","BATTLE_ELIXIRS_CONFIG","makeBattleElixirsInput","flask","FlaskUnknown","ElixirOfDeepEarth","PrismaticElixir","ElixirOfMightyDefense","ElixirOfMightyFortitude","ElixirOfMightyMageblood","ElixirOfMightyThoughts","ElixirOfProtection","ElixirOfSpirit","GUARDIAN_ELIXIRS_CONFIG","makeGuardianElixirsInput","FoodFishFeast","Food","FoodGreatFeast","FoodBlackenedDragonfin","FoodHeartyRhino","FoodMegaMammothMeal","FoodSpicedWormBurger","FoodRhinoliciousWormsteak","FoodImperialMantaSteak","FoodSnapperExtreme","FoodMightyRhinoDogs","FoodFirecrackerSalmon","FoodCuttlesteak","FoodDragonfinFilet","FoodBlackenedBasilisk","FoodGrilledMudfish","FoodRavagerDog","FoodRoastedClefthoof","FoodSpicyHotTalbuk","FoodSkullfishSoup","FoodFishermansFeast","FoodSeafoodMagnifiqueFeast","FoodSeafoodFeast","FoodFortuneCookie","FoodSeveredSagefishHead","FoodSeveredSagefish","FoodBeerBastedCrocolisk","FoodBeerBasedCrocolisk","FoodBakedRockfish","FoodBasiliskLiverdog","FoodBlackbellySushi","FoodSkeweredEll","FoodSkeweredEel","FoodCrocoliskAuGratin","FoodDeliciousSagefishTail","FoodMushroomSauceMudfish","FoodGrilledDragon","FoodLavascaleMinestrone","FOOD_CONFIG","makeFoodInput","PetFood","PetFoodSpicedMammothTreats","GolembloodPotion","Potions","PotionOfTheTolvir","PotionOfConcentration","VolcanicPotion","EarthenPotion","MightyRejuvenationPotion","MythicalHealingPotion","MythicalManaPotion","PotionOfSpeed","HastePotion","MightyRagePotion","POTIONS_CONFIG","PRE_POTIONS_CONFIG","makePotionsInput","makePrepopPotionsInput","ConsumesPicker","settingsTab","buildPotionsPicker","buildElixirsPicker","buildFoodPicker","buildEngPicker","buildPetPicker","potionsElem","prePotOptions","ConsumablesInputs.makePrepopPotionsInput","ConsumablesInputs.PRE_POTIONS_CONFIG","prePotPicker","potionsOptions","ConsumablesInputs.makePotionsInput","ConsumablesInputs.POTIONS_CONFIG","potionsPicker","conjuredOptions","ConsumablesInputs.makeConjuredInput","ConsumablesInputs.CONJURED_CONFIG","conjuredPicker","updateRow","flasksElem","battleElixirsElem","guardianElixirsElem","flasksOptions","ConsumablesInputs.makeFlasksInput","ConsumablesInputs.FLASKS_CONFIG","battleElixirOptions","ConsumablesInputs.makeBattleElixirsInput","ConsumablesInputs.BATTLE_ELIXIRS_CONFIG","guardianElixirOptions","ConsumablesInputs.makeGuardianElixirsInput","ConsumablesInputs.GUARDIAN_ELIXIRS_CONFIG","foodsElem","foodOptions","ConsumablesInputs.makeFoodInput","ConsumablesInputs.FOOD_CONFIG","engiConsumesElem","tinkerOptions","ConsumablesInputs.makeTinkerHandsInput","ConsumablesInputs.TINKERS_HANDS_CONFIG","tinkerPicker","decoyPicker","ConsumablesInputs.ExplosiveDecoy","sapperPicker","ConsumablesInputs.ThermalSapper","explosiveOptions","ConsumablesInputs.makeExplosivesInput","ConsumablesInputs.EXPLOSIVES_CONFIG","explosivePicker","petConsumeInputs","petConsumesElem","rowElem","SettingsTab","column2","column3","column4","buildEncounterSettings","buildPlayerSettings","buildCustomSettingsSections","buildConsumesSection","buildOtherSettings","buildBuffsSettings","buildDebuffsSettings","encounterPicker","playerIconGroup","playerIconInputs","playerInputs","professionGroup","customSections","customSection","otherInputs","swapSlots","itemSwapSlots","buffOptions","BuffDebuffInputs.RAID_BUFFS_CONFIG","miscBuffOptions","BuffDebuffInputs.RAID_BUFFS_MISC_CONFIG","debuffOptions","BuffDebuffInputs.DEBUFFS_CONFIG","miscDebuffOptions","BuffDebuffInputs.DEBUFFS_MISC_CONFIG","savedEncounterManager","getSavedEncounterStorageKey","SavedEncounter","newEncounter","savedSettingsManager","getSavedSettingsStorageKey","SavedSettings","playerBuffs","newSettings","ItemSwap","makePetTypeInputConfig","InputHelpers.makeClassOptionsEnumIconInput","PetType","PetNone","fromPetName","Bat","Bear","BirdOfPrey","Boar","CarrionBird","Cat","Chimaera","CoreHound","Crab","Crocolisk","Devilsaur","Dragonhawk","Gorilla","Hyena","Moth","NetherRay","Raptor","Ravager","Rhino","Scorpid","Serpent","Silithid","Spider","SpiritBeast","SporeBat","Tallstrider","Turtle","WarpStalker","Wasp","WindSerpent","Wolf","Worm","petCategories","categoryOrder","categoryClasses","cunningDefault","HunterPetTalents","serpentSwiftness","dive","owlsFocus","spikedCollar","cullingTheHerd","feedingFrenzy","roarOfRecovery","wolverineBite","wildHunt","ferocityDefault","bloodthirsty","spidersBite","rabid","callOfTheWild","sharkAttack","defaultTalents","charge","boarsSpeed","thunderstomp","graceOfTheMantis","roarOfSacrifice","intervene","ferocityBMDefault","petTalentsConfig","HunterPet","petTalents","petType","petCategory","categoryIdx","getPetTalentsConfig","HunterPetTalentsPicker","curCategory","getCategoryFromPlayer","curTalents","getPetTalentsFromPlayer","savedSets","talentsContainer","pet","_category","pickerContainer","pet2","TalentsTab","buildHunterPickers","buildTalentsPicker","buildSavedTalentsPicker","playerTab","petTab","buildHunterPetPicker","savedTalentsManager","newTalents","_EpWeightsMenu","baseConfig","getModalConfig","showAllStats","statsType","tableBody","resultsElem","resultsViewer","updateType","getNameFromStat","getStatFromName","updateEpRefStat","prevEpSimResult","calculateEp","getPrevSimResult","epSelect","Option","dpsRefStat","getDpsEpRefStat","healRefStat","getHealEpRefStat","tankRefStat","getTankEpRefStat","optimizeGemsButton","getBoundingClientRect","optimizeGems","calcButton","prevEpIterations","colActionButtons","makeUpdateWeights","weightsFunc","epRefStat","refStatName","weights","tps","dtps","tmi","pDeath","showAllStatsContainer","menu","makeEpRatioCell","cell","updateButton","scaledDpsEp","scale","scaledHpsEp","scaledTpsEp","scaledDtpsEp","scaledTmiEp","scaledPDeathEp","newEp","scaledDpsWeights","scaledHpsWeights","scaledTpsWeights","scaledDtpsWeights","scaledTmiWeights","scaledPDeathWeights","newWeights","epUnitStats","isPseudoStat","makeTableRow","rowTotalEp","getProtoValue","scaledEpValue","makeTableRowCells","currentEpCell","withUnitStat","epTotal","epRatio","weightCell","epCell","weightAvg","weightStdev","weightsStdev","makeTableCellContents","epAvg","epStdev","epValuesStdev","template","epDelta","epAvgElem","stdev","stDevToConf90","normaliseValue","refStat","refUnitStat","refWeight","refStdev","setProtoValue","valueStdev","allGems","optimizedGear","optimizeGemsForWeights","unrestrictedGems","Gems.isUnrestrictedGem","bestGemForColor","bestGemForColorEP","bestGemForSocket","bestGemForSocketEP","bestGem","bestGemEP","findBestGems","asMap","socketBonusEPs","socketColors","allSockets","itemSlotStr","threeSocketCombos","permutations","calculateGearGemsEP","statsFromGems","jcGems","bestJcGemForColor","bestJcGemForColorEP","bestJcGemForSocket","bestJcGemForSocketEP","bestJcGem","bestJcGemEP","bestGear","bestGearEP","socketCombo","curItems","gemColor","curGear","hasActiveMetaGem","curGearEP","metaGem","getMetaGem","Gems.getMetaGemCondition","isCompareColorCondition","colorCombos","getColorCombosToSatisfyCondition","colorCombo","isOneOfEach","Gems.PRIMARY_COLORS","GemColorPrismatic","Gems.SECONDARY_COLORS","secondaryColor","remainingColor","Gems.socketToMatchingColors","matchingColor","isTwoAndOne","oneColor","minRed","minYellow","minBlue","twoColor","Gems.gemColorMatchesSocket","partialCombo","isThreeOfAColor","threeColor","matchingColors","combinationsWithDups","gemList","Gems.GEM_COLORS","GEM_COLORS","Gems.gemMatchesSocket","EpWeightsMenu","LaunchStatus","LaunchStatus2","raidSimStatus","Phase","Phase1","status","simLaunchStatuses","SpecUnknown","SpecBloodDeathKnight","SpecFrostDeathKnight","SpecUnholyDeathKnight","SpecBalanceDruid","SpecRestorationDruid","SpecMarksmanshipHunter","SpecSurvivalHunter","SpecArcaneMage","SpecFireMage","SpecHolyPaladin","SpecProtectionPaladin","SpecRetributionPaladin","SpecDisciplinePriest","SpecHolyPriest","SpecShadowPriest","SpecAssassinationRogue","SpecCombatRogue","SpecSubtletyRogue","SpecElementalShaman","SpecRestorationShaman","SpecAfflictionWarlock","SpecDemonologyWarlock","SpecDestructionWarlock","SpecArmsWarrior","SpecProtectionWarrior","SettingsMenu","restoreDefaultsButton","langs","wowheadSupportedLanguages","defaultLang","reload","SocialLinks","buildDiscordLink","anchor","bsTitle","buildGitHubLink","buildPatreonLink","SimHeader","simTabsContainer","simToolbar","knownIssuesContent","knownIssuesLink","addKnownIssuesLink","addBugReportLink","addDownloadBinaryLink","addSimOptionsLink","addSocialLinks","IntersectionObserver","intersectionRatio","threshold","observe","isFirstTab","addImportLink","onClick","hideInRaidSim","addImportExportLink","addExportLink","menuElem","addToolbarLink","addKnownIssue","issue","getInstance","resp","versionInfo","outdated","catch","_error","addDiscordLink","addGitHubLink","addPatreonLink","customRootElement","bsDisplay","SimTitleDropdown","currentSpec","rootLinkArgs","rootLink","buildRootSimLink","noDropdown","buildDropdown","Alpha","raidListItem","buildRaidLink","naturalOrder","buildClassDropdown","dropdownFragment","classLink","buildClassLink","buildSpecLink","iconPath","getSimIconPath","textKlass","getContextualKlass","raidSimLabel","getFullSpecName","launchStatusLabel","raidSimSiteUrl","simLink","Launched","Unlaunched","raidSimIcon","textCssClassForClass","textCssClassForSpec","globalKnownIssues","SimUI","cssScheme","noticeText","simContentContainer","simMain","updateShowDamageMetrics","updateShowThreatMetrics","updateShowHealingMetrics","updateShowEpRatios","updateShowExperimental","addKnownIssues","titleElem","simActionsContainer","iterationsPicker","resultsViewerElem","socialsContainer","simTabContentsContainer","runSimOnce","addAction","actFn","tabContentFragment","addSimTab","statusStr","simStatus","Beta","knownIssues","getSettingsStorageKey","runSim","alertStr","hashCode","toLink","issues","total_count","html_url","maxBodyLength","issueBody","truncated","lastIndexOf","CrashModal","fetchErr","len","registerSpecConfig","registerPlayerConfig","raidSimResultsManager","getMetaGemConditionDescription","failedProfReqs","getFailedProfessionRequirements","fpr","getJCGems","talentPoints","getTalentPoints","addSidebarComponents","addGearTab","addBulkTab","addSettingsTab","addTalentsTab","addRotationTab","addDetailedResultsTab","addTopbarComponents","initEventID","savedSettings","urlParseResults","Importers.IndividualLinkImporter","addRaidSimAction","displayStats","bulkTab","EmbeddedDetailedResults","_parent","Importers.IndividualJsonImporter","Importers.Individual80UImporter","Importers.IndividualWowheadGearPlannerImporter","Importers.IndividualAddonImporter","Exporters.IndividualLinkExporter","Exporters.IndividualJsonExporter","Exporters.IndividualWowheadGearPlannerExporter","Exporters.Individual80UEPExporter","Exporters.IndividualPawnEPExporter","Exporters.IndividualCLIExporter","tankSpec","healingSpec","individualBuffs","other","keyPart","getLocalStorageKey","epWeightsStats","missingRatios","makePresetGear","conditions","talentTree","talentTrees","customCondition","Tooltips.BASIC_BIS_DISCLAIMER","cond","makePresetGearHelper","makePresetAPLRotation","rotationJson","makePresetRotationHelper","makePresetSimpleRotation"],"mappings":"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"}